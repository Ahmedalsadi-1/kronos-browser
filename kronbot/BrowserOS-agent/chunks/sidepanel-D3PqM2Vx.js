import{c as pe,r as h,j as n,a as F,_ as At,I as de,X as Mt,q as Rt,d as it,z as Pa,A as Da,B as Oa,E as La,a9 as Fa,H as $a,S as Ba,G as Ua,L as za,aa as Za,ab as Va,ac as K,ad as w,ae as Ae,af as Pt,ag as qa,ah as Je,ai as L,aj as j,ak as q,al as te,am as Ja,an as Se,ao as Ha,ap as Wa,aq as R,ar as Ga,g as Ka,s as Ya,a0 as Xa,a1 as Qa,a2 as er,a4 as tr,a5 as ar,w as rr,a6 as sr,a7 as nr,a8 as or}from"./product_logo-CblUR3bH.js";import{G as Dt,u as ir,P as Ot,a as lr,b as Lt,C as Ft,c as $t,d as Bt,e as Ut,f as zt,T as cr,g as ur,h as dr,i as pr,F as mr,j as fr,k as hr,l as gr}from"./personalizationStorage-Nkj6qoAO.js";import{t as ee,J as vr,n as yr,o as xr,d as br,p as Qe,T as Sr,q as Zt,r as Vt,v as qt,G as Er,x as wr,y as Fe,e as Tr,B as Jt,E as Ht,F as et,b as Ir,M as Nr,H as _r,I as jr,K as Cr,L as kr,N as Ar,S as Mr}from"./mermaid-NA5CF7SZ-DoFU6Vfk.js";import{j as ne,R as Rr,S as Pr,B as Wt,P as Gt,a as Dr,I as Or,M as Lr,Z as _,u as Fr,b as $r,c as Br}from"./storage-DaDrvY5F.js";import{M as Ur,S as zr}from"./settings-SYN6R1-B.js";import{Z as Zr,p as Vr,A as qr}from"./productUrls-DozRAWps.js";import{L as Jr,m as He,A as Hr}from"./proxy-CNXdqEqr.js";import"./_arrayReduce-DA9huR5Z.js";import"./isArray-u3hEW1hi.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"850560cdfb5607663c662c646ed9e0458a773f78"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b886ab52-a12c-4616-a946-43a1b16058f9",e._sentryDebugIdIdentifier="sentry-dbid-b886ab52-a12c-4616-a946-43a1b16058f9")})()}catch{}const Wr=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Gr=pe("brain",Wr);const Kr=[["path",{d:"M10.1 2.182a10 10 0 0 1 3.8 0",key:"5ilxe3"}],["path",{d:"M13.9 21.818a10 10 0 0 1-3.8 0",key:"11zvb9"}],["path",{d:"M17.609 3.721a10 10 0 0 1 2.69 2.7",key:"1iw5b2"}],["path",{d:"M2.182 13.9a10 10 0 0 1 0-3.8",key:"c0bmvh"}],["path",{d:"M20.279 17.609a10 10 0 0 1-2.7 2.69",key:"1ruxm7"}],["path",{d:"M21.818 10.1a10 10 0 0 1 0 3.8",key:"qkgqxc"}],["path",{d:"M3.721 6.391a10 10 0 0 1 2.7-2.69",key:"1mcia2"}],["path",{d:"M6.391 20.279a10 10 0 0 1-2.69-2.7",key:"1fvljs"}]],Yr=pe("circle-dashed",Kr);const Xr=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],Qr=pe("github",Xr);const es=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],ts=pe("square-stop",es);const as=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],rs=pe("thumbs-down",as);const ss=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],ns=pe("thumbs-up",ss),$e={MESSAGE_THRESHOLD:15,SAMPLING_DIVISOR:1},os=e=>!(e.surveyTaken||e.messageCount<$e.MESSAGE_THRESHOLD||e.messageCount%$e.MESSAGE_THRESHOLD!==0||e.samplingId%$e.SAMPLING_DIVISOR!==0);function is(){const[e,t]=h.useState(!1);h.useEffect(()=>{ne.getValue().then(async u=>{if(u.samplingId===-1){const o={...u,samplingId:Math.floor(Math.random()*100)};await ne.setValue(o)}})},[]);const a=h.useCallback(async()=>{const u=await ne.getValue(),o={...u,messageCount:u.messageCount+1};await ne.setValue(o)},[]),r=h.useCallback(async()=>{const u=await ne.getValue();os(u)&&(ee(vr,{messageCount:u.messageCount}),t(!0))},[]),s=h.useCallback(async()=>{const u=await ne.getValue();ee(yr,{messageCount:u.messageCount}),t(!1),window.open("/options.html?page=survey","_blank")},[]),l=h.useCallback(async()=>{const u=await ne.getValue();ee(xr,{messageCount:u.messageCount}),t(!1)},[]);return{popupVisible:e,recordMessageSent:a,triggerIfEligible:r,onTakeSurvey:s,onDismiss:l}}const ls=[{display:"Summarize this page",prompt:"Read the current tab and summarize it in bullet points",icon:"âœ¨"},{display:"What topics does this page talk about?",prompt:"Read the current tab and briefly describe what it is about in 1-2 lines",icon:"ðŸ”"},{display:"Extract comments from this page",prompt:"Read the current tab and extract comments as bullet points",icon:"ðŸ’¬"}],cs=[{display:"Read about our vision and upvote",prompt:"Go to https://dub.sh/browseros-launch in current tab. Find and click the upvote button",icon:"â¤ï¸"},{display:"Support BrowserOS on Github",prompt:"Go to http://git.new/browseros in current tab and star the repository",icon:"â­"},{display:"Open amazon.com and order Sensodyne toothpaste",prompt:"Open amazon.com in current tab and add sensodyne toothpaste to cart",icon:"ðŸ›’"}],us=({mode:e,mounted:t,onSuggestionClick:a})=>{const r=e==="chat"?ls:cs;return n.jsxs("div",{className:F("m-0! flex h-full flex-col items-center justify-center space-y-4 text-center opacity-0 transition-all duration-700",t?"translate-y-0 opacity-100":"translate-y-4 opacity-0"),children:[n.jsx("div",{className:"mb-2 flex h-14 w-14 items-center justify-center rounded-2xl bg-muted/50",children:n.jsx(At,{className:"h-7 w-7 text-[var(--accent-orange)]"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"mb-1 font-semibold text-lg",children:e==="chat"?"Chat with this page":"Agent at your service"}),n.jsx("p",{className:"max-w-[200px] text-muted-foreground text-xs",children:e==="chat"?"Ask questions about the current page or any topic":"Let AI automate tasks and browse for you"})]}),n.jsx("div",{className:"mt-6 grid w-full max-w-[260px] grid-cols-1 gap-2",children:r.map(s=>n.jsxs("button",{type:"button",onClick:()=>a(s.prompt),className:"group flex items-center justify-between rounded-lg border border-border/50 bg-card px-3 py-2.5 text-left text-xs transition-all duration-200 hover:border-[var(--accent-orange)]/50 hover:bg-[var(--accent-orange)]/5",children:[s.display,n.jsx("span",{className:"opacity-0 transition-opacity duration-200 group-hover:opacity-100",children:s.icon})]},s.display))})]})};function ds(e){if(e.includes("BrowserOS LLM daily limit reached"))return{text:"Add your own API key for unlimited usage.",url:"https://dub.sh/browseros-usage-limit",isRateLimit:!0};let t=e;try{const s=JSON.parse(e);s?.error?.message&&(t=s.error.message)}catch{}const r=t.match(/https?:\/\/[^\s]+/)?.[0];return r&&(t=t.replace(r,"").replace(/\s+/g," ").trim()),{text:t||"An unexpected error occurred",url:r}}const lt=({error:e,onRetry:t})=>{const{text:a,url:r,isRateLimit:s}=ds(e.message);return n.jsxs("div",{className:"mx-4 flex flex-col items-center justify-center gap-3 rounded-lg border border-destructive/30 bg-destructive/5 p-4",children:[n.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[n.jsx(br,{className:"h-5 w-5"}),n.jsx("span",{className:"font-medium text-sm",children:s?"Daily limit reached":"Something went wrong"})]}),n.jsx("p",{className:"text-center text-destructive text-xs",children:a}),s&&n.jsxs("p",{className:"text-muted-foreground text-xs",children:[n.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-foreground",children:"Learn more"})," or ",n.jsx("a",{href:"/options.html?page=survey",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-foreground",children:"take a quick survey"})]}),t&&n.jsxs(de,{variant:"outline",size:"sm",onClick:t,className:"mt-1 gap-2",children:[n.jsx(Rr,{className:"h-3.5 w-3.5"}),"Try again"]})]})},ps=({tabs:e,onRemoveTab:t})=>e.length===0?null:n.jsx("div",{className:"px-3 pt-2",children:n.jsx("div",{className:"styled-scrollbar flex items-center gap-2 overflow-x-auto pb-1",children:e.map(a=>n.jsxs("div",{className:"flex min-w-0 max-w-[200px] flex-shrink-0 items-center gap-1.5 rounded-lg border border-border bg-accent/50 px-2 py-1.5",children:[n.jsx("div",{className:"flex h-4 w-4 flex-shrink-0 items-center justify-center rounded border border-border bg-background",children:a.favIconUrl?n.jsx("img",{src:a.favIconUrl,alt:"",className:"h-3 w-3"}):n.jsx(Dt,{className:"h-3 w-3 text-muted-foreground"})}),n.jsx("div",{className:"flex-1 truncate font-medium text-foreground text-xs",children:a.title}),n.jsx("button",{type:"button",onClick:()=>t(a.id),className:"flex-shrink-0 rounded p-0.5 transition-colors hover:bg-background",title:"Remove tab",children:n.jsx(Mt,{className:"h-3 w-3 text-muted-foreground"})})]},a.id))})}),ms=({isOpen:e,filterText:t,selectedTabs:a,onToggleTab:r,onClose:s,anchorRef:l})=>{const{tabs:u,allTabs:o}=ir({enabled:e,filterText:t}),[d,i]=h.useState(0),m=h.useRef(null),c=h.useMemo(()=>new Set(a.map(y=>y.id)),[a]);return h.useEffect(()=>{i(0)},[t]),h.useEffect(()=>{if(!e)return;const y=v=>{switch(v.key){case"ArrowDown":v.preventDefault(),i(T=>T<u.length-1?T+1:T);break;case"ArrowUp":v.preventDefault(),i(T=>T>0?T-1:T);break;case"Enter":v.preventDefault(),u[d]&&r(u[d]);break;case"Escape":v.preventDefault(),s();break;case"Tab":s();break}};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[e,u,d,r,s]),h.useEffect(()=>{m.current&&d>=0&&m.current.querySelectorAll("[data-tab-item]")[d]?.scrollIntoView({block:"nearest"})},[d]),e?n.jsxs(Ot,{open:e,onOpenChange:y=>!y&&s(),children:[n.jsx(lr,{virtualRef:l}),n.jsx(Lt,{side:"top",align:"start",sideOffset:8,className:"w-[calc(100vw-24px)] max-w-[400px] p-0",onOpenAutoFocus:y=>y.preventDefault(),onCloseAutoFocus:y=>y.preventDefault(),role:"dialog","aria-label":"Select tabs to attach",children:n.jsxs(Ft,{className:"[&_svg:not([class*='text-'])]:text-muted-foreground",shouldFilter:!1,children:[n.jsxs("div",{className:"border-border/50 border-b px-3 py-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-semibold text-muted-foreground text-xs uppercase tracking-wide",children:"Attach Tabs"}),t&&n.jsxs("span",{className:"text-muted-foreground text-xs",children:['Filtering: "',t,'"']})]}),a.length>0&&n.jsxs("span",{className:"mt-1 block text-[var(--accent-orange)] text-xs",children:[a.length," tab",a.length!==1?"s":""," ","selected"]})]}),n.jsxs($t,{ref:m,className:"max-h-64 overflow-auto",role:"listbox","aria-label":"Available tabs","aria-multiselectable":"true",children:[n.jsxs(Bt,{className:"py-6 text-center",children:[n.jsx("div",{className:"text-muted-foreground text-sm",children:o.length===0?"No active tabs":`No tabs matching "${t}"`}),n.jsx("div",{className:"mt-1 text-muted-foreground/70 text-xs",children:o.length===0?"Open some web pages to attach them":"Try a different search term"})]}),n.jsx(Ut,{children:u.map((y,v)=>n.jsx(zt,{"data-tab-item":!0,value:`${y.id}`,onSelect:()=>r(y),onMouseEnter:()=>i(v),className:"p-0 data-[selected=true]:bg-transparent",children:n.jsx(cr,{tab:y,isSelected:c.has(y.id),className:v===d?"bg-accent":void 0})},y.id))})]}),n.jsx("div",{className:"border-border/50 border-t px-3 py-2",children:n.jsxs("div",{className:"flex items-center justify-between text-[10px] text-muted-foreground",children:[n.jsxs("span",{children:[n.jsx("kbd",{className:"rounded border border-border bg-muted px-1 py-0.5",children:"â†‘â†“"})," ","navigate"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"rounded border border-border bg-muted px-1 py-0.5",children:"Enter"})," ","select"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"rounded border border-border bg-muted px-1 py-0.5",children:"Esc"})," ","close"]})]})})]})})]}):null},fs=({input:e,status:t,mode:a,onInputChange:r,onSubmit:s,onStop:l,selectedTabs:u,onToggleTab:o})=>{const d=h.useRef(null),[i,m]=h.useState({isOpen:!1,filterText:"",startPosition:0}),c=h.useRef(e),y=h.useRef(i);h.useEffect(()=>{c.current=e,y.current=i});const v=h.useCallback(()=>{const f=y.current;if(f.isOpen){const b=c.current,g=b.slice(0,f.startPosition),E=b.slice(f.startPosition+1+f.filterText.length);r(g+E),m({isOpen:!1,filterText:"",startPosition:0}),requestAnimationFrame(()=>{d.current?.focus();const p=g.length;d.current?.setSelectionRange(p,p)})}},[r]),T=f=>{const g=d.current?.selectionStart??f.length;if(i.isOpen){const E=f.slice(i.startPosition+1),p=E.search(/\s/),I=p===-1?E:E.slice(0,p);g<=i.startPosition||f[i.startPosition]!=="@"?m({isOpen:!1,filterText:"",startPosition:0}):m(S=>({...S,filterText:I}))}else{const E=f[g-1],p=f.slice(0,g-1),I=/(?:^|[\s\n])$/.test(p);E==="@"&&I&&m({isOpen:!0,filterText:"",startPosition:g-1})}r(f)},x=f=>{if(i.isOpen){if(f.key==="ArrowDown"||f.key==="ArrowUp"||f.key==="Enter"||f.key==="Escape")return;if(f.key==="Tab"){f.preventDefault(),v();return}}f.key==="Enter"&&!f.shiftKey&&!f.metaKey&&!f.ctrlKey&&!f.nativeEvent.isComposing&&(f.preventDefault(),e.trim()&&f.currentTarget.form?.requestSubmit())};return h.useEffect(()=>{if(!i.isOpen)return;const f=b=>{const g=b.target;!d.current?.contains(g)&&!g.closest('[data-slot="popover-content"]')&&v()};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[i.isOpen,v]),n.jsxs("form",{onSubmit:s,className:"relative mt-2 flex w-full items-end gap-2",children:[n.jsx(ms,{isOpen:i.isOpen,filterText:i.filterText,selectedTabs:u,onToggleTab:o,onClose:v,anchorRef:d}),n.jsx("textarea",{ref:d,className:F("field-sizing-content max-h-60 min-h-[42px] flex-1 resize-none overflow-hidden rounded-2xl border border-border/50 bg-muted/50 px-4 py-2.5 pr-11 text-sm outline-none transition-colors placeholder:text-muted-foreground/70 hover:border-border focus:border-[var(--accent-orange)]"),value:e,onChange:f=>T(f.target.value),onKeyDown:x,placeholder:a==="chat"?"Ask about this page...":"What should I do?",rows:1}),t==="streaming"?n.jsxs("button",{type:"button",onClick:l,className:"absolute right-1.5 bottom-1.5 cursor-pointer rounded-full bg-red-600 p-2 text-white shadow-sm transition-all duration-200 hover:bg-red-900 disabled:cursor-not-allowed disabled:opacity-50",children:[n.jsx(ts,{className:"h-3.5 w-3.5"}),n.jsx("span",{className:"sr-only",children:"Stop"})]}):n.jsxs("button",{type:"submit",disabled:!e.trim(),className:"absolute right-1.5 bottom-1.5 cursor-pointer rounded-full bg-[var(--accent-orange)] p-2 text-white shadow-sm transition-all duration-200 hover:bg-[var(--accent-orange-bright)] disabled:cursor-not-allowed disabled:opacity-50",children:[n.jsx(Pr,{className:"h-3.5 w-3.5"}),n.jsx("span",{className:"sr-only",children:"Send"})]})]})},hs=({mode:e,onModeChange:t})=>n.jsxs("div",{className:"flex items-center rounded-full border border-border/50 bg-muted p-0.5",children:[n.jsxs("button",{type:"button",onClick:()=>t("chat"),className:F("flex items-center gap-1.5 rounded-full px-2.5 py-1.5 font-medium text-xs transition-all",e==="chat"?"bg-background text-foreground shadow-sm":"text-muted-foreground"),title:"Chat Mode",children:[n.jsx(Ur,{className:"h-3 w-3"}),n.jsx("span",{children:"Chat"})]}),n.jsxs("button",{type:"button",onClick:()=>t("agent"),className:F("flex items-center gap-1.5 rounded-full px-2.5 py-1.5 font-medium text-xs transition-all",e==="agent"?"bg-background text-foreground shadow-sm":"text-muted-foreground"),title:"Agent Mode",children:[n.jsx(Zr,{className:"h-3 w-3"}),n.jsx("span",{children:"Agent"})]})]}),gs=({mode:e,onModeChange:t,input:a,onInputChange:r,onSubmit:s,status:l,onStop:u,attachedTabs:o,onToggleTab:d,onRemoveTab:i})=>n.jsxs("footer",{className:"border-border/40 border-t bg-background/80 backdrop-blur-md",children:[n.jsx(ps,{tabs:o,onRemoveTab:i}),n.jsxs("div",{className:"p-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(hs,{mode:e,onModeChange:t}),e==="chat"&&n.jsx(ur,{selectedTabs:o,onToggleTab:d,side:"top",children:n.jsxs("button",{type:"button",className:"flex cursor-pointer items-center gap-1.5 rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground data-[state=open]:bg-accent",title:"Select tabs",children:[n.jsx(Jr,{className:"h-4 w-4"}),o.length>0&&n.jsx("span",{className:"font-medium text-[var(--accent-orange)] text-xs",children:o.length}),n.jsx(Qe,{className:"h-3 w-3"})]})})]}),n.jsx(fs,{input:a,status:l,mode:e,onInputChange:r,onSubmit:s,onStop:u,selectedTabs:o,onToggleTab:d})]})]}),vs=({children:e,providers:t,selectedProvider:a,onSelectProvider:r})=>{const[s,l]=h.useState(!1);return n.jsxs(Ot,{open:s,onOpenChange:l,children:[n.jsx(dr,{asChild:!0,children:e}),n.jsx(Lt,{side:"bottom",align:"start",className:"w-48 p-0",children:n.jsxs(Ft,{children:[n.jsx(pr,{placeholder:"Search providers...",className:"h-9"}),n.jsxs($t,{children:[n.jsx("div",{className:"my-2 px-2 font-semibold text-muted-foreground text-xs uppercase tracking-wide",children:"AI Provider"}),n.jsx(Bt,{children:"No provider found"}),n.jsx(Ut,{children:t.map(u=>{const o=a.id===u.id;return n.jsxs(zt,{value:`${u.id} ${u.name}`,onSelect:()=>{r(u),l(!1)},className:F("flex w-full items-center gap-3 rounded-md p-2 transition-colors",o&&"bg-[var(--accent-orange)]/10"),children:[n.jsx("span",{className:"text-muted-foreground",children:u.type==="browseros"?n.jsx(Wt,{size:18}):n.jsx(Gt,{type:u.type,size:18})}),n.jsx("span",{className:"flex-1 text-left text-sm",children:u.name}),o&&n.jsx(Rt,{className:"h-3.5 w-3.5 text-[var(--accent-orange)]"})]},u.id)})})]})]})})]})},ys=({selectedProvider:e,providers:t,onSelectProvider:a,onNewConversation:r,hasMessages:s})=>n.jsxs("header",{className:"flex items-center justify-between border-border/40 border-b bg-background/80 px-3 py-2.5 backdrop-blur-md",children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx(vs,{providers:t,selectedProvider:e,onSelectProvider:a,children:n.jsxs("button",{type:"button",className:"group relative inline-flex cursor-pointer items-center gap-2 rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground data-[state=open]:bg-accent",title:"Change AI Provider",children:[e.type==="browseros"?n.jsx(Wt,{size:18}):n.jsx(Gt,{type:e.type,size:18}),n.jsx("span",{className:"font-semibold text-base",children:e.name})]})})}),n.jsxs("div",{className:"flex items-center gap-1",children:[s&&n.jsx("button",{type:"button",onClick:r,className:"cursor-pointer rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground",title:"New conversation",children:n.jsx(Dr,{className:"h-4 w-4"})}),n.jsx("a",{href:Vr,target:"_blank",rel:"noopener noreferrer",className:"cursor-pointer rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground",title:"Star on Github",children:n.jsx(Qr,{className:"h-4 w-4"})}),n.jsx("a",{href:"/options.html",target:"_blank",rel:"noopener noreferrer",className:"cursor-pointer rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground",title:"Settings",children:n.jsx(zr,{className:"h-4 w-4"})}),n.jsx(Sr,{className:"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground",iconClassName:"h-4 w-4"})]})]});const xs={damping:.7,stiffness:.05,mass:1.25},bs=70,Ss=1e3/60,Es=350;let Oe=!1;globalThis.document?.addEventListener("mousedown",()=>{Oe=!0});globalThis.document?.addEventListener("mouseup",()=>{Oe=!1});globalThis.document?.addEventListener("click",()=>{Oe=!1});const ws=(e={})=>{const[t,a]=h.useState(!1),[r,s]=h.useState(e.initial!==!1),[l,u]=h.useState(!1),o=h.useRef(null);o.current=e;const d=h.useCallback(()=>{if(!Oe)return!1;const g=window.getSelection();if(!g||!g.rangeCount)return!1;const E=g.getRangeAt(0);return E.commonAncestorContainer.contains(f.current)||f.current?.contains(E.commonAncestorContainer)},[]),i=h.useCallback(g=>{c.isAtBottom=g,s(g)},[]),m=h.useCallback(g=>{c.escapedFromLock=g,a(g)},[]),c=h.useMemo(()=>{let g;return{escapedFromLock:t,isAtBottom:r,resizeDifference:0,accumulated:0,velocity:0,listeners:new Set,get scrollTop(){return f.current?.scrollTop??0},set scrollTop(E){f.current&&(f.current.scrollTop=E,c.ignoreScrollToTop=f.current.scrollTop)},get targetScrollTop(){return!f.current||!b.current?0:f.current.scrollHeight-1-f.current.clientHeight},get calculatedTargetScrollTop(){if(!f.current||!b.current)return 0;const{targetScrollTop:E}=this;if(!e.targetScrollTop)return E;if(g?.targetScrollTop===E)return g.calculatedScrollTop;const p=Math.max(Math.min(e.targetScrollTop(E,{scrollElement:f.current,contentElement:b.current}),E),0);return g={targetScrollTop:E,calculatedScrollTop:p},requestAnimationFrame(()=>{g=void 0}),p},get scrollDifference(){return this.calculatedTargetScrollTop-this.scrollTop},get isNearBottom(){return this.scrollDifference<=bs}}},[]),y=h.useCallback((g={})=>{typeof g=="string"&&(g={animation:g}),g.preserveScrollPosition||i(!0);const E=Date.now()+(Number(g.wait)||0),p=Ue(o.current,g.animation),{ignoreEscapes:I=!1}=g;let S,N=c.calculatedTargetScrollTop;g.duration instanceof Promise?g.duration.finally(()=>{S=Date.now()}):S=E+(g.duration??0);const k=async()=>{const P=new Promise(requestAnimationFrame).then(()=>{if(!c.isAtBottom)return c.animation=void 0,!1;const{scrollTop:U}=c,Q=performance.now(),me=(Q-(c.lastTick??Q))/Ss;if(c.animation||(c.animation={behavior:p,promise:P,ignoreEscapes:I}),c.animation.behavior===p&&(c.lastTick=Q),d()||E>Date.now())return k();if(U<Math.min(N,c.calculatedTargetScrollTop)){if(c.animation?.behavior===p){if(p==="instant")return c.scrollTop=c.calculatedTargetScrollTop,k();c.velocity=(p.damping*c.velocity+p.stiffness*c.scrollDifference)/p.mass,c.accumulated+=c.velocity*me,c.scrollTop+=c.accumulated,c.scrollTop!==U&&(c.accumulated=0)}return k()}return S>Date.now()?(N=c.calculatedTargetScrollTop,k()):(c.animation=void 0,c.scrollTop<c.calculatedTargetScrollTop?y({animation:Ue(o.current,o.current.resize),ignoreEscapes:I,duration:Math.max(0,S-Date.now())||void 0}):c.isAtBottom)});return P.then(U=>(requestAnimationFrame(()=>{c.animation||(c.lastTick=void 0,c.velocity=0)}),U))};return g.wait!==!0&&(c.animation=void 0),c.animation?.behavior===p?c.animation.promise:k()},[i,d,c]),v=h.useCallback(()=>{m(!0),i(!1)},[m,i]),T=h.useCallback(({target:g})=>{if(g!==f.current)return;const{scrollTop:E,ignoreScrollToTop:p}=c;let{lastScrollTop:I=E}=c;c.lastScrollTop=E,c.ignoreScrollToTop=void 0,p&&p>E&&(I=p),u(c.isNearBottom),setTimeout(()=>{if(c.resizeDifference||E===p)return;if(d()){m(!0),i(!1);return}const S=E>I,N=E<I;if(c.animation?.ignoreEscapes){c.scrollTop=I;return}N&&(m(!0),i(!1)),S&&m(!1),!c.escapedFromLock&&c.isNearBottom&&i(!0)},1)},[m,i,d,c]),x=h.useCallback(({target:g,deltaY:E})=>{let p=g;for(;!["scroll","auto"].includes(getComputedStyle(p).overflow);){if(!p.parentElement)return;p=p.parentElement}p===f.current&&E<0&&f.current.scrollHeight>f.current.clientHeight&&!c.animation?.ignoreEscapes&&(m(!0),i(!1))},[m,i,c]),f=ct(g=>{f.current?.removeEventListener("scroll",T),f.current?.removeEventListener("wheel",x),g?.addEventListener("scroll",T,{passive:!0}),g?.addEventListener("wheel",x,{passive:!0})},[]),b=ct(g=>{if(c.resizeObserver?.disconnect(),!g)return;let E;c.resizeObserver=new ResizeObserver(([p])=>{const{height:I}=p.contentRect,S=I-(E??I);if(c.resizeDifference=S,c.scrollTop>c.targetScrollTop&&(c.scrollTop=c.targetScrollTop),u(c.isNearBottom),S>=0){const N=Ue(o.current,E?o.current.resize:o.current.initial);y({animation:N,wait:!0,preserveScrollPosition:!0,duration:N==="instant"?void 0:Es})}else c.isNearBottom&&(m(!1),i(!0));E=I,requestAnimationFrame(()=>{setTimeout(()=>{c.resizeDifference===S&&(c.resizeDifference=0)},1)})}),c.resizeObserver?.observe(g)},[]);return{contentRef:b,scrollRef:f,scrollToBottom:y,stopScroll:v,isAtBottom:r||l,isNearBottom:l,escapedFromLock:t,state:c}};function ct(e,t){const a=h.useCallback(r=>(a.current=r,e(r)),t);return a}const Be=new Map;function Ue(...e){const t={...xs};let a=!1;for(const s of e){if(s==="instant"){a=!0;continue}typeof s=="object"&&(a=!1,t.damping=s.damping??t.damping,t.stiffness=s.stiffness??t.stiffness,t.mass=s.mass??t.mass)}const r=JSON.stringify(t);return Be.has(r)||Be.set(r,Object.freeze(t)),a?"instant":Be.get(r)}const Kt=h.createContext(null),Ts=typeof window<"u"?h.useLayoutEffect:h.useEffect;function Me({instance:e,children:t,resize:a,initial:r,mass:s,damping:l,stiffness:u,targetScrollTop:o,contextRef:d,...i}){const m=h.useRef(null),c=h.useCallback((I,S)=>(p?.targetScrollTop??o)?.(I,S)??I,[o]),y=ws({mass:s,damping:l,stiffness:u,resize:a,initial:r,targetScrollTop:c}),{scrollRef:v,contentRef:T,scrollToBottom:x,stopScroll:f,isAtBottom:b,escapedFromLock:g,state:E}=e??y,p=h.useMemo(()=>({scrollToBottom:x,stopScroll:f,scrollRef:v,isAtBottom:b,escapedFromLock:g,contentRef:T,state:E,get targetScrollTop(){return m.current},set targetScrollTop(I){m.current=I}}),[x,b,T,v,f,g,E]);return h.useImperativeHandle(d,()=>p,[p]),Ts(()=>{v.current&&getComputedStyle(v.current).overflow==="visible"&&(v.current.style.overflow="auto")},[]),n.jsx(Kt.Provider,{value:p,children:n.jsx("div",{...i,children:typeof t=="function"?t(p):t})})}(function(e){function t({children:a,...r}){const s=Yt();return n.jsx("div",{ref:s.scrollRef,style:{height:"100%",width:"100%"},children:n.jsx("div",{...r,ref:s.contentRef,children:typeof a=="function"?a(s):a})})}e.Content=t})(Me||(Me={}));function Yt(){const e=h.useContext(Kt);if(!e)throw new Error("use-stick-to-bottom component context must be used within a StickToBottom component");return e}const Is=({className:e,...t})=>n.jsx(Me,{className:F("styled-scrollbar relative flex-1 overflow-y-hidden",e),initial:"smooth",resize:"smooth",role:"log",...t}),Ns=({className:e,...t})=>n.jsx(Me.Content,{className:F("flex flex-col gap-8 p-4",e),...t}),_s=({className:e,...t})=>{const{isAtBottom:a,scrollToBottom:r}=Yt(),s=h.useCallback(()=>{r()},[r]);return!a&&n.jsx(de,{className:F("absolute right-[16px] bottom-4 translate-x-[-50%] rounded-full",e),onClick:s,size:"icon",type:"button",variant:"outline",...t,children:n.jsx(qr,{className:"size-4"})})},js=({children:e,as:t="p",className:a,duration:r=2,spread:s=2})=>{const l=He.create(t),u=h.useMemo(()=>(e?.length??0)*s,[e,s]);return n.jsx(l,{animate:{backgroundPosition:"0% center"},className:F("relative inline-block bg-[length:250%_100%,auto] bg-clip-text text-transparent","[--bg:linear-gradient(90deg,#0000_calc(50%-var(--spread)),var(--color-background),#0000_calc(50%+var(--spread)))] [background-repeat:no-repeat,padding-box]",a),initial:{backgroundPosition:"100% center"},style:{"--spread":`${u}px`,backgroundImage:"var(--bg), linear-gradient(var(--color-muted-foreground), var(--color-muted-foreground))"},transition:{repeat:Number.POSITIVE_INFINITY,duration:r,ease:"linear"},children:e})},Cs=h.memo(js),Xt=h.createContext(null),ks=()=>{const e=h.useContext(Xt);if(!e)throw new Error("Reasoning components must be used within Reasoning");return e},As=1e3,Ms=1e3,Qt=h.memo(({className:e,isStreaming:t=!1,open:a,defaultOpen:r=!0,onOpenChange:s,duration:l,children:u,...o})=>{const[d,i]=it({prop:a,defaultProp:r,onChange:s}),[m,c]=it({prop:l,defaultProp:void 0}),[y,v]=h.useState(!1),[T,x]=h.useState(null);h.useEffect(()=>{t?T===null&&x(Date.now()):T!==null&&(c(Math.ceil((Date.now()-T)/Ms)),x(null))},[t,T,c]),h.useEffect(()=>{if(r&&!t&&d&&!y){const b=setTimeout(()=>{i(!1),v(!0)},As);return()=>clearTimeout(b)}},[t,d,r,i,y]);const f=b=>{i(b)};return n.jsx(Xt.Provider,{value:{isStreaming:t,isOpen:d,setIsOpen:i,duration:m},children:n.jsx(Zt,{className:F("not-prose mb-4",e),onOpenChange:f,open:d,...o,children:u})})}),Rs=(e,t)=>e||t===0?n.jsx(Cs,{duration:1,children:"Thinking..."}):t===void 0?n.jsx("p",{children:"Thought for a few seconds"}):n.jsxs("p",{children:["Thought for ",t," seconds"]}),ea=h.memo(({className:e,children:t,...a})=>{const{isStreaming:r,isOpen:s,duration:l}=ks();return n.jsx(Vt,{className:F("flex w-full items-center gap-2 text-muted-foreground text-sm transition-colors hover:text-foreground",e),...a,children:t??n.jsxs(n.Fragment,{children:[n.jsx(Gr,{className:"size-4"}),Rs(r,l),n.jsx(Qe,{className:F("size-4 transition-transform",s?"rotate-180":"rotate-0")})]})})}),ta=h.memo(({className:e,children:t,...a})=>n.jsx(qt,{className:F("mt-4 text-sm","data-[state=closed]:fade-out-0 data-[state=closed]:slide-out-to-top-2 data-[state=open]:slide-in-from-top-2 text-muted-foreground outline-none data-[state=closed]:animate-out data-[state=open]:animate-in",e),...a,children:n.jsx(Er,{...a,children:t})}));Qt.displayName="Reasoning";ea.displayName="ReasoningTrigger";ta.displayName="ReasoningContent";const Ps=({messageId:e,messageText:t,liked:a,disliked:r,onClickLike:s,onClickDislike:l})=>{const[u,o]=h.useState(!1),[d,i]=h.useState(""),m=a||r,c=()=>{s()},y=()=>{o(!0)},v=()=>{l(d.trim()||void 0),o(!1),i("")},T=()=>{o(!1),i("")};return n.jsxs(wr,{children:[n.jsx(Fe,{onClick:()=>navigator.clipboard.writeText(t),label:"Copy",tooltip:"Copy to clipboard",children:n.jsx(Tr,{className:"size-3"})}),n.jsx(Hr,{mode:"wait",initial:!1,children:m?n.jsxs(He.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},className:"flex items-center gap-1 text-muted-foreground text-xs",children:[n.jsx(Rt,{className:"size-3"}),n.jsx("span",{children:"Feedback submitted"})]},`${e}-feedback-submitted`):n.jsxs(He.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},className:"flex items-center gap-1",children:[n.jsx(Fe,{label:"Like",onClick:c,tooltip:"Like this response",children:n.jsx(ns,{className:"size-4",fill:a?"currentColor":"none"})}),n.jsx(Fe,{label:"Dislike",onClick:y,tooltip:"Dislike this response",children:n.jsx(rs,{className:"size-4",fill:r?"currentColor":"none"})})]},`${e}-feedback-actions`)}),n.jsx(Pa,{open:u,onOpenChange:o,children:n.jsxs(Da,{children:[n.jsxs(Oa,{children:[n.jsx(La,{children:"What went wrong?"}),n.jsx(Fa,{children:"Help us improve by sharing what was wrong with this response."})]}),n.jsx(Or,{placeholder:"Add a comment (optional)",value:d,onChange:x=>i(x.target.value),onKeyDown:x=>{x.key==="Enter"&&v()}}),n.jsxs($a,{children:[n.jsx(de,{variant:"outline",onClick:T,children:"Cancel"}),n.jsx(de,{onClick:v,children:"Submit"})]})]})})]})},Ds=(e,t,a)=>{const r=[];let s=[],l=0,u=0;const o=()=>{s.length>0&&(r.push({type:"tool-batch",key:`${e.id}-tools-${s[0].toolCallId}`,tools:[...s]}),s=[])};for(let d=0;d<e.parts.length;d++){const i=e.parts[d];if(i.type==="text")o(),r.push({type:"text",key:`${e.id}-text-${l}`,text:i.text}),l++;else if(i.type==="reasoning")o(),r.push({type:"reasoning",key:`${e.id}-reasoning-${u}`,text:i.text,isStreaming:a&&d===e.parts.length-1&&t}),u++;else if(i.type.startsWith("tool-")){const m=i;s.push({state:m.state,toolCallId:m.toolCallId,toolName:m.type?.replace("tool-",""),input:m?.input??{},output:m?.output??[]})}}return o(),r},Os=({onTakeSurvey:e,onDismiss:t})=>n.jsx(Jt,{from:"assistant",children:n.jsx(Ht,{children:n.jsxs("div",{className:"relative rounded-lg border border-border/50 bg-card p-4 shadow-sm",children:[n.jsx("button",{type:"button",onClick:t,className:"absolute top-2 right-2 rounded p-1 text-muted-foreground hover:bg-accent hover:text-foreground",children:n.jsx(Mt,{className:"h-4 w-4"})}),n.jsxs("div",{className:"flex items-start gap-3 pr-6",children:[n.jsx(Lr,{className:"h-5 w-5 shrink-0 text-primary"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-sm",children:"Help us improve BrowserOS!"}),n.jsx("p",{className:"mt-1 text-muted-foreground text-xs",children:"Take a quick 2-minute survey."})]})]}),n.jsxs("div",{className:"mt-3 flex gap-2",children:[n.jsx(de,{size:"sm",onClick:e,children:"Take Survey"}),n.jsx(de,{size:"sm",variant:"ghost",onClick:t,children:"Maybe Later"})]})]})})}),Ls=({children:e,className:t,...a})=>n.jsx("div",{className:F("text-muted-foreground text-sm",t),...a,children:e}),Fs=({defaultOpen:e=!0,className:t,...a})=>n.jsx(Zt,{className:F(t),defaultOpen:e,...a}),$s=({children:e,className:t,title:a,TriggerIcon:r=Ba,...s})=>n.jsx(Vt,{asChild:!0,className:F("group",t),...s,children:e??n.jsxs("div",{className:"flex w-full cursor-pointer items-center gap-2 text-muted-foreground text-sm transition-colors hover:text-foreground",children:[n.jsx(r,{className:"size-4"}),n.jsx("p",{className:"text-sm",children:a}),n.jsx(Qe,{className:"size-4 transition-transform group-data-[state=open]:rotate-180"})]})}),Bs=({children:e,className:t,...a})=>n.jsx(qt,{className:F("data-[state=closed]:fade-out-0 data-[state=closed]:slide-out-to-top-2 data-[state=open]:slide-in-from-top-2 text-popover-foreground outline-none data-[state=closed]:animate-out data-[state=open]:animate-in",t),...a,children:n.jsx("div",{className:"mt-4 space-y-2 border-muted border-l-2 pl-4",children:e})}),Us=({tools:e,isLastBatch:t,isLastMessage:a,isStreaming:r})=>{const s=a&&t&&r,[l,u]=h.useState(s),[o,d]=h.useState(!1);h.useEffect(()=>{a&&!o&&u(t?r:!1)},[r,a,t,o]);const i=e.filter(c=>aa(c.state)).length,m=c=>{d(!0),u(c)};return n.jsxs(Fs,{open:l,onOpenChange:m,children:[n.jsx($s,{title:`${i}/${e.length} actions completed`,TriggerIcon:et}),n.jsx(Bs,{children:e.map(c=>n.jsxs(Ls,{className:"flex items-center gap-2",children:[n.jsx(qs,{state:c.state}),n.jsx("span",{children:zs(c.toolName)})]},c.toolCallId))})]})},zs=e=>e?.replace(/_/g," ")?.replace(/([a-z])([A-Z])/g,"$1 $2")?.replace(/^./,t=>t.toUpperCase()),aa=e=>e==="result"||e==="output-available",Zs=e=>e==="call"||e==="input-available",Vs=e=>e==="output-error",qs=({state:e})=>aa(e)?n.jsx(Ua,{className:"h-3.5 w-3.5 text-green-500"}):Zs(e)?n.jsx(za,{className:"h-3.5 w-3.5 animate-spin text-[var(--accent-orange)]"}):Vs(e)?n.jsx(Ir,{className:"h-3.5 w-3.5 text-destructive"}):n.jsx(Yr,{className:"h-3.5 w-3.5 text-muted-foreground"}),ra=({tabs:e})=>e.length>0&&n.jsx("div",{className:"flex flex-wrap gap-1.5",children:e.map((t,a)=>n.jsxs("div",{className:"flex items-center gap-1.5 rounded-md border border-border/50 bg-accent/50 px-2 py-1",children:[t.favIconUrl?n.jsx("img",{src:t.favIconUrl,alt:t.title,className:"h-3 w-3 object-contain"}):n.jsx(Dt,{className:"h-3 w-3 text-muted-foreground"}),n.jsx("span",{className:"max-w-[150px] truncate text-xs",children:t.title})]},t.id||a))}),Js=({action:e})=>n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-[var(--accent-orange)]/10",children:n.jsx(mr,{className:"h-4 w-4 text-[var(--accent-orange)]"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-medium text-foreground text-sm",children:e.name}),e.description&&n.jsx("div",{className:"text-muted-foreground text-xs",children:e.description})]})]}),n.jsx(ra,{tabs:e.tabs})]}),Hs=({action:e})=>{const t=e.mode==="agent";return n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx("div",{className:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-lg bg-[var(--accent-orange)]/10",children:t?n.jsx(et,{className:"h-4 w-4 text-[var(--accent-orange)]"}):n.jsx(At,{className:"h-4 w-4 text-[var(--accent-orange)]"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"mb-0.5 flex items-center gap-1.5",children:n.jsx("span",{className:"rounded bg-[var(--accent-orange)]/10 px-1.5 py-0.5 font-medium text-[10px] text-[var(--accent-orange)] uppercase",children:t?"Agent":"Chat"})}),n.jsx("div",{className:"text-foreground text-sm",children:e.message})]})]}),e.tabs?n.jsx(ra,{tabs:e.tabs}):null]})},Ws=({action:e})=>{switch(e.type){case"ai-tab":return n.jsx(Js,{action:e});case"browseros":return n.jsx(Hs,{action:e});default:return null}},Gs=({messages:e,status:t,messagesEndRef:a,getActionForMessage:r,liked:s,disliked:l,onClickLike:u,onClickDislike:o,showJtbdPopup:d,onTakeSurvey:i,onDismissJtbdPopup:m})=>{const c=t==="streaming"||t==="submitted";return n.jsxs(n.Fragment,{children:[n.jsxs(Is,{className:"ph-mask",children:[n.jsxs(Ns,{children:[e.map((y,v)=>{const T=r(y),x=v===e.length-1,f=Ds(y,x,c),b=f.filter(S=>S.type==="tool-batch"),g=b[b.length-1]?.key,E=f?.filter(S=>S.type==="text")?.map(S=>S.text)?.join(`

`),p=()=>u(y.id),I=S=>o(y.id,S);return n.jsxs(h.Fragment,{children:[n.jsx(Jt,{from:y.role,children:n.jsx(Ht,{children:T?n.jsx(Ws,{action:T}):f.map(S=>{switch(S.type){case"text":return n.jsx(Nr,{children:S.text},S.key);case"reasoning":return n.jsxs(Qt,{className:"w-full",isStreaming:S.isStreaming,children:[n.jsx(ea,{}),n.jsx(ta,{children:S.text})]},S.key);case"tool-batch":return n.jsx(Us,{tools:S.tools,isLastBatch:S.key===g,isLastMessage:x,isStreaming:c},S.key);default:return null}})})}),y.role==="assistant"&&(!x||!c)?n.jsx(Ps,{messageId:y.id,messageText:E,liked:s[y.id]??!1,disliked:l[y.id]??!1,onClickLike:p,onClickDislike:I}):null]},y.id)}),d&&n.jsx(Os,{onTakeSurvey:i,onDismiss:m})]}),n.jsx(_s,{})]}),c&&n.jsxs("div",{className:"flex animate-fadeInUp gap-2 px-3",children:[n.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-[var(--accent-orange)] text-white",children:n.jsx(et,{className:"h-3.5 w-3.5"})}),n.jsxs("div",{className:"flex items-center gap-1 rounded-xl rounded-tl-none border border-border/50 bg-card px-3 py-2.5 shadow-sm",children:[n.jsx("span",{className:"h-1.5 w-1.5 animate-bounce rounded-full bg-[var(--accent-orange)] [animation-delay:-0.3s]"}),n.jsx("span",{className:"h-1.5 w-1.5 animate-bounce rounded-full bg-[var(--accent-orange)] [animation-delay:-0.15s]"}),n.jsx("span",{className:"h-1.5 w-1.5 animate-bounce rounded-full bg-[var(--accent-orange)]"})]})]}),n.jsx("div",{ref:a})]})};var sa="vercel.ai.error",Ks=Symbol.for(sa),na,Ys=class oa extends Error{constructor({name:t,message:a,cause:r}){super(a),this[na]=!0,this.name=t,this.cause=r}static isInstance(t){return oa.hasMarker(t,sa)}static hasMarker(t,a){const r=Symbol.for(a);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}};na=Ks;var re=Ys;function ia(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var la="AI_InvalidArgumentError",ca=`vercel.ai.error.${la}`,Xs=Symbol.for(ca),ua,Qs=class extends re{constructor({message:e,cause:t,argument:a}){super({name:la,message:e,cause:t}),this[ua]=!0,this.argument=a}static isInstance(e){return re.hasMarker(e,ca)}};ua=Xs;var da="AI_JSONParseError",pa=`vercel.ai.error.${da}`,en=Symbol.for(pa),ma,ut=class extends re{constructor({text:e,cause:t}){super({name:da,message:`JSON parsing failed: Text: ${e}.
Error message: ${ia(t)}`,cause:t}),this[ma]=!0,this.text=e}static isInstance(e){return re.hasMarker(e,pa)}};ma=en;var fa="AI_TypeValidationError",ha=`vercel.ai.error.${fa}`,tn=Symbol.for(ha),ga,an=class We extends re{constructor({value:t,cause:a}){super({name:fa,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${ia(a)}`,cause:a}),this[ga]=!0,this.value=t}static isInstance(t){return re.hasMarker(t,ha)}static wrap({value:t,cause:a}){return We.isInstance(a)&&a.value===t?a:new We({value:t,cause:a})}};ga=tn;var Re=an;class dt extends Error{constructor(t,a){super(t),this.name="ParseError",this.type=a.type,this.field=a.field,this.value=a.value,this.line=a.line}}function ze(e){}function rn(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=ze,onError:a=ze,onRetry:r=ze,onComment:s}=e;let l="",u=!0,o,d="",i="";function m(x){const f=u?x.replace(/^\xEF\xBB\xBF/,""):x,[b,g]=sn(`${l}${f}`);for(const E of b)c(E);l=g,u=!1}function c(x){if(x===""){v();return}if(x.startsWith(":")){s&&s(x.slice(x.startsWith(": ")?2:1));return}const f=x.indexOf(":");if(f!==-1){const b=x.slice(0,f),g=x[f+1]===" "?2:1,E=x.slice(f+g);y(b,E,x);return}y(x,"",x)}function y(x,f,b){switch(x){case"event":i=f;break;case"data":d=`${d}${f}
`;break;case"id":o=f.includes("\0")?void 0:f;break;case"retry":/^\d+$/.test(f)?r(parseInt(f,10)):a(new dt(`Invalid \`retry\` value: "${f}"`,{type:"invalid-retry",value:f,line:b}));break;default:a(new dt(`Unknown field "${x.length>20?`${x.slice(0,20)}â€¦`:x}"`,{type:"unknown-field",field:x,value:f,line:b}));break}}function v(){d.length>0&&t({id:o,event:i||void 0,data:d.endsWith(`
`)?d.slice(0,-1):d}),o=void 0,d="",i=""}function T(x={}){l&&x.consume&&c(l),u=!0,o=void 0,d="",i="",l=""}return{feed:m,reset:T}}function sn(e){const t=[];let a="",r=0;for(;r<e.length;){const s=e.indexOf("\r",r),l=e.indexOf(`
`,r);let u=-1;if(s!==-1&&l!==-1?u=Math.min(s,l):s!==-1?s===e.length-1?u=-1:u=s:l!==-1&&(u=l),u===-1){a=e.slice(r);break}else{const o=e.slice(r,u);t.push(o),r=u+1,e[r-1]==="\r"&&e[r]===`
`&&r++}}return[t,a]}class nn extends TransformStream{constructor({onError:t,onRetry:a,onComment:r}={}){let s;super({start(l){s=rn({onEvent:u=>{l.enqueue(u)},onError(u){t==="terminate"?l.error(u):typeof t=="function"&&t(u)},onRetry:a,onComment:r})},transform(l){s.feed(l)}})}}var Ee=({prefix:e,size:t=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const s=()=>{const l=a.length,u=new Array(t);for(let o=0;o<t;o++)u[o]=a[Math.random()*l|0];return u.join("")};if(e==null)return s;if(a.includes(r))throw new Qs({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${e}${r}${s()}`},on=Ee();function pt(e=globalThis){var t,a,r;return e.window?"runtime/browser":(t=e.navigator)!=null&&t.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:(r=(a=e.process)==null?void 0:a.versions)!=null&&r.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function oe(e){if(e==null)return{};const t={};if(e instanceof Headers)e.forEach((a,r)=>{t[r.toLowerCase()]=a});else{Array.isArray(e)||(e=Object.entries(e));for(const[a,r]of e)r!=null&&(t[a.toLowerCase()]=r)}return t}function mt(e,...t){const a=new Headers(oe(e)),r=a.get("user-agent")||"";return a.set("user-agent",[r,...t].filter(Boolean).join(" ")),Object.fromEntries(a.entries())}var ln=/"__proto__"\s*:/,cn=/"constructor"\s*:/;function ft(e){const t=JSON.parse(e);return t===null||typeof t!="object"||ln.test(e)===!1&&cn.test(e)===!1?t:un(t)}function un(e){let t=[e];for(;t.length;){const a=t;t=[];for(const r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const s in r){const l=r[s];l&&typeof l=="object"&&t.push(l)}}}return e}function dn(e){const{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch{return ft(e)}try{return ft(e)}finally{Error.stackTraceLimit=t}}var Pe=Symbol.for("vercel.ai.validator");function pn(e){return{[Pe]:!0,validate:e}}function mn(e){return typeof e=="object"&&e!==null&&Pe in e&&e[Pe]===!0&&"validate"in e}function fn(e){let t;return()=>(t==null&&(t=e()),t)}function hn(e){return mn(e)?e:typeof e=="function"?e():gn(e)}function gn(e){return pn(async t=>{const a=await e["~standard"].validate(t);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new Re({value:t,cause:a.issues})}})}async function ht({value:e,schema:t}){const a=await tt({value:e,schema:t});if(!a.success)throw Re.wrap({value:e,cause:a.error});return a.value}async function tt({value:e,schema:t}){const a=hn(t);try{if(a.validate==null)return{success:!0,value:e,rawValue:e};const r=await a.validate(e);return r.success?{success:!0,value:r.value,rawValue:e}:{success:!1,error:Re.wrap({value:e,cause:r.error}),rawValue:e}}catch(r){return{success:!1,error:Re.wrap({value:e,cause:r}),rawValue:e}}}async function De({text:e,schema:t}){try{const a=dn(e);return t==null?{success:!0,value:a,rawValue:a}:await tt({value:a,schema:t})}catch(a){return{success:!1,error:ut.isInstance(a)?a:new ut({text:e,cause:a}),rawValue:void 0}}}function vn({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new nn).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await De({text:a,schema:t}))}}))}async function le(e){return typeof e=="function"&&(e=e()),Promise.resolve(e)}function _e(e){if(e.type==="object"){e.additionalProperties=!1;const t=e.properties;if(t!=null)for(const a in t)t[a]=_e(t[a])}return e.type==="array"&&e.items!=null&&(Array.isArray(e.items)?e.items=e.items.map(t=>_e(t)):e.items=_e(e.items)),e}var yn=(e,t)=>{let a=0;for(;a<e.length&&a<t.length&&e[a]===t[a];a++);return[(e.length-a).toString(),...t.slice(a)].join("/")},xn=Symbol("Let zodToJsonSchema decide on which parser to use"),gt={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},bn=e=>typeof e=="string"?{...gt,name:e}:{...gt,...e};function J(){return{}}function Sn(e,t){var a,r,s;const l={type:"array"};return(a=e.type)!=null&&a._def&&((s=(r=e.type)==null?void 0:r._def)==null?void 0:s.typeName)!==_.ZodAny&&(l.items=A(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(l.minItems=e.minLength.value),e.maxLength&&(l.maxItems=e.maxLength.value),e.exactLength&&(l.minItems=e.exactLength.value,l.maxItems=e.exactLength.value),l}function En(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const a of e.checks)switch(a.kind){case"min":a.inclusive?t.minimum=a.value:t.exclusiveMinimum=a.value;break;case"max":a.inclusive?t.maximum=a.value:t.exclusiveMaximum=a.value;break;case"multipleOf":t.multipleOf=a.value;break}return t}function wn(){return{type:"boolean"}}function va(e,t){return A(e.type._def,t)}var Tn=(e,t)=>A(e.innerType._def,t);function ya(e,t,a){const r=a??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,l)=>ya(e,t,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return In(e)}}var In=e=>{const t={type:"integer",format:"unix-time"};for(const a of e.checks)switch(a.kind){case"min":t.minimum=a.value;break;case"max":t.maximum=a.value;break}return t};function Nn(e,t){return{...A(e.innerType._def,t),default:e.defaultValue()}}function _n(e,t){return t.effectStrategy==="input"?A(e.schema._def,t):J()}function jn(e){return{type:"string",enum:Array.from(e.values)}}var Cn=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function kn(e,t){const a=[A(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),A(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(Cn(s))r.push(...s.allOf);else{let l=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:u,...o}=s;l=o}r.push(l)}}),r.length?{allOf:r}:void 0}function An(e){const t=typeof e.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(e.value)?"array":"object"}:{type:t==="bigint"?"integer":t,const:e.value}}var Ze=void 0,W={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ze===void 0&&(Ze=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ze),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function xa(e,t){const a={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(t.emailStrategy){case"format:email":G(a,"email",r.message,t);break;case"format:idn-email":G(a,"idn-email",r.message,t);break;case"pattern:zod":Z(a,W.email,r.message,t);break}break;case"url":G(a,"uri",r.message,t);break;case"uuid":G(a,"uuid",r.message,t);break;case"regex":Z(a,r.regex,r.message,t);break;case"cuid":Z(a,W.cuid,r.message,t);break;case"cuid2":Z(a,W.cuid2,r.message,t);break;case"startsWith":Z(a,RegExp(`^${Ve(r.value,t)}`),r.message,t);break;case"endsWith":Z(a,RegExp(`${Ve(r.value,t)}$`),r.message,t);break;case"datetime":G(a,"date-time",r.message,t);break;case"date":G(a,"date",r.message,t);break;case"time":G(a,"time",r.message,t);break;case"duration":G(a,"duration",r.message,t);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":{Z(a,RegExp(Ve(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&G(a,"ipv4",r.message,t),r.version!=="v4"&&G(a,"ipv6",r.message,t);break}case"base64url":Z(a,W.base64url,r.message,t);break;case"jwt":Z(a,W.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&Z(a,W.ipv4Cidr,r.message,t),r.version!=="v4"&&Z(a,W.ipv6Cidr,r.message,t);break}case"emoji":Z(a,W.emoji(),r.message,t);break;case"ulid":{Z(a,W.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{G(a,"binary",r.message,t);break}case"contentEncoding:base64":{a.contentEncoding="base64";break}case"pattern:zod":{Z(a,W.base64,r.message,t);break}}break}case"nanoid":Z(a,W.nanoid,r.message,t)}return a}function Ve(e,t){return t.patternStrategy==="escape"?Rn(e):e}var Mn=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Rn(e){let t="";for(let a=0;a<e.length;a++)Mn.has(e[a])||(t+="\\"),t+=e[a];return t}function G(e,t,a,r){var s;e.format||(s=e.anyOf)!=null&&s.some(l=>l.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...a&&r.errorMessages&&{errorMessage:{format:a}}})):e.format=t}function Z(e,t,a,r){var s;e.pattern||(s=e.allOf)!=null&&s.some(l=>l.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:vt(t,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):e.pattern=vt(t,r)}function vt(e,t){var a;if(!t.applyRegexFlags||!e.flags)return e.source;const r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},s=r.i?e.source.toLowerCase():e.source;let l="",u=!1,o=!1,d=!1;for(let i=0;i<s.length;i++){if(u){l+=s[i],u=!1;continue}if(r.i){if(o){if(s[i].match(/[a-z]/)){d?(l+=s[i],l+=`${s[i-2]}-${s[i]}`.toUpperCase(),d=!1):s[i+1]==="-"&&((a=s[i+2])!=null&&a.match(/[a-z]/))?(l+=s[i],d=!0):l+=`${s[i]}${s[i].toUpperCase()}`;continue}}else if(s[i].match(/[a-z]/)){l+=`[${s[i]}${s[i].toUpperCase()}]`;continue}}if(r.m){if(s[i]==="^"){l+=`(^|(?<=[\r
]))`;continue}else if(s[i]==="$"){l+=`($|(?=[\r
]))`;continue}}if(r.s&&s[i]==="."){l+=o?`${s[i]}\r
`:`[${s[i]}\r
]`;continue}l+=s[i],s[i]==="\\"?u=!0:o&&s[i]==="]"?o=!1:!o&&s[i]==="["&&(o=!0)}try{new RegExp(l)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return l}function ba(e,t){var a,r,s,l,u,o;const d={type:"object",additionalProperties:(a=A(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))!=null?a:t.allowedAdditionalProperties};if(((r=e.keyType)==null?void 0:r._def.typeName)===_.ZodString&&((s=e.keyType._def.checks)!=null&&s.length)){const{type:i,...m}=xa(e.keyType._def,t);return{...d,propertyNames:m}}else{if(((l=e.keyType)==null?void 0:l._def.typeName)===_.ZodEnum)return{...d,propertyNames:{enum:e.keyType._def.values}};if(((u=e.keyType)==null?void 0:u._def.typeName)===_.ZodBranded&&e.keyType._def.type._def.typeName===_.ZodString&&((o=e.keyType._def.type._def.checks)!=null&&o.length)){const{type:i,...m}=va(e.keyType._def,t);return{...d,propertyNames:m}}}return d}function Pn(e,t){if(t.mapStrategy==="record")return ba(e,t);const a=A(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||J(),r=A(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||J();return{type:"array",maxItems:125,items:{type:"array",items:[a,r],minItems:2,maxItems:2}}}function Dn(e){const t=e.values,r=Object.keys(e.values).filter(l=>typeof t[t[l]]!="number").map(l=>t[l]),s=Array.from(new Set(r.map(l=>typeof l)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function On(){return{not:J()}}function Ln(){return{type:"null"}}var Ge={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Fn(e,t){const a=e.options instanceof Map?Array.from(e.options.values()):e.options;if(a.every(r=>r._def.typeName in Ge&&(!r._def.checks||!r._def.checks.length))){const r=a.reduce((s,l)=>{const u=Ge[l._def.typeName];return u&&!s.includes(u)?[...s,u]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=a.reduce((s,l)=>{const u=typeof l._def.value;switch(u){case"string":case"number":case"boolean":return[...s,u];case"bigint":return[...s,"integer"];case"object":if(l._def.value===null)return[...s,"null"];default:return s}},[]);if(r.length===a.length){const s=r.filter((l,u,o)=>o.indexOf(l)===u);return{type:s.length>1?s:s[0],enum:a.reduce((l,u)=>l.includes(u._def.value)?l:[...l,u._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(l=>!r.includes(l))],[])};return $n(e,t)}var $n=(e,t)=>{const a=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,s)=>A(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function Bn(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[Ge[e.innerType._def.typeName],"null"]};const a=A(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function Un(e){const t={type:"number"};if(!e.checks)return t;for(const a of e.checks)switch(a.kind){case"int":t.type="integer";break;case"min":a.inclusive?t.minimum=a.value:t.exclusiveMinimum=a.value;break;case"max":a.inclusive?t.maximum=a.value:t.exclusiveMaximum=a.value;break;case"multipleOf":t.multipleOf=a.value;break}return t}function zn(e,t){const a={type:"object",properties:{}},r=[],s=e.shape();for(const u in s){let o=s[u];if(o===void 0||o._def===void 0)continue;const d=Vn(o),i=A(o._def,{...t,currentPath:[...t.currentPath,"properties",u],propertyPath:[...t.currentPath,"properties",u]});i!==void 0&&(a.properties[u]=i,d||r.push(u))}r.length&&(a.required=r);const l=Zn(e,t);return l!==void 0&&(a.additionalProperties=l),a}function Zn(e,t){if(e.catchall._def.typeName!=="ZodNever")return A(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function Vn(e){try{return e.isOptional()}catch{return!0}}var qn=(e,t)=>{var a;if(t.currentPath.toString()===((a=t.propertyPath)==null?void 0:a.toString()))return A(e.innerType._def,t);const r=A(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:J()},r]}:J()},Jn=(e,t)=>{if(t.pipeStrategy==="input")return A(e.in._def,t);if(t.pipeStrategy==="output")return A(e.out._def,t);const a=A(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=A(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",a?"1":"0"]});return{allOf:[a,r].filter(s=>s!==void 0)}};function Hn(e,t){return A(e.type._def,t)}function Wn(e,t){const r={type:"array",uniqueItems:!0,items:A(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(r.minItems=e.minSize.value),e.maxSize&&(r.maxItems=e.maxSize.value),r}function Gn(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((a,r)=>A(a._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:A(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((a,r)=>A(a._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function Kn(){return{not:J()}}function Yn(){return J()}var Xn=(e,t)=>A(e.innerType._def,t),Qn=(e,t,a)=>{switch(t){case _.ZodString:return xa(e,a);case _.ZodNumber:return Un(e);case _.ZodObject:return zn(e,a);case _.ZodBigInt:return En(e);case _.ZodBoolean:return wn();case _.ZodDate:return ya(e,a);case _.ZodUndefined:return Kn();case _.ZodNull:return Ln();case _.ZodArray:return Sn(e,a);case _.ZodUnion:case _.ZodDiscriminatedUnion:return Fn(e,a);case _.ZodIntersection:return kn(e,a);case _.ZodTuple:return Gn(e,a);case _.ZodRecord:return ba(e,a);case _.ZodLiteral:return An(e);case _.ZodEnum:return jn(e);case _.ZodNativeEnum:return Dn(e);case _.ZodNullable:return Bn(e,a);case _.ZodOptional:return qn(e,a);case _.ZodMap:return Pn(e,a);case _.ZodSet:return Wn(e,a);case _.ZodLazy:return()=>e.getter()._def;case _.ZodPromise:return Hn(e,a);case _.ZodNaN:case _.ZodNever:return On();case _.ZodEffects:return _n(e,a);case _.ZodAny:return J();case _.ZodUnknown:return Yn();case _.ZodDefault:return Nn(e,a);case _.ZodBranded:return va(e,a);case _.ZodReadonly:return Xn(e,a);case _.ZodCatch:return Tn(e,a);case _.ZodPipeline:return Jn(e,a);case _.ZodFunction:case _.ZodVoid:case _.ZodSymbol:return;default:return(r=>{})()}};function A(e,t,a=!1){var r;const s=t.seen.get(e);if(t.override){const d=(r=t.override)==null?void 0:r.call(t,e,t,s,a);if(d!==xn)return d}if(s&&!a){const d=eo(s,t);if(d!==void 0)return d}const l={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,l);const u=Qn(e,e.typeName,t),o=typeof u=="function"?A(u(),t):u;if(o&&to(e,t,o),t.postProcess){const d=t.postProcess(o,e,t);return l.jsonSchema=o,d}return l.jsonSchema=o,o}var eo=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:yn(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((a,r)=>t.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),J()):t.$refStrategy==="seen"?J():void 0}},to=(e,t,a)=>(e.description&&(a.description=e.description),a),ao=e=>{const t=bn(e),a=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}},ro=(e,t)=>{var a;const r=ao(t);let s=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((i,[m,c])=>{var y;return{...i,[m]:(y=A(c._def,{...r,currentPath:[...r.basePath,r.definitionPath,m]},!0))!=null?y:J()}},{}):void 0;const l=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,u=(a=A(e._def,l===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,l]},!1))!=null?a:J(),o=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;o!==void 0&&(u.title=o);const d=l===void 0?s?{...u,[r.definitionPath]:s}:u:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,l].join("/"),[r.definitionPath]:{...s,[l]:u}};return d.$schema="http://json-schema.org/draft-07/schema#",d},so=ro;function no(e,t){var a;const r=(a=void 0)!=null?a:!1;return at(()=>so(e,{$refStrategy:r?"root":"none"}),{validate:async s=>{const l=await e.safeParseAsync(s);return l.success?{success:!0,value:l.data}:{success:!1,error:l.error}}})}function oo(e,t){var a;const r=(a=void 0)!=null?a:!1;return at(()=>_e(Va(e,{target:"draft-7",io:"input",reused:r?"ref":"inline"})),{validate:async s=>{const l=await Za(e,s);return l.success?{success:!0,value:l.data}:{success:!1,error:l.error}}})}function io(e){return"_zod"in e}function Sa(e,t){return io(e)?oo(e):no(e)}var Ke=Symbol.for("vercel.ai.schema");function at(e,{validate:t}={}){return{[Ke]:!0,_type:void 0,[Pe]:!0,get jsonSchema(){return typeof e=="function"&&(e=e()),e},validate:t}}function lo(e){return typeof e=="object"&&e!==null&&Ke in e&&e[Ke]===!0&&"jsonSchema"in e&&"validate"in e}function co(e){return e==null?at({properties:{},additionalProperties:!1}):lo(e)?e:typeof e=="function"?e():Sa(e)}var uo=Object.defineProperty,po=(e,t)=>{for(var a in t)uo(e,a,{get:t[a],enumerable:!0})},Ea="AI_NoObjectGeneratedError",wa=`vercel.ai.error.${Ea}`,mo=Symbol.for(wa),Ta,yt=class extends re{constructor({message:e="No object generated.",cause:t,text:a,response:r,usage:s,finishReason:l}){super({name:Ea,message:e,cause:t}),this[Ta]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=l}static isInstance(e){return re.hasMarker(e,wa)}};Ta=mo;var xt="5.0.116",Ia=K([w(),Ae(Uint8Array),Ae(ArrayBuffer),Pt(e=>{var t,a;return(a=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?a:!1},{message:"Must be a Buffer"})]),be=qa(()=>K([Ha(),w(),Wa(),q(),Je(w(),be),Se(be)])),D=Je(w(),Je(w(),be)),Na=L({type:j("text"),text:w(),providerOptions:D.optional()}),fo=L({type:j("image"),image:K([Ia,Ae(URL)]),mediaType:w().optional(),providerOptions:D.optional()}),_a=L({type:j("file"),data:K([Ia,Ae(URL)]),filename:w().optional(),mediaType:w(),providerOptions:D.optional()}),ho=L({type:j("reasoning"),text:w(),providerOptions:D.optional()}),go=L({type:j("tool-call"),toolCallId:w(),toolName:w(),input:te(),providerOptions:D.optional(),providerExecuted:q().optional()}),vo=Ja("type",[L({type:j("text"),value:w()}),L({type:j("json"),value:be}),L({type:j("error-text"),value:w()}),L({type:j("error-json"),value:be}),L({type:j("content"),value:Se(K([L({type:j("text"),text:w()}),L({type:j("media"),data:w(),mediaType:w()})]))})]),ja=L({type:j("tool-result"),toolCallId:w(),toolName:w(),output:vo,providerOptions:D.optional()}),yo=L({role:j("system"),content:w(),providerOptions:D.optional()}),xo=L({role:j("user"),content:K([w(),Se(K([Na,fo,_a]))]),providerOptions:D.optional()}),bo=L({role:j("assistant"),content:K([w(),Se(K([Na,_a,ho,go,ja]))]),providerOptions:D.optional()}),So=L({role:j("tool"),content:Se(ja),providerOptions:D.optional()});K([yo,xo,bo,So]);Ee({prefix:"aitxt",size:24});(class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue(`data: [DONE]

`)}})}});var Eo=fn(()=>Sa(K([R({type:j("text-start"),id:w(),providerMetadata:D.optional()}),R({type:j("text-delta"),id:w(),delta:w(),providerMetadata:D.optional()}),R({type:j("text-end"),id:w(),providerMetadata:D.optional()}),R({type:j("error"),errorText:w()}),R({type:j("tool-input-start"),toolCallId:w(),toolName:w(),providerExecuted:q().optional(),dynamic:q().optional()}),R({type:j("tool-input-delta"),toolCallId:w(),inputTextDelta:w()}),R({type:j("tool-input-available"),toolCallId:w(),toolName:w(),input:te(),providerExecuted:q().optional(),providerMetadata:D.optional(),dynamic:q().optional()}),R({type:j("tool-input-error"),toolCallId:w(),toolName:w(),input:te(),providerExecuted:q().optional(),providerMetadata:D.optional(),dynamic:q().optional(),errorText:w()}),R({type:j("tool-output-available"),toolCallId:w(),output:te(),providerExecuted:q().optional(),dynamic:q().optional(),preliminary:q().optional()}),R({type:j("tool-output-error"),toolCallId:w(),errorText:w(),providerExecuted:q().optional(),dynamic:q().optional()}),R({type:j("reasoning-start"),id:w(),providerMetadata:D.optional()}),R({type:j("reasoning-delta"),id:w(),delta:w(),providerMetadata:D.optional()}),R({type:j("reasoning-end"),id:w(),providerMetadata:D.optional()}),R({type:j("source-url"),sourceId:w(),url:w(),title:w().optional(),providerMetadata:D.optional()}),R({type:j("source-document"),sourceId:w(),mediaType:w(),title:w(),filename:w().optional(),providerMetadata:D.optional()}),R({type:j("file"),url:w(),mediaType:w(),providerMetadata:D.optional()}),R({type:Pt(e=>typeof e=="string"&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:w().optional(),data:te(),transient:q().optional()}),R({type:j("start-step")}),R({type:j("finish-step")}),R({type:j("start"),messageId:w().optional(),messageMetadata:te().optional()}),R({type:j("finish"),finishReason:Ga(["stop","length","content-filter","tool-calls","error","other","unknown"]).optional(),messageMetadata:te().optional()}),R({type:j("abort")}),R({type:j("message-metadata"),messageMetadata:te()})])));function wo(e){return e.type.startsWith("data-")}function Ca(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;const a={...e};for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const s=t[r];if(s===void 0)continue;const l=r in e?e[r]:void 0,u=s!==null&&typeof s=="object"&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),o=l!=null&&typeof l=="object"&&!Array.isArray(l)&&!(l instanceof Date)&&!(l instanceof RegExp);u&&o?a[r]=Ca(l,s):a[r]=s}return a}function To(e){const t=["ROOT"];let a=-1,r=null;function s(d,i,m){switch(d){case'"':{a=i,t.pop(),t.push(m),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{a=i,r=i,t.pop(),t.push(m),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(m),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{a=i,t.pop(),t.push(m),t.push("INSIDE_NUMBER");break}case"{":{a=i,t.pop(),t.push(m),t.push("INSIDE_OBJECT_START");break}case"[":{a=i,t.pop(),t.push(m),t.push("INSIDE_ARRAY_START");break}}}function l(d,i){switch(d){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{a=i,t.pop();break}}}function u(d,i){switch(d){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{a=i,t.pop();break}}}for(let d=0;d<e.length;d++){const i=e[d];switch(t[t.length-1]){case"ROOT":s(i,d,"FINISH");break;case"INSIDE_OBJECT_START":{switch(i){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{a=d,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{i==='"'&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break}case"INSIDE_OBJECT_KEY":{i==='"'&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break}case"INSIDE_OBJECT_AFTER_KEY":{i===":"&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break}case"INSIDE_OBJECT_BEFORE_VALUE":{s(i,d,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{l(i,d);break}case"INSIDE_STRING":{switch(i){case'"':{t.pop(),a=d;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:a=d}break}case"INSIDE_ARRAY_START":{i==="]"?(a=d,t.pop()):(a=d,s(i,d,"INSIDE_ARRAY_AFTER_VALUE"));break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(i){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{a=d,t.pop();break}default:{a=d;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{s(i,d,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),a=d;break}case"INSIDE_NUMBER":{switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{a=d;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(i,d),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&l(i,d);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&l(i,d);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(i,d);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const c=e.substring(r,d+1);!"false".startsWith(c)&&!"true".startsWith(c)&&!"null".startsWith(c)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?l(i,d):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(i,d)):a=d;break}}}let o=e.slice(0,a+1);for(let d=t.length-1;d>=0;d--)switch(t[d]){case"INSIDE_STRING":{o+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{o+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{o+="]";break}case"INSIDE_LITERAL":{const m=e.substring(r,e.length);"true".startsWith(m)?o+="true".slice(m.length):"false".startsWith(m)?o+="false".slice(m.length):"null".startsWith(m)&&(o+="null".slice(m.length))}}return o}async function ka(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=await De({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await De({text:To(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function je(e){return e.type.startsWith("tool-")}function Io(e){return e.type==="dynamic-tool"}function bt(e){return je(e)||Io(e)}function St(e){return e.type.split("-").slice(1).join("-")}function No({lastMessage:e,messageId:t}){return{message:e?.role==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function _o({stream:e,messageMetadataSchema:t,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:l,onData:u}){return e.pipeThrough(new TransformStream({async transform(o,d){await r(async({state:i,write:m})=>{var c,y,v,T;function x(p){const S=i.message.parts.filter(je).find(N=>N.toolCallId===p);if(S==null)throw new Error("tool-output-error must be preceded by a tool-input-available");return S}function f(p){const S=i.message.parts.filter(N=>N.type==="dynamic-tool").find(N=>N.toolCallId===p);if(S==null)throw new Error("tool-output-error must be preceded by a tool-input-available");return S}function b(p){var I;const S=i.message.parts.find(P=>je(P)&&P.toolCallId===p.toolCallId),N=p,k=S;S!=null?(S.state=p.state,k.input=N.input,k.output=N.output,k.errorText=N.errorText,k.rawInput=N.rawInput,k.preliminary=N.preliminary,k.providerExecuted=(I=N.providerExecuted)!=null?I:S.providerExecuted,N.providerMetadata!=null&&S.state==="input-available"&&(S.callProviderMetadata=N.providerMetadata)):i.message.parts.push({type:`tool-${p.toolName}`,toolCallId:p.toolCallId,state:p.state,input:N.input,output:N.output,rawInput:N.rawInput,errorText:N.errorText,providerExecuted:N.providerExecuted,preliminary:N.preliminary,...N.providerMetadata!=null?{callProviderMetadata:N.providerMetadata}:{}})}function g(p){var I,S;const N=i.message.parts.find(U=>U.type==="dynamic-tool"&&U.toolCallId===p.toolCallId),k=p,P=N;N!=null?(N.state=p.state,P.toolName=p.toolName,P.input=k.input,P.output=k.output,P.errorText=k.errorText,P.rawInput=(I=k.rawInput)!=null?I:P.rawInput,P.preliminary=k.preliminary,P.providerExecuted=(S=k.providerExecuted)!=null?S:N.providerExecuted,k.providerMetadata!=null&&N.state==="input-available"&&(N.callProviderMetadata=k.providerMetadata)):i.message.parts.push({type:"dynamic-tool",toolName:p.toolName,toolCallId:p.toolCallId,state:p.state,input:k.input,output:k.output,errorText:k.errorText,preliminary:k.preliminary,providerExecuted:k.providerExecuted,...k.providerMetadata!=null?{callProviderMetadata:k.providerMetadata}:{}})}async function E(p){if(p!=null){const I=i.message.metadata!=null?Ca(i.message.metadata,p):p;t!=null&&await ht({value:I,schema:t}),i.message.metadata=I}}switch(o.type){case"text-start":{const p={type:"text",text:"",providerMetadata:o.providerMetadata,state:"streaming"};i.activeTextParts[o.id]=p,i.message.parts.push(p),m();break}case"text-delta":{const p=i.activeTextParts[o.id];p.text+=o.delta,p.providerMetadata=(c=o.providerMetadata)!=null?c:p.providerMetadata,m();break}case"text-end":{const p=i.activeTextParts[o.id];p.state="done",p.providerMetadata=(y=o.providerMetadata)!=null?y:p.providerMetadata,delete i.activeTextParts[o.id],m();break}case"reasoning-start":{const p={type:"reasoning",text:"",providerMetadata:o.providerMetadata,state:"streaming"};i.activeReasoningParts[o.id]=p,i.message.parts.push(p),m();break}case"reasoning-delta":{const p=i.activeReasoningParts[o.id];p.text+=o.delta,p.providerMetadata=(v=o.providerMetadata)!=null?v:p.providerMetadata,m();break}case"reasoning-end":{const p=i.activeReasoningParts[o.id];p.providerMetadata=(T=o.providerMetadata)!=null?T:p.providerMetadata,p.state="done",delete i.activeReasoningParts[o.id],m();break}case"file":{i.message.parts.push({type:"file",mediaType:o.mediaType,url:o.url}),m();break}case"source-url":{i.message.parts.push({type:"source-url",sourceId:o.sourceId,url:o.url,title:o.title,providerMetadata:o.providerMetadata}),m();break}case"source-document":{i.message.parts.push({type:"source-document",sourceId:o.sourceId,mediaType:o.mediaType,title:o.title,filename:o.filename,providerMetadata:o.providerMetadata}),m();break}case"tool-input-start":{const p=i.message.parts.filter(je);i.partialToolCalls[o.toolCallId]={text:"",toolName:o.toolName,index:p.length,dynamic:o.dynamic},o.dynamic?g({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted}):b({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted}),m();break}case"tool-input-delta":{const p=i.partialToolCalls[o.toolCallId];p.text+=o.inputTextDelta;const{value:I}=await ka(p.text);p.dynamic?g({toolCallId:o.toolCallId,toolName:p.toolName,state:"input-streaming",input:I}):b({toolCallId:o.toolCallId,toolName:p.toolName,state:"input-streaming",input:I}),m();break}case"tool-input-available":{o.dynamic?g({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}):b({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),m(),l&&!o.providerExecuted&&await l({toolCall:o});break}case"tool-input-error":{o.dynamic?g({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}):b({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:void 0,rawInput:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),m();break}case"tool-output-available":{if(o.dynamic){const p=f(o.toolCallId);g({toolCallId:o.toolCallId,toolName:p.toolName,state:"output-available",input:p.input,output:o.output,preliminary:o.preliminary})}else{const p=x(o.toolCallId);b({toolCallId:o.toolCallId,toolName:St(p),state:"output-available",input:p.input,output:o.output,providerExecuted:o.providerExecuted,preliminary:o.preliminary})}m();break}case"tool-output-error":{if(o.dynamic){const p=f(o.toolCallId);g({toolCallId:o.toolCallId,toolName:p.toolName,state:"output-error",input:p.input,errorText:o.errorText,providerExecuted:o.providerExecuted})}else{const p=x(o.toolCallId);b({toolCallId:o.toolCallId,toolName:St(p),state:"output-error",input:p.input,rawInput:p.rawInput,errorText:o.errorText,providerExecuted:o.providerExecuted})}m();break}case"start-step":{i.message.parts.push({type:"step-start"});break}case"finish-step":{i.activeTextParts={},i.activeReasoningParts={};break}case"start":{o.messageId!=null&&(i.message.id=o.messageId),await E(o.messageMetadata),(o.messageId!=null||o.messageMetadata!=null)&&m();break}case"finish":{o.finishReason!=null&&(i.finishReason=o.finishReason),await E(o.messageMetadata),o.messageMetadata!=null&&m();break}case"message-metadata":{await E(o.messageMetadata),o.messageMetadata!=null&&m();break}case"error":{s?.(new Error(o.errorText));break}default:if(wo(o)){a?.[o.type]!=null&&await ht({value:o.data,schema:a[o.type]});const p=o;if(p.transient){u?.(p);break}const I=p.id!=null?i.message.parts.find(S=>p.type===S.type&&p.id===S.id):void 0;I!=null?I.data=p.data:i.message.parts.push(p),u?.(p),m()}}d.enqueue(o)})}}))}async function jo({stream:e,onError:t}){const a=e.getReader();try{for(;;){const{done:r}=await a.read();if(r)break}}catch(r){t?.(r)}finally{a.releaseLock()}}Ee({prefix:"aitxt",size:24});Ee({prefix:"aiobj",size:24});var Co=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,a)=>{this.queue.push(async()=>{try{await e(),t()}catch(r){a(r)}}),this.processQueue()})}};Ee({prefix:"aiobj",size:24});var ko={};po(ko,{object:()=>Mo,text:()=>Ao});var Ao=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:e}){return{partial:e}},async parseOutput({text:e}){return e}}),Mo=({schema:e})=>{const t=co(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:a}){const r=await ka(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{const s=r.state;throw new Error(`Unsupported parse state: ${s}`)}}},async parseOutput({text:a},r){const s=await De({text:a});if(!s.success)throw new yt({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});const l=await tt({value:s.value,schema:t});if(!l.success)throw new yt({message:"No object generated: response did not match schema.",cause:l.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return l.value}}};async function Ro(e){if(e==null)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw new Error("FileList is not supported in the current environment");return Promise.all(Array.from(e).map(async t=>{const{name:a,type:r}=t,s=await new Promise((l,u)=>{const o=new FileReader;o.onload=d=>{var i;l((i=d.target)==null?void 0:i.result)},o.onerror=d=>u(d),o.readAsDataURL(t)});return{type:"file",mediaType:r,filename:a,url:s}}))}var Po=class{constructor({api:e="/api/chat",credentials:t,headers:a,body:r,fetch:s,prepareSendMessagesRequest:l,prepareReconnectToStreamRequest:u}){this.api=e,this.credentials=t,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=l,this.prepareReconnectToStreamRequest=u}async sendMessages({abortSignal:e,...t}){var a,r,s,l,u;const o=await le(this.body),d=await le(this.headers),i=await le(this.credentials),m={...oe(d),...oe(t.headers)},c=await((a=this.prepareSendMessagesRequest)==null?void 0:a.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...o,...t.body},headers:m,credentials:i,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),y=(r=c?.api)!=null?r:this.api,v=c?.headers!==void 0?oe(c.headers):m,T=c?.body!==void 0?c.body:{...o,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},x=(s=c?.credentials)!=null?s:i,b=await((l=this.fetch)!=null?l:globalThis.fetch)(y,{method:"POST",headers:mt({"Content-Type":"application/json",...v},`ai-sdk/${xt}`,pt()),body:JSON.stringify(T),credentials:x,signal:e});if(!b.ok)throw new Error((u=await b.text())!=null?u:"Failed to fetch the chat response.");if(!b.body)throw new Error("The response body is empty.");return this.processResponseStream(b.body)}async reconnectToStream(e){var t,a,r,s,l;const u=await le(this.body),o=await le(this.headers),d=await le(this.credentials),i={...oe(o),...oe(e.headers)},m=await((t=this.prepareReconnectToStreamRequest)==null?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...u,...e.body},headers:i,credentials:d,requestMetadata:e.metadata})),c=(a=m?.api)!=null?a:`${this.api}/${e.chatId}/stream`,y=m?.headers!==void 0?oe(m.headers):i,v=(r=m?.credentials)!=null?r:d,x=await((s=this.fetch)!=null?s:globalThis.fetch)(c,{method:"GET",headers:mt(y,`ai-sdk/${xt}`,pt()),credentials:v});if(x.status===204)return null;if(!x.ok)throw new Error((l=await x.text())!=null?l:"Failed to fetch the chat response.");if(!x.body)throw new Error("The response body is empty.");return this.processResponseStream(x.body)}},Aa=class extends Po{constructor(e={}){super(e)}processResponseStream(e){return vn({stream:e,schema:Eo}).pipeThrough(new TransformStream({async transform(t,a){if(!t.success)throw t.error;a.enqueue(t.value)}}))}},Do=class{constructor({generateId:e=on,id:t=e(),transport:a=new Aa,messageMetadataSchema:r,dataPartSchemas:s,state:l,onError:u,onToolCall:o,onFinish:d,onData:i,sendAutomaticallyWhen:m}){this.activeResponse=void 0,this.jobExecutor=new Co,this.sendMessage=async(c,y)=>{var v,T,x,f;if(c==null){await this.makeRequest({trigger:"submit-message",messageId:(v=this.lastMessage)==null?void 0:v.id,...y});return}let b;if("text"in c||"files"in c?b={parts:[...Array.isArray(c.files)?c.files:await Ro(c.files),..."text"in c&&c.text!=null?[{type:"text",text:c.text}]:[]]}:b=c,c.messageId!=null){const g=this.state.messages.findIndex(E=>E.id===c.messageId);if(g===-1)throw new Error(`message with id ${c.messageId} not found`);if(this.state.messages[g].role!=="user")throw new Error(`message with id ${c.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,g+1),this.state.replaceMessage(g,{...b,id:c.messageId,role:(T=b.role)!=null?T:"user",metadata:c.metadata})}else this.state.pushMessage({...b,id:(x=b.id)!=null?x:this.generateId(),role:(f=b.role)!=null?f:"user",metadata:c.metadata});await this.makeRequest({trigger:"submit-message",messageId:c.messageId,...y})},this.regenerate=async({messageId:c,...y}={})=>{const v=c==null?this.state.messages.length-1:this.state.messages.findIndex(T=>T.id===c);if(v===-1)throw new Error(`message ${c} not found`);this.state.messages=this.state.messages.slice(0,this.messages[v].role==="assistant"?v:v+1),await this.makeRequest({trigger:"regenerate-message",messageId:c,...y})},this.resumeStream=async(c={})=>{await this.makeRequest({trigger:"resume-stream",...c})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolOutput=async({state:c="output-available",tool:y,toolCallId:v,output:T,errorText:x})=>this.jobExecutor.run(async()=>{var f,b;const g=this.state.messages,E=g[g.length-1];this.state.replaceMessage(g.length-1,{...E,parts:E.parts.map(p=>bt(p)&&p.toolCallId===v?{...p,state:c,output:T,errorText:x}:p)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(p=>bt(p)&&p.toolCallId===v?{...p,state:c,output:T,errorText:x}:p)),this.status!=="streaming"&&this.status!=="submitted"&&((f=this.sendAutomaticallyWhen)!=null&&f.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(b=this.lastMessage)==null?void 0:b.id})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{var c;this.status!=="streaming"&&this.status!=="submitted"||(c=this.activeResponse)!=null&&c.abortController&&this.activeResponse.abortController.abort()},this.id=t,this.transport=a,this.generateId=e,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=l,this.onError=u,this.onToolCall=o,this.onFinish=d,this.onData=i,this.sendAutomaticallyWhen=m}get status(){return this.state.status}setStatus({status:e,error:t}){this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async makeRequest({trigger:e,metadata:t,headers:a,body:r,messageId:s}){var l,u,o,d;this.setStatus({status:"submitted",error:void 0});const i=this.lastMessage;let m=!1,c=!1,y=!1;try{const v={state:No({lastMessage:this.state.snapshot(i),messageId:this.generateId()}),abortController:new AbortController};v.abortController.signal.addEventListener("abort",()=>{m=!0}),this.activeResponse=v;let T;if(e==="resume-stream"){const f=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:a,body:r});if(f==null){this.setStatus({status:"ready"});return}T=f}else T=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:v.abortController.signal,metadata:t,headers:a,body:r,trigger:e,messageId:s});const x=f=>this.jobExecutor.run(()=>f({state:v.state,write:()=>{var b;this.setStatus({status:"streaming"}),v.state.message.id===((b=this.lastMessage)==null?void 0:b.id)?this.state.replaceMessage(this.state.messages.length-1,v.state.message):this.state.pushMessage(v.state.message)}}));await jo({stream:_o({stream:T,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:x,onError:f=>{throw f}}),onError:f=>{throw f}}),this.setStatus({status:"ready"})}catch(v){if(m||v.name==="AbortError")return m=!0,this.setStatus({status:"ready"}),null;y=!0,v instanceof TypeError&&(v.message.toLowerCase().includes("fetch")||v.message.toLowerCase().includes("network"))&&(c=!0),this.onError&&v instanceof Error&&this.onError(v),this.setStatus({status:"error",error:v})}finally{try{(u=this.onFinish)==null||u.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:m,isDisconnect:c,isError:y,finishReason:(l=this.activeResponse)==null?void 0:l.state.finishReason})}catch(v){console.error(v)}this.activeResponse=void 0}(o=this.sendAutomaticallyWhen)!=null&&o.call(this,{messages:this.state.messages})&&!y&&await this.makeRequest({trigger:"submit-message",messageId:(d=this.lastMessage)==null?void 0:d.id,metadata:t,headers:a,body:r})}},qe,Et;function Oo(){if(Et)return qe;Et=1;function e(t,a){if(typeof t!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof t}\`.`);let r,s=0;return function(...u){clearTimeout(r);const o=Date.now(),d=o-s,i=a-d;i<=0?(s=o,t.apply(this,u)):r=setTimeout(()=>{s=Date.now(),t.apply(this,u)},i)}}return qe=e,qe}var Lo=Oo();const Fo=Ka(Lo);var Ma=(e,t,a)=>{if(!t.has(e))throw TypeError("Cannot "+a)},M=(e,t,a)=>(Ma(e,t,"read from private field"),a?a.call(e):t.get(e)),X=(e,t,a)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,a)},ae=(e,t,a,r)=>(Ma(e,t,"write to private field"),t.set(e,a),a);function $o(e,t){return t!=null?Fo(e,t):e}var H,Ce,ke,ge,ve,ye,ce,Ye,Xe,Bo=class{constructor(e=[]){X(this,H,void 0),X(this,Ce,"ready"),X(this,ke,void 0),X(this,ge,new Set),X(this,ve,new Set),X(this,ye,new Set),this.pushMessage=t=>{ae(this,H,M(this,H).concat(t)),M(this,ce).call(this)},this.popMessage=()=>{ae(this,H,M(this,H).slice(0,-1)),M(this,ce).call(this)},this.replaceMessage=(t,a)=>{ae(this,H,[...M(this,H).slice(0,t),this.snapshot(a),...M(this,H).slice(t+1)]),M(this,ce).call(this)},this.snapshot=t=>structuredClone(t),this["~registerMessagesCallback"]=(t,a)=>{const r=a?$o(t,a):t;return M(this,ge).add(r),()=>{M(this,ge).delete(r)}},this["~registerStatusCallback"]=t=>(M(this,ve).add(t),()=>{M(this,ve).delete(t)}),this["~registerErrorCallback"]=t=>(M(this,ye).add(t),()=>{M(this,ye).delete(t)}),X(this,ce,()=>{M(this,ge).forEach(t=>t())}),X(this,Ye,()=>{M(this,ve).forEach(t=>t())}),X(this,Xe,()=>{M(this,ye).forEach(t=>t())}),ae(this,H,e)}get status(){return M(this,Ce)}set status(e){ae(this,Ce,e),M(this,Ye).call(this)}get error(){return M(this,ke)}set error(e){ae(this,ke,e),M(this,Xe).call(this)}get messages(){return M(this,H)}set messages(e){ae(this,H,[...e]),M(this,ce).call(this)}};H=new WeakMap;Ce=new WeakMap;ke=new WeakMap;ge=new WeakMap;ve=new WeakMap;ye=new WeakMap;ce=new WeakMap;Ye=new WeakMap;Xe=new WeakMap;var ue,wt=class extends Do{constructor({messages:t,...a}){const r=new Bo(t);super({...a,state:r}),X(this,ue,void 0),this["~registerMessagesCallback"]=(s,l)=>M(this,ue)["~registerMessagesCallback"](s,l),this["~registerStatusCallback"]=s=>M(this,ue)["~registerStatusCallback"](s),this["~registerErrorCallback"]=s=>M(this,ue)["~registerErrorCallback"](s),ae(this,ue,r)}};ue=new WeakMap;function Uo({experimental_throttle:e,resume:t=!1,...a}={}){const r=h.useRef("chat"in a?a.chat:new wt(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new wt(a));const l=h.useCallback(m=>r.current["~registerMessagesCallback"](m,e),[e,r.current.id]),u=h.useSyncExternalStore(l,()=>r.current.messages,()=>r.current.messages),o=h.useSyncExternalStore(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),d=h.useSyncExternalStore(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),i=h.useCallback(m=>{typeof m=="function"&&(m=m(r.current.messages)),r.current.messages=m},[r]);return h.useEffect(()=>{t&&r.current.resumeStream()},[t,r]),{id:r.current.id,messages:u,setMessages:i,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:d,resumeStream:r.current.resumeStream,status:o,addToolResult:r.current.addToolOutput,addToolOutput:r.current.addToolOutput}}var Tt=Object.prototype.hasOwnProperty;function It(e,t,a){for(a of e.keys())if(xe(a,t))return a}function xe(e,t){var a,r,s;if(e===t)return!0;if(e&&t&&(a=e.constructor)===t.constructor){if(a===Date)return e.getTime()===t.getTime();if(a===RegExp)return e.toString()===t.toString();if(a===Array){if((r=e.length)===t.length)for(;r--&&xe(e[r],t[r]););return r===-1}if(a===Set){if(e.size!==t.size)return!1;for(r of e)if(s=r,s&&typeof s=="object"&&(s=It(t,s),!s)||!t.has(s))return!1;return!0}if(a===Map){if(e.size!==t.size)return!1;for(r of e)if(s=r[0],s&&typeof s=="object"&&(s=It(t,s),!s)||!xe(r[1],t.get(s)))return!1;return!0}if(a===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(a===DataView){if((r=e.byteLength)===t.byteLength)for(;r--&&e.getInt8(r)===t.getInt8(r););return r===-1}if(ArrayBuffer.isView(e)){if((r=e.byteLength)===t.byteLength)for(;r--&&e[r]===t[r];);return r===-1}if(!a||typeof e=="object"){r=0;for(a in e)if(Tt.call(e,a)&&++r&&!Tt.call(t,a)||!(a in t)||!xe(e[a],t[a]))return!1;return Object.keys(t).length===r}}return e!==e&&t!==t}function zo(e){var t=h.useRef(e),a=h.useRef(0);return xe(e,t.current)||(t.current=e,a.current+=1),h.useMemo(function(){return t.current},[a.current])}function Nt(e,t){return h.useEffect(e,zo(t))}const Zo=Ya.defineItem("local:search-actions"),Vo=({messages:e,status:t,conversationId:a})=>{const r=h.useRef(null),u=(e?.[e.length-1]?.parts?.findLast(o=>o?.type?.startsWith("tool-"))??null)?.input?.tabId;h.useEffect(()=>{const o=t==="streaming",d=r.current;if((!o&&d||o&&u&&d&&u!==d)&&d){const c={conversationId:a,isActive:!1};chrome.tabs.sendMessage(d,c).catch(()=>{})}if(o&&u){const c={conversationId:a,isActive:!0};chrome.tabs.sendMessage(u,c).catch(()=>{})}u&&(r.current=u)},[a,t,u])},qo=e=>{const t=e[e.length-1];return t?t.parts.filter(a=>a.type==="text").map(a=>a.text).join(""):""},_t=(e,t)=>{const a=e.findIndex(o=>o.id===t),r=e?.[a]??[],s=e?.[a-1]??[],l=r.parts.filter(o=>o.type==="text").map(o=>o.text).join(`

`),u=s.parts.filter(o=>o.type==="text").map(o=>o.text).join(`
`);return{responseText:l,queryText:u}},jt=e=>e.filter(t=>t.type==="managed").map(t=>t.managedServerName),Ct=e=>e.filter(t=>t.type==="custom").map(t=>({name:t.displayName,url:t.config?.url})),Jo=()=>{const{servers:e}=Fr(),t=h.useRef(jt(e)),a=h.useRef(Ct(e));Nt(()=>{t.current=jt(e),a.current=Ct(e)},[e]);const{providers:r,selectedProvider:s,isLoading:l,setDefaultProvider:u}=$r(),{personalization:o}=fr(),d=h.useRef(o);h.useEffect(()=>{d.current=o},[o]);const{baseUrl:i,isLoading:m,error:c}=Br(),y=h.useRef(i);h.useEffect(()=>{y.current=i},[i]);const v=r.map(C=>({id:C.id,name:C.name,type:C.type})),[T,x]=h.useState("chat"),[f,b]=h.useState(new Map),[g,E]=h.useState({}),[p,I]=h.useState({}),S=h.useRef(crypto.randomUUID()),N=C=>{const{responseText:O,queryText:z}=_t(se,C);ee(Cr,{responseText:O,queryText:z,messageId:C}),E(Y=>({...Y,[C]:!Y[C]}))},k=(C,O)=>{const{responseText:z,queryText:Y}=_t(se,C);ee(jr,{responseText:z,queryText:Y,messageId:C,comment:O}),I(B=>({...B,[C]:!B[C]}))},P=h.useRef(s),U=h.useRef(T),Q=h.useRef(f);Nt(()=>{P.current=s,U.current=T,Q.current=f},[s,T,f]);const me=s?{id:s.id,name:s.name,type:s.id==="browseros"?"browseros":s.type}:v[0],{messages:se,sendMessage:Le,setMessages:fe,status:we,stop:Te,error:Ie}=Uo({transport:new Aa({prepareSendMessagesRequest:async({messages:C})=>{const z=(await chrome.tabs.query({active:!0,currentWindow:!0}))?.[0]??void 0,Y=qo(C),B=P.current,Ra=U.current,st=t.current,nt=a.current,ot=(he=>Q.current.get(he))(Y),ie={};return z&&(ie.windowId=z.windowId,ie.activeTab={id:z.id,url:z.url,title:z.title}),ot?.tabs?.length&&(ie.selectedTabs=ot?.tabs?.map(he=>({id:he.id,url:he.url,title:he.title}))),st.length&&(ie.enabledMcpServers=hr(st)),nt.length&&(ie.customMcpServers=nt),{api:`${y.current}/chat`,body:{message:Y,provider:B?.type,providerType:B?.type,providerName:B?.name,apiKey:B?.apiKey,baseUrl:B?.baseUrl,conversationId:S.current,model:B?.modelId??"default",mode:Ra,contextWindowSize:B?.contextWindow,temperature:B?.temperature,resourceName:B?.resourceName,accessKeyId:B?.accessKeyId,secretAccessKey:B?.secretAccessKey,region:B?.region,sessionToken:B?.sessionToken,browserContext:ie,userSystemPrompt:d.current}}}})});Vo({messages:se,status:we,conversationId:S.current});const Ne=C=>{if(ee(_r,{mode:T,provider_type:s?.type,model:s?.modelId}),C.action){const O=C.action;b(z=>{const Y=new Map(z);return Y.set(C.text,O),Y})}Le({text:C.text})};return h.useEffect(()=>{const C=Zo.watch(O=>{O&&(x(O.mode),Ne({text:O.query,action:O.action}))});return()=>C()},[]),{mode:T,setMode:x,messages:se,sendMessage:Ne,status:we,stop:Te,providers:v,selectedProvider:me,isLoading:l||m,agentUrlError:c,chatError:Ie,handleSelectProvider:C=>{ee(Ar,{provider_id:C.id,provider_type:C.type}),u(C.id)},getActionForMessage:C=>{if(C.role!=="user")return;const O=C.parts.filter(z=>z.type==="text").map(z=>z.text).join("");return f.get(O)},resetConversation:()=>{ee(kr,{message_count:se.length}),Te();const C=S.current;S.current=crypto.randomUUID(),fe([]),b(new Map),E({}),I({}),i&&C&&fetch(`${i}/chat/${C}`,{method:"DELETE"}).catch(()=>{})},liked:g,onClickLike:N,disliked:p,onClickDislike:k}},Ho=()=>{const{mode:e,setMode:t,messages:a,sendMessage:r,status:s,stop:l,providers:u,selectedProvider:o,isLoading:d,agentUrlError:i,chatError:m,handleSelectProvider:c,getActionForMessage:y,resetConversation:v,liked:T,onClickLike:x,disliked:f,onClickDislike:b}=Jo(),{popupVisible:g,recordMessageSent:E,triggerIfEligible:p,onTakeSurvey:I,onDismiss:S}=is(),[N,k]=h.useState(""),[P,U]=h.useState([]),Q=h.useRef(null),[me,se]=h.useState(!1);h.useEffect(()=>{se(!0)},[]),h.useEffect(()=>{(async()=>{const $=(await chrome.tabs.query({active:!0,currentWindow:!0})).filter(V=>V.url?.startsWith("http"));U($)})()},[]);const Le=()=>{Q.current?.scrollIntoView({behavior:"smooth"})};h.useEffect(()=>{Le()},[a]);const fe=h.useRef(s);h.useEffect(()=>{(fe.current==="streaming"||fe.current==="submitted")&&s==="ready"&&a.length>0&&p(),fe.current=s},[s]);const we=$=>{U(V=>V.some(O=>O.id===$.id)?V.filter(O=>O.id!==$.id):[...V,$])},Te=$=>{U(V=>V.filter(C=>C.id!==$))},Ie=$=>{const V=$||N.trim();if(V){if(E(),P.length){const C=gr({mode:e,message:V,tabs:P});r({text:V,action:C})}else r({text:V});k(""),U([])}},Ne=$=>{$.preventDefault(),a.length===0&&ee(Mr,{mode:e,tabs_count:P.length}),Ie()},rt=$=>{Ie($)};return d||!o?n.jsx("div",{className:"flex h-screen w-screen items-center justify-center bg-background",children:n.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-muted-foreground border-t-transparent"})}):n.jsxs("div",{className:"mx-auto flex h-screen w-screen flex-col bg-background text-foreground",children:[n.jsx(ys,{selectedProvider:o,onSelectProvider:c,providers:u,onNewConversation:v,hasMessages:a.length>0}),n.jsxs("main",{className:"mt-4 flex h-full flex-1 flex-col space-y-4 overflow-y-auto",children:[a.length===0?n.jsx(us,{mode:e,mounted:me,onSuggestionClick:rt}):n.jsx(Gs,{messages:a,status:s,messagesEndRef:Q,getActionForMessage:y,liked:T,onClickLike:x,disliked:f,onClickDislike:b,showJtbdPopup:g,onTakeSurvey:I,onDismissJtbdPopup:S}),i&&n.jsx(lt,{error:i}),m&&n.jsx(lt,{error:m})]}),n.jsx(gs,{mode:e,onModeChange:t,input:N,onInputChange:k,onSubmit:Ne,status:s,onStop:l,attachedTabs:P,onToggleTab:we,onRemoveTab:Te})]})},Wo=()=>n.jsx(Xa,{children:n.jsx(Qa,{children:n.jsx(er,{index:!0,element:n.jsx(Ho,{})})})}),kt=document.getElementById("root");kt&&tr.createRoot(kt,ar).render(n.jsx(rr.StrictMode,{children:n.jsx(sr,{children:n.jsxs(nr,{children:[n.jsx(Wo,{}),n.jsx(or,{})]})})}));
