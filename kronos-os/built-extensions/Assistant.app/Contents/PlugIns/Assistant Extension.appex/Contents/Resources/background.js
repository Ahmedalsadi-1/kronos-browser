var background=(function(){"use strict";(function(){try{var Be=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};Be.SENTRY_RELEASE={id:"cef3d2e981a8c76e9e817128ae6fc814ac1270e0"}}catch{}})();try{(function(){var Be=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},At=new Be.Error().stack;At&&(Be._sentryDebugIds=Be._sentryDebugIds||{},Be._sentryDebugIds[At]="cf2480ac-5b59-4fb1-adf2-5d897b2fde44",Be._sentryDebugIdIdentifier="sentry-dbid-cf2480ac-5b59-4fb1-adf2-5d897b2fde44")})()}catch{}function Be(e){return e==null||typeof e=="function"?{main:e}:e}const At={small:512,medium:768,large:1028};class st{static instance=null;constructor(){}static getInstance(){return st.instance||(st.instance=new st),st.instance}async getInteractiveSnapshot(t,r){return new Promise((n,s)=>{const o=a=>{chrome.runtime.lastError?s(new Error(chrome.runtime.lastError.message||"Unknown error")):n(a)};r?chrome.browserOS.getInteractiveSnapshot(t,r,o):chrome.browserOS.getInteractiveSnapshot(t,o)})}async click(t,r){return new Promise((n,s)=>{chrome.browserOS.click(t,r,()=>{chrome.runtime.lastError?s(new Error(chrome.runtime.lastError.message||"Unknown error")):n()})})}async inputText(t,r,n){return new Promise((s,o)=>{chrome.browserOS.inputText(t,r,n,()=>{chrome.runtime.lastError?o(new Error(chrome.runtime.lastError.message||"Unknown error")):s()})})}async clear(t,r){return new Promise((n,s)=>{chrome.browserOS.clear(t,r,()=>{chrome.runtime.lastError?s(new Error(chrome.runtime.lastError.message||"Unknown error")):n()})})}async scrollToNode(t,r){return new Promise((n,s)=>{chrome.browserOS.scrollToNode(t,r,o=>{chrome.runtime.lastError?s(new Error(chrome.runtime.lastError.message||"Unknown error")):n(o)})})}async sendKeys(t,r){return new Promise((n,s)=>{chrome.browserOS.sendKeys(t,r,()=>{chrome.runtime.lastError?s(new Error(chrome.runtime.lastError.message||"Unknown error")):n()})})}async getPageLoadStatus(t){return new Promise((r,n)=>{chrome.browserOS.getPageLoadStatus(t,s=>{chrome.runtime.lastError?n(new Error(chrome.runtime.lastError.message||"Unknown error")):r(s)})})}async getAccessibilityTree(t){return new Promise((r,n)=>{chrome.browserOS.getAccessibilityTree(t,s=>{chrome.runtime.lastError?n(new Error(chrome.runtime.lastError.message||"Unknown error")):r(s)})})}async captureScreenshot(t,r,n,s,o){return new Promise((a,i)=>{const c=l=>{chrome.runtime.lastError?i(new Error(chrome.runtime.lastError.message||"Unknown error")):a(l)};if(s!==void 0&&o!==void 0)chrome.browserOS.captureScreenshot(t,0,n||!1,s,o,c);else if(r!==void 0||n!==void 0){const l=r?At[r]:0;n!==void 0?chrome.browserOS.captureScreenshot(t,l,n,c):chrome.browserOS.captureScreenshot(t,l,c)}else chrome.browserOS.captureScreenshot(t,c)})}async getSnapshot(t,r){return new Promise((n,s)=>{const o=a=>{chrome.runtime.lastError?s(new Error(chrome.runtime.lastError.message||"Unknown error")):n(a)};r?chrome.browserOS.getSnapshot(t,r,o):chrome.browserOS.getSnapshot(t,o)})}async getVersion(){return new Promise((t,r)=>{if(typeof chrome.browserOS.getVersionNumber!="function"){t(null);return}chrome.browserOS.getVersionNumber(n=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message||"Unknown error")):t(n)})})}async getBrowserosVersion(){return new Promise((t,r)=>{if(typeof chrome.browserOS.getBrowserosVersionNumber!="function"){t(null);return}chrome.browserOS.getBrowserosVersionNumber(n=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message||"Unknown error")):t(n)})})}async logMetric(t,r){if(typeof chrome.browserOS.logMetric=="function")return new Promise((n,s)=>{const o=()=>{chrome.runtime.lastError?s(new Error(chrome.runtime.lastError.message||"Unknown error")):n()};r?chrome.browserOS.logMetric(t,r,o):chrome.browserOS.logMetric(t,o)})}async executeJavaScript(t,r){if(typeof chrome.browserOS.executeJavaScript!="function")throw new Error("executeJavaScript API not available");return new Promise((n,s)=>{chrome.browserOS.executeJavaScript(t,r,o=>{chrome.runtime.lastError?s(new Error(chrome.runtime.lastError.message||"Unknown error")):n(o)})})}async clickCoordinates(t,r,n){if(typeof chrome.browserOS.clickCoordinates!="function")throw new Error("clickCoordinates API not available");return new Promise((s,o)=>{chrome.browserOS.clickCoordinates(t,r,n,()=>{chrome.runtime.lastError?o(new Error(chrome.runtime.lastError.message||"Unknown error")):s()})})}async typeAtCoordinates(t,r,n,s){if(typeof chrome.browserOS.typeAtCoordinates!="function")throw new Error("typeAtCoordinates API not available");return new Promise((o,a)=>{chrome.browserOS.typeAtCoordinates(t,r,n,s,()=>{chrome.runtime.lastError?a(new Error(chrome.runtime.lastError.message||"Unknown error")):o()})})}async getPref(t){if(typeof chrome.browserOS?.getPref!="function")throw new Error("getPref API not available");return new Promise((r,n)=>{chrome.browserOS.getPref(t,s=>{chrome.runtime.lastError?n(new Error(chrome.runtime.lastError.message||"Unknown error")):r(s)})})}async setPref(t,r,n){if(typeof chrome.browserOS?.setPref!="function")throw new Error("setPref API not available");return new Promise((s,o)=>{const a=i=>{chrome.runtime.lastError?o(new Error(chrome.runtime.lastError.message||"Unknown error")):s(i)};n!==void 0?chrome.browserOS.setPref(t,r,n,a):chrome.browserOS.setPref(t,r,a)})}async getAllPrefs(){if(typeof chrome.browserOS?.getAllPrefs!="function")throw new Error("getAllPrefs API not available");return new Promise((t,r)=>{chrome.browserOS.getAllPrefs(n=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message||"Unknown error")):t(n)})})}isAPIAvailable(t){return t in chrome.browserOS}getAvailableAPIs(){return Object.keys(chrome.browserOS).filter(t=>typeof chrome.browserOS[t]=="function")}}const gn=()=>st.getInstance(),Ac="browseros.server.version";var Ks=(e=>(e.OPENAI_COMPATIBLE_SUPPORT="OPENAI_COMPATIBLE_SUPPORT",e.MANAGED_MCP_SUPPORT="MANAGED_MCP_SUPPORT",e.PERSONALIZATION_SUPPORT="PERSONALIZATION_SUPPORT",e.UNIFIED_PORT_SUPPORT="UNIFIED_PORT_SUPPORT",e.CUSTOMIZATION_SUPPORT="CUSTOMIZATION_SUPPORT",e))(Ks||{});const Ic={OPENAI_COMPATIBLE_SUPPORT:{minBrowserOSVersion:"0.33.0.1"},MANAGED_MCP_SUPPORT:{minBrowserOSVersion:"0.34.0.0"},PERSONALIZATION_SUPPORT:{minBrowserOSVersion:"0.36.1.0"},UNIFIED_PORT_SUPPORT:{minBrowserOSVersion:"0.36.1.0"},CUSTOMIZATION_SUPPORT:{minBrowserOSVersion:"0.36.1.0"}};function Bt(e){const t=e.split(".").map(Number);if(t.length<2||t.some(Number.isNaN))throw new Error(`Invalid version format: ${e}`);return t}function Js(e,t){const r=Math.max(e.length,t.length);for(let n=0;n<r;n++){const s=e[n]??0,o=t[n]??0;if(s<o)return-1;if(s>o)return 1}return 0}function Bs(e,t,r){return!(!e||t&&Js(e,Bt(t))<0||r&&Js(e,Bt(r))>=0)}let It=null,Ot=null,Ct=!1;const _n={async initialize(){if(Ct)return;const e=st.getInstance();try{const t=await e.getBrowserosVersion();t&&(It=Bt(t))}catch{}try{const t=await e.getPref(Ac);t?.value&&(Ot=Bt(t.value))}catch{}Ct=!0},supports(e){if(!Ct)throw new Error("Capabilities.initialize() must be called before supports()");const t=Ic[e];return!(!t||(t.minBrowserOSVersion||t.maxBrowserOSVersion)&&!Bs(It,t.minBrowserOSVersion,t.maxBrowserOSVersion)||(t.minServerVersion||t.maxServerVersion)&&!Bs(Ot,t.minServerVersion,t.maxServerVersion))},getBrowserOSVersion(){return It?It.join("."):null},getServerVersion(){return Ot?Ot.join("."):null},isInitialized(){return Ct},reset(){It=null,Ot=null,Ct=!1}},Oc=Object.freeze({status:"aborted"});function j(e,t,r){function n(i,c){if(i._zod||Object.defineProperty(i,"_zod",{value:{def:c,constr:a,traits:new Set},enumerable:!1}),i._zod.traits.has(e))return;i._zod.traits.add(e),t(i,c);const l=a.prototype,d=Object.keys(l);for(let S=0;S<d.length;S++){const _=d[S];_ in i||(i[_]=l[_].bind(i))}}const s=r?.Parent??Object;class o extends s{}Object.defineProperty(o,"name",{value:e});function a(i){var c;const l=r?.Parent?new o:this;n(l,i),(c=l._zod).deferred??(c.deferred=[]);for(const d of l._zod.deferred)d();return l}return Object.defineProperty(a,"init",{value:n}),Object.defineProperty(a,Symbol.hasInstance,{value:i=>r?.Parent&&i instanceof r.Parent?!0:i?._zod?.traits?.has(e)}),Object.defineProperty(a,"name",{value:e}),a}class ht extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Ws extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const Gs={};function Qe(e){return Gs}function Ys(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,s])=>t.indexOf(+n)===-1).map(([n,s])=>s)}function yn(e,t){return typeof t=="bigint"?t.toString():t}function Wt(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function vn(e){return e==null}function wn(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function Cc(e,t){const r=(e.toString().split(".")[1]||"").length,n=t.toString();let s=(n.split(".")[1]||"").length;if(s===0&&/\d?e-\d?/.test(n)){const c=n.match(/\d?e-(\d?)/);c?.[1]&&(s=Number.parseInt(c[1]))}const o=r>s?r:s,a=Number.parseInt(e.toFixed(o).replace(".","")),i=Number.parseInt(t.toFixed(o).replace(".",""));return a%i/10**o}const Qs=Symbol("evaluating");function fe(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==Qs)return n===void 0&&(n=Qs,n=r()),n},set(s){Object.defineProperty(e,t,{value:s})},configurable:!0})}function ot(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function at(...e){const t={};for(const r of e){const n=Object.getOwnPropertyDescriptors(r);Object.assign(t,n)}return Object.defineProperties({},t)}function Xs(e){return JSON.stringify(e)}function Nc(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const eo="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Nt(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const zc=Wt(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function pt(e){if(Nt(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const r=t.prototype;return!(Nt(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function to(e){return pt(e)?{...e}:Array.isArray(e)?[...e]:e}const Mc=new Set(["string","number","symbol"]);function mt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Xe(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function B(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function jc(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const qc={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function xc(e,t){const r=e._zod.def,n=at(e._zod.def,{get shape(){const s={};for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(s[o]=r.shape[o])}return ot(this,"shape",s),s},checks:[]});return Xe(e,n)}function Uc(e,t){const r=e._zod.def,n=at(e._zod.def,{get shape(){const s={...e._zod.def.shape};for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&delete s[o]}return ot(this,"shape",s),s},checks:[]});return Xe(e,n)}function Dc(e,t){if(!pt(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const s=at(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t};return ot(this,"shape",o),o},checks:[]});return Xe(e,s)}function Lc(e,t){if(!pt(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r={...e._zod.def,get shape(){const n={...e._zod.def.shape,...t};return ot(this,"shape",n),n},checks:e._zod.def.checks};return Xe(e,r)}function Vc(e,t){const r=at(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return ot(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return Xe(e,r)}function Zc(e,t,r){const n=at(t._zod.def,{get shape(){const s=t._zod.def.shape,o={...s};if(r)for(const a in r){if(!(a in s))throw new Error(`Unrecognized key: "${a}"`);r[a]&&(o[a]=e?new e({type:"optional",innerType:s[a]}):s[a])}else for(const a in s)o[a]=e?new e({type:"optional",innerType:s[a]}):s[a];return ot(this,"shape",o),o},checks:[]});return Xe(t,n)}function Fc(e,t,r){const n=at(t._zod.def,{get shape(){const s=t._zod.def.shape,o={...s};if(r)for(const a in r){if(!(a in o))throw new Error(`Unrecognized key: "${a}"`);r[a]&&(o[a]=new e({type:"nonoptional",innerType:s[a]}))}else for(const a in s)o[a]=new e({type:"nonoptional",innerType:s[a]});return ot(this,"shape",o),o},checks:[]});return Xe(t,n)}function gt(e,t=0){if(e.aborted===!0)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function _t(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function Gt(e){return typeof e=="string"?e:e?.message}function et(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const s=Gt(e.inst?._zod.def?.error?.(e))??Gt(t?.error?.(e))??Gt(r.customError?.(e))??Gt(r.localeError?.(e))??"Invalid input";n.message=s}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function bn(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function zt(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const ro=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,yn,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},no=j("$ZodError",ro),so=j("$ZodError",ro,{Parent:Error});function Hc(e,t=r=>r.message){const r={},n=[];for(const s of e.issues)s.path.length>0?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(t(s))):n.push(t(s));return{formErrors:n,fieldErrors:r}}function Kc(e,t=r=>r.message){const r={_errors:[]},n=s=>{for(const o of s.issues)if(o.code==="invalid_union"&&o.errors.length)o.errors.map(a=>n({issues:a}));else if(o.code==="invalid_key")n({issues:o.issues});else if(o.code==="invalid_element")n({issues:o.issues});else if(o.path.length===0)r._errors.push(t(o));else{let a=r,i=0;for(;i<o.path.length;){const c=o.path[i];i===o.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(t(o))):a[c]=a[c]||{_errors:[]},a=a[c],i++}}};return n(e),r}const Sn=e=>(t,r,n,s)=>{const o=n?Object.assign(n,{async:!1}):{async:!1},a=t._zod.run({value:r,issues:[]},o);if(a instanceof Promise)throw new ht;if(a.issues.length){const i=new(s?.Err??e)(a.issues.map(c=>et(c,o,Qe())));throw eo(i,s?.callee),i}return a.value},$n=e=>async(t,r,n,s)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let a=t._zod.run({value:r,issues:[]},o);if(a instanceof Promise&&(a=await a),a.issues.length){const i=new(s?.Err??e)(a.issues.map(c=>et(c,o,Qe())));throw eo(i,s?.callee),i}return a.value},Yt=e=>(t,r,n)=>{const s=n?{...n,async:!1}:{async:!1},o=t._zod.run({value:r,issues:[]},s);if(o instanceof Promise)throw new ht;return o.issues.length?{success:!1,error:new(e??no)(o.issues.map(a=>et(a,s,Qe())))}:{success:!0,data:o.value}},oo=Yt(so),Qt=e=>async(t,r,n)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let o=t._zod.run({value:r,issues:[]},s);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new e(o.issues.map(a=>et(a,s,Qe())))}:{success:!0,data:o.value}},Jc=Qt(so),Bc=e=>(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Sn(e)(t,r,s)},Wc=e=>(t,r,n)=>Sn(e)(t,r,n),Gc=e=>async(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return $n(e)(t,r,s)},Yc=e=>async(t,r,n)=>$n(e)(t,r,n),Qc=e=>(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Yt(e)(t,r,s)},Xc=e=>(t,r,n)=>Yt(e)(t,r,n),eu=e=>async(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Qt(e)(t,r,s)},tu=e=>async(t,r,n)=>Qt(e)(t,r,n),ru=/^[cC][^\s-]{8,}$/,nu=/^[0-9a-z]+$/,su=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,ou=/^[0-9a-vA-V]{20}$/,au=/^[A-Za-z0-9]{27}$/,iu=/^[a-zA-Z0-9_-]{21}$/,cu=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,uu=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ao=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,lu=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,du="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function fu(){return new RegExp(du,"u")}const hu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,pu=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,mu=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,gu=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,_u=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,io=/^[A-Za-z0-9_-]*$/,yu=/^\+(?:[0-9]){6,14}[0-9]$/,co="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",vu=new RegExp(`^${co}$`);function uo(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function wu(e){return new RegExp(`^${uo(e)}$`)}function bu(e){const t=uo({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${co}T(?:${n})$`)}const Su=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},$u=/^-?\d+$/,Eu=/^-?\d+(?:\.\d+)?/,ku=/^(?:true|false)$/i,Tu=/^null$/i,Pu=/^[^A-Z]*$/,Ru=/^[^a-z]*$/,Me=j("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),lo={number:"number",bigint:"bigint",object:"date"},fo=j("$ZodCheckLessThan",(e,t)=>{Me.init(e,t);const r=lo[typeof t.value];e._zod.onattach.push(n=>{const s=n._zod.bag,o=(t.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<o&&(t.inclusive?s.maximum=t.value:s.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),ho=j("$ZodCheckGreaterThan",(e,t)=>{Me.init(e,t);const r=lo[typeof t.value];e._zod.onattach.push(n=>{const s=n._zod.bag,o=(t.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>o&&(t.inclusive?s.minimum=t.value:s.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Au=j("$ZodCheckMultipleOf",(e,t)=>{Me.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):Cc(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),Iu=j("$ZodCheckNumberFormat",(e,t)=>{Me.init(e,t),t.format=t.format||"float64";const r=t.format?.includes("int"),n=r?"int":"number",[s,o]=qc[t.format];e._zod.onattach.push(a=>{const i=a._zod.bag;i.format=t.format,i.minimum=s,i.maximum=o,r&&(i.pattern=$u)}),e._zod.check=a=>{const i=a.value;if(r){if(!Number.isInteger(i)){a.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:i,inst:e});return}if(!Number.isSafeInteger(i)){i>0?a.issues.push({input:i,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}):a.issues.push({input:i,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort});return}}i<s&&a.issues.push({origin:"number",input:i,code:"too_small",minimum:s,inclusive:!0,inst:e,continue:!t.abort}),i>o&&a.issues.push({origin:"number",input:i,code:"too_big",maximum:o,inst:e})}}),Ou=j("$ZodCheckMaxLength",(e,t)=>{var r;Me.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!vn(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const s=n.value;if(s.length<=t.maximum)return;const a=bn(s);n.issues.push({origin:a,code:"too_big",maximum:t.maximum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),Cu=j("$ZodCheckMinLength",(e,t)=>{var r;Me.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!vn(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const s=n.value;if(s.length>=t.minimum)return;const a=bn(s);n.issues.push({origin:a,code:"too_small",minimum:t.minimum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),Nu=j("$ZodCheckLengthEquals",(e,t)=>{var r;Me.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!vn(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=n=>{const s=n.value,o=s.length;if(o===t.length)return;const a=bn(s),i=o>t.length;n.issues.push({origin:a,...i?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),Xt=j("$ZodCheckStringFormat",(e,t)=>{var r,n;Me.init(e,t),e._zod.onattach.push(s=>{const o=s._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=s=>{t.pattern.lastIndex=0,!t.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:t.format,input:s.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),zu=j("$ZodCheckRegex",(e,t)=>{Xt.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Mu=j("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Pu),Xt.init(e,t)}),ju=j("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Ru),Xt.init(e,t)}),qu=j("$ZodCheckIncludes",(e,t)=>{Me.init(e,t);const r=mt(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(s=>{const o=s._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=s=>{s.value.includes(t.includes,t.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:s.value,inst:e,continue:!t.abort})}}),xu=j("$ZodCheckStartsWith",(e,t)=>{Me.init(e,t);const r=new RegExp(`^${mt(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),Uu=j("$ZodCheckEndsWith",(e,t)=>{Me.init(e,t);const r=new RegExp(`.*${mt(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),Du=j("$ZodCheckOverwrite",(e,t)=>{Me.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class Lu{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(a=>a),s=Math.min(...n.map(a=>a.length-a.trimStart().length)),o=n.map(a=>a.slice(s)).map(a=>" ".repeat(this.indent*2)+a);for(const a of o)this.content.push(a)}compile(){const t=Function,r=this?.args,s=[...(this?.content??[""]).map(o=>`  ${o}`)];return new t(...r,s.join(`
`))}}const Vu={major:4,minor:2,patch:1},pe=j("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Vu;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const s of n)for(const o of s._zod.onattach)o(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const s=(a,i,c)=>{let l=gt(a),d;for(const S of i){if(S._zod.def.when){if(!S._zod.def.when(a))continue}else if(l)continue;const _=a.issues.length,w=S._zod.check(a);if(w instanceof Promise&&c?.async===!1)throw new ht;if(d||w instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await w,a.issues.length!==_&&(l||(l=gt(a,_)))});else{if(a.issues.length===_)continue;l||(l=gt(a,_))}}return d?d.then(()=>a):a},o=(a,i,c)=>{if(gt(a))return a.aborted=!0,a;const l=s(i,n,c);if(l instanceof Promise){if(c.async===!1)throw new ht;return l.then(d=>e._zod.parse(d,c))}return e._zod.parse(l,c)};e._zod.run=(a,i)=>{if(i.skipChecks)return e._zod.parse(a,i);if(i.direction==="backward"){const l=e._zod.parse({value:a.value,issues:[]},{...i,skipChecks:!0});return l instanceof Promise?l.then(d=>o(d,a,i)):o(l,a,i)}const c=e._zod.parse(a,i);if(c instanceof Promise){if(i.async===!1)throw new ht;return c.then(l=>s(l,n,i))}return s(c,n,i)}}e["~standard"]={validate:s=>{try{const o=oo(e,s);return o.success?{value:o.data}:{issues:o.error?.issues}}catch{return Jc(e,s).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),En=j("$ZodString",(e,t)=>{pe.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??Su(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),ge=j("$ZodStringFormat",(e,t)=>{Xt.init(e,t),En.init(e,t)}),Zu=j("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=uu),ge.init(e,t)}),Fu=j("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=ao(n))}else t.pattern??(t.pattern=ao());ge.init(e,t)}),Hu=j("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=lu),ge.init(e,t)}),Ku=j("$ZodURL",(e,t)=>{ge.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),s=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(s.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=s.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),Ju=j("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=fu()),ge.init(e,t)}),Bu=j("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=iu),ge.init(e,t)}),Wu=j("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=ru),ge.init(e,t)}),Gu=j("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=nu),ge.init(e,t)}),Yu=j("$ZodULID",(e,t)=>{t.pattern??(t.pattern=su),ge.init(e,t)}),Qu=j("$ZodXID",(e,t)=>{t.pattern??(t.pattern=ou),ge.init(e,t)}),Xu=j("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=au),ge.init(e,t)}),el=j("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=bu(t)),ge.init(e,t)}),tl=j("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=vu),ge.init(e,t)}),rl=j("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=wu(t)),ge.init(e,t)}),nl=j("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=cu),ge.init(e,t)}),sl=j("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=hu),ge.init(e,t),e._zod.bag.format="ipv4"}),ol=j("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=pu),ge.init(e,t),e._zod.bag.format="ipv6",e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),al=j("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=mu),ge.init(e,t)}),il=j("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=gu),ge.init(e,t),e._zod.check=r=>{const n=r.value.split("/");try{if(n.length!==2)throw new Error;const[s,o]=n;if(!o)throw new Error;const a=Number(o);if(`${a}`!==o)throw new Error;if(a<0||a>128)throw new Error;new URL(`http://[${s}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function po(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const cl=j("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=_u),ge.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=r=>{po(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function ul(e){if(!io.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return po(r)}const ll=j("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=io),ge.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=r=>{ul(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),dl=j("$ZodE164",(e,t)=>{t.pattern??(t.pattern=yu),ge.init(e,t)});function fl(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const s=JSON.parse(atob(n));return!("typ"in s&&s?.typ!=="JWT"||!s.alg||t&&(!("alg"in s)||s.alg!==t))}catch{return!1}}const hl=j("$ZodJWT",(e,t)=>{ge.init(e,t),e._zod.check=r=>{fl(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),mo=j("$ZodNumber",(e,t)=>{pe.init(e,t),e._zod.pattern=e._zod.bag.pattern??Eu,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const s=r.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return r;const o=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:s,inst:e,...o?{received:o}:{}}),r}}),pl=j("$ZodNumberFormat",(e,t)=>{Iu.init(e,t),mo.init(e,t)}),ml=j("$ZodBoolean",(e,t)=>{pe.init(e,t),e._zod.pattern=ku,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const s=r.value;return typeof s=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:s,inst:e}),r}}),gl=j("$ZodNull",(e,t)=>{pe.init(e,t),e._zod.pattern=Tu,e._zod.values=new Set([null]),e._zod.parse=(r,n)=>{const s=r.value;return s===null||r.issues.push({expected:"null",code:"invalid_type",input:s,inst:e}),r}}),_l=j("$ZodAny",(e,t)=>{pe.init(e,t),e._zod.parse=r=>r}),yl=j("$ZodUnknown",(e,t)=>{pe.init(e,t),e._zod.parse=r=>r}),vl=j("$ZodNever",(e,t)=>{pe.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)});function go(e,t,r){e.issues.length&&t.issues.push(..._t(r,e.issues)),t.value[r]=e.value}const wl=j("$ZodArray",(e,t)=>{pe.init(e,t),e._zod.parse=(r,n)=>{const s=r.value;if(!Array.isArray(s))return r.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),r;r.value=Array(s.length);const o=[];for(let a=0;a<s.length;a++){const i=s[a],c=t.element._zod.run({value:i,issues:[]},n);c instanceof Promise?o.push(c.then(l=>go(l,r,a))):go(c,r,a)}return o.length?Promise.all(o).then(()=>r):r}});function er(e,t,r,n){e.issues.length&&t.issues.push(..._t(r,e.issues)),e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function _o(e){const t=Object.keys(e.shape);for(const n of t)if(!e.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const r=jc(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function yo(e,t,r,n,s,o){const a=[],i=s.keySet,c=s.catchall._zod,l=c.def.type;for(const d in t){if(i.has(d))continue;if(l==="never"){a.push(d);continue}const S=c.run({value:t[d],issues:[]},n);S instanceof Promise?e.push(S.then(_=>er(_,r,d,t))):er(S,r,d,t)}return a.length&&r.issues.push({code:"unrecognized_keys",keys:a,input:t,inst:o}),e.length?Promise.all(e).then(()=>r):r}const bl=j("$ZodObject",(e,t)=>{if(pe.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const i=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...i};return Object.defineProperty(t,"shape",{value:c}),c}})}const n=Wt(()=>_o(t));fe(e._zod,"propValues",()=>{const i=t.shape,c={};for(const l in i){const d=i[l]._zod;if(d.values){c[l]??(c[l]=new Set);for(const S of d.values)c[l].add(S)}}return c});const s=Nt,o=t.catchall;let a;e._zod.parse=(i,c)=>{a??(a=n.value);const l=i.value;if(!s(l))return i.issues.push({expected:"object",code:"invalid_type",input:l,inst:e}),i;i.value={};const d=[],S=a.shape;for(const _ of a.keys){const E=S[_]._zod.run({value:l[_],issues:[]},c);E instanceof Promise?d.push(E.then(g=>er(g,i,_,l))):er(E,i,_,l)}return o?yo(d,l,i,c,n.value,e):d.length?Promise.all(d).then(()=>i):i}}),Sl=j("$ZodObjectJIT",(e,t)=>{bl.init(e,t);const r=e._zod.parse,n=Wt(()=>_o(t)),s=_=>{const w=new Lu(["shape","payload","ctx"]),E=n.value,g=p=>{const $=Xs(p);return`shape[${$}]._zod.run({ value: input[${$}], issues: [] }, ctx)`};w.write("const input = payload.value;");const f=Object.create(null);let h=0;for(const p of E.keys)f[p]=`key_${h++}`;w.write("const newResult = {};");for(const p of E.keys){const $=f[p],m=Xs(p);w.write(`const ${$} = ${g(p)};`),w.write(`
        if (${$}.issues.length) {
          payload.issues = payload.issues.concat(${$}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${m}, ...iss.path] : [${m}]
          })));
        }
        
        
        if (${$}.value === undefined) {
          if (${m} in input) {
            newResult[${m}] = undefined;
          }
        } else {
          newResult[${m}] = ${$}.value;
        }
        
      `)}w.write("payload.value = newResult;"),w.write("return payload;");const u=w.compile();return(p,$)=>u(_,p,$)};let o;const a=Nt,i=!Gs.jitless,l=i&&zc.value,d=t.catchall;let S;e._zod.parse=(_,w)=>{S??(S=n.value);const E=_.value;return a(E)?i&&l&&w?.async===!1&&w.jitless!==!0?(o||(o=s(t.shape)),_=o(_,w),d?yo([],E,_,w,S,e):_):r(_,w):(_.issues.push({expected:"object",code:"invalid_type",input:E,inst:e}),_)}});function vo(e,t,r,n){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;const s=e.filter(o=>!gt(o));return s.length===1?(t.value=s[0].value,s[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(o=>o.issues.map(a=>et(a,n,Qe())))}),t)}const wo=j("$ZodUnion",(e,t)=>{pe.init(e,t),fe(e._zod,"optin",()=>t.options.some(s=>s._zod.optin==="optional")?"optional":void 0),fe(e._zod,"optout",()=>t.options.some(s=>s._zod.optout==="optional")?"optional":void 0),fe(e._zod,"values",()=>{if(t.options.every(s=>s._zod.values))return new Set(t.options.flatMap(s=>Array.from(s._zod.values)))}),fe(e._zod,"pattern",()=>{if(t.options.every(s=>s._zod.pattern)){const s=t.options.map(o=>o._zod.pattern);return new RegExp(`^(${s.map(o=>wn(o.source)).join("|")})$`)}});const r=t.options.length===1,n=t.options[0]._zod.run;e._zod.parse=(s,o)=>{if(r)return n(s,o);let a=!1;const i=[];for(const c of t.options){const l=c._zod.run({value:s.value,issues:[]},o);if(l instanceof Promise)i.push(l),a=!0;else{if(l.issues.length===0)return l;i.push(l)}}return a?Promise.all(i).then(c=>vo(c,s,e,o)):vo(i,s,e,o)}}),$l=j("$ZodDiscriminatedUnion",(e,t)=>{t.inclusive=!1,wo.init(e,t);const r=e._zod.parse;fe(e._zod,"propValues",()=>{const s={};for(const o of t.options){const a=o._zod.propValues;if(!a||Object.keys(a).length===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(o)}"`);for(const[i,c]of Object.entries(a)){s[i]||(s[i]=new Set);for(const l of c)s[i].add(l)}}return s});const n=Wt(()=>{const s=t.options,o=new Map;for(const a of s){const i=a._zod.propValues?.[t.discriminator];if(!i||i.size===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(a)}"`);for(const c of i){if(o.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);o.set(c,a)}}return o});e._zod.parse=(s,o)=>{const a=s.value;if(!Nt(a))return s.issues.push({code:"invalid_type",expected:"object",input:a,inst:e}),s;const i=n.value.get(a?.[t.discriminator]);return i?i._zod.run(s,o):t.unionFallback?r(s,o):(s.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:t.discriminator,input:a,path:[t.discriminator],inst:e}),s)}}),El=j("$ZodIntersection",(e,t)=>{pe.init(e,t),e._zod.parse=(r,n)=>{const s=r.value,o=t.left._zod.run({value:s,issues:[]},n),a=t.right._zod.run({value:s,issues:[]},n);return o instanceof Promise||a instanceof Promise?Promise.all([o,a]).then(([c,l])=>bo(r,c,l)):bo(r,o,a)}});function kn(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(pt(e)&&pt(t)){const r=Object.keys(t),n=Object.keys(e).filter(o=>r.indexOf(o)!==-1),s={...e,...t};for(const o of n){const a=kn(e[o],t[o]);if(!a.valid)return{valid:!1,mergeErrorPath:[o,...a.mergeErrorPath]};s[o]=a.data}return{valid:!0,data:s}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const s=e[n],o=t[n],a=kn(s,o);if(!a.valid)return{valid:!1,mergeErrorPath:[n,...a.mergeErrorPath]};r.push(a.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function bo(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),gt(e))return e;const n=kn(t.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}const kl=j("$ZodRecord",(e,t)=>{pe.init(e,t),e._zod.parse=(r,n)=>{const s=r.value;if(!pt(s))return r.issues.push({expected:"record",code:"invalid_type",input:s,inst:e}),r;const o=[],a=t.keyType._zod.values;if(a){r.value={};const i=new Set;for(const l of a)if(typeof l=="string"||typeof l=="number"||typeof l=="symbol"){i.add(typeof l=="number"?l.toString():l);const d=t.valueType._zod.run({value:s[l],issues:[]},n);d instanceof Promise?o.push(d.then(S=>{S.issues.length&&r.issues.push(..._t(l,S.issues)),r.value[l]=S.value})):(d.issues.length&&r.issues.push(..._t(l,d.issues)),r.value[l]=d.value)}let c;for(const l in s)i.has(l)||(c=c??[],c.push(l));c&&c.length>0&&r.issues.push({code:"unrecognized_keys",input:s,inst:e,keys:c})}else{r.value={};for(const i of Reflect.ownKeys(s)){if(i==="__proto__")continue;const c=t.keyType._zod.run({value:i,issues:[]},n);if(c instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(c.issues.length){t.mode==="loose"?r.value[i]=s[i]:r.issues.push({code:"invalid_key",origin:"record",issues:c.issues.map(d=>et(d,n,Qe())),input:i,path:[i],inst:e});continue}const l=t.valueType._zod.run({value:s[i],issues:[]},n);l instanceof Promise?o.push(l.then(d=>{d.issues.length&&r.issues.push(..._t(i,d.issues)),r.value[c.value]=d.value})):(l.issues.length&&r.issues.push(..._t(i,l.issues)),r.value[c.value]=l.value)}}return o.length?Promise.all(o).then(()=>r):r}}),Tl=j("$ZodEnum",(e,t)=>{pe.init(e,t);const r=Ys(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(s=>Mc.has(typeof s)).map(s=>typeof s=="string"?mt(s):s.toString()).join("|")})$`),e._zod.parse=(s,o)=>{const a=s.value;return n.has(a)||s.issues.push({code:"invalid_value",values:r,input:a,inst:e}),s}}),Pl=j("$ZodLiteral",(e,t)=>{if(pe.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");const r=new Set(t.values);e._zod.values=r,e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?mt(n):n?mt(n.toString()):String(n)).join("|")})$`),e._zod.parse=(n,s)=>{const o=n.value;return r.has(o)||n.issues.push({code:"invalid_value",values:t.values,input:o,inst:e}),n}}),Rl=j("$ZodTransform",(e,t)=>{pe.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Ws(e.constructor.name);const s=t.transform(r.value,r);if(n.async)return(s instanceof Promise?s:Promise.resolve(s)).then(a=>(r.value=a,r));if(s instanceof Promise)throw new ht;return r.value=s,r}});function So(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const Al=j("$ZodOptional",(e,t)=>{pe.init(e,t),e._zod.optin="optional",e._zod.optout="optional",fe(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),fe(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${wn(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>{if(t.innerType._zod.optin==="optional"){const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(o=>So(o,r.value)):So(s,r.value)}return r.value===void 0?r:t.innerType._zod.run(r,n)}}),Il=j("$ZodNullable",(e,t)=>{pe.init(e,t),fe(e._zod,"optin",()=>t.innerType._zod.optin),fe(e._zod,"optout",()=>t.innerType._zod.optout),fe(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${wn(r.source)}|null)$`):void 0}),fe(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),Ol=j("$ZodDefault",(e,t)=>{pe.init(e,t),e._zod.optin="optional",fe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);if(r.value===void 0)return r.value=t.defaultValue,r;const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(o=>$o(o,t)):$o(s,t)}});function $o(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Cl=j("$ZodPrefault",(e,t)=>{pe.init(e,t),e._zod.optin="optional",fe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),Nl=j("$ZodNonOptional",(e,t)=>{pe.init(e,t),fe(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(o=>Eo(o,e)):Eo(s,e)}});function Eo(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const zl=j("$ZodCatch",(e,t)=>{pe.init(e,t),fe(e._zod,"optin",()=>t.innerType._zod.optin),fe(e._zod,"optout",()=>t.innerType._zod.optout),fe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(o=>(r.value=o.value,o.issues.length&&(r.value=t.catchValue({...r,error:{issues:o.issues.map(a=>et(a,n,Qe()))},input:r.value}),r.issues=[]),r)):(r.value=s.value,s.issues.length&&(r.value=t.catchValue({...r,error:{issues:s.issues.map(o=>et(o,n,Qe()))},input:r.value}),r.issues=[]),r)}}),Ml=j("$ZodPipe",(e,t)=>{pe.init(e,t),fe(e._zod,"values",()=>t.in._zod.values),fe(e._zod,"optin",()=>t.in._zod.optin),fe(e._zod,"optout",()=>t.out._zod.optout),fe(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,n)=>{if(n.direction==="backward"){const o=t.out._zod.run(r,n);return o instanceof Promise?o.then(a=>tr(a,t.in,n)):tr(o,t.in,n)}const s=t.in._zod.run(r,n);return s instanceof Promise?s.then(o=>tr(o,t.out,n)):tr(s,t.out,n)}});function tr(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const jl=j("$ZodReadonly",(e,t)=>{pe.init(e,t),fe(e._zod,"propValues",()=>t.innerType._zod.propValues),fe(e._zod,"values",()=>t.innerType._zod.values),fe(e._zod,"optin",()=>t.innerType?._zod?.optin),fe(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(ko):ko(s)}});function ko(e){return e.value=Object.freeze(e.value),e}const ql=j("$ZodCustom",(e,t)=>{Me.init(e,t),pe.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,s=t.fn(n);if(s instanceof Promise)return s.then(o=>To(o,r,n,e));To(s,r,n,e)}});function To(e,t,r,n){if(!e){const s={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(s.params=n._zod.def.params),t.issues.push(zt(s))}}var Po;class xl{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const n=r[0];if(this._map.set(t,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};delete n.id;const s={...n,...this._map.get(t)};return Object.keys(s).length?s:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function Ul(){return new xl}(Po=globalThis).__zod_globalRegistry??(Po.__zod_globalRegistry=Ul());const Mt=globalThis.__zod_globalRegistry;function Dl(e,t){return new e({type:"string",...B(t)})}function Ll(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...B(t)})}function Ro(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...B(t)})}function Vl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...B(t)})}function Zl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...B(t)})}function Fl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...B(t)})}function Hl(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...B(t)})}function Ao(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...B(t)})}function Kl(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...B(t)})}function Jl(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...B(t)})}function Bl(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...B(t)})}function Wl(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...B(t)})}function Gl(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...B(t)})}function Yl(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...B(t)})}function Ql(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...B(t)})}function Xl(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...B(t)})}function ed(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...B(t)})}function td(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...B(t)})}function rd(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...B(t)})}function nd(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...B(t)})}function sd(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...B(t)})}function od(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...B(t)})}function ad(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...B(t)})}function id(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...B(t)})}function cd(e,t){return new e({type:"string",format:"date",check:"string_format",...B(t)})}function ud(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...B(t)})}function ld(e,t){return new e({type:"string",format:"duration",check:"string_format",...B(t)})}function dd(e,t){return new e({type:"number",checks:[],...B(t)})}function fd(e,t){return new e({type:"number",coerce:!0,checks:[],...B(t)})}function hd(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...B(t)})}function pd(e,t){return new e({type:"boolean",...B(t)})}function md(e,t){return new e({type:"null",...B(t)})}function gd(e){return new e({type:"any"})}function _d(e){return new e({type:"unknown"})}function yd(e,t){return new e({type:"never",...B(t)})}function Io(e,t){return new fo({check:"less_than",...B(t),value:e,inclusive:!1})}function Tn(e,t){return new fo({check:"less_than",...B(t),value:e,inclusive:!0})}function Oo(e,t){return new ho({check:"greater_than",...B(t),value:e,inclusive:!1})}function Pn(e,t){return new ho({check:"greater_than",...B(t),value:e,inclusive:!0})}function Co(e,t){return new Au({check:"multiple_of",...B(t),value:e})}function No(e,t){return new Ou({check:"max_length",...B(t),maximum:e})}function rr(e,t){return new Cu({check:"min_length",...B(t),minimum:e})}function zo(e,t){return new Nu({check:"length_equals",...B(t),length:e})}function vd(e,t){return new zu({check:"string_format",format:"regex",...B(t),pattern:e})}function wd(e){return new Mu({check:"string_format",format:"lowercase",...B(e)})}function bd(e){return new ju({check:"string_format",format:"uppercase",...B(e)})}function Sd(e,t){return new qu({check:"string_format",format:"includes",...B(t),includes:e})}function $d(e,t){return new xu({check:"string_format",format:"starts_with",...B(t),prefix:e})}function Ed(e,t){return new Uu({check:"string_format",format:"ends_with",...B(t),suffix:e})}function yt(e){return new Du({check:"overwrite",tx:e})}function kd(e){return yt(t=>t.normalize(e))}function Td(){return yt(e=>e.trim())}function Pd(){return yt(e=>e.toLowerCase())}function Rd(){return yt(e=>e.toUpperCase())}function Ad(){return yt(e=>Nc(e))}function Id(e,t,r){return new e({type:"array",element:t,...B(r)})}function Od(e,t,r){const n=B(r);return n.abort??(n.abort=!0),new e({type:"custom",check:"custom",fn:t,...n})}function Cd(e,t,r){return new e({type:"custom",check:"custom",fn:t,...B(r)})}function Nd(e){const t=zd(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(zt(n,r.value,t._zod.def));else{const s=n;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=t),s.continue??(s.continue=!t._zod.def.abort),r.issues.push(zt(s))}},e(r.value,r)));return t}function zd(e,t){const r=new Me({check:"custom",...B(t)});return r._zod.check=e,r}function Mo(e){let t=e?.target??"draft-2020-12";return t==="draft-4"&&(t="draft-04"),t==="draft-7"&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:e?.metadata??Mt,target:t,unrepresentable:e?.unrepresentable??"throw",override:e?.override??(()=>{}),io:e?.io??"output",counter:0,seen:new Map,cycles:e?.cycles??"ref",reused:e?.reused??"inline",external:e?.external??void 0}}function $e(e,t,r={path:[],schemaPath:[]}){var n;const s=e._zod.def,o=t.seen.get(e);if(o)return o.count++,r.schemaPath.includes(e)&&(o.cycle=r.path),o.schema;const a={schema:{},count:1,cycle:void 0,path:r.path};t.seen.set(e,a);const i=e._zod.toJSONSchema?.();if(i)a.schema=i;else{const d={...r,schemaPath:[...r.schemaPath,e],path:r.path},S=e._zod.parent;if(S)a.ref=S,$e(S,t,d),t.seen.get(S).isParent=!0;else if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,a.schema,d);else{const _=a.schema,w=t.processors[s.type];if(!w)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${s.type}`);w(e,t,_,d)}}const c=t.metadataRegistry.get(e);return c&&Object.assign(a.schema,c),t.io==="input"&&Ne(e)&&(delete a.schema.examples,delete a.schema.default),t.io==="input"&&a.schema._prefault&&((n=a.schema).default??(n.default=a.schema._prefault)),delete a.schema._prefault,t.seen.get(e).schema}function jo(e,t){const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=o=>{const a=e.target==="draft-2020-12"?"$defs":"definitions";if(e.external){const d=e.external.registry.get(o[0])?.id,S=e.external.uri??(w=>w);if(d)return{ref:S(d)};const _=o[1].defId??o[1].schema.id??`schema${e.counter++}`;return o[1].defId=_,{defId:_,ref:`${S("__shared")}#/${a}/${_}`}}if(o[1]===r)return{ref:"#"};const c=`#/${a}/`,l=o[1].schema.id??`__schema${e.counter++}`;return{defId:l,ref:c+l}},s=o=>{if(o[1].schema.$ref)return;const a=o[1],{ref:i,defId:c}=n(o);a.def={...a.schema},c&&(a.defId=c);const l=a.schema;for(const d in l)delete l[d];l.$ref=i};if(e.cycles==="throw")for(const o of e.seen.entries()){const a=o[1];if(a.cycle)throw new Error(`Cycle detected: #/${a.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const o of e.seen.entries()){const a=o[1];if(t===o[0]){s(o);continue}if(e.external){const c=e.external.registry.get(o[0])?.id;if(t!==o[0]&&c){s(o);continue}}if(e.metadataRegistry.get(o[0])?.id){s(o);continue}if(a.cycle){s(o);continue}if(a.count>1&&e.reused==="ref"){s(o);continue}}}function qo(e,t){const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=a=>{const i=e.seen.get(a),c=i.def??i.schema,l={...c};if(i.ref===null)return;const d=i.ref;if(i.ref=null,d){n(d);const S=e.seen.get(d).schema;S.$ref&&(e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0")?(c.allOf=c.allOf??[],c.allOf.push(S)):(Object.assign(c,S),Object.assign(c,l))}i.isParent||e.override({zodSchema:a,jsonSchema:c,path:i.path??[]})};for(const a of[...e.seen.entries()].reverse())n(a[0]);const s={};if(e.target==="draft-2020-12"?s.$schema="https://json-schema.org/draft/2020-12/schema":e.target==="draft-07"?s.$schema="http://json-schema.org/draft-07/schema#":e.target==="draft-04"?s.$schema="http://json-schema.org/draft-04/schema#":e.target,e.external?.uri){const a=e.external.registry.get(t)?.id;if(!a)throw new Error("Schema is missing an `id` property");s.$id=e.external.uri(a)}Object.assign(s,r.def??r.schema);const o=e.external?.defs??{};for(const a of e.seen.entries()){const i=a[1];i.def&&i.defId&&(o[i.defId]=i.def)}e.external||Object.keys(o).length>0&&(e.target==="draft-2020-12"?s.$defs=o:s.definitions=o);try{const a=JSON.parse(JSON.stringify(s));return Object.defineProperty(a,"~standard",{value:{...t["~standard"],jsonSchema:{input:nr(t,"input"),output:nr(t,"output")}},enumerable:!1,writable:!1}),a}catch{throw new Error("Error converting schema to JSON.")}}function Ne(e,t){const r=t??{seen:new Set};if(r.seen.has(e))return!1;r.seen.add(e);const n=e._zod.def;if(n.type==="transform")return!0;if(n.type==="array")return Ne(n.element,r);if(n.type==="set")return Ne(n.valueType,r);if(n.type==="lazy")return Ne(n.getter(),r);if(n.type==="promise"||n.type==="optional"||n.type==="nonoptional"||n.type==="nullable"||n.type==="readonly"||n.type==="default"||n.type==="prefault")return Ne(n.innerType,r);if(n.type==="intersection")return Ne(n.left,r)||Ne(n.right,r);if(n.type==="record"||n.type==="map")return Ne(n.keyType,r)||Ne(n.valueType,r);if(n.type==="pipe")return Ne(n.in,r)||Ne(n.out,r);if(n.type==="object"){for(const s in n.shape)if(Ne(n.shape[s],r))return!0;return!1}if(n.type==="union"){for(const s of n.options)if(Ne(s,r))return!0;return!1}if(n.type==="tuple"){for(const s of n.items)if(Ne(s,r))return!0;return!!(n.rest&&Ne(n.rest,r))}return!1}const Md=(e,t={})=>r=>{const n=Mo({...r,processors:t});return $e(e,n),jo(n,e),qo(n,e)},nr=(e,t)=>r=>{const{libraryOptions:n,target:s}=r??{},o=Mo({...n??{},target:s,io:t,processors:{}});return $e(e,o),jo(o,e),qo(o,e)},jd={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},qd=(e,t,r,n)=>{const s=r;s.type="string";const{minimum:o,maximum:a,format:i,patterns:c,contentEncoding:l}=e._zod.bag;if(typeof o=="number"&&(s.minLength=o),typeof a=="number"&&(s.maxLength=a),i&&(s.format=jd[i]??i,s.format===""&&delete s.format),l&&(s.contentEncoding=l),c&&c.size>0){const d=[...c];d.length===1?s.pattern=d[0].source:d.length>1&&(s.allOf=[...d.map(S=>({...t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0"?{type:"string"}:{},pattern:S.source}))])}},xd=(e,t,r,n)=>{const s=r,{minimum:o,maximum:a,format:i,multipleOf:c,exclusiveMaximum:l,exclusiveMinimum:d}=e._zod.bag;typeof i=="string"&&i.includes("int")?s.type="integer":s.type="number",typeof d=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.minimum=d,s.exclusiveMinimum=!0):s.exclusiveMinimum=d),typeof o=="number"&&(s.minimum=o,typeof d=="number"&&t.target!=="draft-04"&&(d>=o?delete s.minimum:delete s.exclusiveMinimum)),typeof l=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.maximum=l,s.exclusiveMaximum=!0):s.exclusiveMaximum=l),typeof a=="number"&&(s.maximum=a,typeof l=="number"&&t.target!=="draft-04"&&(l<=a?delete s.maximum:delete s.exclusiveMaximum)),typeof c=="number"&&(s.multipleOf=c)},Ud=(e,t,r,n)=>{r.type="boolean"},Dd=(e,t,r,n)=>{t.target==="openapi-3.0"?(r.type="string",r.nullable=!0,r.enum=[null]):r.type="null"},Ld=(e,t,r,n)=>{r.not={}},Vd=(e,t,r,n)=>{},Zd=(e,t,r,n)=>{},Fd=(e,t,r,n)=>{const s=e._zod.def,o=Ys(s.entries);o.every(a=>typeof a=="number")&&(r.type="number"),o.every(a=>typeof a=="string")&&(r.type="string"),r.enum=o},Hd=(e,t,r,n)=>{const s=e._zod.def,o=[];for(const a of s.values)if(a===void 0){if(t.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof a=="bigint"){if(t.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");o.push(Number(a))}else o.push(a);if(o.length!==0)if(o.length===1){const a=o[0];r.type=a===null?"null":typeof a,t.target==="draft-04"||t.target==="openapi-3.0"?r.enum=[a]:r.const=a}else o.every(a=>typeof a=="number")&&(r.type="number"),o.every(a=>typeof a=="string")&&(r.type="string"),o.every(a=>typeof a=="boolean")&&(r.type="boolean"),o.every(a=>a===null)&&(r.type="null"),r.enum=o},Kd=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},Jd=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},Bd=(e,t,r,n)=>{const s=r,o=e._zod.def,{minimum:a,maximum:i}=e._zod.bag;typeof a=="number"&&(s.minItems=a),typeof i=="number"&&(s.maxItems=i),s.type="array",s.items=$e(o.element,t,{...n,path:[...n.path,"items"]})},Wd=(e,t,r,n)=>{const s=r,o=e._zod.def;s.type="object",s.properties={};const a=o.shape;for(const l in a)s.properties[l]=$e(a[l],t,{...n,path:[...n.path,"properties",l]});const i=new Set(Object.keys(a)),c=new Set([...i].filter(l=>{const d=o.shape[l]._zod;return t.io==="input"?d.optin===void 0:d.optout===void 0}));c.size>0&&(s.required=Array.from(c)),o.catchall?._zod.def.type==="never"?s.additionalProperties=!1:o.catchall?o.catchall&&(s.additionalProperties=$e(o.catchall,t,{...n,path:[...n.path,"additionalProperties"]})):t.io==="output"&&(s.additionalProperties=!1)},Gd=(e,t,r,n)=>{const s=e._zod.def,o=s.inclusive===!1,a=s.options.map((i,c)=>$e(i,t,{...n,path:[...n.path,o?"oneOf":"anyOf",c]}));o?r.oneOf=a:r.anyOf=a},Yd=(e,t,r,n)=>{const s=e._zod.def,o=$e(s.left,t,{...n,path:[...n.path,"allOf",0]}),a=$e(s.right,t,{...n,path:[...n.path,"allOf",1]}),i=l=>"allOf"in l&&Object.keys(l).length===1,c=[...i(o)?o.allOf:[o],...i(a)?a.allOf:[a]];r.allOf=c},Qd=(e,t,r,n)=>{const s=r,o=e._zod.def;s.type="object",(t.target==="draft-07"||t.target==="draft-2020-12")&&(s.propertyNames=$e(o.keyType,t,{...n,path:[...n.path,"propertyNames"]})),s.additionalProperties=$e(o.valueType,t,{...n,path:[...n.path,"additionalProperties"]})},Xd=(e,t,r,n)=>{const s=e._zod.def,o=$e(s.innerType,t,n),a=t.seen.get(e);t.target==="openapi-3.0"?(a.ref=s.innerType,r.nullable=!0):r.anyOf=[o,{type:"null"}]},ef=(e,t,r,n)=>{const s=e._zod.def;$e(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType},tf=(e,t,r,n)=>{const s=e._zod.def;$e(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType,r.default=JSON.parse(JSON.stringify(s.defaultValue))},rf=(e,t,r,n)=>{const s=e._zod.def;$e(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType,t.io==="input"&&(r._prefault=JSON.parse(JSON.stringify(s.defaultValue)))},nf=(e,t,r,n)=>{const s=e._zod.def;$e(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType;let a;try{a=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}r.default=a},sf=(e,t,r,n)=>{const s=e._zod.def,o=t.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;$e(o,t,n);const a=t.seen.get(e);a.ref=o},of=(e,t,r,n)=>{const s=e._zod.def;$e(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType,r.readOnly=!0},af=(e,t,r,n)=>{const s=e._zod.def;$e(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType},cf=j("ZodISODateTime",(e,t)=>{el.init(e,t),ye.init(e,t)});function xo(e){return id(cf,e)}const uf=j("ZodISODate",(e,t)=>{tl.init(e,t),ye.init(e,t)});function lf(e){return cd(uf,e)}const df=j("ZodISOTime",(e,t)=>{rl.init(e,t),ye.init(e,t)});function ff(e){return ud(df,e)}const hf=j("ZodISODuration",(e,t)=>{nl.init(e,t),ye.init(e,t)});function pf(e){return ld(hf,e)}const Uo=(e,t)=>{no.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>Kc(e,r)},flatten:{value:r=>Hc(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,yn,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,yn,2)}},isEmpty:{get(){return e.issues.length===0}}})},mf=j("ZodError",Uo),Le=j("ZodError",Uo,{Parent:Error}),gf=Sn(Le),_f=$n(Le),yf=Yt(Le),vf=Qt(Le),wf=Bc(Le),bf=Wc(Le),Sf=Gc(Le),$f=Yc(Le),Ef=Qc(Le),kf=Xc(Le),Tf=eu(Le),Pf=tu(Le),_e=j("ZodType",(e,t)=>(pe.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:nr(e,"input"),output:nr(e,"output")}}),e.toJSONSchema=Md(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(at(t,{checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]})),e.clone=(r,n)=>Xe(e,r,n),e.brand=()=>e,e.register=((r,n)=>(r.add(e,n),e)),e.parse=(r,n)=>gf(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>yf(e,r,n),e.parseAsync=async(r,n)=>_f(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>vf(e,r,n),e.spa=e.safeParseAsync,e.encode=(r,n)=>wf(e,r,n),e.decode=(r,n)=>bf(e,r,n),e.encodeAsync=async(r,n)=>Sf(e,r,n),e.decodeAsync=async(r,n)=>$f(e,r,n),e.safeEncode=(r,n)=>Ef(e,r,n),e.safeDecode=(r,n)=>kf(e,r,n),e.safeEncodeAsync=async(r,n)=>Tf(e,r,n),e.safeDecodeAsync=async(r,n)=>Pf(e,r,n),e.refine=(r,n)=>e.check(yh(r,n)),e.superRefine=r=>e.check(vh(r)),e.overwrite=r=>e.check(yt(r)),e.optional=()=>be(e),e.nullable=()=>Go(e),e.nullish=()=>be(Go(e)),e.nonoptional=r=>dh(e,r),e.array=()=>H(e),e.or=r=>me([e,r]),e.and=r=>An(e,r),e.transform=r=>On(e,Bo(r)),e.default=r=>ch(e,r),e.prefault=r=>lh(e,r),e.catch=r=>hh(e,r),e.pipe=r=>On(e,r),e.readonly=()=>gh(e),e.describe=r=>{const n=e.clone();return Mt.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return Mt.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return Mt.get(e);const n=e.clone();return Mt.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),Do=j("_ZodString",(e,t)=>{En.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(n,s,o)=>qd(e,n,s);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(vd(...n)),e.includes=(...n)=>e.check(Sd(...n)),e.startsWith=(...n)=>e.check($d(...n)),e.endsWith=(...n)=>e.check(Ed(...n)),e.min=(...n)=>e.check(rr(...n)),e.max=(...n)=>e.check(No(...n)),e.length=(...n)=>e.check(zo(...n)),e.nonempty=(...n)=>e.check(rr(1,...n)),e.lowercase=n=>e.check(wd(n)),e.uppercase=n=>e.check(bd(n)),e.trim=()=>e.check(Td()),e.normalize=(...n)=>e.check(kd(...n)),e.toLowerCase=()=>e.check(Pd()),e.toUpperCase=()=>e.check(Rd()),e.slugify=()=>e.check(Ad())}),Rf=j("ZodString",(e,t)=>{En.init(e,t),Do.init(e,t),e.email=r=>e.check(Ll(Af,r)),e.url=r=>e.check(Ao(Vo,r)),e.jwt=r=>e.check(ad(Hf,r)),e.emoji=r=>e.check(Kl(Of,r)),e.guid=r=>e.check(Ro(Lo,r)),e.uuid=r=>e.check(Vl(sr,r)),e.uuidv4=r=>e.check(Zl(sr,r)),e.uuidv6=r=>e.check(Fl(sr,r)),e.uuidv7=r=>e.check(Hl(sr,r)),e.nanoid=r=>e.check(Jl(Cf,r)),e.guid=r=>e.check(Ro(Lo,r)),e.cuid=r=>e.check(Bl(Nf,r)),e.cuid2=r=>e.check(Wl(zf,r)),e.ulid=r=>e.check(Gl(Mf,r)),e.base64=r=>e.check(nd(Vf,r)),e.base64url=r=>e.check(sd(Zf,r)),e.xid=r=>e.check(Yl(jf,r)),e.ksuid=r=>e.check(Ql(qf,r)),e.ipv4=r=>e.check(Xl(xf,r)),e.ipv6=r=>e.check(ed(Uf,r)),e.cidrv4=r=>e.check(td(Df,r)),e.cidrv6=r=>e.check(rd(Lf,r)),e.e164=r=>e.check(od(Ff,r)),e.datetime=r=>e.check(xo(r)),e.date=r=>e.check(lf(r)),e.time=r=>e.check(ff(r)),e.duration=r=>e.check(pf(r))});function P(e){return Dl(Rf,e)}const ye=j("ZodStringFormat",(e,t)=>{ge.init(e,t),Do.init(e,t)}),Af=j("ZodEmail",(e,t)=>{Hu.init(e,t),ye.init(e,t)}),Lo=j("ZodGUID",(e,t)=>{Zu.init(e,t),ye.init(e,t)}),sr=j("ZodUUID",(e,t)=>{Fu.init(e,t),ye.init(e,t)}),Vo=j("ZodURL",(e,t)=>{Ku.init(e,t),ye.init(e,t)});function If(e){return Ao(Vo,e)}const Of=j("ZodEmoji",(e,t)=>{Ju.init(e,t),ye.init(e,t)}),Cf=j("ZodNanoID",(e,t)=>{Bu.init(e,t),ye.init(e,t)}),Nf=j("ZodCUID",(e,t)=>{Wu.init(e,t),ye.init(e,t)}),zf=j("ZodCUID2",(e,t)=>{Gu.init(e,t),ye.init(e,t)}),Mf=j("ZodULID",(e,t)=>{Yu.init(e,t),ye.init(e,t)}),jf=j("ZodXID",(e,t)=>{Qu.init(e,t),ye.init(e,t)}),qf=j("ZodKSUID",(e,t)=>{Xu.init(e,t),ye.init(e,t)}),xf=j("ZodIPv4",(e,t)=>{sl.init(e,t),ye.init(e,t)}),Uf=j("ZodIPv6",(e,t)=>{ol.init(e,t),ye.init(e,t)}),Df=j("ZodCIDRv4",(e,t)=>{al.init(e,t),ye.init(e,t)}),Lf=j("ZodCIDRv6",(e,t)=>{il.init(e,t),ye.init(e,t)}),Vf=j("ZodBase64",(e,t)=>{cl.init(e,t),ye.init(e,t)}),Zf=j("ZodBase64URL",(e,t)=>{ll.init(e,t),ye.init(e,t)}),Ff=j("ZodE164",(e,t)=>{dl.init(e,t),ye.init(e,t)}),Hf=j("ZodJWT",(e,t)=>{hl.init(e,t),ye.init(e,t)}),Rn=j("ZodNumber",(e,t)=>{mo.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(n,s,o)=>xd(e,n,s),e.gt=(n,s)=>e.check(Oo(n,s)),e.gte=(n,s)=>e.check(Pn(n,s)),e.min=(n,s)=>e.check(Pn(n,s)),e.lt=(n,s)=>e.check(Io(n,s)),e.lte=(n,s)=>e.check(Tn(n,s)),e.max=(n,s)=>e.check(Tn(n,s)),e.int=n=>e.check(Zo(n)),e.safe=n=>e.check(Zo(n)),e.positive=n=>e.check(Oo(0,n)),e.nonnegative=n=>e.check(Pn(0,n)),e.negative=n=>e.check(Io(0,n)),e.nonpositive=n=>e.check(Tn(0,n)),e.multipleOf=(n,s)=>e.check(Co(n,s)),e.step=(n,s)=>e.check(Co(n,s)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function le(e){return dd(Rn,e)}const Kf=j("ZodNumberFormat",(e,t)=>{pl.init(e,t),Rn.init(e,t)});function Zo(e){return hd(Kf,e)}const Jf=j("ZodBoolean",(e,t)=>{ml.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Ud(e,r,n)});function he(e){return pd(Jf,e)}const Bf=j("ZodNull",(e,t)=>{gl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Dd(e,r,n)});function Fo(e){return md(Bf,e)}const Wf=j("ZodAny",(e,t)=>{_l.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Vd()});function Gf(){return gd(Wf)}const Yf=j("ZodUnknown",(e,t)=>{yl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Zd()});function ve(){return _d(Yf)}const Qf=j("ZodNever",(e,t)=>{vl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Ld(e,r,n)});function Xf(e){return yd(Qf,e)}const eh=j("ZodArray",(e,t)=>{wl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Bd(e,r,n,s),e.element=t.element,e.min=(r,n)=>e.check(rr(r,n)),e.nonempty=r=>e.check(rr(1,r)),e.max=(r,n)=>e.check(No(r,n)),e.length=(r,n)=>e.check(zo(r,n)),e.unwrap=()=>e.element});function H(e,t){return Id(eh,e,t)}const Ho=j("ZodObject",(e,t)=>{Sl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Wd(e,r,n,s),fe(e,"shape",()=>t.shape),e.keyof=()=>xe(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:ve()}),e.loose=()=>e.clone({...e._zod.def,catchall:ve()}),e.strict=()=>e.clone({...e._zod.def,catchall:Xf()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>Dc(e,r),e.safeExtend=r=>Lc(e,r),e.merge=r=>Vc(e,r),e.pick=r=>xc(e,r),e.omit=r=>Uc(e,r),e.partial=(...r)=>Zc(Wo,e,r[0]),e.required=(...r)=>Fc(Yo,e,r[0])});function K(e,t){const r={type:"object",shape:e??{},...B(t)};return new Ho(r)}function ke(e,t){return new Ho({type:"object",shape:e,catchall:ve(),...B(t)})}const Ko=j("ZodUnion",(e,t)=>{wo.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Gd(e,r,n,s),e.options=t.options});function me(e,t){return new Ko({type:"union",options:e,...B(t)})}const th=j("ZodDiscriminatedUnion",(e,t)=>{Ko.init(e,t),$l.init(e,t)});function Jo(e,t,r){return new th({type:"union",options:t,discriminator:e,...B(r)})}const rh=j("ZodIntersection",(e,t)=>{El.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Yd(e,r,n,s)});function An(e,t){return new rh({type:"intersection",left:e,right:t})}const nh=j("ZodRecord",(e,t)=>{kl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Qd(e,r,n,s),e.keyType=t.keyType,e.valueType=t.valueType});function we(e,t,r){return new nh({type:"record",keyType:e,valueType:t,...B(r)})}const In=j("ZodEnum",(e,t)=>{Tl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(n,s,o)=>Fd(e,n,s),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,s)=>{const o={};for(const a of n)if(r.has(a))o[a]=t.entries[a];else throw new Error(`Key ${a} not found in enum`);return new In({...t,checks:[],...B(s),entries:o})},e.exclude=(n,s)=>{const o={...t.entries};for(const a of n)if(r.has(a))delete o[a];else throw new Error(`Key ${a} not found in enum`);return new In({...t,checks:[],...B(s),entries:o})}});function xe(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new In({type:"enum",entries:r,...B(t)})}const sh=j("ZodLiteral",(e,t)=>{Pl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Hd(e,r,n),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function W(e,t){return new sh({type:"literal",values:Array.isArray(e)?e:[e],...B(t)})}const oh=j("ZodTransform",(e,t)=>{Rl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Jd(e,r),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Ws(e.constructor.name);r.addIssue=o=>{if(typeof o=="string")r.issues.push(zt(o,r.value,t));else{const a=o;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=r.value),a.inst??(a.inst=e),r.issues.push(zt(a))}};const s=t.transform(r.value,r);return s instanceof Promise?s.then(o=>(r.value=o,r)):(r.value=s,r)}});function Bo(e){return new oh({type:"transform",transform:e})}const Wo=j("ZodOptional",(e,t)=>{Al.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>af(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function be(e){return new Wo({type:"optional",innerType:e})}const ah=j("ZodNullable",(e,t)=>{Il.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Xd(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function Go(e){return new ah({type:"nullable",innerType:e})}const ih=j("ZodDefault",(e,t)=>{Ol.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>tf(e,r,n,s),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function ch(e,t){return new ih({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():to(t)}})}const uh=j("ZodPrefault",(e,t)=>{Cl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>rf(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function lh(e,t){return new uh({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():to(t)}})}const Yo=j("ZodNonOptional",(e,t)=>{Nl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>ef(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function dh(e,t){return new Yo({type:"nonoptional",innerType:e,...B(t)})}const fh=j("ZodCatch",(e,t)=>{zl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>nf(e,r,n,s),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function hh(e,t){return new fh({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const ph=j("ZodPipe",(e,t)=>{Ml.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>sf(e,r,n,s),e.in=t.in,e.out=t.out});function On(e,t){return new ph({type:"pipe",in:e,out:t})}const mh=j("ZodReadonly",(e,t)=>{jl.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>of(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function gh(e){return new mh({type:"readonly",innerType:e})}const Qo=j("ZodCustom",(e,t)=>{ql.init(e,t),_e.init(e,t),e._zod.processJSONSchema=(r,n,s)=>Kd(e,r)});function _h(e,t){return Od(Qo,e??(()=>!0),t)}function yh(e,t={}){return Cd(Qo,e,t)}function vh(e){return Nd(e)}function Xo(e,t){return On(Bo(e),t)}const wh={custom:"custom"};function ea(e){return fd(Rn,e)}const ta={BASE_URL:"/",BROWSER:"safari",CHROME:!1,COMMAND:"build",DEV:!1,EDGE:!1,ENTRYPOINT:"background",FIREFOX:!1,MANIFEST_VERSION:2,MODE:"production",OPERA:!1,PROD:!0,SAFARI:!0,SSR:!1,VITE_BROWSEROS_SERVER_PORT:"9100",VITE_PUBLIC_POSTHOG_HOST:"",VITE_PUBLIC_POSTHOG_KEY:"",VITE_PUBLIC_SENTRY_DSN:"",VITE_USER_NODE_ENV:"development"},ra=K({VITE_BROWSEROS_SERVER_PORT:ea().optional(),VITE_PUBLIC_POSTHOG_KEY:P().optional(),VITE_PUBLIC_POSTHOG_HOST:P().optional(),VITE_PUBLIC_SENTRY_DSN:P().optional(),PROD:he()});try{ra.parse(ta)}catch(e){if(e instanceof mf){let t=`Missing required values in .env:
`;for(const n of e.issues)t+=`${n.path.join(".")}
`;const r=new Error(t);throw r.stack="",r}throw console.error(e),e}const na=ra.parse(ta),Cn={AGENT_PORT:"browseros.server.agent_port",MCP_PORT:"browseros.server.mcp_port",PROVIDERS:"browseros.providers",THIRD_PARTY_LLM_PROVIDERS:"browseros.third_party_llm.providers",ALLOW_REMOTE_MCP:"browseros.server.allow_remote_in_mcp",RESTART_SERVER:"browseros.server.restart_requested",SHOW_LLM_CHAT:"browseros.show_llm_chat",SHOW_LLM_HUB:"browseros.show_llm_hub",SHOW_TOOLBAR_LABELS:"browseros.show_toolbar_labels",INSTALL_ID:"browseros.metrics_install_id"};class bh extends Error{constructor(){super("Agent server port not configured."),this.name="AgentPortError"}}class Sh extends Error{constructor(){super("MCP server port not configured."),this.name="McpPortError"}}async function $h(){return _n.isInitialized()&&_n.supports(Ks.UNIFIED_PORT_SUPPORT)?`http://127.0.0.1:${await Nn()}`:`http://127.0.0.1:${await Eh()}`}async function Eh(){if(na.VITE_BROWSEROS_SERVER_PORT)return na.VITE_BROWSEROS_SERVER_PORT;try{const t=await gn().getPref(Cn.AGENT_PORT);if(t?.value&&typeof t.value=="number")return t.value}catch{}throw new bh}async function Nn(){try{const t=await gn().getPref(Cn.MCP_PORT);if(t?.value&&typeof t.value=="number")return t.value}catch{}throw new Sh}async function kh(){return`http://127.0.0.1:${await Nn()}/mcp`}async function Th(){return`http://127.0.0.1:${await Nn()}/health`}async function Ph(e){return await chrome.sidePanel.browserosIsOpen({tabId:e})?{opened:!0}:await chrome.sidePanel.browserosToggle({tabId:e})}async function Rh(e){return await chrome.sidePanel.browserosToggle({tabId:e})}var sa=Object.prototype.hasOwnProperty;function zn(e,t){var r,n;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((n=e.length)===t.length)for(;n--&&zn(e[n],t[n]););return n===-1}if(!r||typeof e=="object"){n=0;for(r in e)if(sa.call(e,r)&&++n&&!sa.call(t,r)||!(r in t)||!zn(e[r],t[r]))return!1;return Object.keys(t).length===n}}return e!==e&&t!==t}const Ah=new Error("request for lock canceled");var Ih=function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function i(d){try{l(n.next(d))}catch(S){a(S)}}function c(d){try{l(n.throw(d))}catch(S){a(S)}}function l(d){d.done?o(d.value):s(d.value).then(i,c)}l((n=n.apply(e,t||[])).next())})};class Oh{constructor(t,r=Ah){this._value=t,this._cancelError=r,this._queue=[],this._weightedWaiters=[]}acquire(t=1,r=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((n,s)=>{const o={resolve:n,reject:s,weight:t,priority:r},a=oa(this._queue,i=>r<=i.priority);a===-1&&t<=this._value?this._dispatchItem(o):this._queue.splice(a+1,0,o)})}runExclusive(t){return Ih(this,arguments,void 0,function*(r,n=1,s=0){const[o,a]=yield this.acquire(n,s);try{return yield r(o)}finally{a()}})}waitForUnlock(t=1,r=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,r)?Promise.resolve():new Promise(n=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),Ch(this._weightedWaiters[t-1],{resolve:n,priority:r})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){const r=this._value;this._value-=t.weight,t.resolve([r,this._newReleaser(t.weight)])}_newReleaser(t){let r=!1;return()=>{r||(r=!0,this.release(t))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let t=this._value;t>0;t--){const r=this._weightedWaiters[t-1];r&&(r.forEach(n=>n.resolve()),this._weightedWaiters[t-1]=[])}else{const t=this._queue[0].priority;for(let r=this._value;r>0;r--){const n=this._weightedWaiters[r-1];if(!n)continue;const s=n.findIndex(o=>o.priority<=t);(s===-1?n:n.splice(0,s)).forEach((o=>o.resolve()))}}}_couldLockImmediately(t,r){return(this._queue.length===0||this._queue[0].priority<r)&&t<=this._value}}function Ch(e,t){const r=oa(e,n=>t.priority<=n.priority);e.splice(r+1,0,t)}function oa(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return-1}var Nh=function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function i(d){try{l(n.next(d))}catch(S){a(S)}}function c(d){try{l(n.throw(d))}catch(S){a(S)}}function l(d){d.done?o(d.value):s(d.value).then(i,c)}l((n=n.apply(e,t||[])).next())})};class zh{constructor(t){this._semaphore=new Oh(1,t)}acquire(){return Nh(this,arguments,void 0,function*(t=0){const[,r]=yield this._semaphore.acquire(1,t);return r})}runExclusive(t,r=0){return this._semaphore.runExclusive(()=>t(),1,r)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const or=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome,it=Mh();function Mh(){const e={local:ar("local"),session:ar("session"),sync:ar("sync"),managed:ar("managed")},t=g=>{const f=e[g];if(f==null){const h=Object.keys(e).join(", ");throw Error(`Invalid area "${g}". Options: ${h}`)}return f},r=g=>{const f=g.indexOf(":"),h=g.substring(0,f),u=g.substring(f+1);if(u==null)throw Error(`Storage key should be in the form of "area:key", but received "${g}"`);return{driverArea:h,driverKey:u,driver:t(h)}},n=g=>g+"$",s=(g,f)=>{const h={...g};return Object.entries(f).forEach(([u,p])=>{p==null?delete h[u]:h[u]=p}),h},o=(g,f)=>g??f??null,a=g=>typeof g=="object"&&!Array.isArray(g)?g:{},i=async(g,f,h)=>{const u=await g.getItem(f);return o(u,h?.fallback??h?.defaultValue)},c=async(g,f)=>{const h=n(f),u=await g.getItem(h);return a(u)},l=async(g,f,h)=>{await g.setItem(f,h??null)},d=async(g,f,h)=>{const u=n(f),p=a(await g.getItem(u));await g.setItem(u,s(p,h))},S=async(g,f,h)=>{if(await g.removeItem(f),h?.removeMeta){const u=n(f);await g.removeItem(u)}},_=async(g,f,h)=>{const u=n(f);if(h==null)await g.removeItem(u);else{const p=a(await g.getItem(u));[h].flat().forEach($=>delete p[$]),await g.setItem(u,p)}},w=(g,f,h)=>g.watch(f,h);return{getItem:async(g,f)=>{const{driver:h,driverKey:u}=r(g);return await i(h,u,f)},getItems:async g=>{const f=new Map,h=new Map,u=[];g.forEach($=>{let m,y;typeof $=="string"?m=$:"getValue"in $?(m=$.key,y={fallback:$.fallback}):(m=$.key,y=$.options),u.push(m);const{driverArea:k,driverKey:I}=r(m),z=f.get(k)??[];f.set(k,z.concat(I)),h.set(m,y)});const p=new Map;return await Promise.all(Array.from(f.entries()).map(async([$,m])=>{(await e[$].getItems(m)).forEach(k=>{const I=`${$}:${k.key}`,z=h.get(I),D=o(k.value,z?.fallback??z?.defaultValue);p.set(I,D)})})),u.map($=>({key:$,value:p.get($)}))},getMeta:async g=>{const{driver:f,driverKey:h}=r(g);return await c(f,h)},getMetas:async g=>{const f=g.map(p=>{const $=typeof p=="string"?p:p.key,{driverArea:m,driverKey:y}=r($);return{key:$,driverArea:m,driverKey:y,driverMetaKey:n(y)}}),h=f.reduce((p,$)=>(p[$.driverArea]??=[],p[$.driverArea].push($),p),{}),u={};return await Promise.all(Object.entries(h).map(async([p,$])=>{const m=await or.storage[p].get($.map(y=>y.driverMetaKey));$.forEach(y=>{u[y.key]=m[y.driverMetaKey]??{}})})),f.map(p=>({key:p.key,meta:u[p.key]}))},setItem:async(g,f)=>{const{driver:h,driverKey:u}=r(g);await l(h,u,f)},setItems:async g=>{const f={};g.forEach(h=>{const{driverArea:u,driverKey:p}=r("key"in h?h.key:h.item.key);f[u]??=[],f[u].push({key:p,value:h.value})}),await Promise.all(Object.entries(f).map(async([h,u])=>{await t(h).setItems(u)}))},setMeta:async(g,f)=>{const{driver:h,driverKey:u}=r(g);await d(h,u,f)},setMetas:async g=>{const f={};g.forEach(h=>{const{driverArea:u,driverKey:p}=r("key"in h?h.key:h.item.key);f[u]??=[],f[u].push({key:p,properties:h.meta})}),await Promise.all(Object.entries(f).map(async([h,u])=>{const p=t(h),$=u.map(({key:I})=>n(I)),m=await p.getItems($),y=Object.fromEntries(m.map(({key:I,value:z})=>[I,a(z)])),k=u.map(({key:I,properties:z})=>{const D=n(I);return{key:D,value:s(y[D]??{},z)}});await p.setItems(k)}))},removeItem:async(g,f)=>{const{driver:h,driverKey:u}=r(g);await S(h,u,f)},removeItems:async g=>{const f={};g.forEach(h=>{let u,p;typeof h=="string"?u=h:"getValue"in h?u=h.key:"item"in h?(u=h.item.key,p=h.options):(u=h.key,p=h.options);const{driverArea:$,driverKey:m}=r(u);f[$]??=[],f[$].push(m),p?.removeMeta&&f[$].push(n(m))}),await Promise.all(Object.entries(f).map(async([h,u])=>{await t(h).removeItems(u)}))},clear:async g=>{await t(g).clear()},removeMeta:async(g,f)=>{const{driver:h,driverKey:u}=r(g);await _(h,u,f)},snapshot:async(g,f)=>{const u=await t(g).snapshot();return f?.excludeKeys?.forEach(p=>{delete u[p],delete u[n(p)]}),u},restoreSnapshot:async(g,f)=>{await t(g).restoreSnapshot(f)},watch:(g,f)=>{const{driver:h,driverKey:u}=r(g);return w(h,u,f)},unwatch(){Object.values(e).forEach(g=>{g.unwatch()})},defineItem:(g,f)=>{const{driver:h,driverKey:u}=r(g),{version:p=1,migrations:$={},onMigrationComplete:m,debug:y=!1}=f??{};if(p<1)throw Error("Storage item version cannot be less than 1. Initial versions should be set to 1, not 0.");const k=async()=>{const x=n(u),[{value:q},{value:Z}]=await h.getItems([u,x]);if(q==null)return;const G=Z?.v??1;if(G>p)throw Error(`Version downgrade detected (v${G} -> v${p}) for "${g}"`);if(G===p)return;y===!0&&console.debug(`[@wxt-dev/storage] Running storage migration for ${g}: v${G} -> v${p}`);const ue=Array.from({length:p-G},(X,Se)=>G+Se+1);let ie=q;for(const X of ue)try{ie=await $?.[X]?.(ie)??ie,y===!0&&console.debug(`[@wxt-dev/storage] Storage migration processed for version: v${X}`)}catch(Se){throw new jh(g,X,{cause:Se})}await h.setItems([{key:u,value:ie},{key:x,value:{...Z,v:p}}]),y===!0&&console.debug(`[@wxt-dev/storage] Storage migration completed for ${g} v${p}`,{migratedValue:ie}),m?.(ie,p)},I=f?.migrations==null?Promise.resolve():k().catch(x=>{console.error(`[@wxt-dev/storage] Migration failed for ${g}`,x)}),z=new zh,D=()=>f?.fallback??f?.defaultValue??null,M=()=>z.runExclusive(async()=>{const x=await h.getItem(u);if(x!=null||f?.init==null)return x;const q=await f.init();return await h.setItem(u,q),q});return I.then(M),{key:g,get defaultValue(){return D()},get fallback(){return D()},getValue:async()=>(await I,f?.init?await M():await i(h,u,f)),getMeta:async()=>(await I,await c(h,u)),setValue:async x=>(await I,await l(h,u,x)),setMeta:async x=>(await I,await d(h,u,x)),removeValue:async x=>(await I,await S(h,u,x)),removeMeta:async x=>(await I,await _(h,u,x)),watch:x=>w(h,u,(q,Z)=>x(q??D(),Z??D())),migrate:k}}}}function ar(e){const t=()=>{if(or.runtime==null)throw Error(["'wxt/storage' must be loaded in a web extension environment",`
 - If thrown during a build, see https://github.com/wxt-dev/wxt/issues/371`,` - If thrown during tests, mock 'wxt/browser' correctly. See https://wxt.dev/guide/go-further/testing.html
`].join(`
`));if(or.storage==null)throw Error("You must add the 'storage' permission to your manifest to use 'wxt/storage'");const n=or.storage[e];if(n==null)throw Error(`"browser.storage.${e}" is undefined`);return n},r=new Set;return{getItem:async n=>(await t().get(n))[n],getItems:async n=>{const s=await t().get(n);return n.map(o=>({key:o,value:s[o]??null}))},setItem:async(n,s)=>{s==null?await t().remove(n):await t().set({[n]:s})},setItems:async n=>{const s=n.reduce((o,{key:a,value:i})=>(o[a]=i,o),{});await t().set(s)},removeItem:async n=>{await t().remove(n)},removeItems:async n=>{await t().remove(n)},clear:async()=>{await t().clear()},snapshot:async()=>await t().get(),restoreSnapshot:async n=>{await t().set(n)},watch(n,s){const o=a=>{const i=a[n];i!=null&&(zn(i.newValue,i.oldValue)||s(i.newValue??null,i.oldValue??null))};return t().onChanged.addListener(o),r.add(o),()=>{t().onChanged.removeListener(o),r.delete(o)}},unwatch(){r.forEach(n=>{t().onChanged.removeListener(n)}),r.clear()}}}class jh extends Error{constructor(t,r,n){super(`v${r} migration failed for "${t}"`,n),this.key=t,this.version=r}}const qh="browseros",aa=it.defineItem("local:llm-providers");async function xh(e){try{await gn().setPref(Cn.PROVIDERS,JSON.stringify(e))}catch{}}function Uh(){return aa.watch(async t=>{if(t){const r=await ia.getValue();await xh({defaultProviderId:r,providers:t})}})}const ia=it.defineItem("local:default-provider-id",{fallback:qh});function ir(e){return!!e._zod}function tt(e,t){return ir(e)?oo(e,t):e.safeParse(t)}function ca(e){if(!e)return;let t;if(ir(e)?t=e._zod?.def?.shape:t=e.shape,!!t){if(typeof t=="function")try{return t()}catch{return}return t}}function Dh(e){if(ir(e)){const o=e._zod?.def;if(o){if(o.value!==void 0)return o.value;if(Array.isArray(o.values)&&o.values.length>0)return o.values[0]}}const r=e._def;if(r){if(r.value!==void 0)return r.value;if(Array.isArray(r.values)&&r.values.length>0)return r.values[0]}const n=e.value;if(n!==void 0)return n}const cr="2025-11-25",Lh=[cr,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],ct="io.modelcontextprotocol/related-task",ur="2.0",Te=_h(e=>e!==null&&(typeof e=="object"||typeof e=="function")),ua=me([P(),le().int()]),la=P();ke({ttl:me([le(),Fo()]).optional(),pollInterval:le().optional()});const Vh=K({ttl:le().optional()}),Zh=K({taskId:P()}),Mn=ke({progressToken:ua.optional(),[ct]:Zh.optional()}),Ue=K({_meta:Mn.optional()}),jt=Ue.extend({task:Vh.optional()}),Fh=e=>jt.safeParse(e).success,Pe=K({method:P(),params:Ue.loose().optional()}),Ve=K({_meta:Mn.optional()}),Ze=K({method:P(),params:Ve.loose().optional()}),Re=ke({_meta:Mn.optional()}),lr=me([P(),le().int()]),da=K({jsonrpc:W(ur),id:lr,...Pe.shape}).strict(),jn=e=>da.safeParse(e).success,fa=K({jsonrpc:W(ur),...Ze.shape}).strict(),Hh=e=>fa.safeParse(e).success,qn=K({jsonrpc:W(ur),id:lr,result:Re}).strict(),qt=e=>qn.safeParse(e).success;var re;(function(e){e[e.ConnectionClosed=-32e3]="ConnectionClosed",e[e.RequestTimeout=-32001]="RequestTimeout",e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError",e[e.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(re||(re={}));const xn=K({jsonrpc:W(ur),id:lr.optional(),error:K({code:le().int(),message:P(),data:ve().optional()})}).strict(),Kh=e=>xn.safeParse(e).success,Un=me([da,fa,qn,xn]);me([qn,xn]);const vt=Re.strict(),Jh=Ve.extend({requestId:lr.optional(),reason:P().optional()}),Dn=Ze.extend({method:W("notifications/cancelled"),params:Jh}),Bh=K({src:P(),mimeType:P().optional(),sizes:H(P()).optional(),theme:xe(["light","dark"]).optional()}),xt=K({icons:H(Bh).optional()}),wt=K({name:P(),title:P().optional()}),ha=wt.extend({...wt.shape,...xt.shape,version:P(),websiteUrl:P().optional(),description:P().optional()}),Wh=An(K({applyDefaults:he().optional()}),we(P(),ve())),Gh=Xo(e=>e&&typeof e=="object"&&!Array.isArray(e)&&Object.keys(e).length===0?{form:{}}:e,An(K({form:Wh.optional(),url:Te.optional()}),we(P(),ve()).optional())),Yh=ke({list:Te.optional(),cancel:Te.optional(),requests:ke({sampling:ke({createMessage:Te.optional()}).optional(),elicitation:ke({create:Te.optional()}).optional()}).optional()}),Qh=ke({list:Te.optional(),cancel:Te.optional(),requests:ke({tools:ke({call:Te.optional()}).optional()}).optional()}),Xh=K({experimental:we(P(),Te).optional(),sampling:K({context:Te.optional(),tools:Te.optional()}).optional(),elicitation:Gh.optional(),roots:K({listChanged:he().optional()}).optional(),tasks:Yh.optional()}),ep=Ue.extend({protocolVersion:P(),capabilities:Xh,clientInfo:ha}),tp=Pe.extend({method:W("initialize"),params:ep}),rp=K({experimental:we(P(),Te).optional(),logging:Te.optional(),completions:Te.optional(),prompts:K({listChanged:he().optional()}).optional(),resources:K({subscribe:he().optional(),listChanged:he().optional()}).optional(),tools:K({listChanged:he().optional()}).optional(),tasks:Qh.optional()}),pa=Re.extend({protocolVersion:P(),capabilities:rp,serverInfo:ha,instructions:P().optional()}),ma=Ze.extend({method:W("notifications/initialized"),params:Ve.optional()}),np=e=>ma.safeParse(e).success,Ln=Pe.extend({method:W("ping"),params:Ue.optional()}),sp=K({progress:le(),total:be(le()),message:be(P())}),op=K({...Ve.shape,...sp.shape,progressToken:ua}),Vn=Ze.extend({method:W("notifications/progress"),params:op}),ap=Ue.extend({cursor:la.optional()}),Ut=Pe.extend({params:ap.optional()}),Dt=Re.extend({nextCursor:la.optional()}),ip=xe(["working","input_required","completed","failed","cancelled"]),Lt=K({taskId:P(),status:ip,ttl:me([le(),Fo()]),createdAt:P(),lastUpdatedAt:P(),pollInterval:be(le()),statusMessage:be(P())}),Vt=Re.extend({task:Lt}),cp=Ve.merge(Lt),dr=Ze.extend({method:W("notifications/tasks/status"),params:cp}),Zn=Pe.extend({method:W("tasks/get"),params:Ue.extend({taskId:P()})}),Fn=Re.merge(Lt),Hn=Pe.extend({method:W("tasks/result"),params:Ue.extend({taskId:P()})});Re.loose();const Kn=Ut.extend({method:W("tasks/list")}),Jn=Dt.extend({tasks:H(Lt)}),Bn=Pe.extend({method:W("tasks/cancel"),params:Ue.extend({taskId:P()})}),up=Re.merge(Lt),ga=K({uri:P(),mimeType:be(P()),_meta:we(P(),ve()).optional()}),_a=ga.extend({text:P()}),Wn=P().refine(e=>{try{return atob(e),!0}catch{return!1}},{message:"Invalid Base64 string"}),ya=ga.extend({blob:Wn}),Zt=xe(["user","assistant"]),bt=K({audience:H(Zt).optional(),priority:le().min(0).max(1).optional(),lastModified:xo({offset:!0}).optional()}),va=K({...wt.shape,...xt.shape,uri:P(),description:be(P()),mimeType:be(P()),annotations:bt.optional(),_meta:be(ke({}))}),lp=K({...wt.shape,...xt.shape,uriTemplate:P(),description:be(P()),mimeType:be(P()),annotations:bt.optional(),_meta:be(ke({}))}),dp=Ut.extend({method:W("resources/list")}),wa=Dt.extend({resources:H(va)}),fp=Ut.extend({method:W("resources/templates/list")}),ba=Dt.extend({resourceTemplates:H(lp)}),Gn=Ue.extend({uri:P()}),hp=Gn,pp=Pe.extend({method:W("resources/read"),params:hp}),Sa=Re.extend({contents:H(me([_a,ya]))}),$a=Ze.extend({method:W("notifications/resources/list_changed"),params:Ve.optional()}),mp=Gn,gp=Pe.extend({method:W("resources/subscribe"),params:mp}),_p=Gn,yp=Pe.extend({method:W("resources/unsubscribe"),params:_p}),vp=Ve.extend({uri:P()}),wp=Ze.extend({method:W("notifications/resources/updated"),params:vp}),bp=K({name:P(),description:be(P()),required:be(he())}),Sp=K({...wt.shape,...xt.shape,description:be(P()),arguments:be(H(bp)),_meta:be(ke({}))}),$p=Ut.extend({method:W("prompts/list")}),Ea=Dt.extend({prompts:H(Sp)}),Ep=Ue.extend({name:P(),arguments:we(P(),P()).optional()}),kp=Pe.extend({method:W("prompts/get"),params:Ep}),Yn=K({type:W("text"),text:P(),annotations:bt.optional(),_meta:we(P(),ve()).optional()}),Qn=K({type:W("image"),data:Wn,mimeType:P(),annotations:bt.optional(),_meta:we(P(),ve()).optional()}),Xn=K({type:W("audio"),data:Wn,mimeType:P(),annotations:bt.optional(),_meta:we(P(),ve()).optional()}),Tp=K({type:W("tool_use"),name:P(),id:P(),input:we(P(),ve()),_meta:we(P(),ve()).optional()}),Pp=K({type:W("resource"),resource:me([_a,ya]),annotations:bt.optional(),_meta:we(P(),ve()).optional()}),Rp=va.extend({type:W("resource_link")}),es=me([Yn,Qn,Xn,Rp,Pp]),Ap=K({role:Zt,content:es}),ka=Re.extend({description:P().optional(),messages:H(Ap)}),Ta=Ze.extend({method:W("notifications/prompts/list_changed"),params:Ve.optional()}),Ip=K({title:P().optional(),readOnlyHint:he().optional(),destructiveHint:he().optional(),idempotentHint:he().optional(),openWorldHint:he().optional()}),Op=K({taskSupport:xe(["required","optional","forbidden"]).optional()}),Pa=K({...wt.shape,...xt.shape,description:P().optional(),inputSchema:K({type:W("object"),properties:we(P(),Te).optional(),required:H(P()).optional()}).catchall(ve()),outputSchema:K({type:W("object"),properties:we(P(),Te).optional(),required:H(P()).optional()}).catchall(ve()).optional(),annotations:Ip.optional(),execution:Op.optional(),_meta:we(P(),ve()).optional()}),Cp=Ut.extend({method:W("tools/list")}),Ra=Dt.extend({tools:H(Pa)}),fr=Re.extend({content:H(es).default([]),structuredContent:we(P(),ve()).optional(),isError:he().optional()});fr.or(Re.extend({toolResult:ve()}));const Np=jt.extend({name:P(),arguments:we(P(),ve()).optional()}),zp=Pe.extend({method:W("tools/call"),params:Np}),Aa=Ze.extend({method:W("notifications/tools/list_changed"),params:Ve.optional()}),Mp=K({autoRefresh:he().default(!0),debounceMs:le().int().nonnegative().default(300)}),Ia=xe(["debug","info","notice","warning","error","critical","alert","emergency"]),jp=Ue.extend({level:Ia}),qp=Pe.extend({method:W("logging/setLevel"),params:jp}),xp=Ve.extend({level:Ia,logger:P().optional(),data:ve()}),Up=Ze.extend({method:W("notifications/message"),params:xp}),Dp=K({name:P().optional()}),Lp=K({hints:H(Dp).optional(),costPriority:le().min(0).max(1).optional(),speedPriority:le().min(0).max(1).optional(),intelligencePriority:le().min(0).max(1).optional()}),Vp=K({mode:xe(["auto","required","none"]).optional()}),Zp=K({type:W("tool_result"),toolUseId:P().describe("The unique identifier for the corresponding tool call."),content:H(es).default([]),structuredContent:K({}).loose().optional(),isError:he().optional(),_meta:we(P(),ve()).optional()}),Fp=Jo("type",[Yn,Qn,Xn]),hr=Jo("type",[Yn,Qn,Xn,Tp,Zp]),Hp=K({role:Zt,content:me([hr,H(hr)]),_meta:we(P(),ve()).optional()}),Kp=jt.extend({messages:H(Hp),modelPreferences:Lp.optional(),systemPrompt:P().optional(),includeContext:xe(["none","thisServer","allServers"]).optional(),temperature:le().optional(),maxTokens:le().int(),stopSequences:H(P()).optional(),metadata:Te.optional(),tools:H(Pa).optional(),toolChoice:Vp.optional()}),Oa=Pe.extend({method:W("sampling/createMessage"),params:Kp}),Ca=Re.extend({model:P(),stopReason:be(xe(["endTurn","stopSequence","maxTokens"]).or(P())),role:Zt,content:Fp}),Jp=Re.extend({model:P(),stopReason:be(xe(["endTurn","stopSequence","maxTokens","toolUse"]).or(P())),role:Zt,content:me([hr,H(hr)])}),Bp=K({type:W("boolean"),title:P().optional(),description:P().optional(),default:he().optional()}),Wp=K({type:W("string"),title:P().optional(),description:P().optional(),minLength:le().optional(),maxLength:le().optional(),format:xe(["email","uri","date","date-time"]).optional(),default:P().optional()}),Gp=K({type:xe(["number","integer"]),title:P().optional(),description:P().optional(),minimum:le().optional(),maximum:le().optional(),default:le().optional()}),Yp=K({type:W("string"),title:P().optional(),description:P().optional(),enum:H(P()),default:P().optional()}),Qp=K({type:W("string"),title:P().optional(),description:P().optional(),oneOf:H(K({const:P(),title:P()})),default:P().optional()}),Xp=K({type:W("string"),title:P().optional(),description:P().optional(),enum:H(P()),enumNames:H(P()).optional(),default:P().optional()}),em=me([Yp,Qp]),tm=K({type:W("array"),title:P().optional(),description:P().optional(),minItems:le().optional(),maxItems:le().optional(),items:K({type:W("string"),enum:H(P())}),default:H(P()).optional()}),rm=K({type:W("array"),title:P().optional(),description:P().optional(),minItems:le().optional(),maxItems:le().optional(),items:K({anyOf:H(K({const:P(),title:P()}))}),default:H(P()).optional()}),nm=me([tm,rm]),sm=me([Xp,em,nm]),om=me([sm,Bp,Wp,Gp]),am=jt.extend({mode:W("form").optional(),message:P(),requestedSchema:K({type:W("object"),properties:we(P(),om),required:H(P()).optional()})}),im=jt.extend({mode:W("url"),message:P(),elicitationId:P(),url:P().url()}),cm=me([am,im]),Na=Pe.extend({method:W("elicitation/create"),params:cm}),um=Ve.extend({elicitationId:P()}),lm=Ze.extend({method:W("notifications/elicitation/complete"),params:um}),za=Re.extend({action:xe(["accept","decline","cancel"]),content:Xo(e=>e===null?void 0:e,we(P(),me([P(),le(),he(),H(P())])).optional())}),dm=K({type:W("ref/resource"),uri:P()}),fm=K({type:W("ref/prompt"),name:P()}),hm=Ue.extend({ref:me([fm,dm]),argument:K({name:P(),value:P()}),context:K({arguments:we(P(),P()).optional()}).optional()}),pm=Pe.extend({method:W("completion/complete"),params:hm}),Ma=Re.extend({completion:ke({values:H(P()).max(100),total:be(le().int()),hasMore:be(he())})}),mm=K({uri:P().startsWith("file://"),name:P().optional(),_meta:we(P(),ve()).optional()}),gm=Pe.extend({method:W("roots/list"),params:Ue.optional()}),_m=Re.extend({roots:H(mm)}),ym=Ze.extend({method:W("notifications/roots/list_changed"),params:Ve.optional()});me([Ln,tp,pm,qp,kp,$p,dp,fp,pp,gp,yp,zp,Cp,Zn,Hn,Kn,Bn]),me([Dn,Vn,ma,ym,dr]),me([vt,Ca,Jp,za,_m,Fn,Jn,Vt]),me([Ln,Oa,Na,gm,Zn,Hn,Kn,Bn]),me([Dn,Vn,Up,wp,$a,Aa,Ta,dr,lm]),me([vt,pa,Ma,ka,Ea,wa,ba,Sa,fr,Ra,Fn,Jn,Vt]);class Q extends Error{constructor(t,r,n){super(`MCP error ${t}: ${r}`),this.code=t,this.data=n,this.name="McpError"}static fromError(t,r,n){if(t===re.UrlElicitationRequired&&n){const s=n;if(s.elicitations)return new vm(s.elicitations,r)}return new Q(t,r,n)}}class vm extends Q{constructor(t,r=`URL elicitation${t.length>1?"s":""} required`){super(re.UrlElicitationRequired,r,{elicitations:t})}get elicitations(){return this.data?.elicitations??[]}}function ut(e){return e==="completed"||e==="failed"||e==="cancelled"}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function ja(e){const r=ca(e)?.method;if(!r)throw new Error("Schema is missing a method literal");const n=Dh(r);if(typeof n!="string")throw new Error("Schema method literal must be a string");return n}function qa(e,t){const r=tt(e,t);if(!r.success)throw r.error;return r.data}const wm=6e4;class bm{constructor(t){this._options=t,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(Dn,r=>{this._oncancel(r)}),this.setNotificationHandler(Vn,r=>{this._onprogress(r)}),this.setRequestHandler(Ln,r=>({})),this._taskStore=t?.taskStore,this._taskMessageQueue=t?.taskMessageQueue,this._taskStore&&(this.setRequestHandler(Zn,async(r,n)=>{const s=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!s)throw new Q(re.InvalidParams,"Failed to retrieve task: Task not found");return{...s}}),this.setRequestHandler(Hn,async(r,n)=>{const s=async()=>{const o=r.params.taskId;if(this._taskMessageQueue){let i;for(;i=await this._taskMessageQueue.dequeue(o,n.sessionId);){if(i.type==="response"||i.type==="error"){const c=i.message,l=c.id,d=this._requestResolvers.get(l);if(d)if(this._requestResolvers.delete(l),i.type==="response")d(c);else{const S=c,_=new Q(S.error.code,S.error.message,S.error.data);d(_)}else{const S=i.type==="response"?"Response":"Error";this._onerror(new Error(`${S} handler missing for request ${l}`))}continue}await this._transport?.send(i.message,{relatedRequestId:n.requestId})}}const a=await this._taskStore.getTask(o,n.sessionId);if(!a)throw new Q(re.InvalidParams,`Task not found: ${o}`);if(!ut(a.status))return await this._waitForTaskUpdate(o,n.signal),await s();if(ut(a.status)){const i=await this._taskStore.getTaskResult(o,n.sessionId);return this._clearTaskQueue(o),{...i,_meta:{...i._meta,[ct]:{taskId:o}}}}return await s()};return await s()}),this.setRequestHandler(Kn,async(r,n)=>{try{const{tasks:s,nextCursor:o}=await this._taskStore.listTasks(r.params?.cursor,n.sessionId);return{tasks:s,nextCursor:o,_meta:{}}}catch(s){throw new Q(re.InvalidParams,`Failed to list tasks: ${s instanceof Error?s.message:String(s)}`)}}),this.setRequestHandler(Bn,async(r,n)=>{try{const s=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!s)throw new Q(re.InvalidParams,`Task not found: ${r.params.taskId}`);if(ut(s.status))throw new Q(re.InvalidParams,`Cannot cancel task in terminal status: ${s.status}`);await this._taskStore.updateTaskStatus(r.params.taskId,"cancelled","Client cancelled task execution.",n.sessionId),this._clearTaskQueue(r.params.taskId);const o=await this._taskStore.getTask(r.params.taskId,n.sessionId);if(!o)throw new Q(re.InvalidParams,`Task not found after cancellation: ${r.params.taskId}`);return{_meta:{},...o}}catch(s){throw s instanceof Q?s:new Q(re.InvalidRequest,`Failed to cancel task: ${s instanceof Error?s.message:String(s)}`)}}))}async _oncancel(t){if(!t.params.requestId)return;this._requestHandlerAbortControllers.get(t.params.requestId)?.abort(t.params.reason)}_setupTimeout(t,r,n,s,o=!1){this._timeoutInfo.set(t,{timeoutId:setTimeout(s,r),startTime:Date.now(),timeout:r,maxTotalTimeout:n,resetTimeoutOnProgress:o,onTimeout:s})}_resetTimeout(t){const r=this._timeoutInfo.get(t);if(!r)return!1;const n=Date.now()-r.startTime;if(r.maxTotalTimeout&&n>=r.maxTotalTimeout)throw this._timeoutInfo.delete(t),Q.fromError(re.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:r.maxTotalTimeout,totalElapsed:n});return clearTimeout(r.timeoutId),r.timeoutId=setTimeout(r.onTimeout,r.timeout),!0}_cleanupTimeout(t){const r=this._timeoutInfo.get(t);r&&(clearTimeout(r.timeoutId),this._timeoutInfo.delete(t))}async connect(t){this._transport=t;const r=this.transport?.onclose;this._transport.onclose=()=>{r?.(),this._onclose()};const n=this.transport?.onerror;this._transport.onerror=o=>{n?.(o),this._onerror(o)};const s=this._transport?.onmessage;this._transport.onmessage=(o,a)=>{s?.(o,a),qt(o)||Kh(o)?this._onresponse(o):jn(o)?this._onrequest(o,a):Hh(o)?this._onnotification(o):this._onerror(new Error(`Unknown message type: ${JSON.stringify(o)}`))},await this._transport.start()}_onclose(){const t=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();const r=Q.fromError(re.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(const n of t.values())n(r)}_onerror(t){this.onerror?.(t)}_onnotification(t){const r=this._notificationHandlers.get(t.method)??this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(t)).catch(n=>this._onerror(new Error(`Uncaught error in notification handler: ${n}`)))}_onrequest(t,r){const n=this._requestHandlers.get(t.method)??this.fallbackRequestHandler,s=this._transport,o=t.params?._meta?.[ct]?.taskId;if(n===void 0){const d={jsonrpc:"2.0",id:t.id,error:{code:re.MethodNotFound,message:"Method not found"}};o&&this._taskMessageQueue?this._enqueueTaskMessage(o,{type:"error",message:d,timestamp:Date.now()},s?.sessionId).catch(S=>this._onerror(new Error(`Failed to enqueue error response: ${S}`))):s?.send(d).catch(S=>this._onerror(new Error(`Failed to send an error response: ${S}`)));return}const a=new AbortController;this._requestHandlerAbortControllers.set(t.id,a);const i=Fh(t.params)?t.params.task:void 0,c=this._taskStore?this.requestTaskStore(t,s?.sessionId):void 0,l={signal:a.signal,sessionId:s?.sessionId,_meta:t.params?._meta,sendNotification:async d=>{const S={relatedRequestId:t.id};o&&(S.relatedTask={taskId:o}),await this.notification(d,S)},sendRequest:async(d,S,_)=>{const w={..._,relatedRequestId:t.id};o&&!w.relatedTask&&(w.relatedTask={taskId:o});const E=w.relatedTask?.taskId??o;return E&&c&&await c.updateTaskStatus(E,"input_required"),await this.request(d,S,w)},authInfo:r?.authInfo,requestId:t.id,requestInfo:r?.requestInfo,taskId:o,taskStore:c,taskRequestedTtl:i?.ttl,closeSSEStream:r?.closeSSEStream,closeStandaloneSSEStream:r?.closeStandaloneSSEStream};Promise.resolve().then(()=>{i&&this.assertTaskHandlerCapability(t.method)}).then(()=>n(t,l)).then(async d=>{if(a.signal.aborted)return;const S={result:d,jsonrpc:"2.0",id:t.id};o&&this._taskMessageQueue?await this._enqueueTaskMessage(o,{type:"response",message:S,timestamp:Date.now()},s?.sessionId):await s?.send(S)},async d=>{if(a.signal.aborted)return;const S={jsonrpc:"2.0",id:t.id,error:{code:Number.isSafeInteger(d.code)?d.code:re.InternalError,message:d.message??"Internal error",...d.data!==void 0&&{data:d.data}}};o&&this._taskMessageQueue?await this._enqueueTaskMessage(o,{type:"error",message:S,timestamp:Date.now()},s?.sessionId):await s?.send(S)}).catch(d=>this._onerror(new Error(`Failed to send response: ${d}`))).finally(()=>{this._requestHandlerAbortControllers.delete(t.id)})}_onprogress(t){const{progressToken:r,...n}=t.params,s=Number(r),o=this._progressHandlers.get(s);if(!o){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(t)}`));return}const a=this._responseHandlers.get(s),i=this._timeoutInfo.get(s);if(i&&a&&i.resetTimeoutOnProgress)try{this._resetTimeout(s)}catch(c){this._responseHandlers.delete(s),this._progressHandlers.delete(s),this._cleanupTimeout(s),a(c);return}o(n)}_onresponse(t){const r=Number(t.id),n=this._requestResolvers.get(r);if(n){if(this._requestResolvers.delete(r),qt(t))n(t);else{const a=new Q(t.error.code,t.error.message,t.error.data);n(a)}return}const s=this._responseHandlers.get(r);if(s===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(t)}`));return}this._responseHandlers.delete(r),this._cleanupTimeout(r);let o=!1;if(qt(t)&&t.result&&typeof t.result=="object"){const a=t.result;if(a.task&&typeof a.task=="object"){const i=a.task;typeof i.taskId=="string"&&(o=!0,this._taskProgressTokens.set(i.taskId,r))}}if(o||this._progressHandlers.delete(r),qt(t))s(t);else{const a=Q.fromError(t.error.code,t.error.message,t.error.data);s(a)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(t,r,n){const{task:s}=n??{};if(!s){try{yield{type:"result",result:await this.request(t,r,n)}}catch(a){yield{type:"error",error:a instanceof Q?a:new Q(re.InternalError,String(a))}}return}let o;try{const a=await this.request(t,Vt,n);if(a.task)o=a.task.taskId,yield{type:"taskCreated",task:a.task};else throw new Q(re.InternalError,"Task creation did not return a task");for(;;){const i=await this.getTask({taskId:o},n);if(yield{type:"taskStatus",task:i},ut(i.status)){i.status==="completed"?yield{type:"result",result:await this.getTaskResult({taskId:o},r,n)}:i.status==="failed"?yield{type:"error",error:new Q(re.InternalError,`Task ${o} failed`)}:i.status==="cancelled"&&(yield{type:"error",error:new Q(re.InternalError,`Task ${o} was cancelled`)});return}if(i.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:o},r,n)};return}const c=i.pollInterval??this._options?.defaultTaskPollInterval??1e3;await new Promise(l=>setTimeout(l,c)),n?.signal?.throwIfAborted()}}catch(a){yield{type:"error",error:a instanceof Q?a:new Q(re.InternalError,String(a))}}}request(t,r,n){const{relatedRequestId:s,resumptionToken:o,onresumptiontoken:a,task:i,relatedTask:c}=n??{};return new Promise((l,d)=>{const S=u=>{d(u)};if(!this._transport){S(new Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{this.assertCapabilityForMethod(t.method),i&&this.assertTaskCapability(t.method)}catch(u){S(u);return}n?.signal?.throwIfAborted();const _=this._requestMessageId++,w={...t,jsonrpc:"2.0",id:_};n?.onprogress&&(this._progressHandlers.set(_,n.onprogress),w.params={...t.params,_meta:{...t.params?._meta||{},progressToken:_}}),i&&(w.params={...w.params,task:i}),c&&(w.params={...w.params,_meta:{...w.params?._meta||{},[ct]:c}});const E=u=>{this._responseHandlers.delete(_),this._progressHandlers.delete(_),this._cleanupTimeout(_),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:_,reason:String(u)}},{relatedRequestId:s,resumptionToken:o,onresumptiontoken:a}).catch($=>this._onerror(new Error(`Failed to send cancellation: ${$}`)));const p=u instanceof Q?u:new Q(re.RequestTimeout,String(u));d(p)};this._responseHandlers.set(_,u=>{if(!n?.signal?.aborted){if(u instanceof Error)return d(u);try{const p=tt(r,u.result);p.success?l(p.data):d(p.error)}catch(p){d(p)}}}),n?.signal?.addEventListener("abort",()=>{E(n?.signal?.reason)});const g=n?.timeout??wm,f=()=>E(Q.fromError(re.RequestTimeout,"Request timed out",{timeout:g}));this._setupTimeout(_,g,n?.maxTotalTimeout,f,n?.resetTimeoutOnProgress??!1);const h=c?.taskId;if(h){const u=p=>{const $=this._responseHandlers.get(_);$?$(p):this._onerror(new Error(`Response handler missing for side-channeled request ${_}`))};this._requestResolvers.set(_,u),this._enqueueTaskMessage(h,{type:"request",message:w,timestamp:Date.now()}).catch(p=>{this._cleanupTimeout(_),d(p)})}else this._transport.send(w,{relatedRequestId:s,resumptionToken:o,onresumptiontoken:a}).catch(u=>{this._cleanupTimeout(_),d(u)})})}async getTask(t,r){return this.request({method:"tasks/get",params:t},Fn,r)}async getTaskResult(t,r,n){return this.request({method:"tasks/result",params:t},r,n)}async listTasks(t,r){return this.request({method:"tasks/list",params:t},Jn,r)}async cancelTask(t,r){return this.request({method:"tasks/cancel",params:t},up,r)}async notification(t,r){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(t.method);const n=r?.relatedTask?.taskId;if(n){const i={...t,jsonrpc:"2.0",params:{...t.params,_meta:{...t.params?._meta||{},[ct]:r.relatedTask}}};await this._enqueueTaskMessage(n,{type:"notification",message:i,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(t.method)&&!t.params&&!r?.relatedRequestId&&!r?.relatedTask){if(this._pendingDebouncedNotifications.has(t.method))return;this._pendingDebouncedNotifications.add(t.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(t.method),!this._transport)return;let i={...t,jsonrpc:"2.0"};r?.relatedTask&&(i={...i,params:{...i.params,_meta:{...i.params?._meta||{},[ct]:r.relatedTask}}}),this._transport?.send(i,r).catch(c=>this._onerror(c))});return}let a={...t,jsonrpc:"2.0"};r?.relatedTask&&(a={...a,params:{...a.params,_meta:{...a.params?._meta||{},[ct]:r.relatedTask}}}),await this._transport.send(a,r)}setRequestHandler(t,r){const n=ja(t);this.assertRequestHandlerCapability(n),this._requestHandlers.set(n,(s,o)=>{const a=qa(t,s);return Promise.resolve(r(a,o))})}removeRequestHandler(t){this._requestHandlers.delete(t)}assertCanSetRequestHandler(t){if(this._requestHandlers.has(t))throw new Error(`A request handler for ${t} already exists, which would be overridden`)}setNotificationHandler(t,r){const n=ja(t);this._notificationHandlers.set(n,s=>{const o=qa(t,s);return Promise.resolve(r(o))})}removeNotificationHandler(t){this._notificationHandlers.delete(t)}_cleanupTaskProgressHandler(t){const r=this._taskProgressTokens.get(t);r!==void 0&&(this._progressHandlers.delete(r),this._taskProgressTokens.delete(t))}async _enqueueTaskMessage(t,r,n){if(!this._taskStore||!this._taskMessageQueue)throw new Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");const s=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(t,r,n,s)}async _clearTaskQueue(t,r){if(this._taskMessageQueue){const n=await this._taskMessageQueue.dequeueAll(t,r);for(const s of n)if(s.type==="request"&&jn(s.message)){const o=s.message.id,a=this._requestResolvers.get(o);a?(a(new Q(re.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(o)):this._onerror(new Error(`Resolver missing for request ${o} during task ${t} cleanup`))}}}async _waitForTaskUpdate(t,r){let n=this._options?.defaultTaskPollInterval??1e3;try{const s=await this._taskStore?.getTask(t);s?.pollInterval&&(n=s.pollInterval)}catch{}return new Promise((s,o)=>{if(r.aborted){o(new Q(re.InvalidRequest,"Request cancelled"));return}const a=setTimeout(s,n);r.addEventListener("abort",()=>{clearTimeout(a),o(new Q(re.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(t,r){const n=this._taskStore;if(!n)throw new Error("No task store configured");return{createTask:async s=>{if(!t)throw new Error("No request provided");return await n.createTask(s,t.id,{method:t.method,params:t.params},r)},getTask:async s=>{const o=await n.getTask(s,r);if(!o)throw new Q(re.InvalidParams,"Failed to retrieve task: Task not found");return o},storeTaskResult:async(s,o,a)=>{await n.storeTaskResult(s,o,a,r);const i=await n.getTask(s,r);if(i){const c=dr.parse({method:"notifications/tasks/status",params:i});await this.notification(c),ut(i.status)&&this._cleanupTaskProgressHandler(s)}},getTaskResult:s=>n.getTaskResult(s,r),updateTaskStatus:async(s,o,a)=>{const i=await n.getTask(s,r);if(!i)throw new Q(re.InvalidParams,`Task "${s}" not found - it may have been cleaned up`);if(ut(i.status))throw new Q(re.InvalidParams,`Cannot update task "${s}" from terminal status "${i.status}" to "${o}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await n.updateTaskStatus(s,o,a,r);const c=await n.getTask(s,r);if(c){const l=dr.parse({method:"notifications/tasks/status",params:c});await this.notification(l),ut(c.status)&&this._cleanupTaskProgressHandler(s)}},listTasks:s=>n.listTasks(s,r)}}}function xa(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function Sm(e,t){const r={...e};for(const n in t){const s=n,o=t[s];if(o===void 0)continue;const a=r[s];xa(a)&&xa(o)?r[s]={...a,...o}:r[s]=o}return r}function ts(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var pr={exports:{}},rs={},We={},lt={},ns={},ss={},os={},Ua;function mr(){return Ua||(Ua=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.regexpCode=e.getEsmExportName=e.getProperty=e.safeStringify=e.stringify=e.strConcat=e.addCodeArg=e.str=e._=e.nil=e._Code=e.Name=e.IDENTIFIER=e._CodeOrName=void 0;class t{}e._CodeOrName=t,e.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class r extends t{constructor(u){if(super(),!e.IDENTIFIER.test(u))throw new Error("CodeGen: name must be a valid identifier");this.str=u}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}e.Name=r;class n extends t{constructor(u){super(),this._items=typeof u=="string"?[u]:u}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const u=this._items[0];return u===""||u==='""'}get str(){var u;return(u=this._str)!==null&&u!==void 0?u:this._str=this._items.reduce((p,$)=>`${p}${$}`,"")}get names(){var u;return(u=this._names)!==null&&u!==void 0?u:this._names=this._items.reduce((p,$)=>($ instanceof r&&(p[$.str]=(p[$.str]||0)+1),p),{})}}e._Code=n,e.nil=new n("");function s(h,...u){const p=[h[0]];let $=0;for(;$<u.length;)i(p,u[$]),p.push(h[++$]);return new n(p)}e._=s;const o=new n("+");function a(h,...u){const p=[w(h[0])];let $=0;for(;$<u.length;)p.push(o),i(p,u[$]),p.push(o,w(h[++$]));return c(p),new n(p)}e.str=a;function i(h,u){u instanceof n?h.push(...u._items):u instanceof r?h.push(u):h.push(S(u))}e.addCodeArg=i;function c(h){let u=1;for(;u<h.length-1;){if(h[u]===o){const p=l(h[u-1],h[u+1]);if(p!==void 0){h.splice(u-1,3,p);continue}h[u++]="+"}u++}}function l(h,u){if(u==='""')return h;if(h==='""')return u;if(typeof h=="string")return u instanceof r||h[h.length-1]!=='"'?void 0:typeof u!="string"?`${h.slice(0,-1)}${u}"`:u[0]==='"'?h.slice(0,-1)+u.slice(1):void 0;if(typeof u=="string"&&u[0]==='"'&&!(h instanceof r))return`"${h}${u.slice(1)}`}function d(h,u){return u.emptyStr()?h:h.emptyStr()?u:a`${h}${u}`}e.strConcat=d;function S(h){return typeof h=="number"||typeof h=="boolean"||h===null?h:w(Array.isArray(h)?h.join(","):h)}function _(h){return new n(w(h))}e.stringify=_;function w(h){return JSON.stringify(h).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e.safeStringify=w;function E(h){return typeof h=="string"&&e.IDENTIFIER.test(h)?new n(`.${h}`):s`[${h}]`}e.getProperty=E;function g(h){if(typeof h=="string"&&e.IDENTIFIER.test(h))return new n(`${h}`);throw new Error(`CodeGen: invalid export name: ${h}, use explicit $id name mapping`)}e.getEsmExportName=g;function f(h){return new n(h.toString())}e.regexpCode=f})(os)),os}var as={},Da;function La(){return Da||(Da=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueScope=e.ValueScopeName=e.Scope=e.varKinds=e.UsedValueState=void 0;const t=mr();class r extends Error{constructor(l){super(`CodeGen: "code" for ${l} not defined`),this.value=l.value}}var n;(function(c){c[c.Started=0]="Started",c[c.Completed=1]="Completed"})(n||(e.UsedValueState=n={})),e.varKinds={const:new t.Name("const"),let:new t.Name("let"),var:new t.Name("var")};class s{constructor({prefixes:l,parent:d}={}){this._names={},this._prefixes=l,this._parent=d}toName(l){return l instanceof t.Name?l:this.name(l)}name(l){return new t.Name(this._newName(l))}_newName(l){const d=this._names[l]||this._nameGroup(l);return`${l}${d.index++}`}_nameGroup(l){var d,S;if(!((S=(d=this._parent)===null||d===void 0?void 0:d._prefixes)===null||S===void 0)&&S.has(l)||this._prefixes&&!this._prefixes.has(l))throw new Error(`CodeGen: prefix "${l}" is not allowed in this scope`);return this._names[l]={prefix:l,index:0}}}e.Scope=s;class o extends t.Name{constructor(l,d){super(d),this.prefix=l}setValue(l,{property:d,itemIndex:S}){this.value=l,this.scopePath=(0,t._)`.${new t.Name(d)}[${S}]`}}e.ValueScopeName=o;const a=(0,t._)`\n`;class i extends s{constructor(l){super(l),this._values={},this._scope=l.scope,this.opts={...l,_n:l.lines?a:t.nil}}get(){return this._scope}name(l){return new o(l,this._newName(l))}value(l,d){var S;if(d.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const _=this.toName(l),{prefix:w}=_,E=(S=d.key)!==null&&S!==void 0?S:d.ref;let g=this._values[w];if(g){const u=g.get(E);if(u)return u}else g=this._values[w]=new Map;g.set(E,_);const f=this._scope[w]||(this._scope[w]=[]),h=f.length;return f[h]=d.ref,_.setValue(d,{property:w,itemIndex:h}),_}getValue(l,d){const S=this._values[l];if(S)return S.get(d)}scopeRefs(l,d=this._values){return this._reduceValues(d,S=>{if(S.scopePath===void 0)throw new Error(`CodeGen: name "${S}" has no value`);return(0,t._)`${l}${S.scopePath}`})}scopeCode(l=this._values,d,S){return this._reduceValues(l,_=>{if(_.value===void 0)throw new Error(`CodeGen: name "${_}" has no value`);return _.value.code},d,S)}_reduceValues(l,d,S={},_){let w=t.nil;for(const E in l){const g=l[E];if(!g)continue;const f=S[E]=S[E]||new Map;g.forEach(h=>{if(f.has(h))return;f.set(h,n.Started);let u=d(h);if(u){const p=this.opts.es5?e.varKinds.var:e.varKinds.const;w=(0,t._)`${w}${p} ${h} = ${u};${this.opts._n}`}else if(u=_?.(h))w=(0,t._)`${w}${u}${this.opts._n}`;else throw new r(h);f.set(h,n.Completed)})}return w}}e.ValueScope=i})(as)),as}var Va;function ne(){return Va||(Va=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.or=e.and=e.not=e.CodeGen=e.operators=e.varKinds=e.ValueScopeName=e.ValueScope=e.Scope=e.Name=e.regexpCode=e.stringify=e.getProperty=e.nil=e.strConcat=e.str=e._=void 0;const t=mr(),r=La();var n=mr();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(e,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(e,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(e,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return n.Name}});var s=La();Object.defineProperty(e,"Scope",{enumerable:!0,get:function(){return s.Scope}}),Object.defineProperty(e,"ValueScope",{enumerable:!0,get:function(){return s.ValueScope}}),Object.defineProperty(e,"ValueScopeName",{enumerable:!0,get:function(){return s.ValueScopeName}}),Object.defineProperty(e,"varKinds",{enumerable:!0,get:function(){return s.varKinds}}),e.operators={GT:new t._Code(">"),GTE:new t._Code(">="),LT:new t._Code("<"),LTE:new t._Code("<="),EQ:new t._Code("==="),NEQ:new t._Code("!=="),NOT:new t._Code("!"),OR:new t._Code("||"),AND:new t._Code("&&"),ADD:new t._Code("+")};class o{optimizeNodes(){return this}optimizeNames(b,T){return this}}class a extends o{constructor(b,T,N){super(),this.varKind=b,this.name=T,this.rhs=N}render({es5:b,_n:T}){const N=b?r.varKinds.var:this.varKind,V=this.rhs===void 0?"":` = ${this.rhs}`;return`${N} ${this.name}${V};`+T}optimizeNames(b,T){if(b[this.name.str])return this.rhs&&(this.rhs=Z(this.rhs,b,T)),this}get names(){return this.rhs instanceof t._CodeOrName?this.rhs.names:{}}}class i extends o{constructor(b,T,N){super(),this.lhs=b,this.rhs=T,this.sideEffects=N}render({_n:b}){return`${this.lhs} = ${this.rhs};`+b}optimizeNames(b,T){if(!(this.lhs instanceof t.Name&&!b[this.lhs.str]&&!this.sideEffects))return this.rhs=Z(this.rhs,b,T),this}get names(){const b=this.lhs instanceof t.Name?{}:{...this.lhs.names};return q(b,this.rhs)}}class c extends i{constructor(b,T,N,V){super(b,N,V),this.op=T}render({_n:b}){return`${this.lhs} ${this.op}= ${this.rhs};`+b}}class l extends o{constructor(b){super(),this.label=b,this.names={}}render({_n:b}){return`${this.label}:`+b}}class d extends o{constructor(b){super(),this.label=b,this.names={}}render({_n:b}){return`break${this.label?` ${this.label}`:""};`+b}}class S extends o{constructor(b){super(),this.error=b}render({_n:b}){return`throw ${this.error};`+b}get names(){return this.error.names}}class _ extends o{constructor(b){super(),this.code=b}render({_n:b}){return`${this.code};`+b}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(b,T){return this.code=Z(this.code,b,T),this}get names(){return this.code instanceof t._CodeOrName?this.code.names:{}}}class w extends o{constructor(b=[]){super(),this.nodes=b}render(b){return this.nodes.reduce((T,N)=>T+N.render(b),"")}optimizeNodes(){const{nodes:b}=this;let T=b.length;for(;T--;){const N=b[T].optimizeNodes();Array.isArray(N)?b.splice(T,1,...N):N?b[T]=N:b.splice(T,1)}return b.length>0?this:void 0}optimizeNames(b,T){const{nodes:N}=this;let V=N.length;for(;V--;){const J=N[V];J.optimizeNames(b,T)||(G(b,J.names),N.splice(V,1))}return N.length>0?this:void 0}get names(){return this.nodes.reduce((b,T)=>x(b,T.names),{})}}class E extends w{render(b){return"{"+b._n+super.render(b)+"}"+b._n}}class g extends w{}class f extends E{}f.kind="else";class h extends E{constructor(b,T){super(T),this.condition=b}render(b){let T=`if(${this.condition})`+super.render(b);return this.else&&(T+="else "+this.else.render(b)),T}optimizeNodes(){super.optimizeNodes();const b=this.condition;if(b===!0)return this.nodes;let T=this.else;if(T){const N=T.optimizeNodes();T=this.else=Array.isArray(N)?new f(N):N}if(T)return b===!1?T instanceof h?T:T.nodes:this.nodes.length?this:new h(ue(b),T instanceof h?[T]:T.nodes);if(!(b===!1||!this.nodes.length))return this}optimizeNames(b,T){var N;if(this.else=(N=this.else)===null||N===void 0?void 0:N.optimizeNames(b,T),!!(super.optimizeNames(b,T)||this.else))return this.condition=Z(this.condition,b,T),this}get names(){const b=super.names;return q(b,this.condition),this.else&&x(b,this.else.names),b}}h.kind="if";class u extends E{}u.kind="for";class p extends u{constructor(b){super(),this.iteration=b}render(b){return`for(${this.iteration})`+super.render(b)}optimizeNames(b,T){if(super.optimizeNames(b,T))return this.iteration=Z(this.iteration,b,T),this}get names(){return x(super.names,this.iteration.names)}}class $ extends u{constructor(b,T,N,V){super(),this.varKind=b,this.name=T,this.from=N,this.to=V}render(b){const T=b.es5?r.varKinds.var:this.varKind,{name:N,from:V,to:J}=this;return`for(${T} ${N}=${V}; ${N}<${J}; ${N}++)`+super.render(b)}get names(){const b=q(super.names,this.from);return q(b,this.to)}}class m extends u{constructor(b,T,N,V){super(),this.loop=b,this.varKind=T,this.name=N,this.iterable=V}render(b){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(b)}optimizeNames(b,T){if(super.optimizeNames(b,T))return this.iterable=Z(this.iterable,b,T),this}get names(){return x(super.names,this.iterable.names)}}class y extends E{constructor(b,T,N){super(),this.name=b,this.args=T,this.async=N}render(b){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(b)}}y.kind="func";class k extends w{render(b){return"return "+super.render(b)}}k.kind="return";class I extends E{render(b){let T="try"+super.render(b);return this.catch&&(T+=this.catch.render(b)),this.finally&&(T+=this.finally.render(b)),T}optimizeNodes(){var b,T;return super.optimizeNodes(),(b=this.catch)===null||b===void 0||b.optimizeNodes(),(T=this.finally)===null||T===void 0||T.optimizeNodes(),this}optimizeNames(b,T){var N,V;return super.optimizeNames(b,T),(N=this.catch)===null||N===void 0||N.optimizeNames(b,T),(V=this.finally)===null||V===void 0||V.optimizeNames(b,T),this}get names(){const b=super.names;return this.catch&&x(b,this.catch.names),this.finally&&x(b,this.finally.names),b}}class z extends E{constructor(b){super(),this.error=b}render(b){return`catch(${this.error})`+super.render(b)}}z.kind="catch";class D extends E{render(b){return"finally"+super.render(b)}}D.kind="finally";class M{constructor(b,T={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...T,_n:T.lines?`
`:""},this._extScope=b,this._scope=new r.Scope({parent:b}),this._nodes=[new g]}toString(){return this._root.render(this.opts)}name(b){return this._scope.name(b)}scopeName(b){return this._extScope.name(b)}scopeValue(b,T){const N=this._extScope.value(b,T);return(this._values[N.prefix]||(this._values[N.prefix]=new Set)).add(N),N}getScopeValue(b,T){return this._extScope.getValue(b,T)}scopeRefs(b){return this._extScope.scopeRefs(b,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(b,T,N,V){const J=this._scope.toName(T);return N!==void 0&&V&&(this._constants[J.str]=N),this._leafNode(new a(b,J,N)),J}const(b,T,N){return this._def(r.varKinds.const,b,T,N)}let(b,T,N){return this._def(r.varKinds.let,b,T,N)}var(b,T,N){return this._def(r.varKinds.var,b,T,N)}assign(b,T,N){return this._leafNode(new i(b,T,N))}add(b,T){return this._leafNode(new c(b,e.operators.ADD,T))}code(b){return typeof b=="function"?b():b!==t.nil&&this._leafNode(new _(b)),this}object(...b){const T=["{"];for(const[N,V]of b)T.length>1&&T.push(","),T.push(N),(N!==V||this.opts.es5)&&(T.push(":"),(0,t.addCodeArg)(T,V));return T.push("}"),new t._Code(T)}if(b,T,N){if(this._blockNode(new h(b)),T&&N)this.code(T).else().code(N).endIf();else if(T)this.code(T).endIf();else if(N)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(b){return this._elseNode(new h(b))}else(){return this._elseNode(new f)}endIf(){return this._endBlockNode(h,f)}_for(b,T){return this._blockNode(b),T&&this.code(T).endFor(),this}for(b,T){return this._for(new p(b),T)}forRange(b,T,N,V,J=this.opts.es5?r.varKinds.var:r.varKinds.let){const ee=this._scope.toName(b);return this._for(new $(J,ee,T,N),()=>V(ee))}forOf(b,T,N,V=r.varKinds.const){const J=this._scope.toName(b);if(this.opts.es5){const ee=T instanceof t.Name?T:this.var("_arr",T);return this.forRange("_i",0,(0,t._)`${ee}.length`,ae=>{this.var(J,(0,t._)`${ee}[${ae}]`),N(J)})}return this._for(new m("of",V,J,T),()=>N(J))}forIn(b,T,N,V=this.opts.es5?r.varKinds.var:r.varKinds.const){if(this.opts.ownProperties)return this.forOf(b,(0,t._)`Object.keys(${T})`,N);const J=this._scope.toName(b);return this._for(new m("in",V,J,T),()=>N(J))}endFor(){return this._endBlockNode(u)}label(b){return this._leafNode(new l(b))}break(b){return this._leafNode(new d(b))}return(b){const T=new k;if(this._blockNode(T),this.code(b),T.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(k)}try(b,T,N){if(!T&&!N)throw new Error('CodeGen: "try" without "catch" and "finally"');const V=new I;if(this._blockNode(V),this.code(b),T){const J=this.name("e");this._currNode=V.catch=new z(J),T(J)}return N&&(this._currNode=V.finally=new D,this.code(N)),this._endBlockNode(z,D)}throw(b){return this._leafNode(new S(b))}block(b,T){return this._blockStarts.push(this._nodes.length),b&&this.code(b).endBlock(T),this}endBlock(b){const T=this._blockStarts.pop();if(T===void 0)throw new Error("CodeGen: not in self-balancing block");const N=this._nodes.length-T;if(N<0||b!==void 0&&N!==b)throw new Error(`CodeGen: wrong number of nodes: ${N} vs ${b} expected`);return this._nodes.length=T,this}func(b,T=t.nil,N,V){return this._blockNode(new y(b,T,N)),V&&this.code(V).endFunc(),this}endFunc(){return this._endBlockNode(y)}optimize(b=1){for(;b-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(b){return this._currNode.nodes.push(b),this}_blockNode(b){this._currNode.nodes.push(b),this._nodes.push(b)}_endBlockNode(b,T){const N=this._currNode;if(N instanceof b||T&&N instanceof T)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${T?`${b.kind}/${T.kind}`:b.kind}"`)}_elseNode(b){const T=this._currNode;if(!(T instanceof h))throw new Error('CodeGen: "else" without "if"');return this._currNode=T.else=b,this}get _root(){return this._nodes[0]}get _currNode(){const b=this._nodes;return b[b.length-1]}set _currNode(b){const T=this._nodes;T[T.length-1]=b}}e.CodeGen=M;function x(A,b){for(const T in b)A[T]=(A[T]||0)+(b[T]||0);return A}function q(A,b){return b instanceof t._CodeOrName?x(A,b.names):A}function Z(A,b,T){if(A instanceof t.Name)return N(A);if(!V(A))return A;return new t._Code(A._items.reduce((J,ee)=>(ee instanceof t.Name&&(ee=N(ee)),ee instanceof t._Code?J.push(...ee._items):J.push(ee),J),[]));function N(J){const ee=T[J.str];return ee===void 0||b[J.str]!==1?J:(delete b[J.str],ee)}function V(J){return J instanceof t._Code&&J._items.some(ee=>ee instanceof t.Name&&b[ee.str]===1&&T[ee.str]!==void 0)}}function G(A,b){for(const T in b)A[T]=(A[T]||0)-(b[T]||0)}function ue(A){return typeof A=="boolean"||typeof A=="number"||A===null?!A:(0,t._)`!${R(A)}`}e.not=ue;const ie=v(e.operators.AND);function X(...A){return A.reduce(ie)}e.and=X;const Se=v(e.operators.OR);function L(...A){return A.reduce(Se)}e.or=L;function v(A){return(b,T)=>b===t.nil?T:T===t.nil?b:(0,t._)`${R(b)} ${A} ${R(T)}`}function R(A){return A instanceof t.Name?A:(0,t._)`(${A})`}})(ss)),ss}var se={},Za;function ce(){if(Za)return se;Za=1,Object.defineProperty(se,"__esModule",{value:!0}),se.checkStrictMode=se.getErrorPath=se.Type=se.useFunc=se.setEvaluated=se.evaluatedPropsToName=se.mergeEvaluated=se.eachItem=se.unescapeJsonPointer=se.escapeJsonPointer=se.escapeFragment=se.unescapeFragment=se.schemaRefOrVal=se.schemaHasRulesButRef=se.schemaHasRules=se.checkUnknownRules=se.alwaysValidSchema=se.toHash=void 0;const e=ne(),t=mr();function r(m){const y={};for(const k of m)y[k]=!0;return y}se.toHash=r;function n(m,y){return typeof y=="boolean"?y:Object.keys(y).length===0?!0:(s(m,y),!o(y,m.self.RULES.all))}se.alwaysValidSchema=n;function s(m,y=m.schema){const{opts:k,self:I}=m;if(!k.strictSchema||typeof y=="boolean")return;const z=I.RULES.keywords;for(const D in y)z[D]||$(m,`unknown keyword: "${D}"`)}se.checkUnknownRules=s;function o(m,y){if(typeof m=="boolean")return!m;for(const k in m)if(y[k])return!0;return!1}se.schemaHasRules=o;function a(m,y){if(typeof m=="boolean")return!m;for(const k in m)if(k!=="$ref"&&y.all[k])return!0;return!1}se.schemaHasRulesButRef=a;function i({topSchemaRef:m,schemaPath:y},k,I,z){if(!z){if(typeof k=="number"||typeof k=="boolean")return k;if(typeof k=="string")return(0,e._)`${k}`}return(0,e._)`${m}${y}${(0,e.getProperty)(I)}`}se.schemaRefOrVal=i;function c(m){return S(decodeURIComponent(m))}se.unescapeFragment=c;function l(m){return encodeURIComponent(d(m))}se.escapeFragment=l;function d(m){return typeof m=="number"?`${m}`:m.replace(/~/g,"~0").replace(/\//g,"~1")}se.escapeJsonPointer=d;function S(m){return m.replace(/~1/g,"/").replace(/~0/g,"~")}se.unescapeJsonPointer=S;function _(m,y){if(Array.isArray(m))for(const k of m)y(k);else y(m)}se.eachItem=_;function w({mergeNames:m,mergeToName:y,mergeValues:k,resultToName:I}){return(z,D,M,x)=>{const q=M===void 0?D:M instanceof e.Name?(D instanceof e.Name?m(z,D,M):y(z,D,M),M):D instanceof e.Name?(y(z,M,D),D):k(D,M);return x===e.Name&&!(q instanceof e.Name)?I(z,q):q}}se.mergeEvaluated={props:w({mergeNames:(m,y,k)=>m.if((0,e._)`${k} !== true && ${y} !== undefined`,()=>{m.if((0,e._)`${y} === true`,()=>m.assign(k,!0),()=>m.assign(k,(0,e._)`${k} || {}`).code((0,e._)`Object.assign(${k}, ${y})`))}),mergeToName:(m,y,k)=>m.if((0,e._)`${k} !== true`,()=>{y===!0?m.assign(k,!0):(m.assign(k,(0,e._)`${k} || {}`),g(m,k,y))}),mergeValues:(m,y)=>m===!0?!0:{...m,...y},resultToName:E}),items:w({mergeNames:(m,y,k)=>m.if((0,e._)`${k} !== true && ${y} !== undefined`,()=>m.assign(k,(0,e._)`${y} === true ? true : ${k} > ${y} ? ${k} : ${y}`)),mergeToName:(m,y,k)=>m.if((0,e._)`${k} !== true`,()=>m.assign(k,y===!0?!0:(0,e._)`${k} > ${y} ? ${k} : ${y}`)),mergeValues:(m,y)=>m===!0?!0:Math.max(m,y),resultToName:(m,y)=>m.var("items",y)})};function E(m,y){if(y===!0)return m.var("props",!0);const k=m.var("props",(0,e._)`{}`);return y!==void 0&&g(m,k,y),k}se.evaluatedPropsToName=E;function g(m,y,k){Object.keys(k).forEach(I=>m.assign((0,e._)`${y}${(0,e.getProperty)(I)}`,!0))}se.setEvaluated=g;const f={};function h(m,y){return m.scopeValue("func",{ref:y,code:f[y.code]||(f[y.code]=new t._Code(y.code))})}se.useFunc=h;var u;(function(m){m[m.Num=0]="Num",m[m.Str=1]="Str"})(u||(se.Type=u={}));function p(m,y,k){if(m instanceof e.Name){const I=y===u.Num;return k?I?(0,e._)`"[" + ${m} + "]"`:(0,e._)`"['" + ${m} + "']"`:I?(0,e._)`"/" + ${m}`:(0,e._)`"/" + ${m}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return k?(0,e.getProperty)(m).toString():"/"+d(m)}se.getErrorPath=p;function $(m,y,k=m.opts.strictSchema){if(k){if(y=`strict mode: ${y}`,k===!0)throw new Error(y);m.self.logger.warn(y)}}return se.checkStrictMode=$,se}var gr={},Fa;function rt(){if(Fa)return gr;Fa=1,Object.defineProperty(gr,"__esModule",{value:!0});const e=ne(),t={data:new e.Name("data"),valCxt:new e.Name("valCxt"),instancePath:new e.Name("instancePath"),parentData:new e.Name("parentData"),parentDataProperty:new e.Name("parentDataProperty"),rootData:new e.Name("rootData"),dynamicAnchors:new e.Name("dynamicAnchors"),vErrors:new e.Name("vErrors"),errors:new e.Name("errors"),this:new e.Name("this"),self:new e.Name("self"),scope:new e.Name("scope"),json:new e.Name("json"),jsonPos:new e.Name("jsonPos"),jsonLen:new e.Name("jsonLen"),jsonPart:new e.Name("jsonPart")};return gr.default=t,gr}var Ha;function _r(){return Ha||(Ha=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extendErrors=e.resetErrorsCount=e.reportExtraError=e.reportError=e.keyword$DataError=e.keywordError=void 0;const t=ne(),r=ce(),n=rt();e.keywordError={message:({keyword:f})=>(0,t.str)`must pass "${f}" keyword validation`},e.keyword$DataError={message:({keyword:f,schemaType:h})=>h?(0,t.str)`"${f}" keyword must be ${h} ($data)`:(0,t.str)`"${f}" keyword is invalid ($data)`};function s(f,h=e.keywordError,u,p){const{it:$}=f,{gen:m,compositeRule:y,allErrors:k}=$,I=S(f,h,u);p??(y||k)?c(m,I):l($,(0,t._)`[${I}]`)}e.reportError=s;function o(f,h=e.keywordError,u){const{it:p}=f,{gen:$,compositeRule:m,allErrors:y}=p,k=S(f,h,u);c($,k),m||y||l(p,n.default.vErrors)}e.reportExtraError=o;function a(f,h){f.assign(n.default.errors,h),f.if((0,t._)`${n.default.vErrors} !== null`,()=>f.if(h,()=>f.assign((0,t._)`${n.default.vErrors}.length`,h),()=>f.assign(n.default.vErrors,null)))}e.resetErrorsCount=a;function i({gen:f,keyword:h,schemaValue:u,data:p,errsCount:$,it:m}){if($===void 0)throw new Error("ajv implementation error");const y=f.name("err");f.forRange("i",$,n.default.errors,k=>{f.const(y,(0,t._)`${n.default.vErrors}[${k}]`),f.if((0,t._)`${y}.instancePath === undefined`,()=>f.assign((0,t._)`${y}.instancePath`,(0,t.strConcat)(n.default.instancePath,m.errorPath))),f.assign((0,t._)`${y}.schemaPath`,(0,t.str)`${m.errSchemaPath}/${h}`),m.opts.verbose&&(f.assign((0,t._)`${y}.schema`,u),f.assign((0,t._)`${y}.data`,p))})}e.extendErrors=i;function c(f,h){const u=f.const("err",h);f.if((0,t._)`${n.default.vErrors} === null`,()=>f.assign(n.default.vErrors,(0,t._)`[${u}]`),(0,t._)`${n.default.vErrors}.push(${u})`),f.code((0,t._)`${n.default.errors}++`)}function l(f,h){const{gen:u,validateName:p,schemaEnv:$}=f;$.$async?u.throw((0,t._)`new ${f.ValidationError}(${h})`):(u.assign((0,t._)`${p}.errors`,h),u.return(!1))}const d={keyword:new t.Name("keyword"),schemaPath:new t.Name("schemaPath"),params:new t.Name("params"),propertyName:new t.Name("propertyName"),message:new t.Name("message"),schema:new t.Name("schema"),parentSchema:new t.Name("parentSchema")};function S(f,h,u){const{createErrors:p}=f.it;return p===!1?(0,t._)`{}`:_(f,h,u)}function _(f,h,u={}){const{gen:p,it:$}=f,m=[w($,u),E(f,u)];return g(f,h,m),p.object(...m)}function w({errorPath:f},{instancePath:h}){const u=h?(0,t.str)`${f}${(0,r.getErrorPath)(h,r.Type.Str)}`:f;return[n.default.instancePath,(0,t.strConcat)(n.default.instancePath,u)]}function E({keyword:f,it:{errSchemaPath:h}},{schemaPath:u,parentSchema:p}){let $=p?h:(0,t.str)`${h}/${f}`;return u&&($=(0,t.str)`${$}${(0,r.getErrorPath)(u,r.Type.Str)}`),[d.schemaPath,$]}function g(f,{params:h,message:u},p){const{keyword:$,data:m,schemaValue:y,it:k}=f,{opts:I,propertyName:z,topSchemaRef:D,schemaPath:M}=k;p.push([d.keyword,$],[d.params,typeof h=="function"?h(f):h||(0,t._)`{}`]),I.messages&&p.push([d.message,typeof u=="function"?u(f):u]),I.verbose&&p.push([d.schema,y],[d.parentSchema,(0,t._)`${D}${M}`],[n.default.data,m]),z&&p.push([d.propertyName,z])}})(ns)),ns}var Ka;function $m(){if(Ka)return lt;Ka=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.boolOrEmptySchema=lt.topBoolOrEmptySchema=void 0;const e=_r(),t=ne(),r=rt(),n={message:"boolean schema is false"};function s(i){const{gen:c,schema:l,validateName:d}=i;l===!1?a(i,!1):typeof l=="object"&&l.$async===!0?c.return(r.default.data):(c.assign((0,t._)`${d}.errors`,null),c.return(!0))}lt.topBoolOrEmptySchema=s;function o(i,c){const{gen:l,schema:d}=i;d===!1?(l.var(c,!1),a(i)):l.var(c,!0)}lt.boolOrEmptySchema=o;function a(i,c){const{gen:l,data:d}=i,S={gen:l,keyword:"false schema",data:d,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:i};(0,e.reportError)(S,n,void 0,c)}return lt}var Ae={},dt={},Ja;function Ba(){if(Ja)return dt;Ja=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.getRules=dt.isJSONType=void 0;const e=["string","number","integer","boolean","null","object","array"],t=new Set(e);function r(s){return typeof s=="string"&&t.has(s)}dt.isJSONType=r;function n(){const s={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...s,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},s.number,s.string,s.array,s.object],post:{rules:[]},all:{},keywords:{}}}return dt.getRules=n,dt}var Ge={},Wa;function Ga(){if(Wa)return Ge;Wa=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.shouldUseRule=Ge.shouldUseGroup=Ge.schemaHasRulesForType=void 0;function e({schema:n,self:s},o){const a=s.RULES.types[o];return a&&a!==!0&&t(n,a)}Ge.schemaHasRulesForType=e;function t(n,s){return s.rules.some(o=>r(n,o))}Ge.shouldUseGroup=t;function r(n,s){var o;return n[s.keyword]!==void 0||((o=s.definition.implements)===null||o===void 0?void 0:o.some(a=>n[a]!==void 0))}return Ge.shouldUseRule=r,Ge}var Ya;function yr(){if(Ya)return Ae;Ya=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.reportTypeError=Ae.checkDataTypes=Ae.checkDataType=Ae.coerceAndCheckDataType=Ae.getJSONTypes=Ae.getSchemaTypes=Ae.DataType=void 0;const e=Ba(),t=Ga(),r=_r(),n=ne(),s=ce();var o;(function(u){u[u.Correct=0]="Correct",u[u.Wrong=1]="Wrong"})(o||(Ae.DataType=o={}));function a(u){const p=i(u.type);if(p.includes("null")){if(u.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!p.length&&u.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');u.nullable===!0&&p.push("null")}return p}Ae.getSchemaTypes=a;function i(u){const p=Array.isArray(u)?u:u?[u]:[];if(p.every(e.isJSONType))return p;throw new Error("type must be JSONType or JSONType[]: "+p.join(","))}Ae.getJSONTypes=i;function c(u,p){const{gen:$,data:m,opts:y}=u,k=d(p,y.coerceTypes),I=p.length>0&&!(k.length===0&&p.length===1&&(0,t.schemaHasRulesForType)(u,p[0]));if(I){const z=E(p,m,y.strictNumbers,o.Wrong);$.if(z,()=>{k.length?S(u,p,k):f(u)})}return I}Ae.coerceAndCheckDataType=c;const l=new Set(["string","number","integer","boolean","null"]);function d(u,p){return p?u.filter($=>l.has($)||p==="array"&&$==="array"):[]}function S(u,p,$){const{gen:m,data:y,opts:k}=u,I=m.let("dataType",(0,n._)`typeof ${y}`),z=m.let("coerced",(0,n._)`undefined`);k.coerceTypes==="array"&&m.if((0,n._)`${I} == 'object' && Array.isArray(${y}) && ${y}.length == 1`,()=>m.assign(y,(0,n._)`${y}[0]`).assign(I,(0,n._)`typeof ${y}`).if(E(p,y,k.strictNumbers),()=>m.assign(z,y))),m.if((0,n._)`${z} !== undefined`);for(const M of $)(l.has(M)||M==="array"&&k.coerceTypes==="array")&&D(M);m.else(),f(u),m.endIf(),m.if((0,n._)`${z} !== undefined`,()=>{m.assign(y,z),_(u,z)});function D(M){switch(M){case"string":m.elseIf((0,n._)`${I} == "number" || ${I} == "boolean"`).assign(z,(0,n._)`"" + ${y}`).elseIf((0,n._)`${y} === null`).assign(z,(0,n._)`""`);return;case"number":m.elseIf((0,n._)`${I} == "boolean" || ${y} === null
              || (${I} == "string" && ${y} && ${y} == +${y})`).assign(z,(0,n._)`+${y}`);return;case"integer":m.elseIf((0,n._)`${I} === "boolean" || ${y} === null
              || (${I} === "string" && ${y} && ${y} == +${y} && !(${y} % 1))`).assign(z,(0,n._)`+${y}`);return;case"boolean":m.elseIf((0,n._)`${y} === "false" || ${y} === 0 || ${y} === null`).assign(z,!1).elseIf((0,n._)`${y} === "true" || ${y} === 1`).assign(z,!0);return;case"null":m.elseIf((0,n._)`${y} === "" || ${y} === 0 || ${y} === false`),m.assign(z,null);return;case"array":m.elseIf((0,n._)`${I} === "string" || ${I} === "number"
              || ${I} === "boolean" || ${y} === null`).assign(z,(0,n._)`[${y}]`)}}}function _({gen:u,parentData:p,parentDataProperty:$},m){u.if((0,n._)`${p} !== undefined`,()=>u.assign((0,n._)`${p}[${$}]`,m))}function w(u,p,$,m=o.Correct){const y=m===o.Correct?n.operators.EQ:n.operators.NEQ;let k;switch(u){case"null":return(0,n._)`${p} ${y} null`;case"array":k=(0,n._)`Array.isArray(${p})`;break;case"object":k=(0,n._)`${p} && typeof ${p} == "object" && !Array.isArray(${p})`;break;case"integer":k=I((0,n._)`!(${p} % 1) && !isNaN(${p})`);break;case"number":k=I();break;default:return(0,n._)`typeof ${p} ${y} ${u}`}return m===o.Correct?k:(0,n.not)(k);function I(z=n.nil){return(0,n.and)((0,n._)`typeof ${p} == "number"`,z,$?(0,n._)`isFinite(${p})`:n.nil)}}Ae.checkDataType=w;function E(u,p,$,m){if(u.length===1)return w(u[0],p,$,m);let y;const k=(0,s.toHash)(u);if(k.array&&k.object){const I=(0,n._)`typeof ${p} != "object"`;y=k.null?I:(0,n._)`!${p} || ${I}`,delete k.null,delete k.array,delete k.object}else y=n.nil;k.number&&delete k.integer;for(const I in k)y=(0,n.and)(y,w(I,p,$,m));return y}Ae.checkDataTypes=E;const g={message:({schema:u})=>`must be ${u}`,params:({schema:u,schemaValue:p})=>typeof u=="string"?(0,n._)`{type: ${u}}`:(0,n._)`{type: ${p}}`};function f(u){const p=h(u);(0,r.reportError)(p,g)}Ae.reportTypeError=f;function h(u){const{gen:p,data:$,schema:m}=u,y=(0,s.schemaRefOrVal)(u,m,"type");return{gen:p,keyword:"type",data:$,schema:m.type,schemaCode:y,schemaValue:y,parentSchema:m,params:{},it:u}}return Ae}var Ft={},Qa;function Em(){if(Qa)return Ft;Qa=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.assignDefaults=void 0;const e=ne(),t=ce();function r(s,o){const{properties:a,items:i}=s.schema;if(o==="object"&&a)for(const c in a)n(s,c,a[c].default);else o==="array"&&Array.isArray(i)&&i.forEach((c,l)=>n(s,l,c.default))}Ft.assignDefaults=r;function n(s,o,a){const{gen:i,compositeRule:c,data:l,opts:d}=s;if(a===void 0)return;const S=(0,e._)`${l}${(0,e.getProperty)(o)}`;if(c){(0,t.checkStrictMode)(s,`default is ignored for: ${S}`);return}let _=(0,e._)`${S} === undefined`;d.useDefaults==="empty"&&(_=(0,e._)`${_} || ${S} === null || ${S} === ""`),i.if(_,(0,e._)`${S} = ${(0,e.stringify)(a)}`)}return Ft}var He={},de={},Xa;function Ke(){if(Xa)return de;Xa=1,Object.defineProperty(de,"__esModule",{value:!0}),de.validateUnion=de.validateArray=de.usePattern=de.callValidateCode=de.schemaProperties=de.allSchemaProperties=de.noPropertyInData=de.propertyInData=de.isOwnProperty=de.hasPropFunc=de.reportMissingProp=de.checkMissingProp=de.checkReportMissingProp=void 0;const e=ne(),t=ce(),r=rt(),n=ce();function s(u,p){const{gen:$,data:m,it:y}=u;$.if(d($,m,p,y.opts.ownProperties),()=>{u.setParams({missingProperty:(0,e._)`${p}`},!0),u.error()})}de.checkReportMissingProp=s;function o({gen:u,data:p,it:{opts:$}},m,y){return(0,e.or)(...m.map(k=>(0,e.and)(d(u,p,k,$.ownProperties),(0,e._)`${y} = ${k}`)))}de.checkMissingProp=o;function a(u,p){u.setParams({missingProperty:p},!0),u.error()}de.reportMissingProp=a;function i(u){return u.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,e._)`Object.prototype.hasOwnProperty`})}de.hasPropFunc=i;function c(u,p,$){return(0,e._)`${i(u)}.call(${p}, ${$})`}de.isOwnProperty=c;function l(u,p,$,m){const y=(0,e._)`${p}${(0,e.getProperty)($)} !== undefined`;return m?(0,e._)`${y} && ${c(u,p,$)}`:y}de.propertyInData=l;function d(u,p,$,m){const y=(0,e._)`${p}${(0,e.getProperty)($)} === undefined`;return m?(0,e.or)(y,(0,e.not)(c(u,p,$))):y}de.noPropertyInData=d;function S(u){return u?Object.keys(u).filter(p=>p!=="__proto__"):[]}de.allSchemaProperties=S;function _(u,p){return S(p).filter($=>!(0,t.alwaysValidSchema)(u,p[$]))}de.schemaProperties=_;function w({schemaCode:u,data:p,it:{gen:$,topSchemaRef:m,schemaPath:y,errorPath:k},it:I},z,D,M){const x=M?(0,e._)`${u}, ${p}, ${m}${y}`:p,q=[[r.default.instancePath,(0,e.strConcat)(r.default.instancePath,k)],[r.default.parentData,I.parentData],[r.default.parentDataProperty,I.parentDataProperty],[r.default.rootData,r.default.rootData]];I.opts.dynamicRef&&q.push([r.default.dynamicAnchors,r.default.dynamicAnchors]);const Z=(0,e._)`${x}, ${$.object(...q)}`;return D!==e.nil?(0,e._)`${z}.call(${D}, ${Z})`:(0,e._)`${z}(${Z})`}de.callValidateCode=w;const E=(0,e._)`new RegExp`;function g({gen:u,it:{opts:p}},$){const m=p.unicodeRegExp?"u":"",{regExp:y}=p.code,k=y($,m);return u.scopeValue("pattern",{key:k.toString(),ref:k,code:(0,e._)`${y.code==="new RegExp"?E:(0,n.useFunc)(u,y)}(${$}, ${m})`})}de.usePattern=g;function f(u){const{gen:p,data:$,keyword:m,it:y}=u,k=p.name("valid");if(y.allErrors){const z=p.let("valid",!0);return I(()=>p.assign(z,!1)),z}return p.var(k,!0),I(()=>p.break()),k;function I(z){const D=p.const("len",(0,e._)`${$}.length`);p.forRange("i",0,D,M=>{u.subschema({keyword:m,dataProp:M,dataPropType:t.Type.Num},k),p.if((0,e.not)(k),z)})}}de.validateArray=f;function h(u){const{gen:p,schema:$,keyword:m,it:y}=u;if(!Array.isArray($))throw new Error("ajv implementation error");if($.some(D=>(0,t.alwaysValidSchema)(y,D))&&!y.opts.unevaluated)return;const I=p.let("valid",!1),z=p.name("_valid");p.block(()=>$.forEach((D,M)=>{const x=u.subschema({keyword:m,schemaProp:M,compositeRule:!0},z);p.assign(I,(0,e._)`${I} || ${z}`),u.mergeValidEvaluated(x,z)||p.if((0,e.not)(I))})),u.result(I,()=>u.reset(),()=>u.error(!0))}return de.validateUnion=h,de}var ei;function km(){if(ei)return He;ei=1,Object.defineProperty(He,"__esModule",{value:!0}),He.validateKeywordUsage=He.validSchemaType=He.funcKeywordCode=He.macroKeywordCode=void 0;const e=ne(),t=rt(),r=Ke(),n=_r();function s(_,w){const{gen:E,keyword:g,schema:f,parentSchema:h,it:u}=_,p=w.macro.call(u.self,f,h,u),$=l(E,g,p);u.opts.validateSchema!==!1&&u.self.validateSchema(p,!0);const m=E.name("valid");_.subschema({schema:p,schemaPath:e.nil,errSchemaPath:`${u.errSchemaPath}/${g}`,topSchemaRef:$,compositeRule:!0},m),_.pass(m,()=>_.error(!0))}He.macroKeywordCode=s;function o(_,w){var E;const{gen:g,keyword:f,schema:h,parentSchema:u,$data:p,it:$}=_;c($,w);const m=!p&&w.compile?w.compile.call($.self,h,u,$):w.validate,y=l(g,f,m),k=g.let("valid");_.block$data(k,I),_.ok((E=w.valid)!==null&&E!==void 0?E:k);function I(){if(w.errors===!1)M(),w.modifying&&a(_),x(()=>_.error());else{const q=w.async?z():D();w.modifying&&a(_),x(()=>i(_,q))}}function z(){const q=g.let("ruleErrs",null);return g.try(()=>M((0,e._)`await `),Z=>g.assign(k,!1).if((0,e._)`${Z} instanceof ${$.ValidationError}`,()=>g.assign(q,(0,e._)`${Z}.errors`),()=>g.throw(Z))),q}function D(){const q=(0,e._)`${y}.errors`;return g.assign(q,null),M(e.nil),q}function M(q=w.async?(0,e._)`await `:e.nil){const Z=$.opts.passContext?t.default.this:t.default.self,G=!("compile"in w&&!p||w.schema===!1);g.assign(k,(0,e._)`${q}${(0,r.callValidateCode)(_,y,Z,G)}`,w.modifying)}function x(q){var Z;g.if((0,e.not)((Z=w.valid)!==null&&Z!==void 0?Z:k),q)}}He.funcKeywordCode=o;function a(_){const{gen:w,data:E,it:g}=_;w.if(g.parentData,()=>w.assign(E,(0,e._)`${g.parentData}[${g.parentDataProperty}]`))}function i(_,w){const{gen:E}=_;E.if((0,e._)`Array.isArray(${w})`,()=>{E.assign(t.default.vErrors,(0,e._)`${t.default.vErrors} === null ? ${w} : ${t.default.vErrors}.concat(${w})`).assign(t.default.errors,(0,e._)`${t.default.vErrors}.length`),(0,n.extendErrors)(_)},()=>_.error())}function c({schemaEnv:_},w){if(w.async&&!_.$async)throw new Error("async keyword in sync schema")}function l(_,w,E){if(E===void 0)throw new Error(`keyword "${w}" failed to compile`);return _.scopeValue("keyword",typeof E=="function"?{ref:E}:{ref:E,code:(0,e.stringify)(E)})}function d(_,w,E=!1){return!w.length||w.some(g=>g==="array"?Array.isArray(_):g==="object"?_&&typeof _=="object"&&!Array.isArray(_):typeof _==g||E&&typeof _>"u")}He.validSchemaType=d;function S({schema:_,opts:w,self:E,errSchemaPath:g},f,h){if(Array.isArray(f.keyword)?!f.keyword.includes(h):f.keyword!==h)throw new Error("ajv implementation error");const u=f.dependencies;if(u?.some(p=>!Object.prototype.hasOwnProperty.call(_,p)))throw new Error(`parent schema must have dependencies of ${h}: ${u.join(",")}`);if(f.validateSchema&&!f.validateSchema(_[h])){const $=`keyword "${h}" value is invalid at path "${g}": `+E.errorsText(f.validateSchema.errors);if(w.validateSchema==="log")E.logger.error($);else throw new Error($)}}return He.validateKeywordUsage=S,He}var Ye={},ti;function Tm(){if(ti)return Ye;ti=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.extendSubschemaMode=Ye.extendSubschemaData=Ye.getSubschema=void 0;const e=ne(),t=ce();function r(o,{keyword:a,schemaProp:i,schema:c,schemaPath:l,errSchemaPath:d,topSchemaRef:S}){if(a!==void 0&&c!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(a!==void 0){const _=o.schema[a];return i===void 0?{schema:_,schemaPath:(0,e._)`${o.schemaPath}${(0,e.getProperty)(a)}`,errSchemaPath:`${o.errSchemaPath}/${a}`}:{schema:_[i],schemaPath:(0,e._)`${o.schemaPath}${(0,e.getProperty)(a)}${(0,e.getProperty)(i)}`,errSchemaPath:`${o.errSchemaPath}/${a}/${(0,t.escapeFragment)(i)}`}}if(c!==void 0){if(l===void 0||d===void 0||S===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:c,schemaPath:l,topSchemaRef:S,errSchemaPath:d}}throw new Error('either "keyword" or "schema" must be passed')}Ye.getSubschema=r;function n(o,a,{dataProp:i,dataPropType:c,data:l,dataTypes:d,propertyName:S}){if(l!==void 0&&i!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:_}=a;if(i!==void 0){const{errorPath:E,dataPathArr:g,opts:f}=a,h=_.let("data",(0,e._)`${a.data}${(0,e.getProperty)(i)}`,!0);w(h),o.errorPath=(0,e.str)`${E}${(0,t.getErrorPath)(i,c,f.jsPropertySyntax)}`,o.parentDataProperty=(0,e._)`${i}`,o.dataPathArr=[...g,o.parentDataProperty]}if(l!==void 0){const E=l instanceof e.Name?l:_.let("data",l,!0);w(E),S!==void 0&&(o.propertyName=S)}d&&(o.dataTypes=d);function w(E){o.data=E,o.dataLevel=a.dataLevel+1,o.dataTypes=[],a.definedProperties=new Set,o.parentData=a.data,o.dataNames=[...a.dataNames,E]}}Ye.extendSubschemaData=n;function s(o,{jtdDiscriminator:a,jtdMetadata:i,compositeRule:c,createErrors:l,allErrors:d}){c!==void 0&&(o.compositeRule=c),l!==void 0&&(o.createErrors=l),d!==void 0&&(o.allErrors=d),o.jtdDiscriminator=a,o.jtdMetadata=i}return Ye.extendSubschemaMode=s,Ye}var ze={},is,ri;function ni(){return ri||(ri=1,is=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,s,o;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(s=n;s--!==0;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(o=Object.keys(t),n=o.length,n!==Object.keys(r).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(r,o[s]))return!1;for(s=n;s--!==0;){var a=o[s];if(!e(t[a],r[a]))return!1}return!0}return t!==t&&r!==r}),is}var cs={exports:{}},si;function Pm(){if(si)return cs.exports;si=1;var e=cs.exports=function(n,s,o){typeof s=="function"&&(o=s,s={}),o=s.cb||o;var a=typeof o=="function"?o:o.pre||function(){},i=o.post||function(){};t(s,a,i,n,"",n)};e.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},e.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},e.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},e.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function t(n,s,o,a,i,c,l,d,S,_){if(a&&typeof a=="object"&&!Array.isArray(a)){s(a,i,c,l,d,S,_);for(var w in a){var E=a[w];if(Array.isArray(E)){if(w in e.arrayKeywords)for(var g=0;g<E.length;g++)t(n,s,o,E[g],i+"/"+w+"/"+g,c,i,w,a,g)}else if(w in e.propsKeywords){if(E&&typeof E=="object")for(var f in E)t(n,s,o,E[f],i+"/"+w+"/"+r(f),c,i,w,a,f)}else(w in e.keywords||n.allKeys&&!(w in e.skipKeywords))&&t(n,s,o,E,i+"/"+w,c,i,w,a)}o(a,i,c,l,d,S,_)}}function r(n){return n.replace(/~/g,"~0").replace(/\//g,"~1")}return cs.exports}var oi;function vr(){if(oi)return ze;oi=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.getSchemaRefs=ze.resolveUrl=ze.normalizeId=ze._getFullPath=ze.getFullPath=ze.inlineRef=void 0;const e=ce(),t=ni(),r=Pm(),n=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function s(g,f=!0){return typeof g=="boolean"?!0:f===!0?!a(g):f?i(g)<=f:!1}ze.inlineRef=s;const o=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function a(g){for(const f in g){if(o.has(f))return!0;const h=g[f];if(Array.isArray(h)&&h.some(a)||typeof h=="object"&&a(h))return!0}return!1}function i(g){let f=0;for(const h in g){if(h==="$ref")return 1/0;if(f++,!n.has(h)&&(typeof g[h]=="object"&&(0,e.eachItem)(g[h],u=>f+=i(u)),f===1/0))return 1/0}return f}function c(g,f="",h){h!==!1&&(f=S(f));const u=g.parse(f);return l(g,u)}ze.getFullPath=c;function l(g,f){return g.serialize(f).split("#")[0]+"#"}ze._getFullPath=l;const d=/#\/?$/;function S(g){return g?g.replace(d,""):""}ze.normalizeId=S;function _(g,f,h){return h=S(h),g.resolve(f,h)}ze.resolveUrl=_;const w=/^[a-z_][-a-z0-9._]*$/i;function E(g,f){if(typeof g=="boolean")return{};const{schemaId:h,uriResolver:u}=this.opts,p=S(g[h]||f),$={"":p},m=c(u,p,!1),y={},k=new Set;return r(g,{allKeys:!0},(D,M,x,q)=>{if(q===void 0)return;const Z=m+M;let G=$[q];typeof D[h]=="string"&&(G=ue.call(this,D[h])),ie.call(this,D.$anchor),ie.call(this,D.$dynamicAnchor),$[M]=G;function ue(X){const Se=this.opts.uriResolver.resolve;if(X=S(G?Se(G,X):X),k.has(X))throw z(X);k.add(X);let L=this.refs[X];return typeof L=="string"&&(L=this.refs[L]),typeof L=="object"?I(D,L.schema,X):X!==S(Z)&&(X[0]==="#"?(I(D,y[X],X),y[X]=D):this.refs[X]=Z),X}function ie(X){if(typeof X=="string"){if(!w.test(X))throw new Error(`invalid anchor "${X}"`);ue.call(this,`#${X}`)}}}),y;function I(D,M,x){if(M!==void 0&&!t(D,M))throw z(x)}function z(D){return new Error(`reference "${D}" resolves to more than one schema`)}}return ze.getSchemaRefs=E,ze}var ai;function wr(){if(ai)return We;ai=1,Object.defineProperty(We,"__esModule",{value:!0}),We.getData=We.KeywordCxt=We.validateFunctionCode=void 0;const e=$m(),t=yr(),r=Ga(),n=yr(),s=Em(),o=km(),a=Tm(),i=ne(),c=rt(),l=vr(),d=ce(),S=_r();function _(O){if(m(O)&&(k(O),$(O))){f(O);return}w(O,()=>(0,e.topBoolOrEmptySchema)(O))}We.validateFunctionCode=_;function w({gen:O,validateName:C,schema:U,schemaEnv:F,opts:Y},oe){Y.code.es5?O.func(C,(0,i._)`${c.default.data}, ${c.default.valCxt}`,F.$async,()=>{O.code((0,i._)`"use strict"; ${u(U,Y)}`),g(O,Y),O.code(oe)}):O.func(C,(0,i._)`${c.default.data}, ${E(Y)}`,F.$async,()=>O.code(u(U,Y)).code(oe))}function E(O){return(0,i._)`{${c.default.instancePath}="", ${c.default.parentData}, ${c.default.parentDataProperty}, ${c.default.rootData}=${c.default.data}${O.dynamicRef?(0,i._)`, ${c.default.dynamicAnchors}={}`:i.nil}}={}`}function g(O,C){O.if(c.default.valCxt,()=>{O.var(c.default.instancePath,(0,i._)`${c.default.valCxt}.${c.default.instancePath}`),O.var(c.default.parentData,(0,i._)`${c.default.valCxt}.${c.default.parentData}`),O.var(c.default.parentDataProperty,(0,i._)`${c.default.valCxt}.${c.default.parentDataProperty}`),O.var(c.default.rootData,(0,i._)`${c.default.valCxt}.${c.default.rootData}`),C.dynamicRef&&O.var(c.default.dynamicAnchors,(0,i._)`${c.default.valCxt}.${c.default.dynamicAnchors}`)},()=>{O.var(c.default.instancePath,(0,i._)`""`),O.var(c.default.parentData,(0,i._)`undefined`),O.var(c.default.parentDataProperty,(0,i._)`undefined`),O.var(c.default.rootData,c.default.data),C.dynamicRef&&O.var(c.default.dynamicAnchors,(0,i._)`{}`)})}function f(O){const{schema:C,opts:U,gen:F}=O;w(O,()=>{U.$comment&&C.$comment&&q(O),D(O),F.let(c.default.vErrors,null),F.let(c.default.errors,0),U.unevaluated&&h(O),I(O),Z(O)})}function h(O){const{gen:C,validateName:U}=O;O.evaluated=C.const("evaluated",(0,i._)`${U}.evaluated`),C.if((0,i._)`${O.evaluated}.dynamicProps`,()=>C.assign((0,i._)`${O.evaluated}.props`,(0,i._)`undefined`)),C.if((0,i._)`${O.evaluated}.dynamicItems`,()=>C.assign((0,i._)`${O.evaluated}.items`,(0,i._)`undefined`))}function u(O,C){const U=typeof O=="object"&&O[C.schemaId];return U&&(C.code.source||C.code.process)?(0,i._)`/*# sourceURL=${U} */`:i.nil}function p(O,C){if(m(O)&&(k(O),$(O))){y(O,C);return}(0,e.boolOrEmptySchema)(O,C)}function $({schema:O,self:C}){if(typeof O=="boolean")return!O;for(const U in O)if(C.RULES.all[U])return!0;return!1}function m(O){return typeof O.schema!="boolean"}function y(O,C){const{schema:U,gen:F,opts:Y}=O;Y.$comment&&U.$comment&&q(O),M(O),x(O);const oe=F.const("_errs",c.default.errors);I(O,oe),F.var(C,(0,i._)`${oe} === ${c.default.errors}`)}function k(O){(0,d.checkUnknownRules)(O),z(O)}function I(O,C){if(O.opts.jtd)return ue(O,[],!1,C);const U=(0,t.getSchemaTypes)(O.schema),F=(0,t.coerceAndCheckDataType)(O,U);ue(O,U,!F,C)}function z(O){const{schema:C,errSchemaPath:U,opts:F,self:Y}=O;C.$ref&&F.ignoreKeywordsWithRef&&(0,d.schemaHasRulesButRef)(C,Y.RULES)&&Y.logger.warn(`$ref: keywords ignored in schema at path "${U}"`)}function D(O){const{schema:C,opts:U}=O;C.default!==void 0&&U.useDefaults&&U.strictSchema&&(0,d.checkStrictMode)(O,"default is ignored in the schema root")}function M(O){const C=O.schema[O.opts.schemaId];C&&(O.baseId=(0,l.resolveUrl)(O.opts.uriResolver,O.baseId,C))}function x(O){if(O.schema.$async&&!O.schemaEnv.$async)throw new Error("async schema in sync schema")}function q({gen:O,schemaEnv:C,schema:U,errSchemaPath:F,opts:Y}){const oe=U.$comment;if(Y.$comment===!0)O.code((0,i._)`${c.default.self}.logger.log(${oe})`);else if(typeof Y.$comment=="function"){const Oe=(0,i.str)`${F}/$comment`,Je=O.scopeValue("root",{ref:C.root});O.code((0,i._)`${c.default.self}.opts.$comment(${oe}, ${Oe}, ${Je}.schema)`)}}function Z(O){const{gen:C,schemaEnv:U,validateName:F,ValidationError:Y,opts:oe}=O;U.$async?C.if((0,i._)`${c.default.errors} === 0`,()=>C.return(c.default.data),()=>C.throw((0,i._)`new ${Y}(${c.default.vErrors})`)):(C.assign((0,i._)`${F}.errors`,c.default.vErrors),oe.unevaluated&&G(O),C.return((0,i._)`${c.default.errors} === 0`))}function G({gen:O,evaluated:C,props:U,items:F}){U instanceof i.Name&&O.assign((0,i._)`${C}.props`,U),F instanceof i.Name&&O.assign((0,i._)`${C}.items`,F)}function ue(O,C,U,F){const{gen:Y,schema:oe,data:Oe,allErrors:Je,opts:je,self:qe}=O,{RULES:Ce}=qe;if(oe.$ref&&(je.ignoreKeywordsWithRef||!(0,d.schemaHasRulesButRef)(oe,Ce))){Y.block(()=>V(O,"$ref",Ce.all.$ref.definition));return}je.jtd||X(O,C),Y.block(()=>{for(const Fe of Ce.rules)Rt(Fe);Rt(Ce.post)});function Rt(Fe){(0,r.shouldUseGroup)(oe,Fe)&&(Fe.type?(Y.if((0,n.checkDataType)(Fe.type,Oe,je.strictNumbers)),ie(O,Fe),C.length===1&&C[0]===Fe.type&&U&&(Y.else(),(0,n.reportTypeError)(O)),Y.endIf()):ie(O,Fe),Je||Y.if((0,i._)`${c.default.errors} === ${F||0}`))}}function ie(O,C){const{gen:U,schema:F,opts:{useDefaults:Y}}=O;Y&&(0,s.assignDefaults)(O,C.type),U.block(()=>{for(const oe of C.rules)(0,r.shouldUseRule)(F,oe)&&V(O,oe.keyword,oe.definition,C.type)})}function X(O,C){O.schemaEnv.meta||!O.opts.strictTypes||(Se(O,C),O.opts.allowUnionTypes||L(O,C),v(O,O.dataTypes))}function Se(O,C){if(C.length){if(!O.dataTypes.length){O.dataTypes=C;return}C.forEach(U=>{A(O.dataTypes,U)||T(O,`type "${U}" not allowed by context "${O.dataTypes.join(",")}"`)}),b(O,C)}}function L(O,C){C.length>1&&!(C.length===2&&C.includes("null"))&&T(O,"use allowUnionTypes to allow union type keyword")}function v(O,C){const U=O.self.RULES.all;for(const F in U){const Y=U[F];if(typeof Y=="object"&&(0,r.shouldUseRule)(O.schema,Y)){const{type:oe}=Y.definition;oe.length&&!oe.some(Oe=>R(C,Oe))&&T(O,`missing type "${oe.join(",")}" for keyword "${F}"`)}}}function R(O,C){return O.includes(C)||C==="number"&&O.includes("integer")}function A(O,C){return O.includes(C)||C==="integer"&&O.includes("number")}function b(O,C){const U=[];for(const F of O.dataTypes)A(C,F)?U.push(F):C.includes("integer")&&F==="number"&&U.push("integer");O.dataTypes=U}function T(O,C){const U=O.schemaEnv.baseId+O.errSchemaPath;C+=` at "${U}" (strictTypes)`,(0,d.checkStrictMode)(O,C,O.opts.strictTypes)}class N{constructor(C,U,F){if((0,o.validateKeywordUsage)(C,U,F),this.gen=C.gen,this.allErrors=C.allErrors,this.keyword=F,this.data=C.data,this.schema=C.schema[F],this.$data=U.$data&&C.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,d.schemaRefOrVal)(C,this.schema,F,this.$data),this.schemaType=U.schemaType,this.parentSchema=C.schema,this.params={},this.it=C,this.def=U,this.$data)this.schemaCode=C.gen.const("vSchema",ae(this.$data,C));else if(this.schemaCode=this.schemaValue,!(0,o.validSchemaType)(this.schema,U.schemaType,U.allowUndefined))throw new Error(`${F} value must be ${JSON.stringify(U.schemaType)}`);("code"in U?U.trackErrors:U.errors!==!1)&&(this.errsCount=C.gen.const("_errs",c.default.errors))}result(C,U,F){this.failResult((0,i.not)(C),U,F)}failResult(C,U,F){this.gen.if(C),F?F():this.error(),U?(this.gen.else(),U(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(C,U){this.failResult((0,i.not)(C),void 0,U)}fail(C){if(C===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(C),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(C){if(!this.$data)return this.fail(C);const{schemaCode:U}=this;this.fail((0,i._)`${U} !== undefined && (${(0,i.or)(this.invalid$data(),C)})`)}error(C,U,F){if(U){this.setParams(U),this._error(C,F),this.setParams({});return}this._error(C,F)}_error(C,U){(C?S.reportExtraError:S.reportError)(this,this.def.error,U)}$dataError(){(0,S.reportError)(this,this.def.$dataError||S.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,S.resetErrorsCount)(this.gen,this.errsCount)}ok(C){this.allErrors||this.gen.if(C)}setParams(C,U){U?Object.assign(this.params,C):this.params=C}block$data(C,U,F=i.nil){this.gen.block(()=>{this.check$data(C,F),U()})}check$data(C=i.nil,U=i.nil){if(!this.$data)return;const{gen:F,schemaCode:Y,schemaType:oe,def:Oe}=this;F.if((0,i.or)((0,i._)`${Y} === undefined`,U)),C!==i.nil&&F.assign(C,!0),(oe.length||Oe.validateSchema)&&(F.elseIf(this.invalid$data()),this.$dataError(),C!==i.nil&&F.assign(C,!1)),F.else()}invalid$data(){const{gen:C,schemaCode:U,schemaType:F,def:Y,it:oe}=this;return(0,i.or)(Oe(),Je());function Oe(){if(F.length){if(!(U instanceof i.Name))throw new Error("ajv implementation error");const je=Array.isArray(F)?F:[F];return(0,i._)`${(0,n.checkDataTypes)(je,U,oe.opts.strictNumbers,n.DataType.Wrong)}`}return i.nil}function Je(){if(Y.validateSchema){const je=C.scopeValue("validate$data",{ref:Y.validateSchema});return(0,i._)`!${je}(${U})`}return i.nil}}subschema(C,U){const F=(0,a.getSubschema)(this.it,C);(0,a.extendSubschemaData)(F,this.it,C),(0,a.extendSubschemaMode)(F,C);const Y={...this.it,...F,items:void 0,props:void 0};return p(Y,U),Y}mergeEvaluated(C,U){const{it:F,gen:Y}=this;F.opts.unevaluated&&(F.props!==!0&&C.props!==void 0&&(F.props=d.mergeEvaluated.props(Y,C.props,F.props,U)),F.items!==!0&&C.items!==void 0&&(F.items=d.mergeEvaluated.items(Y,C.items,F.items,U)))}mergeValidEvaluated(C,U){const{it:F,gen:Y}=this;if(F.opts.unevaluated&&(F.props!==!0||F.items!==!0))return Y.if(U,()=>this.mergeEvaluated(C,i.Name)),!0}}We.KeywordCxt=N;function V(O,C,U,F){const Y=new N(O,U,C);"code"in U?U.code(Y,F):Y.$data&&U.validate?(0,o.funcKeywordCode)(Y,U):"macro"in U?(0,o.macroKeywordCode)(Y,U):(U.compile||U.validate)&&(0,o.funcKeywordCode)(Y,U)}const J=/^\/(?:[^~]|~0|~1)*$/,ee=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function ae(O,{dataLevel:C,dataNames:U,dataPathArr:F}){let Y,oe;if(O==="")return c.default.rootData;if(O[0]==="/"){if(!J.test(O))throw new Error(`Invalid JSON-pointer: ${O}`);Y=O,oe=c.default.rootData}else{const qe=ee.exec(O);if(!qe)throw new Error(`Invalid JSON-pointer: ${O}`);const Ce=+qe[1];if(Y=qe[2],Y==="#"){if(Ce>=C)throw new Error(je("property/index",Ce));return F[C-Ce]}if(Ce>C)throw new Error(je("data",Ce));if(oe=U[C-Ce],!Y)return oe}let Oe=oe;const Je=Y.split("/");for(const qe of Je)qe&&(oe=(0,i._)`${oe}${(0,i.getProperty)((0,d.unescapeJsonPointer)(qe))}`,Oe=(0,i._)`${Oe} && ${oe}`);return Oe;function je(qe,Ce){return`Cannot access ${qe} ${Ce} levels up, current level is ${C}`}}return We.getData=ae,We}var br={},ii;function us(){if(ii)return br;ii=1,Object.defineProperty(br,"__esModule",{value:!0});class e extends Error{constructor(r){super("validation failed"),this.errors=r,this.ajv=this.validation=!0}}return br.default=e,br}var Sr={},ci;function $r(){if(ci)return Sr;ci=1,Object.defineProperty(Sr,"__esModule",{value:!0});const e=vr();class t extends Error{constructor(n,s,o,a){super(a||`can't resolve reference ${o} from id ${s}`),this.missingRef=(0,e.resolveUrl)(n,s,o),this.missingSchema=(0,e.normalizeId)((0,e.getFullPath)(n,this.missingRef))}}return Sr.default=t,Sr}var De={},ui;function ls(){if(ui)return De;ui=1,Object.defineProperty(De,"__esModule",{value:!0}),De.resolveSchema=De.getCompilingSchema=De.resolveRef=De.compileSchema=De.SchemaEnv=void 0;const e=ne(),t=us(),r=rt(),n=vr(),s=ce(),o=wr();class a{constructor(h){var u;this.refs={},this.dynamicAnchors={};let p;typeof h.schema=="object"&&(p=h.schema),this.schema=h.schema,this.schemaId=h.schemaId,this.root=h.root||this,this.baseId=(u=h.baseId)!==null&&u!==void 0?u:(0,n.normalizeId)(p?.[h.schemaId||"$id"]),this.schemaPath=h.schemaPath,this.localRefs=h.localRefs,this.meta=h.meta,this.$async=p?.$async,this.refs={}}}De.SchemaEnv=a;function i(f){const h=d.call(this,f);if(h)return h;const u=(0,n.getFullPath)(this.opts.uriResolver,f.root.baseId),{es5:p,lines:$}=this.opts.code,{ownProperties:m}=this.opts,y=new e.CodeGen(this.scope,{es5:p,lines:$,ownProperties:m});let k;f.$async&&(k=y.scopeValue("Error",{ref:t.default,code:(0,e._)`require("ajv/dist/runtime/validation_error").default`}));const I=y.scopeName("validate");f.validateName=I;const z={gen:y,allErrors:this.opts.allErrors,data:r.default.data,parentData:r.default.parentData,parentDataProperty:r.default.parentDataProperty,dataNames:[r.default.data],dataPathArr:[e.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:y.scopeValue("schema",this.opts.code.source===!0?{ref:f.schema,code:(0,e.stringify)(f.schema)}:{ref:f.schema}),validateName:I,ValidationError:k,schema:f.schema,schemaEnv:f,rootId:u,baseId:f.baseId||u,schemaPath:e.nil,errSchemaPath:f.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,e._)`""`,opts:this.opts,self:this};let D;try{this._compilations.add(f),(0,o.validateFunctionCode)(z),y.optimize(this.opts.code.optimize);const M=y.toString();D=`${y.scopeRefs(r.default.scope)}return ${M}`,this.opts.code.process&&(D=this.opts.code.process(D,f));const q=new Function(`${r.default.self}`,`${r.default.scope}`,D)(this,this.scope.get());if(this.scope.value(I,{ref:q}),q.errors=null,q.schema=f.schema,q.schemaEnv=f,f.$async&&(q.$async=!0),this.opts.code.source===!0&&(q.source={validateName:I,validateCode:M,scopeValues:y._values}),this.opts.unevaluated){const{props:Z,items:G}=z;q.evaluated={props:Z instanceof e.Name?void 0:Z,items:G instanceof e.Name?void 0:G,dynamicProps:Z instanceof e.Name,dynamicItems:G instanceof e.Name},q.source&&(q.source.evaluated=(0,e.stringify)(q.evaluated))}return f.validate=q,f}catch(M){throw delete f.validate,delete f.validateName,D&&this.logger.error("Error compiling schema, function code:",D),M}finally{this._compilations.delete(f)}}De.compileSchema=i;function c(f,h,u){var p;u=(0,n.resolveUrl)(this.opts.uriResolver,h,u);const $=f.refs[u];if($)return $;let m=_.call(this,f,u);if(m===void 0){const y=(p=f.localRefs)===null||p===void 0?void 0:p[u],{schemaId:k}=this.opts;y&&(m=new a({schema:y,schemaId:k,root:f,baseId:h}))}if(m!==void 0)return f.refs[u]=l.call(this,m)}De.resolveRef=c;function l(f){return(0,n.inlineRef)(f.schema,this.opts.inlineRefs)?f.schema:f.validate?f:i.call(this,f)}function d(f){for(const h of this._compilations)if(S(h,f))return h}De.getCompilingSchema=d;function S(f,h){return f.schema===h.schema&&f.root===h.root&&f.baseId===h.baseId}function _(f,h){let u;for(;typeof(u=this.refs[h])=="string";)h=u;return u||this.schemas[h]||w.call(this,f,h)}function w(f,h){const u=this.opts.uriResolver.parse(h),p=(0,n._getFullPath)(this.opts.uriResolver,u);let $=(0,n.getFullPath)(this.opts.uriResolver,f.baseId,void 0);if(Object.keys(f.schema).length>0&&p===$)return g.call(this,u,f);const m=(0,n.normalizeId)(p),y=this.refs[m]||this.schemas[m];if(typeof y=="string"){const k=w.call(this,f,y);return typeof k?.schema!="object"?void 0:g.call(this,u,k)}if(typeof y?.schema=="object"){if(y.validate||i.call(this,y),m===(0,n.normalizeId)(h)){const{schema:k}=y,{schemaId:I}=this.opts,z=k[I];return z&&($=(0,n.resolveUrl)(this.opts.uriResolver,$,z)),new a({schema:k,schemaId:I,root:f,baseId:$})}return g.call(this,u,y)}}De.resolveSchema=w;const E=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function g(f,{baseId:h,schema:u,root:p}){var $;if((($=f.fragment)===null||$===void 0?void 0:$[0])!=="/")return;for(const k of f.fragment.slice(1).split("/")){if(typeof u=="boolean")return;const I=u[(0,s.unescapeFragment)(k)];if(I===void 0)return;u=I;const z=typeof u=="object"&&u[this.opts.schemaId];!E.has(k)&&z&&(h=(0,n.resolveUrl)(this.opts.uriResolver,h,z))}let m;if(typeof u!="boolean"&&u.$ref&&!(0,s.schemaHasRulesButRef)(u,this.RULES)){const k=(0,n.resolveUrl)(this.opts.uriResolver,h,u.$ref);m=w.call(this,p,k)}const{schemaId:y}=this.opts;if(m=m||new a({schema:u,schemaId:y,root:p,baseId:h}),m.schema!==m.root.schema)return m}return De}const Rm={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1};var Er={},Ht={exports:{}},ds,li;function di(){if(li)return ds;li=1;const e=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),t=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function r(_){let w="",E=0,g=0;for(g=0;g<_.length;g++)if(E=_[g].charCodeAt(0),E!==48){if(!(E>=48&&E<=57||E>=65&&E<=70||E>=97&&E<=102))return"";w+=_[g];break}for(g+=1;g<_.length;g++){if(E=_[g].charCodeAt(0),!(E>=48&&E<=57||E>=65&&E<=70||E>=97&&E<=102))return"";w+=_[g]}return w}const n=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function s(_){return _.length=0,!0}function o(_,w,E){if(_.length){const g=r(_);if(g!=="")w.push(g);else return E.error=!0,!1;_.length=0}return!0}function a(_){let w=0;const E={error:!1,address:"",zone:""},g=[],f=[];let h=!1,u=!1,p=o;for(let $=0;$<_.length;$++){const m=_[$];if(!(m==="["||m==="]"))if(m===":"){if(h===!0&&(u=!0),!p(f,g,E))break;if(++w>7){E.error=!0;break}$>0&&_[$-1]===":"&&(h=!0),g.push(":");continue}else if(m==="%"){if(!p(f,g,E))break;p=s}else{f.push(m);continue}}return f.length&&(p===s?E.zone=f.join(""):u?g.push(f.join("")):g.push(r(f))),E.address=g.join(""),E}function i(_){if(c(_,":")<2)return{host:_,isIPV6:!1};const w=a(_);if(w.error)return{host:_,isIPV6:!1};{let E=w.address,g=w.address;return w.zone&&(E+="%"+w.zone,g+="%25"+w.zone),{host:E,isIPV6:!0,escapedHost:g}}}function c(_,w){let E=0;for(let g=0;g<_.length;g++)_[g]===w&&E++;return E}function l(_){let w=_;const E=[];let g=-1,f=0;for(;f=w.length;){if(f===1){if(w===".")break;if(w==="/"){E.push("/");break}else{E.push(w);break}}else if(f===2){if(w[0]==="."){if(w[1]===".")break;if(w[1]==="/"){w=w.slice(2);continue}}else if(w[0]==="/"&&(w[1]==="."||w[1]==="/")){E.push("/");break}}else if(f===3&&w==="/.."){E.length!==0&&E.pop(),E.push("/");break}if(w[0]==="."){if(w[1]==="."){if(w[2]==="/"){w=w.slice(3);continue}}else if(w[1]==="/"){w=w.slice(2);continue}}else if(w[0]==="/"&&w[1]==="."){if(w[2]==="/"){w=w.slice(2);continue}else if(w[2]==="."&&w[3]==="/"){w=w.slice(3),E.length!==0&&E.pop();continue}}if((g=w.indexOf("/",1))===-1){E.push(w);break}else E.push(w.slice(0,g)),w=w.slice(g)}return E.join("")}function d(_,w){const E=w!==!0?escape:unescape;return _.scheme!==void 0&&(_.scheme=E(_.scheme)),_.userinfo!==void 0&&(_.userinfo=E(_.userinfo)),_.host!==void 0&&(_.host=E(_.host)),_.path!==void 0&&(_.path=E(_.path)),_.query!==void 0&&(_.query=E(_.query)),_.fragment!==void 0&&(_.fragment=E(_.fragment)),_}function S(_){const w=[];if(_.userinfo!==void 0&&(w.push(_.userinfo),w.push("@")),_.host!==void 0){let E=unescape(_.host);if(!t(E)){const g=i(E);g.isIPV6===!0?E=`[${g.escapedHost}]`:E=_.host}w.push(E)}return(typeof _.port=="number"||typeof _.port=="string")&&(w.push(":"),w.push(String(_.port))),w.length?w.join(""):void 0}return ds={nonSimpleDomain:n,recomposeAuthority:S,normalizeComponentEncoding:d,removeDotSegments:l,isIPv4:t,isUUID:e,normalizeIPv6:i,stringArrayToHexStripped:r},ds}var fs,fi;function Am(){if(fi)return fs;fi=1;const{isUUID:e}=di(),t=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,r=["http","https","ws","wss","urn","urn:uuid"];function n(m){return r.indexOf(m)!==-1}function s(m){return m.secure===!0?!0:m.secure===!1?!1:m.scheme?m.scheme.length===3&&(m.scheme[0]==="w"||m.scheme[0]==="W")&&(m.scheme[1]==="s"||m.scheme[1]==="S")&&(m.scheme[2]==="s"||m.scheme[2]==="S"):!1}function o(m){return m.host||(m.error=m.error||"HTTP URIs must have a host."),m}function a(m){const y=String(m.scheme).toLowerCase()==="https";return(m.port===(y?443:80)||m.port==="")&&(m.port=void 0),m.path||(m.path="/"),m}function i(m){return m.secure=s(m),m.resourceName=(m.path||"/")+(m.query?"?"+m.query:""),m.path=void 0,m.query=void 0,m}function c(m){if((m.port===(s(m)?443:80)||m.port==="")&&(m.port=void 0),typeof m.secure=="boolean"&&(m.scheme=m.secure?"wss":"ws",m.secure=void 0),m.resourceName){const[y,k]=m.resourceName.split("?");m.path=y&&y!=="/"?y:void 0,m.query=k,m.resourceName=void 0}return m.fragment=void 0,m}function l(m,y){if(!m.path)return m.error="URN can not be parsed",m;const k=m.path.match(t);if(k){const I=y.scheme||m.scheme||"urn";m.nid=k[1].toLowerCase(),m.nss=k[2];const z=`${I}:${y.nid||m.nid}`,D=$(z);m.path=void 0,D&&(m=D.parse(m,y))}else m.error=m.error||"URN can not be parsed.";return m}function d(m,y){if(m.nid===void 0)throw new Error("URN without nid cannot be serialized");const k=y.scheme||m.scheme||"urn",I=m.nid.toLowerCase(),z=`${k}:${y.nid||I}`,D=$(z);D&&(m=D.serialize(m,y));const M=m,x=m.nss;return M.path=`${I||y.nid}:${x}`,y.skipEscape=!0,M}function S(m,y){const k=m;return k.uuid=k.nss,k.nss=void 0,!y.tolerant&&(!k.uuid||!e(k.uuid))&&(k.error=k.error||"UUID is not valid."),k}function _(m){const y=m;return y.nss=(m.uuid||"").toLowerCase(),y}const w={scheme:"http",domainHost:!0,parse:o,serialize:a},E={scheme:"https",domainHost:w.domainHost,parse:o,serialize:a},g={scheme:"ws",domainHost:!0,parse:i,serialize:c},f={scheme:"wss",domainHost:g.domainHost,parse:g.parse,serialize:g.serialize},p={http:w,https:E,ws:g,wss:f,urn:{scheme:"urn",parse:l,serialize:d,skipNormalize:!0},"urn:uuid":{scheme:"urn:uuid",parse:S,serialize:_,skipNormalize:!0}};Object.setPrototypeOf(p,null);function $(m){return m&&(p[m]||p[m.toLowerCase()])||void 0}return fs={wsIsSecure:s,SCHEMES:p,isValidSchemeName:n,getSchemeHandler:$},fs}var hi;function Im(){if(hi)return Ht.exports;hi=1;const{normalizeIPv6:e,removeDotSegments:t,recomposeAuthority:r,normalizeComponentEncoding:n,isIPv4:s,nonSimpleDomain:o}=di(),{SCHEMES:a,getSchemeHandler:i}=Am();function c(f,h){return typeof f=="string"?f=_(E(f,h),h):typeof f=="object"&&(f=E(_(f,h),h)),f}function l(f,h,u){const p=u?Object.assign({scheme:"null"},u):{scheme:"null"},$=d(E(f,p),E(h,p),p,!0);return p.skipEscape=!0,_($,p)}function d(f,h,u,p){const $={};return p||(f=E(_(f,u),u),h=E(_(h,u),u)),u=u||{},!u.tolerant&&h.scheme?($.scheme=h.scheme,$.userinfo=h.userinfo,$.host=h.host,$.port=h.port,$.path=t(h.path||""),$.query=h.query):(h.userinfo!==void 0||h.host!==void 0||h.port!==void 0?($.userinfo=h.userinfo,$.host=h.host,$.port=h.port,$.path=t(h.path||""),$.query=h.query):(h.path?(h.path[0]==="/"?$.path=t(h.path):((f.userinfo!==void 0||f.host!==void 0||f.port!==void 0)&&!f.path?$.path="/"+h.path:f.path?$.path=f.path.slice(0,f.path.lastIndexOf("/")+1)+h.path:$.path=h.path,$.path=t($.path)),$.query=h.query):($.path=f.path,h.query!==void 0?$.query=h.query:$.query=f.query),$.userinfo=f.userinfo,$.host=f.host,$.port=f.port),$.scheme=f.scheme),$.fragment=h.fragment,$}function S(f,h,u){return typeof f=="string"?(f=unescape(f),f=_(n(E(f,u),!0),{...u,skipEscape:!0})):typeof f=="object"&&(f=_(n(f,!0),{...u,skipEscape:!0})),typeof h=="string"?(h=unescape(h),h=_(n(E(h,u),!0),{...u,skipEscape:!0})):typeof h=="object"&&(h=_(n(h,!0),{...u,skipEscape:!0})),f.toLowerCase()===h.toLowerCase()}function _(f,h){const u={host:f.host,scheme:f.scheme,userinfo:f.userinfo,port:f.port,path:f.path,query:f.query,nid:f.nid,nss:f.nss,uuid:f.uuid,fragment:f.fragment,reference:f.reference,resourceName:f.resourceName,secure:f.secure,error:""},p=Object.assign({},h),$=[],m=i(p.scheme||u.scheme);m&&m.serialize&&m.serialize(u,p),u.path!==void 0&&(p.skipEscape?u.path=unescape(u.path):(u.path=escape(u.path),u.scheme!==void 0&&(u.path=u.path.split("%3A").join(":")))),p.reference!=="suffix"&&u.scheme&&$.push(u.scheme,":");const y=r(u);if(y!==void 0&&(p.reference!=="suffix"&&$.push("//"),$.push(y),u.path&&u.path[0]!=="/"&&$.push("/")),u.path!==void 0){let k=u.path;!p.absolutePath&&(!m||!m.absolutePath)&&(k=t(k)),y===void 0&&k[0]==="/"&&k[1]==="/"&&(k="/%2F"+k.slice(2)),$.push(k)}return u.query!==void 0&&$.push("?",u.query),u.fragment!==void 0&&$.push("#",u.fragment),$.join("")}const w=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function E(f,h){const u=Object.assign({},h),p={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0};let $=!1;u.reference==="suffix"&&(u.scheme?f=u.scheme+":"+f:f="//"+f);const m=f.match(w);if(m){if(p.scheme=m[1],p.userinfo=m[3],p.host=m[4],p.port=parseInt(m[5],10),p.path=m[6]||"",p.query=m[7],p.fragment=m[8],isNaN(p.port)&&(p.port=m[5]),p.host)if(s(p.host)===!1){const I=e(p.host);p.host=I.host.toLowerCase(),$=I.isIPV6}else $=!0;p.scheme===void 0&&p.userinfo===void 0&&p.host===void 0&&p.port===void 0&&p.query===void 0&&!p.path?p.reference="same-document":p.scheme===void 0?p.reference="relative":p.fragment===void 0?p.reference="absolute":p.reference="uri",u.reference&&u.reference!=="suffix"&&u.reference!==p.reference&&(p.error=p.error||"URI is not a "+u.reference+" reference.");const y=i(u.scheme||p.scheme);if(!u.unicodeSupport&&(!y||!y.unicodeSupport)&&p.host&&(u.domainHost||y&&y.domainHost)&&$===!1&&o(p.host))try{p.host=URL.domainToASCII(p.host.toLowerCase())}catch(k){p.error=p.error||"Host's domain name can not be converted to ASCII: "+k}(!y||y&&!y.skipNormalize)&&(f.indexOf("%")!==-1&&(p.scheme!==void 0&&(p.scheme=unescape(p.scheme)),p.host!==void 0&&(p.host=unescape(p.host))),p.path&&(p.path=escape(unescape(p.path))),p.fragment&&(p.fragment=encodeURI(decodeURIComponent(p.fragment)))),y&&y.parse&&y.parse(p,u)}else p.error=p.error||"URI can not be parsed.";return p}const g={SCHEMES:a,normalize:c,resolve:l,resolveComponent:d,equal:S,serialize:_,parse:E};return Ht.exports=g,Ht.exports.default=g,Ht.exports.fastUri=g,Ht.exports}var pi;function Om(){if(pi)return Er;pi=1,Object.defineProperty(Er,"__esModule",{value:!0});const e=Im();return e.code='require("ajv/dist/runtime/uri").default',Er.default=e,Er}var mi;function Cm(){return mi||(mi=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;var t=wr();Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return t.KeywordCxt}});var r=ne();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return r.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return r.CodeGen}});const n=us(),s=$r(),o=Ba(),a=ls(),i=ne(),c=vr(),l=yr(),d=ce(),S=Rm,_=Om(),w=(L,v)=>new RegExp(L,v);w.code="new RegExp";const E=["removeAdditional","useDefaults","coerceTypes"],g=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),f={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},h={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},u=200;function p(L){var v,R,A,b,T,N,V,J,ee,ae,O,C,U,F,Y,oe,Oe,Je,je,qe,Ce,Rt,Fe,Zs,Fs;const Jt=L.strict,Hs=(v=L.code)===null||v===void 0?void 0:v.optimize,Pc=Hs===!0||Hs===void 0?1:Hs||0,Rc=(A=(R=L.code)===null||R===void 0?void 0:R.regExp)!==null&&A!==void 0?A:w,Q_=(b=L.uriResolver)!==null&&b!==void 0?b:_.default;return{strictSchema:(N=(T=L.strictSchema)!==null&&T!==void 0?T:Jt)!==null&&N!==void 0?N:!0,strictNumbers:(J=(V=L.strictNumbers)!==null&&V!==void 0?V:Jt)!==null&&J!==void 0?J:!0,strictTypes:(ae=(ee=L.strictTypes)!==null&&ee!==void 0?ee:Jt)!==null&&ae!==void 0?ae:"log",strictTuples:(C=(O=L.strictTuples)!==null&&O!==void 0?O:Jt)!==null&&C!==void 0?C:"log",strictRequired:(F=(U=L.strictRequired)!==null&&U!==void 0?U:Jt)!==null&&F!==void 0?F:!1,code:L.code?{...L.code,optimize:Pc,regExp:Rc}:{optimize:Pc,regExp:Rc},loopRequired:(Y=L.loopRequired)!==null&&Y!==void 0?Y:u,loopEnum:(oe=L.loopEnum)!==null&&oe!==void 0?oe:u,meta:(Oe=L.meta)!==null&&Oe!==void 0?Oe:!0,messages:(Je=L.messages)!==null&&Je!==void 0?Je:!0,inlineRefs:(je=L.inlineRefs)!==null&&je!==void 0?je:!0,schemaId:(qe=L.schemaId)!==null&&qe!==void 0?qe:"$id",addUsedSchema:(Ce=L.addUsedSchema)!==null&&Ce!==void 0?Ce:!0,validateSchema:(Rt=L.validateSchema)!==null&&Rt!==void 0?Rt:!0,validateFormats:(Fe=L.validateFormats)!==null&&Fe!==void 0?Fe:!0,unicodeRegExp:(Zs=L.unicodeRegExp)!==null&&Zs!==void 0?Zs:!0,int32range:(Fs=L.int32range)!==null&&Fs!==void 0?Fs:!0,uriResolver:Q_}}class ${constructor(v={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,v=this.opts={...v,...p(v)};const{es5:R,lines:A}=this.opts.code;this.scope=new i.ValueScope({scope:{},prefixes:g,es5:R,lines:A}),this.logger=x(v.logger);const b=v.validateFormats;v.validateFormats=!1,this.RULES=(0,o.getRules)(),m.call(this,f,v,"NOT SUPPORTED"),m.call(this,h,v,"DEPRECATED","warn"),this._metaOpts=D.call(this),v.formats&&I.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),v.keywords&&z.call(this,v.keywords),typeof v.meta=="object"&&this.addMetaSchema(v.meta),k.call(this),v.validateFormats=b}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:v,meta:R,schemaId:A}=this.opts;let b=S;A==="id"&&(b={...S},b.id=b.$id,delete b.$id),R&&v&&this.addMetaSchema(b,b[A],!1)}defaultMeta(){const{meta:v,schemaId:R}=this.opts;return this.opts.defaultMeta=typeof v=="object"?v[R]||v:void 0}validate(v,R){let A;if(typeof v=="string"){if(A=this.getSchema(v),!A)throw new Error(`no schema with key or ref "${v}"`)}else A=this.compile(v);const b=A(R);return"$async"in A||(this.errors=A.errors),b}compile(v,R){const A=this._addSchema(v,R);return A.validate||this._compileSchemaEnv(A)}compileAsync(v,R){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:A}=this.opts;return b.call(this,v,R);async function b(ae,O){await T.call(this,ae.$schema);const C=this._addSchema(ae,O);return C.validate||N.call(this,C)}async function T(ae){ae&&!this.getSchema(ae)&&await b.call(this,{$ref:ae},!0)}async function N(ae){try{return this._compileSchemaEnv(ae)}catch(O){if(!(O instanceof s.default))throw O;return V.call(this,O),await J.call(this,O.missingSchema),N.call(this,ae)}}function V({missingSchema:ae,missingRef:O}){if(this.refs[ae])throw new Error(`AnySchema ${ae} is loaded but ${O} cannot be resolved`)}async function J(ae){const O=await ee.call(this,ae);this.refs[ae]||await T.call(this,O.$schema),this.refs[ae]||this.addSchema(O,ae,R)}async function ee(ae){const O=this._loading[ae];if(O)return O;try{return await(this._loading[ae]=A(ae))}finally{delete this._loading[ae]}}}addSchema(v,R,A,b=this.opts.validateSchema){if(Array.isArray(v)){for(const N of v)this.addSchema(N,void 0,A,b);return this}let T;if(typeof v=="object"){const{schemaId:N}=this.opts;if(T=v[N],T!==void 0&&typeof T!="string")throw new Error(`schema ${N} must be string`)}return R=(0,c.normalizeId)(R||T),this._checkUnique(R),this.schemas[R]=this._addSchema(v,A,R,b,!0),this}addMetaSchema(v,R,A=this.opts.validateSchema){return this.addSchema(v,R,!0,A),this}validateSchema(v,R){if(typeof v=="boolean")return!0;let A;if(A=v.$schema,A!==void 0&&typeof A!="string")throw new Error("$schema must be a string");if(A=A||this.opts.defaultMeta||this.defaultMeta(),!A)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const b=this.validate(A,v);if(!b&&R){const T="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(T);else throw new Error(T)}return b}getSchema(v){let R;for(;typeof(R=y.call(this,v))=="string";)v=R;if(R===void 0){const{schemaId:A}=this.opts,b=new a.SchemaEnv({schema:{},schemaId:A});if(R=a.resolveSchema.call(this,b,v),!R)return;this.refs[v]=R}return R.validate||this._compileSchemaEnv(R)}removeSchema(v){if(v instanceof RegExp)return this._removeAllSchemas(this.schemas,v),this._removeAllSchemas(this.refs,v),this;switch(typeof v){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const R=y.call(this,v);return typeof R=="object"&&this._cache.delete(R.schema),delete this.schemas[v],delete this.refs[v],this}case"object":{const R=v;this._cache.delete(R);let A=v[this.opts.schemaId];return A&&(A=(0,c.normalizeId)(A),delete this.schemas[A],delete this.refs[A]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(v){for(const R of v)this.addKeyword(R);return this}addKeyword(v,R){let A;if(typeof v=="string")A=v,typeof R=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),R.keyword=A);else if(typeof v=="object"&&R===void 0){if(R=v,A=R.keyword,Array.isArray(A)&&!A.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(Z.call(this,A,R),!R)return(0,d.eachItem)(A,T=>G.call(this,T)),this;ie.call(this,R);const b={...R,type:(0,l.getJSONTypes)(R.type),schemaType:(0,l.getJSONTypes)(R.schemaType)};return(0,d.eachItem)(A,b.type.length===0?T=>G.call(this,T,b):T=>b.type.forEach(N=>G.call(this,T,b,N))),this}getKeyword(v){const R=this.RULES.all[v];return typeof R=="object"?R.definition:!!R}removeKeyword(v){const{RULES:R}=this;delete R.keywords[v],delete R.all[v];for(const A of R.rules){const b=A.rules.findIndex(T=>T.keyword===v);b>=0&&A.rules.splice(b,1)}return this}addFormat(v,R){return typeof R=="string"&&(R=new RegExp(R)),this.formats[v]=R,this}errorsText(v=this.errors,{separator:R=", ",dataVar:A="data"}={}){return!v||v.length===0?"No errors":v.map(b=>`${A}${b.instancePath} ${b.message}`).reduce((b,T)=>b+R+T)}$dataMetaSchema(v,R){const A=this.RULES.all;v=JSON.parse(JSON.stringify(v));for(const b of R){const T=b.split("/").slice(1);let N=v;for(const V of T)N=N[V];for(const V in A){const J=A[V];if(typeof J!="object")continue;const{$data:ee}=J.definition,ae=N[V];ee&&ae&&(N[V]=Se(ae))}}return v}_removeAllSchemas(v,R){for(const A in v){const b=v[A];(!R||R.test(A))&&(typeof b=="string"?delete v[A]:b&&!b.meta&&(this._cache.delete(b.schema),delete v[A]))}}_addSchema(v,R,A,b=this.opts.validateSchema,T=this.opts.addUsedSchema){let N;const{schemaId:V}=this.opts;if(typeof v=="object")N=v[V];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof v!="boolean")throw new Error("schema must be object or boolean")}let J=this._cache.get(v);if(J!==void 0)return J;A=(0,c.normalizeId)(N||A);const ee=c.getSchemaRefs.call(this,v,A);return J=new a.SchemaEnv({schema:v,schemaId:V,meta:R,baseId:A,localRefs:ee}),this._cache.set(J.schema,J),T&&!A.startsWith("#")&&(A&&this._checkUnique(A),this.refs[A]=J),b&&this.validateSchema(v,!0),J}_checkUnique(v){if(this.schemas[v]||this.refs[v])throw new Error(`schema with key or id "${v}" already exists`)}_compileSchemaEnv(v){if(v.meta?this._compileMetaSchema(v):a.compileSchema.call(this,v),!v.validate)throw new Error("ajv implementation error");return v.validate}_compileMetaSchema(v){const R=this.opts;this.opts=this._metaOpts;try{a.compileSchema.call(this,v)}finally{this.opts=R}}}$.ValidationError=n.default,$.MissingRefError=s.default,e.default=$;function m(L,v,R,A="error"){for(const b in L){const T=b;T in v&&this.logger[A](`${R}: option ${b}. ${L[T]}`)}}function y(L){return L=(0,c.normalizeId)(L),this.schemas[L]||this.refs[L]}function k(){const L=this.opts.schemas;if(L)if(Array.isArray(L))this.addSchema(L);else for(const v in L)this.addSchema(L[v],v)}function I(){for(const L in this.opts.formats){const v=this.opts.formats[L];v&&this.addFormat(L,v)}}function z(L){if(Array.isArray(L)){this.addVocabulary(L);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const v in L){const R=L[v];R.keyword||(R.keyword=v),this.addKeyword(R)}}function D(){const L={...this.opts};for(const v of E)delete L[v];return L}const M={log(){},warn(){},error(){}};function x(L){if(L===!1)return M;if(L===void 0)return console;if(L.log&&L.warn&&L.error)return L;throw new Error("logger must implement log, warn and error methods")}const q=/^[a-z_$][a-z0-9_$:-]*$/i;function Z(L,v){const{RULES:R}=this;if((0,d.eachItem)(L,A=>{if(R.keywords[A])throw new Error(`Keyword ${A} is already defined`);if(!q.test(A))throw new Error(`Keyword ${A} has invalid name`)}),!!v&&v.$data&&!("code"in v||"validate"in v))throw new Error('$data keyword must have "code" or "validate" function')}function G(L,v,R){var A;const b=v?.post;if(R&&b)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:T}=this;let N=b?T.post:T.rules.find(({type:J})=>J===R);if(N||(N={type:R,rules:[]},T.rules.push(N)),T.keywords[L]=!0,!v)return;const V={keyword:L,definition:{...v,type:(0,l.getJSONTypes)(v.type),schemaType:(0,l.getJSONTypes)(v.schemaType)}};v.before?ue.call(this,N,V,v.before):N.rules.push(V),T.all[L]=V,(A=v.implements)===null||A===void 0||A.forEach(J=>this.addKeyword(J))}function ue(L,v,R){const A=L.rules.findIndex(b=>b.keyword===R);A>=0?L.rules.splice(A,0,v):(L.rules.push(v),this.logger.warn(`rule ${R} is not defined`))}function ie(L){let{metaSchema:v}=L;v!==void 0&&(L.$data&&this.opts.$data&&(v=Se(v)),L.validateSchema=this.compile(v,!0))}const X={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Se(L){return{anyOf:[L,X]}}})(rs)),rs}var kr={},Tr={},Pr={},gi;function Nm(){if(gi)return Pr;gi=1,Object.defineProperty(Pr,"__esModule",{value:!0});const e={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};return Pr.default=e,Pr}var nt={},_i;function zm(){if(_i)return nt;_i=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.callRef=nt.getValidate=void 0;const e=$r(),t=Ke(),r=ne(),n=rt(),s=ls(),o=ce(),a={keyword:"$ref",schemaType:"string",code(l){const{gen:d,schema:S,it:_}=l,{baseId:w,schemaEnv:E,validateName:g,opts:f,self:h}=_,{root:u}=E;if((S==="#"||S==="#/")&&w===u.baseId)return $();const p=s.resolveRef.call(h,u,w,S);if(p===void 0)throw new e.default(_.opts.uriResolver,w,S);if(p instanceof s.SchemaEnv)return m(p);return y(p);function $(){if(E===u)return c(l,g,E,E.$async);const k=d.scopeValue("root",{ref:u});return c(l,(0,r._)`${k}.validate`,u,u.$async)}function m(k){const I=i(l,k);c(l,I,k,k.$async)}function y(k){const I=d.scopeValue("schema",f.code.source===!0?{ref:k,code:(0,r.stringify)(k)}:{ref:k}),z=d.name("valid"),D=l.subschema({schema:k,dataTypes:[],schemaPath:r.nil,topSchemaRef:I,errSchemaPath:S},z);l.mergeEvaluated(D),l.ok(z)}}};function i(l,d){const{gen:S}=l;return d.validate?S.scopeValue("validate",{ref:d.validate}):(0,r._)`${S.scopeValue("wrapper",{ref:d})}.validate`}nt.getValidate=i;function c(l,d,S,_){const{gen:w,it:E}=l,{allErrors:g,schemaEnv:f,opts:h}=E,u=h.passContext?n.default.this:r.nil;_?p():$();function p(){if(!f.$async)throw new Error("async schema referenced by sync schema");const k=w.let("valid");w.try(()=>{w.code((0,r._)`await ${(0,t.callValidateCode)(l,d,u)}`),y(d),g||w.assign(k,!0)},I=>{w.if((0,r._)`!(${I} instanceof ${E.ValidationError})`,()=>w.throw(I)),m(I),g||w.assign(k,!1)}),l.ok(k)}function $(){l.result((0,t.callValidateCode)(l,d,u),()=>y(d),()=>m(d))}function m(k){const I=(0,r._)`${k}.errors`;w.assign(n.default.vErrors,(0,r._)`${n.default.vErrors} === null ? ${I} : ${n.default.vErrors}.concat(${I})`),w.assign(n.default.errors,(0,r._)`${n.default.vErrors}.length`)}function y(k){var I;if(!E.opts.unevaluated)return;const z=(I=S?.validate)===null||I===void 0?void 0:I.evaluated;if(E.props!==!0)if(z&&!z.dynamicProps)z.props!==void 0&&(E.props=o.mergeEvaluated.props(w,z.props,E.props));else{const D=w.var("props",(0,r._)`${k}.evaluated.props`);E.props=o.mergeEvaluated.props(w,D,E.props,r.Name)}if(E.items!==!0)if(z&&!z.dynamicItems)z.items!==void 0&&(E.items=o.mergeEvaluated.items(w,z.items,E.items));else{const D=w.var("items",(0,r._)`${k}.evaluated.items`);E.items=o.mergeEvaluated.items(w,D,E.items,r.Name)}}}return nt.callRef=c,nt.default=a,nt}var yi;function Mm(){if(yi)return Tr;yi=1,Object.defineProperty(Tr,"__esModule",{value:!0});const e=Nm(),t=zm(),r=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",e.default,t.default];return Tr.default=r,Tr}var Rr={},Ar={},vi;function jm(){if(vi)return Ar;vi=1,Object.defineProperty(Ar,"__esModule",{value:!0});const e=ne(),t=e.operators,r={maximum:{okStr:"<=",ok:t.LTE,fail:t.GT},minimum:{okStr:">=",ok:t.GTE,fail:t.LT},exclusiveMaximum:{okStr:"<",ok:t.LT,fail:t.GTE},exclusiveMinimum:{okStr:">",ok:t.GT,fail:t.LTE}},n={message:({keyword:o,schemaCode:a})=>(0,e.str)`must be ${r[o].okStr} ${a}`,params:({keyword:o,schemaCode:a})=>(0,e._)`{comparison: ${r[o].okStr}, limit: ${a}}`},s={keyword:Object.keys(r),type:"number",schemaType:"number",$data:!0,error:n,code(o){const{keyword:a,data:i,schemaCode:c}=o;o.fail$data((0,e._)`${i} ${r[a].fail} ${c} || isNaN(${i})`)}};return Ar.default=s,Ar}var Ir={},wi;function qm(){if(wi)return Ir;wi=1,Object.defineProperty(Ir,"__esModule",{value:!0});const e=ne(),r={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:n})=>(0,e.str)`must be multiple of ${n}`,params:({schemaCode:n})=>(0,e._)`{multipleOf: ${n}}`},code(n){const{gen:s,data:o,schemaCode:a,it:i}=n,c=i.opts.multipleOfPrecision,l=s.let("res"),d=c?(0,e._)`Math.abs(Math.round(${l}) - ${l}) > 1e-${c}`:(0,e._)`${l} !== parseInt(${l})`;n.fail$data((0,e._)`(${a} === 0 || (${l} = ${o}/${a}, ${d}))`)}};return Ir.default=r,Ir}var Or={},Cr={},bi;function xm(){if(bi)return Cr;bi=1,Object.defineProperty(Cr,"__esModule",{value:!0});function e(t){const r=t.length;let n=0,s=0,o;for(;s<r;)n++,o=t.charCodeAt(s++),o>=55296&&o<=56319&&s<r&&(o=t.charCodeAt(s),(o&64512)===56320&&s++);return n}return Cr.default=e,e.code='require("ajv/dist/runtime/ucs2length").default',Cr}var Si;function Um(){if(Si)return Or;Si=1,Object.defineProperty(Or,"__esModule",{value:!0});const e=ne(),t=ce(),r=xm(),s={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:{message({keyword:o,schemaCode:a}){const i=o==="maxLength"?"more":"fewer";return(0,e.str)`must NOT have ${i} than ${a} characters`},params:({schemaCode:o})=>(0,e._)`{limit: ${o}}`},code(o){const{keyword:a,data:i,schemaCode:c,it:l}=o,d=a==="maxLength"?e.operators.GT:e.operators.LT,S=l.opts.unicode===!1?(0,e._)`${i}.length`:(0,e._)`${(0,t.useFunc)(o.gen,r.default)}(${i})`;o.fail$data((0,e._)`${S} ${d} ${c}`)}};return Or.default=s,Or}var Nr={},$i;function Dm(){if($i)return Nr;$i=1,Object.defineProperty(Nr,"__esModule",{value:!0});const e=Ke(),t=ne(),n={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:s})=>(0,t.str)`must match pattern "${s}"`,params:({schemaCode:s})=>(0,t._)`{pattern: ${s}}`},code(s){const{data:o,$data:a,schema:i,schemaCode:c,it:l}=s,d=l.opts.unicodeRegExp?"u":"",S=a?(0,t._)`(new RegExp(${c}, ${d}))`:(0,e.usePattern)(s,i);s.fail$data((0,t._)`!${S}.test(${o})`)}};return Nr.default=n,Nr}var zr={},Ei;function Lm(){if(Ei)return zr;Ei=1,Object.defineProperty(zr,"__esModule",{value:!0});const e=ne(),r={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:{message({keyword:n,schemaCode:s}){const o=n==="maxProperties"?"more":"fewer";return(0,e.str)`must NOT have ${o} than ${s} properties`},params:({schemaCode:n})=>(0,e._)`{limit: ${n}}`},code(n){const{keyword:s,data:o,schemaCode:a}=n,i=s==="maxProperties"?e.operators.GT:e.operators.LT;n.fail$data((0,e._)`Object.keys(${o}).length ${i} ${a}`)}};return zr.default=r,zr}var Mr={},ki;function Vm(){if(ki)return Mr;ki=1,Object.defineProperty(Mr,"__esModule",{value:!0});const e=Ke(),t=ne(),r=ce(),s={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:o}})=>(0,t.str)`must have required property '${o}'`,params:({params:{missingProperty:o}})=>(0,t._)`{missingProperty: ${o}}`},code(o){const{gen:a,schema:i,schemaCode:c,data:l,$data:d,it:S}=o,{opts:_}=S;if(!d&&i.length===0)return;const w=i.length>=_.loopRequired;if(S.allErrors?E():g(),_.strictRequired){const u=o.parentSchema.properties,{definedProperties:p}=o.it;for(const $ of i)if(u?.[$]===void 0&&!p.has($)){const m=S.schemaEnv.baseId+S.errSchemaPath,y=`required property "${$}" is not defined at "${m}" (strictRequired)`;(0,r.checkStrictMode)(S,y,S.opts.strictRequired)}}function E(){if(w||d)o.block$data(t.nil,f);else for(const u of i)(0,e.checkReportMissingProp)(o,u)}function g(){const u=a.let("missing");if(w||d){const p=a.let("valid",!0);o.block$data(p,()=>h(u,p)),o.ok(p)}else a.if((0,e.checkMissingProp)(o,i,u)),(0,e.reportMissingProp)(o,u),a.else()}function f(){a.forOf("prop",c,u=>{o.setParams({missingProperty:u}),a.if((0,e.noPropertyInData)(a,l,u,_.ownProperties),()=>o.error())})}function h(u,p){o.setParams({missingProperty:u}),a.forOf(u,c,()=>{a.assign(p,(0,e.propertyInData)(a,l,u,_.ownProperties)),a.if((0,t.not)(p),()=>{o.error(),a.break()})},t.nil)}}};return Mr.default=s,Mr}var jr={},Ti;function Zm(){if(Ti)return jr;Ti=1,Object.defineProperty(jr,"__esModule",{value:!0});const e=ne(),r={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:{message({keyword:n,schemaCode:s}){const o=n==="maxItems"?"more":"fewer";return(0,e.str)`must NOT have ${o} than ${s} items`},params:({schemaCode:n})=>(0,e._)`{limit: ${n}}`},code(n){const{keyword:s,data:o,schemaCode:a}=n,i=s==="maxItems"?e.operators.GT:e.operators.LT;n.fail$data((0,e._)`${o}.length ${i} ${a}`)}};return jr.default=r,jr}var qr={},xr={},Pi;function hs(){if(Pi)return xr;Pi=1,Object.defineProperty(xr,"__esModule",{value:!0});const e=ni();return e.code='require("ajv/dist/runtime/equal").default',xr.default=e,xr}var Ri;function Fm(){if(Ri)return qr;Ri=1,Object.defineProperty(qr,"__esModule",{value:!0});const e=yr(),t=ne(),r=ce(),n=hs(),o={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i:a,j:i}})=>(0,t.str)`must NOT have duplicate items (items ## ${i} and ${a} are identical)`,params:({params:{i:a,j:i}})=>(0,t._)`{i: ${a}, j: ${i}}`},code(a){const{gen:i,data:c,$data:l,schema:d,parentSchema:S,schemaCode:_,it:w}=a;if(!l&&!d)return;const E=i.let("valid"),g=S.items?(0,e.getSchemaTypes)(S.items):[];a.block$data(E,f,(0,t._)`${_} === false`),a.ok(E);function f(){const $=i.let("i",(0,t._)`${c}.length`),m=i.let("j");a.setParams({i:$,j:m}),i.assign(E,!0),i.if((0,t._)`${$} > 1`,()=>(h()?u:p)($,m))}function h(){return g.length>0&&!g.some($=>$==="object"||$==="array")}function u($,m){const y=i.name("item"),k=(0,e.checkDataTypes)(g,y,w.opts.strictNumbers,e.DataType.Wrong),I=i.const("indices",(0,t._)`{}`);i.for((0,t._)`;${$}--;`,()=>{i.let(y,(0,t._)`${c}[${$}]`),i.if(k,(0,t._)`continue`),g.length>1&&i.if((0,t._)`typeof ${y} == "string"`,(0,t._)`${y} += "_"`),i.if((0,t._)`typeof ${I}[${y}] == "number"`,()=>{i.assign(m,(0,t._)`${I}[${y}]`),a.error(),i.assign(E,!1).break()}).code((0,t._)`${I}[${y}] = ${$}`)})}function p($,m){const y=(0,r.useFunc)(i,n.default),k=i.name("outer");i.label(k).for((0,t._)`;${$}--;`,()=>i.for((0,t._)`${m} = ${$}; ${m}--;`,()=>i.if((0,t._)`${y}(${c}[${$}], ${c}[${m}])`,()=>{a.error(),i.assign(E,!1).break(k)})))}}};return qr.default=o,qr}var Ur={},Ai;function Hm(){if(Ai)return Ur;Ai=1,Object.defineProperty(Ur,"__esModule",{value:!0});const e=ne(),t=ce(),r=hs(),s={keyword:"const",$data:!0,error:{message:"must be equal to constant",params:({schemaCode:o})=>(0,e._)`{allowedValue: ${o}}`},code(o){const{gen:a,data:i,$data:c,schemaCode:l,schema:d}=o;c||d&&typeof d=="object"?o.fail$data((0,e._)`!${(0,t.useFunc)(a,r.default)}(${i}, ${l})`):o.fail((0,e._)`${d} !== ${i}`)}};return Ur.default=s,Ur}var Dr={},Ii;function Km(){if(Ii)return Dr;Ii=1,Object.defineProperty(Dr,"__esModule",{value:!0});const e=ne(),t=ce(),r=hs(),s={keyword:"enum",schemaType:"array",$data:!0,error:{message:"must be equal to one of the allowed values",params:({schemaCode:o})=>(0,e._)`{allowedValues: ${o}}`},code(o){const{gen:a,data:i,$data:c,schema:l,schemaCode:d,it:S}=o;if(!c&&l.length===0)throw new Error("enum must have non-empty array");const _=l.length>=S.opts.loopEnum;let w;const E=()=>w??(w=(0,t.useFunc)(a,r.default));let g;if(_||c)g=a.let("valid"),o.block$data(g,f);else{if(!Array.isArray(l))throw new Error("ajv implementation error");const u=a.const("vSchema",d);g=(0,e.or)(...l.map((p,$)=>h(u,$)))}o.pass(g);function f(){a.assign(g,!1),a.forOf("v",d,u=>a.if((0,e._)`${E()}(${i}, ${u})`,()=>a.assign(g,!0).break()))}function h(u,p){const $=l[p];return typeof $=="object"&&$!==null?(0,e._)`${E()}(${i}, ${u}[${p}])`:(0,e._)`${i} === ${$}`}}};return Dr.default=s,Dr}var Oi;function Jm(){if(Oi)return Rr;Oi=1,Object.defineProperty(Rr,"__esModule",{value:!0});const e=jm(),t=qm(),r=Um(),n=Dm(),s=Lm(),o=Vm(),a=Zm(),i=Fm(),c=Hm(),l=Km(),d=[e.default,t.default,r.default,n.default,s.default,o.default,a.default,i.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},c.default,l.default];return Rr.default=d,Rr}var Lr={},St={},Ci;function Ni(){if(Ci)return St;Ci=1,Object.defineProperty(St,"__esModule",{value:!0}),St.validateAdditionalItems=void 0;const e=ne(),t=ce(),n={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:o}})=>(0,e.str)`must NOT have more than ${o} items`,params:({params:{len:o}})=>(0,e._)`{limit: ${o}}`},code(o){const{parentSchema:a,it:i}=o,{items:c}=a;if(!Array.isArray(c)){(0,t.checkStrictMode)(i,'"additionalItems" is ignored when "items" is not an array of schemas');return}s(o,c)}};function s(o,a){const{gen:i,schema:c,data:l,keyword:d,it:S}=o;S.items=!0;const _=i.const("len",(0,e._)`${l}.length`);if(c===!1)o.setParams({len:a.length}),o.pass((0,e._)`${_} <= ${a.length}`);else if(typeof c=="object"&&!(0,t.alwaysValidSchema)(S,c)){const E=i.var("valid",(0,e._)`${_} <= ${a.length}`);i.if((0,e.not)(E),()=>w(E)),o.ok(E)}function w(E){i.forRange("i",a.length,_,g=>{o.subschema({keyword:d,dataProp:g,dataPropType:t.Type.Num},E),S.allErrors||i.if((0,e.not)(E),()=>i.break())})}}return St.validateAdditionalItems=s,St.default=n,St}var Vr={},$t={},zi;function Mi(){if(zi)return $t;zi=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.validateTuple=void 0;const e=ne(),t=ce(),r=Ke(),n={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(o){const{schema:a,it:i}=o;if(Array.isArray(a))return s(o,"additionalItems",a);i.items=!0,!(0,t.alwaysValidSchema)(i,a)&&o.ok((0,r.validateArray)(o))}};function s(o,a,i=o.schema){const{gen:c,parentSchema:l,data:d,keyword:S,it:_}=o;g(l),_.opts.unevaluated&&i.length&&_.items!==!0&&(_.items=t.mergeEvaluated.items(c,i.length,_.items));const w=c.name("valid"),E=c.const("len",(0,e._)`${d}.length`);i.forEach((f,h)=>{(0,t.alwaysValidSchema)(_,f)||(c.if((0,e._)`${E} > ${h}`,()=>o.subschema({keyword:S,schemaProp:h,dataProp:h},w)),o.ok(w))});function g(f){const{opts:h,errSchemaPath:u}=_,p=i.length,$=p===f.minItems&&(p===f.maxItems||f[a]===!1);if(h.strictTuples&&!$){const m=`"${S}" is ${p}-tuple, but minItems or maxItems/${a} are not specified or different at path "${u}"`;(0,t.checkStrictMode)(_,m,h.strictTuples)}}}return $t.validateTuple=s,$t.default=n,$t}var ji;function Bm(){if(ji)return Vr;ji=1,Object.defineProperty(Vr,"__esModule",{value:!0});const e=Mi(),t={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:r=>(0,e.validateTuple)(r,"items")};return Vr.default=t,Vr}var Zr={},qi;function Wm(){if(qi)return Zr;qi=1,Object.defineProperty(Zr,"__esModule",{value:!0});const e=ne(),t=ce(),r=Ke(),n=Ni(),o={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:{message:({params:{len:a}})=>(0,e.str)`must NOT have more than ${a} items`,params:({params:{len:a}})=>(0,e._)`{limit: ${a}}`},code(a){const{schema:i,parentSchema:c,it:l}=a,{prefixItems:d}=c;l.items=!0,!(0,t.alwaysValidSchema)(l,i)&&(d?(0,n.validateAdditionalItems)(a,d):a.ok((0,r.validateArray)(a)))}};return Zr.default=o,Zr}var Fr={},xi;function Gm(){if(xi)return Fr;xi=1,Object.defineProperty(Fr,"__esModule",{value:!0});const e=ne(),t=ce(),n={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:s,max:o}})=>o===void 0?(0,e.str)`must contain at least ${s} valid item(s)`:(0,e.str)`must contain at least ${s} and no more than ${o} valid item(s)`,params:({params:{min:s,max:o}})=>o===void 0?(0,e._)`{minContains: ${s}}`:(0,e._)`{minContains: ${s}, maxContains: ${o}}`},code(s){const{gen:o,schema:a,parentSchema:i,data:c,it:l}=s;let d,S;const{minContains:_,maxContains:w}=i;l.opts.next?(d=_===void 0?1:_,S=w):d=1;const E=o.const("len",(0,e._)`${c}.length`);if(s.setParams({min:d,max:S}),S===void 0&&d===0){(0,t.checkStrictMode)(l,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(S!==void 0&&d>S){(0,t.checkStrictMode)(l,'"minContains" > "maxContains" is always invalid'),s.fail();return}if((0,t.alwaysValidSchema)(l,a)){let p=(0,e._)`${E} >= ${d}`;S!==void 0&&(p=(0,e._)`${p} && ${E} <= ${S}`),s.pass(p);return}l.items=!0;const g=o.name("valid");S===void 0&&d===1?h(g,()=>o.if(g,()=>o.break())):d===0?(o.let(g,!0),S!==void 0&&o.if((0,e._)`${c}.length > 0`,f)):(o.let(g,!1),f()),s.result(g,()=>s.reset());function f(){const p=o.name("_valid"),$=o.let("count",0);h(p,()=>o.if(p,()=>u($)))}function h(p,$){o.forRange("i",0,E,m=>{s.subschema({keyword:"contains",dataProp:m,dataPropType:t.Type.Num,compositeRule:!0},p),$()})}function u(p){o.code((0,e._)`${p}++`),S===void 0?o.if((0,e._)`${p} >= ${d}`,()=>o.assign(g,!0).break()):(o.if((0,e._)`${p} > ${S}`,()=>o.assign(g,!1).break()),d===1?o.assign(g,!0):o.if((0,e._)`${p} >= ${d}`,()=>o.assign(g,!0)))}}};return Fr.default=n,Fr}var ps={},Ui;function Ym(){return Ui||(Ui=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateSchemaDeps=e.validatePropertyDeps=e.error=void 0;const t=ne(),r=ce(),n=Ke();e.error={message:({params:{property:c,depsCount:l,deps:d}})=>{const S=l===1?"property":"properties";return(0,t.str)`must have ${S} ${d} when property ${c} is present`},params:({params:{property:c,depsCount:l,deps:d,missingProperty:S}})=>(0,t._)`{property: ${c},
    missingProperty: ${S},
    depsCount: ${l},
    deps: ${d}}`};const s={keyword:"dependencies",type:"object",schemaType:"object",error:e.error,code(c){const[l,d]=o(c);a(c,l),i(c,d)}};function o({schema:c}){const l={},d={};for(const S in c){if(S==="__proto__")continue;const _=Array.isArray(c[S])?l:d;_[S]=c[S]}return[l,d]}function a(c,l=c.schema){const{gen:d,data:S,it:_}=c;if(Object.keys(l).length===0)return;const w=d.let("missing");for(const E in l){const g=l[E];if(g.length===0)continue;const f=(0,n.propertyInData)(d,S,E,_.opts.ownProperties);c.setParams({property:E,depsCount:g.length,deps:g.join(", ")}),_.allErrors?d.if(f,()=>{for(const h of g)(0,n.checkReportMissingProp)(c,h)}):(d.if((0,t._)`${f} && (${(0,n.checkMissingProp)(c,g,w)})`),(0,n.reportMissingProp)(c,w),d.else())}}e.validatePropertyDeps=a;function i(c,l=c.schema){const{gen:d,data:S,keyword:_,it:w}=c,E=d.name("valid");for(const g in l)(0,r.alwaysValidSchema)(w,l[g])||(d.if((0,n.propertyInData)(d,S,g,w.opts.ownProperties),()=>{const f=c.subschema({keyword:_,schemaProp:g},E);c.mergeValidEvaluated(f,E)},()=>d.var(E,!0)),c.ok(E))}e.validateSchemaDeps=i,e.default=s})(ps)),ps}var Hr={},Di;function Qm(){if(Di)return Hr;Di=1,Object.defineProperty(Hr,"__esModule",{value:!0});const e=ne(),t=ce(),n={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:"property name must be valid",params:({params:s})=>(0,e._)`{propertyName: ${s.propertyName}}`},code(s){const{gen:o,schema:a,data:i,it:c}=s;if((0,t.alwaysValidSchema)(c,a))return;const l=o.name("valid");o.forIn("key",i,d=>{s.setParams({propertyName:d}),s.subschema({keyword:"propertyNames",data:d,dataTypes:["string"],propertyName:d,compositeRule:!0},l),o.if((0,e.not)(l),()=>{s.error(!0),c.allErrors||o.break()})}),s.ok(l)}};return Hr.default=n,Hr}var Kr={},Li;function Vi(){if(Li)return Kr;Li=1,Object.defineProperty(Kr,"__esModule",{value:!0});const e=Ke(),t=ne(),r=rt(),n=ce(),o={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"must NOT have additional properties",params:({params:a})=>(0,t._)`{additionalProperty: ${a.additionalProperty}}`},code(a){const{gen:i,schema:c,parentSchema:l,data:d,errsCount:S,it:_}=a;if(!S)throw new Error("ajv implementation error");const{allErrors:w,opts:E}=_;if(_.props=!0,E.removeAdditional!=="all"&&(0,n.alwaysValidSchema)(_,c))return;const g=(0,e.allSchemaProperties)(l.properties),f=(0,e.allSchemaProperties)(l.patternProperties);h(),a.ok((0,t._)`${S} === ${r.default.errors}`);function h(){i.forIn("key",d,y=>{!g.length&&!f.length?$(y):i.if(u(y),()=>$(y))})}function u(y){let k;if(g.length>8){const I=(0,n.schemaRefOrVal)(_,l.properties,"properties");k=(0,e.isOwnProperty)(i,I,y)}else g.length?k=(0,t.or)(...g.map(I=>(0,t._)`${y} === ${I}`)):k=t.nil;return f.length&&(k=(0,t.or)(k,...f.map(I=>(0,t._)`${(0,e.usePattern)(a,I)}.test(${y})`))),(0,t.not)(k)}function p(y){i.code((0,t._)`delete ${d}[${y}]`)}function $(y){if(E.removeAdditional==="all"||E.removeAdditional&&c===!1){p(y);return}if(c===!1){a.setParams({additionalProperty:y}),a.error(),w||i.break();return}if(typeof c=="object"&&!(0,n.alwaysValidSchema)(_,c)){const k=i.name("valid");E.removeAdditional==="failing"?(m(y,k,!1),i.if((0,t.not)(k),()=>{a.reset(),p(y)})):(m(y,k),w||i.if((0,t.not)(k),()=>i.break()))}}function m(y,k,I){const z={keyword:"additionalProperties",dataProp:y,dataPropType:n.Type.Str};I===!1&&Object.assign(z,{compositeRule:!0,createErrors:!1,allErrors:!1}),a.subschema(z,k)}}};return Kr.default=o,Kr}var Jr={},Zi;function Xm(){if(Zi)return Jr;Zi=1,Object.defineProperty(Jr,"__esModule",{value:!0});const e=wr(),t=Ke(),r=ce(),n=Vi(),s={keyword:"properties",type:"object",schemaType:"object",code(o){const{gen:a,schema:i,parentSchema:c,data:l,it:d}=o;d.opts.removeAdditional==="all"&&c.additionalProperties===void 0&&n.default.code(new e.KeywordCxt(d,n.default,"additionalProperties"));const S=(0,t.allSchemaProperties)(i);for(const f of S)d.definedProperties.add(f);d.opts.unevaluated&&S.length&&d.props!==!0&&(d.props=r.mergeEvaluated.props(a,(0,r.toHash)(S),d.props));const _=S.filter(f=>!(0,r.alwaysValidSchema)(d,i[f]));if(_.length===0)return;const w=a.name("valid");for(const f of _)E(f)?g(f):(a.if((0,t.propertyInData)(a,l,f,d.opts.ownProperties)),g(f),d.allErrors||a.else().var(w,!0),a.endIf()),o.it.definedProperties.add(f),o.ok(w);function E(f){return d.opts.useDefaults&&!d.compositeRule&&i[f].default!==void 0}function g(f){o.subschema({keyword:"properties",schemaProp:f,dataProp:f},w)}}};return Jr.default=s,Jr}var Br={},Fi;function eg(){if(Fi)return Br;Fi=1,Object.defineProperty(Br,"__esModule",{value:!0});const e=Ke(),t=ne(),r=ce(),n=ce(),s={keyword:"patternProperties",type:"object",schemaType:"object",code(o){const{gen:a,schema:i,data:c,parentSchema:l,it:d}=o,{opts:S}=d,_=(0,e.allSchemaProperties)(i),w=_.filter($=>(0,r.alwaysValidSchema)(d,i[$]));if(_.length===0||w.length===_.length&&(!d.opts.unevaluated||d.props===!0))return;const E=S.strictSchema&&!S.allowMatchingProperties&&l.properties,g=a.name("valid");d.props!==!0&&!(d.props instanceof t.Name)&&(d.props=(0,n.evaluatedPropsToName)(a,d.props));const{props:f}=d;h();function h(){for(const $ of _)E&&u($),d.allErrors?p($):(a.var(g,!0),p($),a.if(g))}function u($){for(const m in E)new RegExp($).test(m)&&(0,r.checkStrictMode)(d,`property ${m} matches pattern ${$} (use allowMatchingProperties)`)}function p($){a.forIn("key",c,m=>{a.if((0,t._)`${(0,e.usePattern)(o,$)}.test(${m})`,()=>{const y=w.includes($);y||o.subschema({keyword:"patternProperties",schemaProp:$,dataProp:m,dataPropType:n.Type.Str},g),d.opts.unevaluated&&f!==!0?a.assign((0,t._)`${f}[${m}]`,!0):!y&&!d.allErrors&&a.if((0,t.not)(g),()=>a.break())})})}}};return Br.default=s,Br}var Wr={},Hi;function tg(){if(Hi)return Wr;Hi=1,Object.defineProperty(Wr,"__esModule",{value:!0});const e=ce(),t={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(r){const{gen:n,schema:s,it:o}=r;if((0,e.alwaysValidSchema)(o,s)){r.fail();return}const a=n.name("valid");r.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},a),r.failResult(a,()=>r.reset(),()=>r.error())},error:{message:"must NOT be valid"}};return Wr.default=t,Wr}var Gr={},Ki;function rg(){if(Ki)return Gr;Ki=1,Object.defineProperty(Gr,"__esModule",{value:!0});const t={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:Ke().validateUnion,error:{message:"must match a schema in anyOf"}};return Gr.default=t,Gr}var Yr={},Ji;function ng(){if(Ji)return Yr;Ji=1,Object.defineProperty(Yr,"__esModule",{value:!0});const e=ne(),t=ce(),n={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"must match exactly one schema in oneOf",params:({params:s})=>(0,e._)`{passingSchemas: ${s.passing}}`},code(s){const{gen:o,schema:a,parentSchema:i,it:c}=s;if(!Array.isArray(a))throw new Error("ajv implementation error");if(c.opts.discriminator&&i.discriminator)return;const l=a,d=o.let("valid",!1),S=o.let("passing",null),_=o.name("_valid");s.setParams({passing:S}),o.block(w),s.result(d,()=>s.reset(),()=>s.error(!0));function w(){l.forEach((E,g)=>{let f;(0,t.alwaysValidSchema)(c,E)?o.var(_,!0):f=s.subschema({keyword:"oneOf",schemaProp:g,compositeRule:!0},_),g>0&&o.if((0,e._)`${_} && ${d}`).assign(d,!1).assign(S,(0,e._)`[${S}, ${g}]`).else(),o.if(_,()=>{o.assign(d,!0),o.assign(S,g),f&&s.mergeEvaluated(f,e.Name)})})}}};return Yr.default=n,Yr}var Qr={},Bi;function sg(){if(Bi)return Qr;Bi=1,Object.defineProperty(Qr,"__esModule",{value:!0});const e=ce(),t={keyword:"allOf",schemaType:"array",code(r){const{gen:n,schema:s,it:o}=r;if(!Array.isArray(s))throw new Error("ajv implementation error");const a=n.name("valid");s.forEach((i,c)=>{if((0,e.alwaysValidSchema)(o,i))return;const l=r.subschema({keyword:"allOf",schemaProp:c},a);r.ok(a),r.mergeEvaluated(l)})}};return Qr.default=t,Qr}var Xr={},Wi;function og(){if(Wi)return Xr;Wi=1,Object.defineProperty(Xr,"__esModule",{value:!0});const e=ne(),t=ce(),n={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:o})=>(0,e.str)`must match "${o.ifClause}" schema`,params:({params:o})=>(0,e._)`{failingKeyword: ${o.ifClause}}`},code(o){const{gen:a,parentSchema:i,it:c}=o;i.then===void 0&&i.else===void 0&&(0,t.checkStrictMode)(c,'"if" without "then" and "else" is ignored');const l=s(c,"then"),d=s(c,"else");if(!l&&!d)return;const S=a.let("valid",!0),_=a.name("_valid");if(w(),o.reset(),l&&d){const g=a.let("ifClause");o.setParams({ifClause:g}),a.if(_,E("then",g),E("else",g))}else l?a.if(_,E("then")):a.if((0,e.not)(_),E("else"));o.pass(S,()=>o.error(!0));function w(){const g=o.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},_);o.mergeEvaluated(g)}function E(g,f){return()=>{const h=o.subschema({keyword:g},_);a.assign(S,_),o.mergeValidEvaluated(h,S),f?a.assign(f,(0,e._)`${g}`):o.setParams({ifClause:g})}}}};function s(o,a){const i=o.schema[a];return i!==void 0&&!(0,t.alwaysValidSchema)(o,i)}return Xr.default=n,Xr}var en={},Gi;function ag(){if(Gi)return en;Gi=1,Object.defineProperty(en,"__esModule",{value:!0});const e=ce(),t={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:r,parentSchema:n,it:s}){n.if===void 0&&(0,e.checkStrictMode)(s,`"${r}" without "if" is ignored`)}};return en.default=t,en}var Yi;function ig(){if(Yi)return Lr;Yi=1,Object.defineProperty(Lr,"__esModule",{value:!0});const e=Ni(),t=Bm(),r=Mi(),n=Wm(),s=Gm(),o=Ym(),a=Qm(),i=Vi(),c=Xm(),l=eg(),d=tg(),S=rg(),_=ng(),w=sg(),E=og(),g=ag();function f(h=!1){const u=[d.default,S.default,_.default,w.default,E.default,g.default,a.default,i.default,o.default,c.default,l.default];return h?u.push(t.default,n.default):u.push(e.default,r.default),u.push(s.default),u}return Lr.default=f,Lr}var tn={},rn={},Qi;function cg(){if(Qi)return rn;Qi=1,Object.defineProperty(rn,"__esModule",{value:!0});const e=ne(),r={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:n})=>(0,e.str)`must match format "${n}"`,params:({schemaCode:n})=>(0,e._)`{format: ${n}}`},code(n,s){const{gen:o,data:a,$data:i,schema:c,schemaCode:l,it:d}=n,{opts:S,errSchemaPath:_,schemaEnv:w,self:E}=d;if(!S.validateFormats)return;i?g():f();function g(){const h=o.scopeValue("formats",{ref:E.formats,code:S.code.formats}),u=o.const("fDef",(0,e._)`${h}[${l}]`),p=o.let("fType"),$=o.let("format");o.if((0,e._)`typeof ${u} == "object" && !(${u} instanceof RegExp)`,()=>o.assign(p,(0,e._)`${u}.type || "string"`).assign($,(0,e._)`${u}.validate`),()=>o.assign(p,(0,e._)`"string"`).assign($,u)),n.fail$data((0,e.or)(m(),y()));function m(){return S.strictSchema===!1?e.nil:(0,e._)`${l} && !${$}`}function y(){const k=w.$async?(0,e._)`(${u}.async ? await ${$}(${a}) : ${$}(${a}))`:(0,e._)`${$}(${a})`,I=(0,e._)`(typeof ${$} == "function" ? ${k} : ${$}.test(${a}))`;return(0,e._)`${$} && ${$} !== true && ${p} === ${s} && !${I}`}}function f(){const h=E.formats[c];if(!h){m();return}if(h===!0)return;const[u,p,$]=y(h);u===s&&n.pass(k());function m(){if(S.strictSchema===!1){E.logger.warn(I());return}throw new Error(I());function I(){return`unknown format "${c}" ignored in schema at path "${_}"`}}function y(I){const z=I instanceof RegExp?(0,e.regexpCode)(I):S.code.formats?(0,e._)`${S.code.formats}${(0,e.getProperty)(c)}`:void 0,D=o.scopeValue("formats",{key:c,ref:I,code:z});return typeof I=="object"&&!(I instanceof RegExp)?[I.type||"string",I.validate,(0,e._)`${D}.validate`]:["string",I,D]}function k(){if(typeof h=="object"&&!(h instanceof RegExp)&&h.async){if(!w.$async)throw new Error("async format in sync schema");return(0,e._)`await ${$}(${a})`}return typeof p=="function"?(0,e._)`${$}(${a})`:(0,e._)`${$}.test(${a})`}}}};return rn.default=r,rn}var Xi;function ug(){if(Xi)return tn;Xi=1,Object.defineProperty(tn,"__esModule",{value:!0});const t=[cg().default];return tn.default=t,tn}var ft={},ec;function lg(){return ec||(ec=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.contentVocabulary=ft.metadataVocabulary=void 0,ft.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],ft.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]),ft}var tc;function dg(){if(tc)return kr;tc=1,Object.defineProperty(kr,"__esModule",{value:!0});const e=Mm(),t=Jm(),r=ig(),n=ug(),s=lg(),o=[e.default,t.default,(0,r.default)(),n.default,s.metadataVocabulary,s.contentVocabulary];return kr.default=o,kr}var nn={},Kt={},rc;function fg(){if(rc)return Kt;rc=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.DiscrError=void 0;var e;return(function(t){t.Tag="tag",t.Mapping="mapping"})(e||(Kt.DiscrError=e={})),Kt}var nc;function hg(){if(nc)return nn;nc=1,Object.defineProperty(nn,"__esModule",{value:!0});const e=ne(),t=fg(),r=ls(),n=$r(),s=ce(),a={keyword:"discriminator",type:"object",schemaType:"object",error:{message:({params:{discrError:i,tagName:c}})=>i===t.DiscrError.Tag?`tag "${c}" must be string`:`value of tag "${c}" must be in oneOf`,params:({params:{discrError:i,tag:c,tagName:l}})=>(0,e._)`{error: ${i}, tag: ${l}, tagValue: ${c}}`},code(i){const{gen:c,data:l,schema:d,parentSchema:S,it:_}=i,{oneOf:w}=S;if(!_.opts.discriminator)throw new Error("discriminator: requires discriminator option");const E=d.propertyName;if(typeof E!="string")throw new Error("discriminator: requires propertyName");if(d.mapping)throw new Error("discriminator: mapping is not supported");if(!w)throw new Error("discriminator: requires oneOf keyword");const g=c.let("valid",!1),f=c.const("tag",(0,e._)`${l}${(0,e.getProperty)(E)}`);c.if((0,e._)`typeof ${f} == "string"`,()=>h(),()=>i.error(!1,{discrError:t.DiscrError.Tag,tag:f,tagName:E})),i.ok(g);function h(){const $=p();c.if(!1);for(const m in $)c.elseIf((0,e._)`${f} === ${m}`),c.assign(g,u($[m]));c.else(),i.error(!1,{discrError:t.DiscrError.Mapping,tag:f,tagName:E}),c.endIf()}function u($){const m=c.name("valid"),y=i.subschema({keyword:"oneOf",schemaProp:$},m);return i.mergeEvaluated(y,e.Name),m}function p(){var $;const m={},y=I(S);let k=!0;for(let M=0;M<w.length;M++){let x=w[M];if(x?.$ref&&!(0,s.schemaHasRulesButRef)(x,_.self.RULES)){const Z=x.$ref;if(x=r.resolveRef.call(_.self,_.schemaEnv.root,_.baseId,Z),x instanceof r.SchemaEnv&&(x=x.schema),x===void 0)throw new n.default(_.opts.uriResolver,_.baseId,Z)}const q=($=x?.properties)===null||$===void 0?void 0:$[E];if(typeof q!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${E}"`);k=k&&(y||I(x)),z(q,M)}if(!k)throw new Error(`discriminator: "${E}" must be required`);return m;function I({required:M}){return Array.isArray(M)&&M.includes(E)}function z(M,x){if(M.const)D(M.const,x);else if(M.enum)for(const q of M.enum)D(q,x);else throw new Error(`discriminator: "properties/${E}" must have "const" or "enum"`)}function D(M,x){if(typeof M!="string"||M in m)throw new Error(`discriminator: "${E}" values must be unique strings`);m[M]=x}}}};return nn.default=a,nn}const pg={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0};var sc;function oc(){return sc||(sc=1,(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRefError=t.ValidationError=t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=t.Ajv=void 0;const r=Cm(),n=dg(),s=hg(),o=pg,a=["/properties"],i="http://json-schema.org/draft-07/schema";class c extends r.default{_addVocabularies(){super._addVocabularies(),n.default.forEach(E=>this.addVocabulary(E)),this.opts.discriminator&&this.addKeyword(s.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const E=this.opts.$data?this.$dataMetaSchema(o,a):o;this.addMetaSchema(E,i,!1),this.refs["http://json-schema.org/schema"]=i}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(i)?i:void 0)}}t.Ajv=c,e.exports=t=c,e.exports.Ajv=c,Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var l=wr();Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return l.KeywordCxt}});var d=ne();Object.defineProperty(t,"_",{enumerable:!0,get:function(){return d._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return d.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return d.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return d.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return d.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return d.CodeGen}});var S=us();Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return S.default}});var _=$r();Object.defineProperty(t,"MissingRefError",{enumerable:!0,get:function(){return _.default}})})(pr,pr.exports)),pr.exports}var mg=oc();const gg=ts(mg);var sn={exports:{}},ms={},ac;function _g(){return ac||(ac=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formatNames=e.fastFormats=e.fullFormats=void 0;function t(M,x){return{validate:M,compare:x}}e.fullFormats={date:t(o,a),time:t(c(!0),l),"date-time":t(_(!0),w),"iso-time":t(c(),d),"iso-date-time":t(_(),E),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:h,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:D,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:p,int32:{type:"number",validate:y},int64:{type:"number",validate:k},float:{type:"number",validate:I},double:{type:"number",validate:I},password:!0,binary:!0},e.fastFormats={...e.fullFormats,date:t(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,a),time:t(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,l),"date-time":t(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,w),"iso-time":t(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,d),"iso-date-time":t(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,E),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i},e.formatNames=Object.keys(e.fullFormats);function r(M){return M%4===0&&(M%100!==0||M%400===0)}const n=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,s=[0,31,28,31,30,31,30,31,31,30,31,30,31];function o(M){const x=n.exec(M);if(!x)return!1;const q=+x[1],Z=+x[2],G=+x[3];return Z>=1&&Z<=12&&G>=1&&G<=(Z===2&&r(q)?29:s[Z])}function a(M,x){if(M&&x)return M>x?1:M<x?-1:0}const i=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function c(M){return function(q){const Z=i.exec(q);if(!Z)return!1;const G=+Z[1],ue=+Z[2],ie=+Z[3],X=Z[4],Se=Z[5]==="-"?-1:1,L=+(Z[6]||0),v=+(Z[7]||0);if(L>23||v>59||M&&!X)return!1;if(G<=23&&ue<=59&&ie<60)return!0;const R=ue-v*Se,A=G-L*Se-(R<0?1:0);return(A===23||A===-1)&&(R===59||R===-1)&&ie<61}}function l(M,x){if(!(M&&x))return;const q=new Date("2020-01-01T"+M).valueOf(),Z=new Date("2020-01-01T"+x).valueOf();if(q&&Z)return q-Z}function d(M,x){if(!(M&&x))return;const q=i.exec(M),Z=i.exec(x);if(q&&Z)return M=q[1]+q[2]+q[3],x=Z[1]+Z[2]+Z[3],M>x?1:M<x?-1:0}const S=/t|\s/i;function _(M){const x=c(M);return function(Z){const G=Z.split(S);return G.length===2&&o(G[0])&&x(G[1])}}function w(M,x){if(!(M&&x))return;const q=new Date(M).valueOf(),Z=new Date(x).valueOf();if(q&&Z)return q-Z}function E(M,x){if(!(M&&x))return;const[q,Z]=M.split(S),[G,ue]=x.split(S),ie=a(q,G);if(ie!==void 0)return ie||l(Z,ue)}const g=/\/|:/,f=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function h(M){return g.test(M)&&f.test(M)}const u=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function p(M){return u.lastIndex=0,u.test(M)}const $=-2147483648,m=2**31-1;function y(M){return Number.isInteger(M)&&M<=m&&M>=$}function k(M){return Number.isInteger(M)}function I(){return!0}const z=/[^\\]\\Z/;function D(M){if(z.test(M))return!1;try{return new RegExp(M),!0}catch{return!1}}})(ms)),ms}var gs={},ic;function yg(){return ic||(ic=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formatLimitDefinition=void 0;const t=oc(),r=ne(),n=r.operators,s={formatMaximum:{okStr:"<=",ok:n.LTE,fail:n.GT},formatMinimum:{okStr:">=",ok:n.GTE,fail:n.LT},formatExclusiveMaximum:{okStr:"<",ok:n.LT,fail:n.GTE},formatExclusiveMinimum:{okStr:">",ok:n.GT,fail:n.LTE}},o={message:({keyword:i,schemaCode:c})=>(0,r.str)`should be ${s[i].okStr} ${c}`,params:({keyword:i,schemaCode:c})=>(0,r._)`{comparison: ${s[i].okStr}, limit: ${c}}`};e.formatLimitDefinition={keyword:Object.keys(s),type:"string",schemaType:"string",$data:!0,error:o,code(i){const{gen:c,data:l,schemaCode:d,keyword:S,it:_}=i,{opts:w,self:E}=_;if(!w.validateFormats)return;const g=new t.KeywordCxt(_,E.RULES.all.format.definition,"format");g.$data?f():h();function f(){const p=c.scopeValue("formats",{ref:E.formats,code:w.code.formats}),$=c.const("fmt",(0,r._)`${p}[${g.schemaCode}]`);i.fail$data((0,r.or)((0,r._)`typeof ${$} != "object"`,(0,r._)`${$} instanceof RegExp`,(0,r._)`typeof ${$}.compare != "function"`,u($)))}function h(){const p=g.schema,$=E.formats[p];if(!$||$===!0)return;if(typeof $!="object"||$ instanceof RegExp||typeof $.compare!="function")throw new Error(`"${S}": format "${p}" does not define "compare" function`);const m=c.scopeValue("formats",{key:p,ref:$,code:w.code.formats?(0,r._)`${w.code.formats}${(0,r.getProperty)(p)}`:void 0});i.fail$data(u(m))}function u(p){return(0,r._)`${p}.compare(${l}, ${d}) ${s[S].fail} 0`}},dependencies:["format"]};const a=i=>(i.addKeyword(e.formatLimitDefinition),i);e.default=a})(gs)),gs}var cc;function vg(){return cc||(cc=1,(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const r=_g(),n=yg(),s=ne(),o=new s.Name("fullFormats"),a=new s.Name("fastFormats"),i=(l,d={keywords:!0})=>{if(Array.isArray(d))return c(l,d,r.fullFormats,o),l;const[S,_]=d.mode==="fast"?[r.fastFormats,a]:[r.fullFormats,o],w=d.formats||r.formatNames;return c(l,w,S,_),d.keywords&&(0,n.default)(l),l};i.get=(l,d="full")=>{const _=(d==="fast"?r.fastFormats:r.fullFormats)[l];if(!_)throw new Error(`Unknown format "${l}"`);return _};function c(l,d,S,_){var w,E;(w=(E=l.opts.code).formats)!==null&&w!==void 0||(E.formats=(0,s._)`require("ajv-formats/dist/formats").${_}`);for(const g of d)l.addFormat(g,S[g])}e.exports=t=i,Object.defineProperty(t,"__esModule",{value:!0}),t.default=i})(sn,sn.exports)),sn.exports}var wg=vg();const bg=ts(wg);function Sg(){const e=new gg({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return bg(e),e}class $g{constructor(t){this._ajv=t??Sg()}getValidator(t){const r="$id"in t&&typeof t.$id=="string"?this._ajv.getSchema(t.$id)??this._ajv.compile(t):this._ajv.compile(t);return n=>r(n)?{valid:!0,data:n,errorMessage:void 0}:{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(r.errors)}}}class Eg{constructor(t){this._client=t}async*callToolStream(t,r=fr,n){const s=this._client,o={...n,task:n?.task??(s.isToolTask(t.name)?{}:void 0)},a=s.requestStream({method:"tools/call",params:t},r,o),i=s.getToolOutputValidator(t.name);for await(const c of a){if(c.type==="result"&&i){const l=c.result;if(!l.structuredContent&&!l.isError){yield{type:"error",error:new Q(re.InvalidRequest,`Tool ${t.name} has an output schema but did not return structured content`)};return}if(l.structuredContent)try{const d=i(l.structuredContent);if(!d.valid){yield{type:"error",error:new Q(re.InvalidParams,`Structured content does not match the tool's output schema: ${d.errorMessage}`)};return}}catch(d){if(d instanceof Q){yield{type:"error",error:d};return}yield{type:"error",error:new Q(re.InvalidParams,`Failed to validate structured content: ${d instanceof Error?d.message:String(d)}`)};return}}yield c}}async getTask(t,r){return this._client.getTask({taskId:t},r)}async getTaskResult(t,r,n){return this._client.getTaskResult({taskId:t},r,n)}async listTasks(t,r){return this._client.listTasks(t?{cursor:t}:void 0,r)}async cancelTask(t,r){return this._client.cancelTask({taskId:t},r)}requestStream(t,r,n){return this._client.requestStream(t,r,n)}}function kg(e,t,r){if(!e)throw new Error(`${r} does not support task creation (required for ${t})`);switch(t){case"tools/call":if(!e.tools?.call)throw new Error(`${r} does not support task creation for tools/call (required for ${t})`);break}}function Tg(e,t,r){if(!e)throw new Error(`${r} does not support task creation (required for ${t})`);switch(t){case"sampling/createMessage":if(!e.sampling?.createMessage)throw new Error(`${r} does not support task creation for sampling/createMessage (required for ${t})`);break;case"elicitation/create":if(!e.elicitation?.create)throw new Error(`${r} does not support task creation for elicitation/create (required for ${t})`);break}}function on(e,t){if(!(!e||t===null||typeof t!="object")){if(e.type==="object"&&e.properties&&typeof e.properties=="object"){const r=t,n=e.properties;for(const s of Object.keys(n)){const o=n[s];r[s]===void 0&&Object.prototype.hasOwnProperty.call(o,"default")&&(r[s]=o.default),r[s]!==void 0&&on(o,r[s])}}if(Array.isArray(e.anyOf))for(const r of e.anyOf)typeof r!="boolean"&&on(r,t);if(Array.isArray(e.oneOf))for(const r of e.oneOf)typeof r!="boolean"&&on(r,t)}}function Pg(e){if(!e)return{supportsFormMode:!1,supportsUrlMode:!1};const t=e.form!==void 0,r=e.url!==void 0;return{supportsFormMode:t||!t&&!r,supportsUrlMode:r}}class Rg extends bm{constructor(t,r){super(r),this._clientInfo=t,this._cachedToolOutputValidators=new Map,this._cachedKnownTaskTools=new Set,this._cachedRequiredTaskTools=new Set,this._listChangedDebounceTimers=new Map,this._capabilities=r?.capabilities??{},this._jsonSchemaValidator=r?.jsonSchemaValidator??new $g,r?.listChanged&&(this._pendingListChangedConfig=r.listChanged)}_setupListChangedHandlers(t){t.tools&&this._serverCapabilities?.tools?.listChanged&&this._setupListChangedHandler("tools",Aa,t.tools,async()=>(await this.listTools()).tools),t.prompts&&this._serverCapabilities?.prompts?.listChanged&&this._setupListChangedHandler("prompts",Ta,t.prompts,async()=>(await this.listPrompts()).prompts),t.resources&&this._serverCapabilities?.resources?.listChanged&&this._setupListChangedHandler("resources",$a,t.resources,async()=>(await this.listResources()).resources)}get experimental(){return this._experimental||(this._experimental={tasks:new Eg(this)}),this._experimental}registerCapabilities(t){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=Sm(this._capabilities,t)}setRequestHandler(t,r){const s=ca(t)?.method;if(!s)throw new Error("Schema is missing a method literal");let o;if(ir(s)){const i=s;o=i._zod?.def?.value??i.value}else{const i=s;o=i._def?.value??i.value}if(typeof o!="string")throw new Error("Schema method literal must be a string");const a=o;if(a==="elicitation/create"){const i=async(c,l)=>{const d=tt(Na,c);if(!d.success){const u=d.error instanceof Error?d.error.message:String(d.error);throw new Q(re.InvalidParams,`Invalid elicitation request: ${u}`)}const{params:S}=d.data;S.mode=S.mode??"form";const{supportsFormMode:_,supportsUrlMode:w}=Pg(this._capabilities.elicitation);if(S.mode==="form"&&!_)throw new Q(re.InvalidParams,"Client does not support form-mode elicitation requests");if(S.mode==="url"&&!w)throw new Q(re.InvalidParams,"Client does not support URL-mode elicitation requests");const E=await Promise.resolve(r(c,l));if(S.task){const u=tt(Vt,E);if(!u.success){const p=u.error instanceof Error?u.error.message:String(u.error);throw new Q(re.InvalidParams,`Invalid task creation result: ${p}`)}return u.data}const g=tt(za,E);if(!g.success){const u=g.error instanceof Error?g.error.message:String(g.error);throw new Q(re.InvalidParams,`Invalid elicitation result: ${u}`)}const f=g.data,h=S.mode==="form"?S.requestedSchema:void 0;if(S.mode==="form"&&f.action==="accept"&&f.content&&h&&this._capabilities.elicitation?.form?.applyDefaults)try{on(h,f.content)}catch{}return f};return super.setRequestHandler(t,i)}if(a==="sampling/createMessage"){const i=async(c,l)=>{const d=tt(Oa,c);if(!d.success){const E=d.error instanceof Error?d.error.message:String(d.error);throw new Q(re.InvalidParams,`Invalid sampling request: ${E}`)}const{params:S}=d.data,_=await Promise.resolve(r(c,l));if(S.task){const E=tt(Vt,_);if(!E.success){const g=E.error instanceof Error?E.error.message:String(E.error);throw new Q(re.InvalidParams,`Invalid task creation result: ${g}`)}return E.data}const w=tt(Ca,_);if(!w.success){const E=w.error instanceof Error?w.error.message:String(w.error);throw new Q(re.InvalidParams,`Invalid sampling result: ${E}`)}return w.data};return super.setRequestHandler(t,i)}return super.setRequestHandler(t,r)}assertCapability(t,r){if(!this._serverCapabilities?.[t])throw new Error(`Server does not support ${t} (required for ${r})`)}async connect(t,r){if(await super.connect(t),t.sessionId===void 0)try{const n=await this.request({method:"initialize",params:{protocolVersion:cr,capabilities:this._capabilities,clientInfo:this._clientInfo}},pa,r);if(n===void 0)throw new Error(`Server sent invalid initialize result: ${n}`);if(!Lh.includes(n.protocolVersion))throw new Error(`Server's protocol version is not supported: ${n.protocolVersion}`);this._serverCapabilities=n.capabilities,this._serverVersion=n.serverInfo,t.setProtocolVersion&&t.setProtocolVersion(n.protocolVersion),this._instructions=n.instructions,await this.notification({method:"notifications/initialized"}),this._pendingListChangedConfig&&(this._setupListChangedHandlers(this._pendingListChangedConfig),this._pendingListChangedConfig=void 0)}catch(n){throw this.close(),n}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(t){switch(t){case"logging/setLevel":if(!this._serverCapabilities?.logging)throw new Error(`Server does not support logging (required for ${t})`);break;case"prompts/get":case"prompts/list":if(!this._serverCapabilities?.prompts)throw new Error(`Server does not support prompts (required for ${t})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!this._serverCapabilities?.resources)throw new Error(`Server does not support resources (required for ${t})`);if(t==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${t})`);break;case"tools/call":case"tools/list":if(!this._serverCapabilities?.tools)throw new Error(`Server does not support tools (required for ${t})`);break;case"completion/complete":if(!this._serverCapabilities?.completions)throw new Error(`Server does not support completions (required for ${t})`);break}}assertNotificationCapability(t){switch(t){case"notifications/roots/list_changed":if(!this._capabilities.roots?.listChanged)throw new Error(`Client does not support roots list changed notifications (required for ${t})`);break}}assertRequestHandlerCapability(t){if(this._capabilities)switch(t){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${t})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${t})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${t})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw new Error(`Client does not support tasks capability (required for ${t})`);break}}assertTaskCapability(t){kg(this._serverCapabilities?.tasks?.requests,t,"Server")}assertTaskHandlerCapability(t){this._capabilities&&Tg(this._capabilities.tasks?.requests,t,"Client")}async ping(t){return this.request({method:"ping"},vt,t)}async complete(t,r){return this.request({method:"completion/complete",params:t},Ma,r)}async setLoggingLevel(t,r){return this.request({method:"logging/setLevel",params:{level:t}},vt,r)}async getPrompt(t,r){return this.request({method:"prompts/get",params:t},ka,r)}async listPrompts(t,r){return this.request({method:"prompts/list",params:t},Ea,r)}async listResources(t,r){return this.request({method:"resources/list",params:t},wa,r)}async listResourceTemplates(t,r){return this.request({method:"resources/templates/list",params:t},ba,r)}async readResource(t,r){return this.request({method:"resources/read",params:t},Sa,r)}async subscribeResource(t,r){return this.request({method:"resources/subscribe",params:t},vt,r)}async unsubscribeResource(t,r){return this.request({method:"resources/unsubscribe",params:t},vt,r)}async callTool(t,r=fr,n){if(this.isToolTaskRequired(t.name))throw new Q(re.InvalidRequest,`Tool "${t.name}" requires task-based execution. Use client.experimental.tasks.callToolStream() instead.`);const s=await this.request({method:"tools/call",params:t},r,n),o=this.getToolOutputValidator(t.name);if(o){if(!s.structuredContent&&!s.isError)throw new Q(re.InvalidRequest,`Tool ${t.name} has an output schema but did not return structured content`);if(s.structuredContent)try{const a=o(s.structuredContent);if(!a.valid)throw new Q(re.InvalidParams,`Structured content does not match the tool's output schema: ${a.errorMessage}`)}catch(a){throw a instanceof Q?a:new Q(re.InvalidParams,`Failed to validate structured content: ${a instanceof Error?a.message:String(a)}`)}}return s}isToolTask(t){return this._serverCapabilities?.tasks?.requests?.tools?.call?this._cachedKnownTaskTools.has(t):!1}isToolTaskRequired(t){return this._cachedRequiredTaskTools.has(t)}cacheToolMetadata(t){this._cachedToolOutputValidators.clear(),this._cachedKnownTaskTools.clear(),this._cachedRequiredTaskTools.clear();for(const r of t){if(r.outputSchema){const s=this._jsonSchemaValidator.getValidator(r.outputSchema);this._cachedToolOutputValidators.set(r.name,s)}const n=r.execution?.taskSupport;(n==="required"||n==="optional")&&this._cachedKnownTaskTools.add(r.name),n==="required"&&this._cachedRequiredTaskTools.add(r.name)}}getToolOutputValidator(t){return this._cachedToolOutputValidators.get(t)}async listTools(t,r){const n=await this.request({method:"tools/list",params:t},Ra,r);return this.cacheToolMetadata(n.tools),n}_setupListChangedHandler(t,r,n,s){const o=Mp.safeParse(n);if(!o.success)throw new Error(`Invalid ${t} listChanged options: ${o.error.message}`);if(typeof n.onChanged!="function")throw new Error(`Invalid ${t} listChanged options: onChanged must be a function`);const{autoRefresh:a,debounceMs:i}=o.data,{onChanged:c}=n,l=async()=>{if(!a){c(null,null);return}try{const S=await s();c(null,S)}catch(S){const _=S instanceof Error?S:new Error(String(S));c(_,null)}},d=()=>{if(i){const S=this._listChangedDebounceTimers.get(t);S&&clearTimeout(S);const _=setTimeout(l,i);this._listChangedDebounceTimers.set(t,_)}else l()};this.setNotificationHandler(r,d)}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}}function _s(e){return e?e instanceof Headers?Object.fromEntries(e.entries()):Array.isArray(e)?Object.fromEntries(e):{...e}:{}}function Ag(e=fetch,t){return t?async(r,n)=>{const s={...t,...n,headers:n?.headers?{..._s(t.headers),..._s(n.headers)}:t.headers};return e(r,s)}:e}let ys;ys=globalThis.crypto;async function Ig(e){return(await ys).getRandomValues(new Uint8Array(e))}async function Og(e){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let r="";const n=await Ig(e);for(let s=0;s<e;s++){const o=n[s]%t.length;r+=t[o]}return r}async function Cg(e){return await Og(e)}async function Ng(e){const t=await(await ys).subtle.digest("SHA-256",new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function zg(e){if(e||(e=43),e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;const t=await Cg(e),r=await Ng(t);return{code_verifier:t,code_challenge:r}}const Ie=If().superRefine((e,t)=>{if(!URL.canParse(e))return t.addIssue({code:wh.custom,message:"URL must be parseable",fatal:!0}),Oc}).refine(e=>{const t=new URL(e);return t.protocol!=="javascript:"&&t.protocol!=="data:"&&t.protocol!=="vbscript:"},{message:"URL cannot use javascript:, data:, or vbscript: scheme"}),Mg=ke({resource:P().url(),authorization_servers:H(Ie).optional(),jwks_uri:P().url().optional(),scopes_supported:H(P()).optional(),bearer_methods_supported:H(P()).optional(),resource_signing_alg_values_supported:H(P()).optional(),resource_name:P().optional(),resource_documentation:P().optional(),resource_policy_uri:P().url().optional(),resource_tos_uri:P().url().optional(),tls_client_certificate_bound_access_tokens:he().optional(),authorization_details_types_supported:H(P()).optional(),dpop_signing_alg_values_supported:H(P()).optional(),dpop_bound_access_tokens_required:he().optional()}),uc=ke({issuer:P(),authorization_endpoint:Ie,token_endpoint:Ie,registration_endpoint:Ie.optional(),scopes_supported:H(P()).optional(),response_types_supported:H(P()),response_modes_supported:H(P()).optional(),grant_types_supported:H(P()).optional(),token_endpoint_auth_methods_supported:H(P()).optional(),token_endpoint_auth_signing_alg_values_supported:H(P()).optional(),service_documentation:Ie.optional(),revocation_endpoint:Ie.optional(),revocation_endpoint_auth_methods_supported:H(P()).optional(),revocation_endpoint_auth_signing_alg_values_supported:H(P()).optional(),introspection_endpoint:P().optional(),introspection_endpoint_auth_methods_supported:H(P()).optional(),introspection_endpoint_auth_signing_alg_values_supported:H(P()).optional(),code_challenge_methods_supported:H(P()).optional(),client_id_metadata_document_supported:he().optional()}),jg=ke({issuer:P(),authorization_endpoint:Ie,token_endpoint:Ie,userinfo_endpoint:Ie.optional(),jwks_uri:Ie,registration_endpoint:Ie.optional(),scopes_supported:H(P()).optional(),response_types_supported:H(P()),response_modes_supported:H(P()).optional(),grant_types_supported:H(P()).optional(),acr_values_supported:H(P()).optional(),subject_types_supported:H(P()),id_token_signing_alg_values_supported:H(P()),id_token_encryption_alg_values_supported:H(P()).optional(),id_token_encryption_enc_values_supported:H(P()).optional(),userinfo_signing_alg_values_supported:H(P()).optional(),userinfo_encryption_alg_values_supported:H(P()).optional(),userinfo_encryption_enc_values_supported:H(P()).optional(),request_object_signing_alg_values_supported:H(P()).optional(),request_object_encryption_alg_values_supported:H(P()).optional(),request_object_encryption_enc_values_supported:H(P()).optional(),token_endpoint_auth_methods_supported:H(P()).optional(),token_endpoint_auth_signing_alg_values_supported:H(P()).optional(),display_values_supported:H(P()).optional(),claim_types_supported:H(P()).optional(),claims_supported:H(P()).optional(),service_documentation:P().optional(),claims_locales_supported:H(P()).optional(),ui_locales_supported:H(P()).optional(),claims_parameter_supported:he().optional(),request_parameter_supported:he().optional(),request_uri_parameter_supported:he().optional(),require_request_uri_registration:he().optional(),op_policy_uri:Ie.optional(),op_tos_uri:Ie.optional(),client_id_metadata_document_supported:he().optional()}),qg=K({...jg.shape,...uc.pick({code_challenge_methods_supported:!0}).shape}),xg=K({access_token:P(),id_token:P().optional(),token_type:P(),expires_in:ea().optional(),scope:P().optional(),refresh_token:P().optional()}).strip(),Ug=K({error:P(),error_description:P().optional(),error_uri:P().optional()}),lc=Ie.optional().or(W("").transform(()=>{})),Dg=K({redirect_uris:H(Ie),token_endpoint_auth_method:P().optional(),grant_types:H(P()).optional(),response_types:H(P()).optional(),client_name:P().optional(),client_uri:Ie.optional(),logo_uri:lc,scope:P().optional(),contacts:H(P()).optional(),tos_uri:lc,policy_uri:P().optional(),jwks_uri:Ie.optional(),jwks:Gf().optional(),software_id:P().optional(),software_version:P().optional(),software_statement:P().optional()}).strip(),Lg=K({client_id:P(),client_secret:P().optional(),client_id_issued_at:le().optional(),client_secret_expires_at:le().optional()}).strip(),Vg=Dg.merge(Lg);K({error:P(),error_description:P().optional()}).strip(),K({token:P(),token_type_hint:P().optional()}).strip();function Zg(e){const t=typeof e=="string"?new URL(e):new URL(e.href);return t.hash="",t}function Fg({requestedResource:e,configuredResource:t}){const r=typeof e=="string"?new URL(e):new URL(e.href),n=typeof t=="string"?new URL(t):new URL(t.href);if(r.origin!==n.origin||r.pathname.length<n.pathname.length)return!1;const s=r.pathname.endsWith("/")?r.pathname:r.pathname+"/",o=n.pathname.endsWith("/")?n.pathname:n.pathname+"/";return s.startsWith(o)}class Ee extends Error{constructor(t,r){super(t),this.errorUri=r,this.name=this.constructor.name}toResponseObject(){const t={error:this.errorCode,error_description:this.message};return this.errorUri&&(t.error_uri=this.errorUri),t}get errorCode(){return this.constructor.errorCode}}class vs extends Ee{}vs.errorCode="invalid_request";class an extends Ee{}an.errorCode="invalid_client";class cn extends Ee{}cn.errorCode="invalid_grant";class un extends Ee{}un.errorCode="unauthorized_client";class ws extends Ee{}ws.errorCode="unsupported_grant_type";class bs extends Ee{}bs.errorCode="invalid_scope";class Ss extends Ee{}Ss.errorCode="access_denied";class Et extends Ee{}Et.errorCode="server_error";class $s extends Ee{}$s.errorCode="temporarily_unavailable";class Es extends Ee{}Es.errorCode="unsupported_response_type";class ks extends Ee{}ks.errorCode="unsupported_token_type";class Ts extends Ee{}Ts.errorCode="invalid_token";class Ps extends Ee{}Ps.errorCode="method_not_allowed";class Rs extends Ee{}Rs.errorCode="too_many_requests";class ln extends Ee{}ln.errorCode="invalid_client_metadata";class As extends Ee{}As.errorCode="insufficient_scope";class Is extends Ee{}Is.errorCode="invalid_target";const Hg={[vs.errorCode]:vs,[an.errorCode]:an,[cn.errorCode]:cn,[un.errorCode]:un,[ws.errorCode]:ws,[bs.errorCode]:bs,[Ss.errorCode]:Ss,[Et.errorCode]:Et,[$s.errorCode]:$s,[Es.errorCode]:Es,[ks.errorCode]:ks,[Ts.errorCode]:Ts,[Ps.errorCode]:Ps,[Rs.errorCode]:Rs,[ln.errorCode]:ln,[As.errorCode]:As,[Is.errorCode]:Is};class kt extends Error{constructor(t){super(t??"Unauthorized")}}function Kg(e){return["client_secret_basic","client_secret_post","none"].includes(e)}const Os="code",Cs="S256";function Jg(e,t){const r=e.client_secret!==void 0;return t.length===0?r?"client_secret_post":"none":"token_endpoint_auth_method"in e&&e.token_endpoint_auth_method&&Kg(e.token_endpoint_auth_method)&&t.includes(e.token_endpoint_auth_method)?e.token_endpoint_auth_method:r&&t.includes("client_secret_basic")?"client_secret_basic":r&&t.includes("client_secret_post")?"client_secret_post":t.includes("none")?"none":r?"client_secret_post":"none"}function Bg(e,t,r,n){const{client_id:s,client_secret:o}=t;switch(e){case"client_secret_basic":Wg(s,o,r);return;case"client_secret_post":Gg(s,o,n);return;case"none":Yg(s,n);return;default:throw new Error(`Unsupported client authentication method: ${e}`)}}function Wg(e,t,r){if(!t)throw new Error("client_secret_basic authentication requires a client_secret");const n=btoa(`${e}:${t}`);r.set("Authorization",`Basic ${n}`)}function Gg(e,t,r){r.set("client_id",e),t&&r.set("client_secret",t)}function Yg(e,t){t.set("client_id",e)}async function dc(e){const t=e instanceof Response?e.status:void 0,r=e instanceof Response?await e.text():e;try{const n=Ug.parse(JSON.parse(r)),{error:s,error_description:o,error_uri:a}=n,i=Hg[s]||Et;return new i(o||"",a)}catch(n){const s=`${t?`HTTP ${t}: `:""}Invalid OAuth error response: ${n}. Raw body: ${r}`;return new Et(s)}}async function dn(e,t){try{return await Ns(e,t)}catch(r){if(r instanceof an||r instanceof un)return await e.invalidateCredentials?.("all"),await Ns(e,t);if(r instanceof cn)return await e.invalidateCredentials?.("tokens"),await Ns(e,t);throw r}}async function Ns(e,{serverUrl:t,authorizationCode:r,scope:n,resourceMetadataUrl:s,fetchFn:o}){let a,i;try{a=await e_(t,{resourceMetadataUrl:s},o),a.authorization_servers&&a.authorization_servers.length>0&&(i=a.authorization_servers[0])}catch{}i||(i=new URL("/",t));const c=await Xg(t,e,a),l=await o_(i,{fetchFn:o});let d=await Promise.resolve(e.clientInformation());if(!d){if(r!==void 0)throw new Error("Existing OAuth client information is required when exchanging an authorization code");const f=l?.client_id_metadata_document_supported===!0,h=e.clientMetadataUrl;if(h&&!Qg(h))throw new ln(`clientMetadataUrl must be a valid HTTPS URL with a non-root pathname, got: ${h}`);if(f&&h)d={client_id:h},await e.saveClientInformation?.(d);else{if(!e.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");const p=await l_(i,{metadata:l,clientMetadata:e.clientMetadata,fetchFn:o});await e.saveClientInformation(p),d=p}}const S=!e.redirectUrl;if(r!==void 0||S){const f=await u_(e,i,{metadata:l,resource:c,authorizationCode:r,fetchFn:o});return await e.saveTokens(f),"AUTHORIZED"}const _=await e.tokens();if(_?.refresh_token)try{const f=await c_(i,{metadata:l,clientInformation:d,refreshToken:_.refresh_token,resource:c,addClientAuthentication:e.addClientAuthentication,fetchFn:o});return await e.saveTokens(f),"AUTHORIZED"}catch(f){if(!(!(f instanceof Ee)||f instanceof Et))throw f}const w=e.state?await e.state():void 0,{authorizationUrl:E,codeVerifier:g}=await a_(i,{metadata:l,clientInformation:d,state:w,redirectUrl:e.redirectUrl,scope:n||a?.scopes_supported?.join(" ")||e.clientMetadata.scope,resource:c});return await e.saveCodeVerifier(g),await e.redirectToAuthorization(E),"REDIRECT"}function Qg(e){if(!e)return!1;try{const t=new URL(e);return t.protocol==="https:"&&t.pathname!=="/"}catch{return!1}}async function Xg(e,t,r){const n=Zg(e);if(t.validateResourceURL)return await t.validateResourceURL(n,r?.resource);if(r){if(!Fg({requestedResource:n,configuredResource:r.resource}))throw new Error(`Protected resource ${r.resource} does not match expected ${n} (or origin)`);return new URL(r.resource)}}function fc(e){const t=e.headers.get("WWW-Authenticate");if(!t)return{};const[r,n]=t.split(" ");if(r.toLowerCase()!=="bearer"||!n)return{};const s=zs(e,"resource_metadata")||void 0;let o;if(s)try{o=new URL(s)}catch{}const a=zs(e,"scope")||void 0,i=zs(e,"error")||void 0;return{resourceMetadataUrl:o,scope:a,error:i}}function zs(e,t){const r=e.headers.get("WWW-Authenticate");if(!r)return null;const n=new RegExp(`${t}=(?:"([^"]+)"|([^\\s,]+))`),s=r.match(n);return s?s[1]||s[2]:null}async function e_(e,t,r=fetch){const n=await n_(e,"oauth-protected-resource",r,{protocolVersion:t?.protocolVersion,metadataUrl:t?.resourceMetadataUrl});if(!n||n.status===404)throw await n?.body?.cancel(),new Error("Resource server does not implement OAuth 2.0 Protected Resource Metadata.");if(!n.ok)throw await n.body?.cancel(),new Error(`HTTP ${n.status} trying to load well-known OAuth protected resource metadata.`);return Mg.parse(await n.json())}async function Ms(e,t,r=fetch){try{return await r(e,{headers:t})}catch(n){if(n instanceof TypeError)return t?Ms(e,void 0,r):void 0;throw n}}function t_(e,t="",r={}){return t.endsWith("/")&&(t=t.slice(0,-1)),r.prependPathname?`${t}/.well-known/${e}`:`/.well-known/${e}${t}`}async function hc(e,t,r=fetch){return await Ms(e,{"MCP-Protocol-Version":t},r)}function r_(e,t){return!e||e.status>=400&&e.status<500&&t!=="/"}async function n_(e,t,r,n){const s=new URL(e),o=n?.protocolVersion??cr;let a;if(n?.metadataUrl)a=new URL(n.metadataUrl);else{const c=t_(t,s.pathname);a=new URL(c,n?.metadataServerUrl??s),a.search=s.search}let i=await hc(a,o,r);if(!n?.metadataUrl&&r_(i,s.pathname)){const c=new URL(`/.well-known/${t}`,s);i=await hc(c,o,r)}return i}function s_(e){const t=typeof e=="string"?new URL(e):e,r=t.pathname!=="/",n=[];if(!r)return n.push({url:new URL("/.well-known/oauth-authorization-server",t.origin),type:"oauth"}),n.push({url:new URL("/.well-known/openid-configuration",t.origin),type:"oidc"}),n;let s=t.pathname;return s.endsWith("/")&&(s=s.slice(0,-1)),n.push({url:new URL(`/.well-known/oauth-authorization-server${s}`,t.origin),type:"oauth"}),n.push({url:new URL(`/.well-known/openid-configuration${s}`,t.origin),type:"oidc"}),n.push({url:new URL(`${s}/.well-known/openid-configuration`,t.origin),type:"oidc"}),n}async function o_(e,{fetchFn:t=fetch,protocolVersion:r=cr}={}){const n={"MCP-Protocol-Version":r,Accept:"application/json"},s=s_(e);for(const{url:o,type:a}of s){const i=await Ms(o,n,t);if(i){if(!i.ok){if(await i.body?.cancel(),i.status>=400&&i.status<500)continue;throw new Error(`HTTP ${i.status} trying to load ${a==="oauth"?"OAuth":"OpenID provider"} metadata from ${o}`)}return a==="oauth"?uc.parse(await i.json()):qg.parse(await i.json())}}}async function a_(e,{metadata:t,clientInformation:r,redirectUrl:n,scope:s,state:o,resource:a}){let i;if(t){if(i=new URL(t.authorization_endpoint),!t.response_types_supported.includes(Os))throw new Error(`Incompatible auth server: does not support response type ${Os}`);if(t.code_challenge_methods_supported&&!t.code_challenge_methods_supported.includes(Cs))throw new Error(`Incompatible auth server: does not support code challenge method ${Cs}`)}else i=new URL("/authorize",e);const c=await zg(),l=c.code_verifier,d=c.code_challenge;return i.searchParams.set("response_type",Os),i.searchParams.set("client_id",r.client_id),i.searchParams.set("code_challenge",d),i.searchParams.set("code_challenge_method",Cs),i.searchParams.set("redirect_uri",String(n)),o&&i.searchParams.set("state",o),s&&i.searchParams.set("scope",s),s?.includes("offline_access")&&i.searchParams.append("prompt","consent"),a&&i.searchParams.set("resource",a.href),{authorizationUrl:i,codeVerifier:l}}function i_(e,t,r){return new URLSearchParams({grant_type:"authorization_code",code:e,code_verifier:t,redirect_uri:String(r)})}async function pc(e,{metadata:t,tokenRequestParams:r,clientInformation:n,addClientAuthentication:s,resource:o,fetchFn:a}){const i=t?.token_endpoint?new URL(t.token_endpoint):new URL("/token",e),c=new Headers({"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"});if(o&&r.set("resource",o.href),s)await s(c,r,i,t);else if(n){const d=t?.token_endpoint_auth_methods_supported??[],S=Jg(n,d);Bg(S,n,c,r)}const l=await(a??fetch)(i,{method:"POST",headers:c,body:r});if(!l.ok)throw await dc(l);return xg.parse(await l.json())}async function c_(e,{metadata:t,clientInformation:r,refreshToken:n,resource:s,addClientAuthentication:o,fetchFn:a}){const i=new URLSearchParams({grant_type:"refresh_token",refresh_token:n}),c=await pc(e,{metadata:t,tokenRequestParams:i,clientInformation:r,addClientAuthentication:o,resource:s,fetchFn:a});return{refresh_token:n,...c}}async function u_(e,t,{metadata:r,resource:n,authorizationCode:s,fetchFn:o}={}){const a=e.clientMetadata.scope;let i;if(e.prepareTokenRequest&&(i=await e.prepareTokenRequest(a)),!i){if(!s)throw new Error("Either provider.prepareTokenRequest() or authorizationCode is required");if(!e.redirectUrl)throw new Error("redirectUrl is required for authorization_code flow");const l=await e.codeVerifier();i=i_(s,l,e.redirectUrl)}const c=await e.clientInformation();return pc(t,{metadata:r,tokenRequestParams:i,clientInformation:c??void 0,addClientAuthentication:e.addClientAuthentication,resource:n,fetchFn:o})}async function l_(e,{metadata:t,clientMetadata:r,fetchFn:n}){let s;if(t){if(!t.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");s=new URL(t.registration_endpoint)}else s=new URL("/register",e);const o=await(n??fetch)(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!o.ok)throw await dc(o);return Vg.parse(await o.json())}class mc extends Error{constructor(t,r){super(t),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}}function js(e){}function gc(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=js,onError:r=js,onRetry:n=js,onComment:s}=e;let o="",a=!0,i,c="",l="";function d(g){const f=a?g.replace(/^\xEF\xBB\xBF/,""):g,[h,u]=d_(`${o}${f}`);for(const p of h)S(p);o=u,a=!1}function S(g){if(g===""){w();return}if(g.startsWith(":")){s&&s(g.slice(g.startsWith(": ")?2:1));return}const f=g.indexOf(":");if(f!==-1){const h=g.slice(0,f),u=g[f+1]===" "?2:1,p=g.slice(f+u);_(h,p,g);return}_(g,"",g)}function _(g,f,h){switch(g){case"event":l=f;break;case"data":c=`${c}${f}
`;break;case"id":i=f.includes("\0")?void 0:f;break;case"retry":/^\d+$/.test(f)?n(parseInt(f,10)):r(new mc(`Invalid \`retry\` value: "${f}"`,{type:"invalid-retry",value:f,line:h}));break;default:r(new mc(`Unknown field "${g.length>20?`${g.slice(0,20)}`:g}"`,{type:"unknown-field",field:g,value:f,line:h}));break}}function w(){c.length>0&&t({id:i,event:l||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),i=void 0,c="",l=""}function E(g={}){o&&g.consume&&S(o),a=!0,i=void 0,c="",l="",o=""}return{feed:d,reset:E}}function d_(e){const t=[];let r="",n=0;for(;n<e.length;){const s=e.indexOf("\r",n),o=e.indexOf(`
`,n);let a=-1;if(s!==-1&&o!==-1?a=Math.min(s,o):s!==-1?s===e.length-1?a=-1:a=s:o!==-1&&(a=o),a===-1){r=e.slice(n);break}else{const i=e.slice(n,a);t.push(i),n=a+1,e[n-1]==="\r"&&e[n]===`
`&&n++}}return[t,r]}class f_ extends TransformStream{constructor({onError:t,onRetry:r,onComment:n}={}){let s;super({start(o){s=gc({onEvent:a=>{o.enqueue(a)},onError(a){t==="terminate"?o.error(a):typeof t=="function"&&t(a)},onRetry:r,onComment:n})},transform(o){s.feed(o)}})}}const h_={initialReconnectionDelay:1e3,maxReconnectionDelay:3e4,reconnectionDelayGrowFactor:1.5,maxRetries:2};class Tt extends Error{constructor(t,r){super(`Streamable HTTP error: ${r}`),this.code=t}}class p_{constructor(t,r){this._hasCompletedAuthFlow=!1,this._url=t,this._resourceMetadataUrl=void 0,this._scope=void 0,this._requestInit=r?.requestInit,this._authProvider=r?.authProvider,this._fetch=r?.fetch,this._fetchWithInit=Ag(r?.fetch,r?.requestInit),this._sessionId=r?.sessionId,this._reconnectionOptions=r?.reconnectionOptions??h_}async _authThenStart(){if(!this._authProvider)throw new kt("No auth provider");let t;try{t=await dn(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})}catch(r){throw this.onerror?.(r),r}if(t!=="AUTHORIZED")throw new kt;return await this._startOrAuthSse({resumptionToken:void 0})}async _commonHeaders(){const t={};if(this._authProvider){const n=await this._authProvider.tokens();n&&(t.Authorization=`Bearer ${n.access_token}`)}this._sessionId&&(t["mcp-session-id"]=this._sessionId),this._protocolVersion&&(t["mcp-protocol-version"]=this._protocolVersion);const r=_s(this._requestInit?.headers);return new Headers({...t,...r})}async _startOrAuthSse(t){const{resumptionToken:r}=t;try{const n=await this._commonHeaders();n.set("Accept","text/event-stream"),r&&n.set("last-event-id",r);const s=await(this._fetch??fetch)(this._url,{method:"GET",headers:n,signal:this._abortController?.signal});if(!s.ok){if(await s.body?.cancel(),s.status===401&&this._authProvider)return await this._authThenStart();if(s.status===405)return;throw new Tt(s.status,`Failed to open SSE stream: ${s.statusText}`)}this._handleSseStream(s.body,t,!0)}catch(n){throw this.onerror?.(n),n}}_getNextReconnectionDelay(t){if(this._serverRetryMs!==void 0)return this._serverRetryMs;const r=this._reconnectionOptions.initialReconnectionDelay,n=this._reconnectionOptions.reconnectionDelayGrowFactor,s=this._reconnectionOptions.maxReconnectionDelay;return Math.min(r*Math.pow(n,t),s)}_scheduleReconnection(t,r=0){const n=this._reconnectionOptions.maxRetries;if(r>=n){this.onerror?.(new Error(`Maximum reconnection attempts (${n}) exceeded.`));return}const s=this._getNextReconnectionDelay(r);this._reconnectionTimeout=setTimeout(()=>{this._startOrAuthSse(t).catch(o=>{this.onerror?.(new Error(`Failed to reconnect SSE stream: ${o instanceof Error?o.message:String(o)}`)),this._scheduleReconnection(t,r+1)})},s)}_handleSseStream(t,r,n){if(!t)return;const{onresumptiontoken:s,replayMessageId:o}=r;let a,i=!1,c=!1;(async()=>{try{const d=t.pipeThrough(new TextDecoderStream).pipeThrough(new f_({onRetry:w=>{this._serverRetryMs=w}})).getReader();for(;;){const{value:w,done:E}=await d.read();if(E)break;if(w.id&&(a=w.id,i=!0,s?.(w.id)),!!w.data&&(!w.event||w.event==="message"))try{const g=Un.parse(JSON.parse(w.data));qt(g)&&(c=!0,o!==void 0&&(g.id=o)),this.onmessage?.(g)}catch(g){this.onerror?.(g)}}(n||i)&&!c&&this._abortController&&!this._abortController.signal.aborted&&this._scheduleReconnection({resumptionToken:a,onresumptiontoken:s,replayMessageId:o},0)}catch(d){if(this.onerror?.(new Error(`SSE stream disconnected: ${d}`)),(n||i)&&!c&&this._abortController&&!this._abortController.signal.aborted)try{this._scheduleReconnection({resumptionToken:a,onresumptiontoken:s,replayMessageId:o},0)}catch(w){this.onerror?.(new Error(`Failed to reconnect: ${w instanceof Error?w.message:String(w)}`))}}})()}async start(){if(this._abortController)throw new Error("StreamableHTTPClientTransport already started! If using Client class, note that connect() calls start() automatically.");this._abortController=new AbortController}async finishAuth(t){if(!this._authProvider)throw new kt("No auth provider");if(await dn(this._authProvider,{serverUrl:this._url,authorizationCode:t,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})!=="AUTHORIZED")throw new kt("Failed to authorize")}async close(){this._reconnectionTimeout&&(clearTimeout(this._reconnectionTimeout),this._reconnectionTimeout=void 0),this._abortController?.abort(),this.onclose?.()}async send(t,r){try{const{resumptionToken:n,onresumptiontoken:s}=r||{};if(n){this._startOrAuthSse({resumptionToken:n,replayMessageId:jn(t)?t.id:void 0}).catch(_=>this.onerror?.(_));return}const o=await this._commonHeaders();o.set("content-type","application/json"),o.set("accept","application/json, text/event-stream");const a={...this._requestInit,method:"POST",headers:o,body:JSON.stringify(t),signal:this._abortController?.signal},i=await(this._fetch??fetch)(this._url,a),c=i.headers.get("mcp-session-id");if(c&&(this._sessionId=c),!i.ok){const _=await i.text().catch(()=>null);if(i.status===401&&this._authProvider){if(this._hasCompletedAuthFlow)throw new Tt(401,"Server returned 401 after successful authentication");const{resourceMetadataUrl:w,scope:E}=fc(i);if(this._resourceMetadataUrl=w,this._scope=E,await dn(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetchWithInit})!=="AUTHORIZED")throw new kt;return this._hasCompletedAuthFlow=!0,this.send(t)}if(i.status===403&&this._authProvider){const{resourceMetadataUrl:w,scope:E,error:g}=fc(i);if(g==="insufficient_scope"){const f=i.headers.get("WWW-Authenticate");if(this._lastUpscopingHeader===f)throw new Tt(403,"Server returned 403 after trying upscoping");if(E&&(this._scope=E),w&&(this._resourceMetadataUrl=w),this._lastUpscopingHeader=f??void 0,await dn(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl,scope:this._scope,fetchFn:this._fetch})!=="AUTHORIZED")throw new kt;return this.send(t)}}throw new Tt(i.status,`Error POSTing to endpoint: ${_}`)}if(this._hasCompletedAuthFlow=!1,this._lastUpscopingHeader=void 0,i.status===202){await i.body?.cancel(),np(t)&&this._startOrAuthSse({resumptionToken:void 0}).catch(_=>this.onerror?.(_));return}const d=(Array.isArray(t)?t:[t]).filter(_=>"method"in _&&"id"in _&&_.id!==void 0).length>0,S=i.headers.get("content-type");if(d)if(S?.includes("text/event-stream"))this._handleSseStream(i.body,{onresumptiontoken:s},!1);else if(S?.includes("application/json")){const _=await i.json(),w=Array.isArray(_)?_.map(E=>Un.parse(E)):[Un.parse(_)];for(const E of w)this.onmessage?.(E)}else throw await i.body?.cancel(),new Tt(-1,`Unexpected content type: ${S}`);else await i.body?.cancel()}catch(n){throw this.onerror?.(n),n}}get sessionId(){return this._sessionId}async terminateSession(){if(this._sessionId)try{const t=await this._commonHeaders(),r={...this._requestInit,method:"DELETE",headers:t,signal:this._abortController?.signal},n=await(this._fetch??fetch)(this._url,r);if(await n.body?.cancel(),!n.ok&&n.status!==405)throw new Tt(n.status,`Failed to terminate session: ${n.statusText}`);this._sessionId=void 0}catch(t){throw this.onerror?.(t),t}}setProtocolVersion(t){this._protocolVersion=t}get protocolVersion(){return this._protocolVersion}async resumeStream(t,r){await this._startOrAuthSse({resumptionToken:t,onresumptiontoken:r?.onresumptiontoken})}}async function m_(e){const t=new Rg({name:"browseros-settings",version:"1.0.0"}),r=new p_(new URL(e));try{return await t.connect(r),(await t.listTools()).tools.map(s=>({name:s.name,description:s.description}))}finally{await t.close()}}const g_=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),__=new Map(g_);class qs extends Error{name="NonError";constructor(t){super(qs._prepareSuperMessage(t))}static _prepareSuperMessage(t){try{return JSON.stringify(t)}catch{return String(t)}}}const y_=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],xs=new WeakSet,v_=e=>{xs.add(e);const t=e.toJSON();return xs.delete(e),t},_c=e=>__.get(e)??Error,Us=({from:e,seen:t,to:r,forceEnumerable:n,maxDepth:s,depth:o,useToJSON:a,serialize:i})=>{if(!r)if(Array.isArray(e))r=[];else if(!i&&yc(e)){const l=_c(e.name);r=new l}else r={};if(t.push(e),o>=s)return r;if(a&&typeof e.toJSON=="function"&&!xs.has(e))return v_(e);const c=l=>Us({from:l,seen:[...t],forceEnumerable:n,maxDepth:s,depth:o,useToJSON:a,serialize:i});for(const[l,d]of Object.entries(e)){if(d&&d instanceof Uint8Array&&d.constructor.name==="Buffer"){r[l]="[object Buffer]";continue}if(d!==null&&typeof d=="object"&&typeof d.pipe=="function"){r[l]="[object Stream]";continue}if(typeof d!="function"){if(!d||typeof d!="object"){try{r[l]=d}catch{}continue}if(!t.includes(e[l])){o++,r[l]=c(e[l]);continue}r[l]="[Circular]"}}for(const{property:l,enumerable:d}of y_)typeof e[l]<"u"&&e[l]!==null&&Object.defineProperty(r,l,{value:yc(e[l])?c(e[l]):e[l],enumerable:n?!0:d,configurable:!0,writable:!0});return r};function w_(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY,useToJSON:n=!0}=t;return typeof e=="object"&&e!==null?Us({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0,useToJSON:n,serialize:!0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}function b_(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=t;if(e instanceof Error)return e;if(S_(e)){const n=_c(e.name);return Us({from:e,seen:[],to:new n,maxDepth:r,depth:0,serialize:!1})}return new qs(e)}function yc(e){return!!e&&typeof e=="object"&&"name"in e&&"message"in e&&"stack"in e}function S_(e){return!!e&&typeof e=="object"&&"message"in e&&!Array.isArray(e)}var $_=Object.defineProperty,E_=Object.defineProperties,k_=Object.getOwnPropertyDescriptors,vc=Object.getOwnPropertySymbols,T_=Object.prototype.hasOwnProperty,P_=Object.prototype.propertyIsEnumerable,wc=(e,t,r)=>t in e?$_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bc=(e,t)=>{for(var r in t||(t={}))T_.call(t,r)&&wc(e,r,t[r]);if(vc)for(var r of vc(t))P_.call(t,r)&&wc(e,r,t[r]);return e},Sc=(e,t)=>E_(e,k_(t)),R_=(e,t,r)=>new Promise((n,s)=>{var o=c=>{try{i(r.next(c))}catch(l){s(l)}},a=c=>{try{i(r.throw(c))}catch(l){s(l)}},i=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,a);i((r=r.apply(e,t)).next())});function A_(e){let t,r={};function n(){Object.entries(r).length===0&&(t?.(),t=void 0)}let s=Math.floor(Math.random()*1e4);function o(){return s++}return{sendMessage(a,i,...c){return R_(this,null,function*(){var l,d,S,_;const w={id:o(),type:a,data:i,timestamp:Date.now()},E=(d=yield(l=e.verifyMessageData)==null?void 0:l.call(e,w))!=null?d:w;(S=e.logger)==null||S.debug(`[messaging] sendMessage {id=${E.id}} `,E,...c);const g=yield e.sendMessage(E,...c),{res:f,err:h}=g??{err:new Error("No response")};if((_=e.logger)==null||_.debug(`[messaging] sendMessage {id=${E.id}} `,{res:f,err:h}),h!=null)throw b_(h);return f})},onMessage(a,i){var c,l,d;if(t==null&&((c=e.logger)==null||c.debug(`[messaging] "${a}" initialized the message listener for this context`),t=e.addRootListener(S=>{var _,w;if(typeof S.type!="string"||typeof S.timestamp!="number"){if(e.breakError)return;const f=Error(`[messaging] Unknown message format, must include the 'type' & 'timestamp' fields, received: ${JSON.stringify(S)}`);throw(_=e.logger)==null||_.error(f),f}(w=e?.logger)==null||w.debug("[messaging] Received message",S);const E=r[S.type];if(E==null)return;const g=E(S);return Promise.resolve(g).then(f=>{var h,u;return(u=(h=e.verifyMessageData)==null?void 0:h.call(e,f))!=null?u:f}).then(f=>{var h;return(h=e?.logger)==null||h.debug(`[messaging] onMessage {id=${S.id}} `,{res:f}),{res:f}}).catch(f=>{var h;return(h=e?.logger)==null||h.debug(`[messaging] onMessage {id=${S.id}} `,{err:f}),{err:w_(f)}})})),r[a]!=null){const S=Error(`[messaging] In this JS context, only one listener can be setup for ${a}`);throw(l=e.logger)==null||l.error(S),S}return r[a]=i,(d=e.logger)==null||d.log(`[messaging] Added listener for ${a}`),()=>{delete r[a],n()}},removeAllListeners(){Object.keys(r).forEach(a=>{delete r[a]}),n()}}}var fn={exports:{}},I_=fn.exports,$c;function O_(){return $c||($c=1,(function(e,t){(function(r,n){n(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:I_,function(r){if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const n="The message port closed before a response was received.",s=o=>{const a={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(a).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class i extends WeakMap{constructor(k,I=void 0){super(I),this.createItem=k}get(k){return this.has(k)||this.set(k,this.createItem(k)),super.get(k)}}const c=y=>y&&typeof y=="object"&&typeof y.then=="function",l=(y,k)=>(...I)=>{o.runtime.lastError?y.reject(new Error(o.runtime.lastError.message)):k.singleCallbackArg||I.length<=1&&k.singleCallbackArg!==!1?y.resolve(I[0]):y.resolve(I)},d=y=>y==1?"argument":"arguments",S=(y,k)=>function(z,...D){if(D.length<k.minArgs)throw new Error(`Expected at least ${k.minArgs} ${d(k.minArgs)} for ${y}(), got ${D.length}`);if(D.length>k.maxArgs)throw new Error(`Expected at most ${k.maxArgs} ${d(k.maxArgs)} for ${y}(), got ${D.length}`);return new Promise((M,x)=>{if(k.fallbackToNoCallback)try{z[y](...D,l({resolve:M,reject:x},k))}catch(q){console.warn(`${y} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,q),z[y](...D),k.fallbackToNoCallback=!1,k.noCallback=!0,M()}else k.noCallback?(z[y](...D),M()):z[y](...D,l({resolve:M,reject:x},k))})},_=(y,k,I)=>new Proxy(k,{apply(z,D,M){return I.call(D,y,...M)}});let w=Function.call.bind(Object.prototype.hasOwnProperty);const E=(y,k={},I={})=>{let z=Object.create(null),D={has(x,q){return q in y||q in z},get(x,q,Z){if(q in z)return z[q];if(!(q in y))return;let G=y[q];if(typeof G=="function")if(typeof k[q]=="function")G=_(y,y[q],k[q]);else if(w(I,q)){let ue=S(q,I[q]);G=_(y,y[q],ue)}else G=G.bind(y);else if(typeof G=="object"&&G!==null&&(w(k,q)||w(I,q)))G=E(G,k[q],I[q]);else if(w(I,"*"))G=E(G,k[q],I["*"]);else return Object.defineProperty(z,q,{configurable:!0,enumerable:!0,get(){return y[q]},set(ue){y[q]=ue}}),G;return z[q]=G,G},set(x,q,Z,G){return q in z?z[q]=Z:y[q]=Z,!0},defineProperty(x,q,Z){return Reflect.defineProperty(z,q,Z)},deleteProperty(x,q){return Reflect.deleteProperty(z,q)}},M=Object.create(y);return new Proxy(M,D)},g=y=>({addListener(k,I,...z){k.addListener(y.get(I),...z)},hasListener(k,I){return k.hasListener(y.get(I))},removeListener(k,I){k.removeListener(y.get(I))}}),f=new i(y=>typeof y!="function"?y:function(I){const z=E(I,{},{getContent:{minArgs:0,maxArgs:0}});y(z)}),h=new i(y=>typeof y!="function"?y:function(I,z,D){let M=!1,x,q=new Promise(ie=>{x=function(X){M=!0,ie(X)}}),Z;try{Z=y(I,z,x)}catch(ie){Z=Promise.reject(ie)}const G=Z!==!0&&c(Z);if(Z!==!0&&!G&&!M)return!1;const ue=ie=>{ie.then(X=>{D(X)},X=>{let Se;X&&(X instanceof Error||typeof X.message=="string")?Se=X.message:Se="An unexpected error occurred",D({__mozWebExtensionPolyfillReject__:!0,message:Se})}).catch(X=>{console.error("Failed to send onMessage rejected reply",X)})};return ue(G?Z:q),!0}),u=({reject:y,resolve:k},I)=>{o.runtime.lastError?o.runtime.lastError.message===n?k():y(new Error(o.runtime.lastError.message)):I&&I.__mozWebExtensionPolyfillReject__?y(new Error(I.message)):k(I)},p=(y,k,I,...z)=>{if(z.length<k.minArgs)throw new Error(`Expected at least ${k.minArgs} ${d(k.minArgs)} for ${y}(), got ${z.length}`);if(z.length>k.maxArgs)throw new Error(`Expected at most ${k.maxArgs} ${d(k.maxArgs)} for ${y}(), got ${z.length}`);return new Promise((D,M)=>{const x=u.bind(null,{resolve:D,reject:M});z.push(x),I.sendMessage(...z)})},$={devtools:{network:{onRequestFinished:g(f)}},runtime:{onMessage:g(h),onMessageExternal:g(h),sendMessage:p.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:p.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},m={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return a.privacy={network:{"*":m},services:{"*":m},websites:{"*":m}},E(o,$,a)};r.exports=s(chrome)}else r.exports=globalThis.browser})})(fn)),fn.exports}var C_=O_();const hn=ts(C_);function Ds(e){return A_(Sc(bc({},e),{sendMessage(t,r){if(r==null)return hn.runtime.sendMessage(t);const n=typeof r=="number"?{tabId:r}:r;return hn.tabs.sendMessage(n.tabId,t,n.frameId!=null?{frameId:n.frameId}:void 0)},addRootListener(t){const r=(n,s)=>t(typeof n=="object"?Sc(bc({},n),{sender:s}):n);return hn.runtime.onMessage.addListener(r),()=>hn.runtime.onMessage.removeListener(r)}}))}const{onMessage:Ec}=Ds(),{onMessage:N_}=Ds(),z_=it.defineItem("local:search-actions"),{onMessage:M_}=Ds(),j_=e=>{const[t,r]=e.split(":").map(Number),n=new Date,s=new Date;return s.setHours(t,r,0,0),s.getTime()<=n.getTime()&&s.setDate(s.getDate()+1),s.getTime()},q_=async e=>{const t=`scheduled-job-${e.id}`;let r;if(e.scheduleType==="daily"&&e.scheduleTime)r={when:j_(e.scheduleTime),periodInMinutes:1440};else if(e.scheduleType==="hourly"&&e.scheduleInterval){const n=e.scheduleInterval*60;r={delayInMinutes:n,periodInMinutes:n}}else e.scheduleType==="minutes"&&e.scheduleInterval&&(r={delayInMinutes:e.scheduleInterval,periodInMinutes:e.scheduleInterval});r&&await chrome.alarms.create(t,r)};var Ls={exports:{}},te={};var kc;function x_(){if(kc)return te;kc=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),a=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),S=Symbol.for("react.activity"),_=Symbol.iterator;function w(v){return v===null||typeof v!="object"?null:(v=_&&v[_]||v["@@iterator"],typeof v=="function"?v:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,f={};function h(v,R,A){this.props=v,this.context=R,this.refs=f,this.updater=A||E}h.prototype.isReactComponent={},h.prototype.setState=function(v,R){if(typeof v!="object"&&typeof v!="function"&&v!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,v,R,"setState")},h.prototype.forceUpdate=function(v){this.updater.enqueueForceUpdate(this,v,"forceUpdate")};function u(){}u.prototype=h.prototype;function p(v,R,A){this.props=v,this.context=R,this.refs=f,this.updater=A||E}var $=p.prototype=new u;$.constructor=p,g($,h.prototype),$.isPureReactComponent=!0;var m=Array.isArray;function y(){}var k={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function z(v,R,A){var b=A.ref;return{$$typeof:e,type:v,key:R,ref:b!==void 0?b:null,props:A}}function D(v,R){return z(v.type,R,v.props)}function M(v){return typeof v=="object"&&v!==null&&v.$$typeof===e}function x(v){var R={"=":"=0",":":"=2"};return"$"+v.replace(/[=:]/g,function(A){return R[A]})}var q=/\/+/g;function Z(v,R){return typeof v=="object"&&v!==null&&v.key!=null?x(""+v.key):R.toString(36)}function G(v){switch(v.status){case"fulfilled":return v.value;case"rejected":throw v.reason;default:switch(typeof v.status=="string"?v.then(y,y):(v.status="pending",v.then(function(R){v.status==="pending"&&(v.status="fulfilled",v.value=R)},function(R){v.status==="pending"&&(v.status="rejected",v.reason=R)})),v.status){case"fulfilled":return v.value;case"rejected":throw v.reason}}throw v}function ue(v,R,A,b,T){var N=typeof v;(N==="undefined"||N==="boolean")&&(v=null);var V=!1;if(v===null)V=!0;else switch(N){case"bigint":case"string":case"number":V=!0;break;case"object":switch(v.$$typeof){case e:case t:V=!0;break;case d:return V=v._init,ue(V(v._payload),R,A,b,T)}}if(V)return T=T(v),V=b===""?"."+Z(v,0):b,m(T)?(A="",V!=null&&(A=V.replace(q,"$&/")+"/"),ue(T,R,A,"",function(ae){return ae})):T!=null&&(M(T)&&(T=D(T,A+(T.key==null||v&&v.key===T.key?"":(""+T.key).replace(q,"$&/")+"/")+V)),R.push(T)),1;V=0;var J=b===""?".":b+":";if(m(v))for(var ee=0;ee<v.length;ee++)b=v[ee],N=J+Z(b,ee),V+=ue(b,R,A,N,T);else if(ee=w(v),typeof ee=="function")for(v=ee.call(v),ee=0;!(b=v.next()).done;)b=b.value,N=J+Z(b,ee++),V+=ue(b,R,A,N,T);else if(N==="object"){if(typeof v.then=="function")return ue(G(v),R,A,b,T);throw R=String(v),Error("Objects are not valid as a React child (found: "+(R==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":R)+"). If you meant to render a collection of children, use an array instead.")}return V}function ie(v,R,A){if(v==null)return v;var b=[],T=0;return ue(v,b,"","",function(N){return R.call(A,N,T++)}),b}function X(v){if(v._status===-1){var R=v._result;R=R(),R.then(function(A){(v._status===0||v._status===-1)&&(v._status=1,v._result=A)},function(A){(v._status===0||v._status===-1)&&(v._status=2,v._result=A)}),v._status===-1&&(v._status=0,v._result=R)}if(v._status===1)return v._result.default;throw v._result}var Se=typeof reportError=="function"?reportError:function(v){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var R=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof v=="object"&&v!==null&&typeof v.message=="string"?String(v.message):String(v),error:v});if(!window.dispatchEvent(R))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",v);return}console.error(v)},L={map:ie,forEach:function(v,R,A){ie(v,function(){R.apply(this,arguments)},A)},count:function(v){var R=0;return ie(v,function(){R++}),R},toArray:function(v){return ie(v,function(R){return R})||[]},only:function(v){if(!M(v))throw Error("React.Children.only expected to receive a single React element child.");return v}};return te.Activity=S,te.Children=L,te.Component=h,te.Fragment=r,te.Profiler=s,te.PureComponent=p,te.StrictMode=n,te.Suspense=c,te.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,te.__COMPILER_RUNTIME={__proto__:null,c:function(v){return k.H.useMemoCache(v)}},te.cache=function(v){return function(){return v.apply(null,arguments)}},te.cacheSignal=function(){return null},te.cloneElement=function(v,R,A){if(v==null)throw Error("The argument must be a React element, but you passed "+v+".");var b=g({},v.props),T=v.key;if(R!=null)for(N in R.key!==void 0&&(T=""+R.key),R)!I.call(R,N)||N==="key"||N==="__self"||N==="__source"||N==="ref"&&R.ref===void 0||(b[N]=R[N]);var N=arguments.length-2;if(N===1)b.children=A;else if(1<N){for(var V=Array(N),J=0;J<N;J++)V[J]=arguments[J+2];b.children=V}return z(v.type,T,b)},te.createContext=function(v){return v={$$typeof:a,_currentValue:v,_currentValue2:v,_threadCount:0,Provider:null,Consumer:null},v.Provider=v,v.Consumer={$$typeof:o,_context:v},v},te.createElement=function(v,R,A){var b,T={},N=null;if(R!=null)for(b in R.key!==void 0&&(N=""+R.key),R)I.call(R,b)&&b!=="key"&&b!=="__self"&&b!=="__source"&&(T[b]=R[b]);var V=arguments.length-2;if(V===1)T.children=A;else if(1<V){for(var J=Array(V),ee=0;ee<V;ee++)J[ee]=arguments[ee+2];T.children=J}if(v&&v.defaultProps)for(b in V=v.defaultProps,V)T[b]===void 0&&(T[b]=V[b]);return z(v,N,T)},te.createRef=function(){return{current:null}},te.forwardRef=function(v){return{$$typeof:i,render:v}},te.isValidElement=M,te.lazy=function(v){return{$$typeof:d,_payload:{_status:-1,_result:v},_init:X}},te.memo=function(v,R){return{$$typeof:l,type:v,compare:R===void 0?null:R}},te.startTransition=function(v){var R=k.T,A={};k.T=A;try{var b=v(),T=k.S;T!==null&&T(A,b),typeof b=="object"&&b!==null&&typeof b.then=="function"&&b.then(y,Se)}catch(N){Se(N)}finally{R!==null&&A.types!==null&&(R.types=A.types),k.T=R}},te.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},te.use=function(v){return k.H.use(v)},te.useActionState=function(v,R,A){return k.H.useActionState(v,R,A)},te.useCallback=function(v,R){return k.H.useCallback(v,R)},te.useContext=function(v){return k.H.useContext(v)},te.useDebugValue=function(){},te.useDeferredValue=function(v,R){return k.H.useDeferredValue(v,R)},te.useEffect=function(v,R){return k.H.useEffect(v,R)},te.useEffectEvent=function(v){return k.H.useEffectEvent(v)},te.useId=function(){return k.H.useId()},te.useImperativeHandle=function(v,R,A){return k.H.useImperativeHandle(v,R,A)},te.useInsertionEffect=function(v,R){return k.H.useInsertionEffect(v,R)},te.useLayoutEffect=function(v,R){return k.H.useLayoutEffect(v,R)},te.useMemo=function(v,R){return k.H.useMemo(v,R)},te.useOptimistic=function(v,R){return k.H.useOptimistic(v,R)},te.useReducer=function(v,R,A){return k.H.useReducer(v,R,A)},te.useRef=function(v){return k.H.useRef(v)},te.useState=function(v){return k.H.useState(v)},te.useSyncExternalStore=function(v,R,A){return k.H.useSyncExternalStore(v,R,A)},te.useTransition=function(){return k.H.useTransition()},te.version="19.2.3",te}var Tc;function U_(){return Tc||(Tc=1,Ls.exports=x_()),Ls.exports}U_();const D_=it.defineItem("local:mcpServers",{fallback:[]}),L_=it.defineItem("local:personalization",{fallback:""}),V_="You're running a task that was scheduled for now. There is an external system which manages the schedule, you don't have to worry about it. Just run the task and give the result",Z_=async()=>{const e=await aa.getValue();if(!e?.length)return null;const t=await ia.getValue();return e.find(n=>n.id===t)??e[0]??null};async function F_(e){const t=await $h(),r=await Z_(),n=e.conversationId??crypto.randomUUID(),s=await L_.getValue(),o=await D_.getValue()??[],a=o.filter(d=>d.type==="managed").map(d=>d.managedServerName).filter(d=>!!d),i=o.filter(d=>d.type==="custom"&&!!d.config?.url).map(d=>({name:d.displayName,url:d.config.url})),c=await fetch(`${t}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:e.message}],message:e.message,provider:r?.type,providerType:r?.type,providerName:r?.name,apiKey:r?.apiKey,baseUrl:r?.baseUrl,conversationId:n,model:r?.modelId??"default",mode:e.mode??"agent",contextWindowSize:r?.contextWindow,temperature:r?.temperature,resourceName:r?.resourceName,accessKeyId:r?.accessKeyId,secretAccessKey:r?.secretAccessKey,region:r?.region,sessionToken:r?.sessionToken,browserContext:e.activeTab||e.windowId||a.length||i.length?{windowId:e.windowId,activeTab:e.activeTab,enabledMcpServers:a.length>0?a:void 0,customMcpServers:i.length>0?i:void 0}:void 0,userSystemPrompt:`${s}
${V_}`,isScheduledTask:!0})});if(!c.ok)throw new Error(`Chat request failed: ${c.status} ${c.statusText}`);const l=await K_(c);if(l.error)throw new Error(l.error);return{text:l.fullText,conversationId:n,finalResult:l.finalResult,executionLog:l.executionLog,toolCalls:l.toolCalls}}function H_(e,t){if(e.type==="text-delta"){const r=e.delta;t.fullText+=r,t.currentStepText+=r,t.lastTextBeforeToolCall+=r}else if(e.type==="tool-input-available"){const r={id:e.toolCallId,name:e.toolName,input:e.input,timestamp:new Date().toISOString()};t.toolCallsMap.set(e.toolCallId,r),t.currentStepText.trim()&&(t.executionSteps.push(t.currentStepText.trim()),t.currentStepText="")}else if(e.type==="tool-output-available"){const r=t.toolCallsMap.get(e.toolCallId);r&&(r.output=e.output)}else if(e.type==="tool-output-error"){const r=t.toolCallsMap.get(e.toolCallId);r&&(r.error=e.errorText)}else e.type==="error"?t.error=e.errorText:e.type==="finish"&&(t.receivedFinish=!0)}async function K_(e){if(!e.body)throw new Error("Response body is not readable");const t={fullText:"",currentStepText:"",lastTextBeforeToolCall:"",executionSteps:[],toolCallsMap:new Map,error:null,receivedFinish:!1},r=gc({onEvent(n){if(n.data!=="[DONE]")try{const s=JSON.parse(n.data);H_(s,t)}catch{}}});try{const n=e.body.getReader(),s=new TextDecoder;for(;;){const{done:i,value:c}=await n.read();if(i)break;const l=s.decode(c,{stream:!0});r.feed(l)}!t.receivedFinish&&!t.error&&(t.error="Stream ended unexpectedly without completion. The task may have been interrupted.");const o=t.currentStepText.trim()?t.currentStepText.trim():t.lastTextBeforeToolCall.trim(),a=[...t.executionSteps];return o&&a.push(o),{fullText:t.fullText,finalResult:o,executionLog:a.join(`

`),toolCalls:Array.from(t.toolCallsMap.values()),error:t.error}}catch(n){return{fullText:t.fullText,finalResult:"",executionLog:t.executionSteps.join(`

`),toolCalls:Array.from(t.toolCallsMap.values()),error:n instanceof Error?n.message:String(n||"Unknown error")}}}const pn=it.defineItem("local:scheduledJobs",{fallback:[]}),Pt=it.defineItem("local:scheduledJobRuns",{fallback:[]}),J_=15,B_=600*1e3,W_=async()=>{const e=async()=>{const a=await Pt.getValue()??[],i=Date.now(),c=a.map(l=>{if(l.status!=="running")return l;const d=new Date(l.startedAt).getTime();return i-d>B_?{...l,status:"failed",completedAt:new Date().toISOString(),result:"Job timed out!"}:l});await Pt.setValue(c)},t=async()=>{const a=(await pn.getValue()).filter(i=>i.enabled);for(let i=0;i<a.length;i++){const c=a[i],l=`scheduled-job-${c.id}`;await chrome.alarms.get(l)||await q_(c)}},r=async(a,i)=>{const c={id:crypto.randomUUID(),jobId:a,startedAt:new Date().toISOString(),status:i},l=await Pt.getValue()??[],d=l.filter(_=>_.jobId!==a),S=l.filter(_=>_.jobId===a).sort((_,w)=>new Date(w.startedAt).getTime()-new Date(_.startedAt).getTime()).slice(0,J_-1);return await Pt.setValue([...d,...S,c]),c},n=async(a,i)=>{const c=await Pt.getValue()??[];await Pt.setValue(c.map(l=>l.id===a?{...l,...i}:l))},s=async a=>{const i=await pn.getValue()??[];await pn.setValue(i.map(c=>c.id===a?{...c,lastRunAt:new Date().toISOString()}:c))},o=async a=>{const i=(await pn.getValue()).find(S=>S.id===a);if(!i)throw new Error(`Job not found: ${a}`);const c=await chrome.windows.create({url:"chrome://newtab",focused:!1,state:"minimized",type:"normal"});await new Promise(S=>setTimeout(S,1e3));const l=c?.tabs?.[0];if(!c||!l)throw new Error("Failed to create background window");const d=await r(a,"running");try{const S=await F_({message:i.query,activeTab:l,windowId:c.id});await n(d.id,{status:"completed",completedAt:new Date().toISOString(),result:S.text,finalResult:S.finalResult,executionLog:S.executionLog,toolCalls:S.toolCalls})}catch(S){const _=S instanceof Error?S.message:String(S);await n(d.id,{status:"failed",completedAt:new Date().toISOString(),result:_,error:_})}finally{await s(a),c.id&&await chrome.windows.remove(c.id)}};chrome.alarms.onAlarm.addListener(async a=>{if(!a.name.startsWith("scheduled-job-"))return;const i=a.name.replace("scheduled-job-","");await o(i)}),M_("runScheduledJob",async({data:a})=>{try{return await o(a.jobId),{success:!0}}catch(i){return{success:!1,error:i instanceof Error?i.message:String(i)}}}),chrome.runtime.onStartup.addListener(async()=>{await e(),await t()}),chrome.runtime.onInstalled.addListener(async()=>{await e(),await t()})},G_=Be(()=>{chrome.sidePanel.setOptions({enabled:!1}),_n.initialize().catch(()=>null),Uh(),W_(),chrome.action.onClicked.addListener(async e=>{e.id&&await Rh(e.id)}),N_("open",async e=>{const r=(await chrome.tabs.query({active:!0,currentWindow:!0}))?.[0]?.id;if(r){const{opened:n}=await Ph(r);n&&setTimeout(()=>{z_.setValue(e.data)},500)}}),chrome.runtime.onInstalled.addListener(e=>{e.reason===chrome.runtime.OnInstalledReason.INSTALL&&chrome.tabs.create({url:chrome.runtime.getURL("onboarding.html")})}),Ec("checkHealth",async()=>{try{const e=await Th();return{healthy:(await fetch(e)).ok}}catch{return{healthy:!1}}}),Ec("fetchMcpTools",async()=>{try{const e=await kh();return{tools:await m_(e)}}catch(e){return{tools:[],error:e instanceof Error?e.message:"Failed to fetch tools"}}})});function dy(){}function mn(e,...t){}const Y_={debug:(...e)=>mn(console.debug,...e),log:(...e)=>mn(console.log,...e),warn:(...e)=>mn(console.warn,...e),error:(...e)=>mn(console.error,...e)};let Vs;try{Vs=G_.main(),Vs instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw Y_.error("The background crashed on startup!"),e}return Vs})();
