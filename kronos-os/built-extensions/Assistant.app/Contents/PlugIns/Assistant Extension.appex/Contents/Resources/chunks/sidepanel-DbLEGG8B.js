import{c as pe,j as o,a as L,_ as _t,H as _e,X as xa,r as f,I as Nt,d as at,y as ba,z as Ta,A as Sa,B as Ea,a9 as wa,G as Ia,S as _a,E as Na,L as Ca,aa as ja,ab as Aa,ac as K,ad as b,ae as Ne,af as Ct,ag as ka,ah as ze,ai as O,aj as C,ak as Z,al as ee,am as Ma,an as be,ao as Ra,ap as Pa,aq as R,ar as Da,g as Oa,s as La,a0 as Fa,a1 as $a,a2 as Ba,a4 as za,a5 as Ua,v as Za,a6 as qa,a7 as Va,a8 as Ja}from"./product_logo-D13hEBab.js";import{G as jt,T as Wa,P as Ga,a as Ha,b as Ka,C as Ya,c as Xa,d as Qa,e as er,f as tr,g as ar,F as rr,u as sr,h as nr,i as or}from"./personalizationStorage-DhZ-P_9s.js";import{e as ir,o as Ge,T as lr,p as At,q as kt,r as Mt,G as cr,t as ur,v as Pe,f as dr,B as He,d as pr,x as mr,y as fr,M as hr,E as ce,F as gr,H as vr,I as yr,J as xr,K as br,S as Tr}from"./mermaid-NA5CF7SZ-BLmXvdgo.js";import{R as Sr,S as Er,B as Rt,P as Pt,a as wr,I as Ir,Z as _,u as _r,b as Nr,c as Cr}from"./mcpServerStorage-BmqUzA9I.js";import{M as jr,S as Ar}from"./settings-CYF6iMPY.js";import{Z as kr,p as Mr,A as Rr}from"./productUrls-BKjuSFa3.js";import{L as Pr,m as Ue,A as Dr}from"./proxy-BtKuY_1Q.js";import"./_arrayReduce-Dq31dRPX.js";import"./isArray-wghjNQ3q.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"cef3d2e981a8c76e9e817128ae6fc814ac1270e0"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c5e073e5-282b-4efa-9e46-496f3e87b25b",e._sentryDebugIdIdentifier="sentry-dbid-c5e073e5-282b-4efa-9e46-496f3e87b25b")})()}catch{}const Or=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Lr=pe("brain",Or);const Fr=[["path",{d:"M10.1 2.182a10 10 0 0 1 3.8 0",key:"5ilxe3"}],["path",{d:"M13.9 21.818a10 10 0 0 1-3.8 0",key:"11zvb9"}],["path",{d:"M17.609 3.721a10 10 0 0 1 2.69 2.7",key:"1iw5b2"}],["path",{d:"M2.182 13.9a10 10 0 0 1 0-3.8",key:"c0bmvh"}],["path",{d:"M20.279 17.609a10 10 0 0 1-2.7 2.69",key:"1ruxm7"}],["path",{d:"M21.818 10.1a10 10 0 0 1 0 3.8",key:"qkgqxc"}],["path",{d:"M3.721 6.391a10 10 0 0 1 2.7-2.69",key:"1mcia2"}],["path",{d:"M6.391 20.279a10 10 0 0 1-2.69-2.7",key:"1fvljs"}]],$r=pe("circle-dashed",Fr);const Br=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],zr=pe("github",Br);const Ur=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],Zr=pe("square-stop",Ur);const qr=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],Vr=pe("thumbs-down",qr);const Jr=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],Wr=pe("thumbs-up",Jr),Gr=[{display:"Summarize this page",prompt:"Read the current tab and summarize it in bullet points",icon:"âœ¨"},{display:"What topics does this page talk about?",prompt:"Read the current tab and briefly describe what it is about in 1-2 lines",icon:"ðŸ”"},{display:"Extract comments from this page",prompt:"Read the current tab and extract comments as bullet points",icon:"ðŸ’¬"}],Hr=[{display:"Read about our vision and upvote",prompt:"Go to https://dub.sh/browseros-launch in current tab. Find and click the upvote button",icon:"â¤ï¸"},{display:"Support BrowserOS on Github",prompt:"Go to http://git.new/browseros in current tab and star the repository",icon:"â­"},{display:"Open amazon.com and order Sensodyne toothpaste",prompt:"Open amazon.com in current tab and add sensodyne toothpaste to cart",icon:"ðŸ›’"}],Kr=({mode:e,mounted:t,onSuggestionClick:a})=>{const r=e==="chat"?Gr:Hr;return o.jsxs("div",{className:L("m-0! flex h-full flex-col items-center justify-center space-y-4 text-center opacity-0 transition-all duration-700",t?"translate-y-0 opacity-100":"translate-y-4 opacity-0"),children:[o.jsx("div",{className:"mb-2 flex h-14 w-14 items-center justify-center rounded-2xl bg-muted/50",children:o.jsx(_t,{className:"h-7 w-7 text-[var(--accent-orange)]"})}),o.jsxs("div",{children:[o.jsx("h2",{className:"mb-1 font-semibold text-lg",children:e==="chat"?"Chat with this page":"Agent at your service"}),o.jsx("p",{className:"max-w-[200px] text-muted-foreground text-xs",children:e==="chat"?"Ask questions about the current page or any topic":"Let AI automate tasks and browse for you"})]}),o.jsx("div",{className:"mt-6 grid w-full max-w-[260px] grid-cols-1 gap-2",children:r.map(n=>o.jsxs("button",{type:"button",onClick:()=>a(n.prompt),className:"group flex items-center justify-between rounded-lg border border-border/50 bg-card px-3 py-2.5 text-left text-xs transition-all duration-200 hover:border-[var(--accent-orange)]/50 hover:bg-[var(--accent-orange)]/5",children:[n.display,o.jsx("span",{className:"opacity-0 transition-opacity duration-200 group-hover:opacity-100",children:n.icon})]},n.display))})]})};function Yr(e){if(e.includes("BrowserOS LLM daily limit reached"))return{text:"Add your own API key for unlimited usage.",url:"https://dub.sh/browseros-usage-limit",isRateLimit:!0};let t=e;try{const n=JSON.parse(e);n?.error?.message&&(t=n.error.message)}catch{}const r=t.match(/https?:\/\/[^\s]+/)?.[0];return r&&(t=t.replace(r,"").replace(/\s+/g," ").trim()),{text:t||"An unexpected error occurred",url:r}}const rt=({error:e,onRetry:t})=>{const{text:a,url:r,isRateLimit:n}=Yr(e.message);return o.jsxs("div",{className:"mx-4 flex flex-col items-center justify-center gap-3 rounded-lg border border-destructive/30 bg-destructive/5 p-4",children:[o.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[o.jsx(ir,{className:"h-5 w-5"}),o.jsx("span",{className:"font-medium text-sm",children:n?"Daily limit reached":"Something went wrong"})]}),o.jsx("p",{className:"text-center text-destructive text-xs",children:a}),n&&o.jsxs("p",{className:"text-muted-foreground text-xs",children:[o.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-foreground",children:"Learn more"})," or ",o.jsx("a",{href:"/options.html?page=survey",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-foreground",children:"take a quick survey"})]}),t&&o.jsxs(_e,{variant:"outline",size:"sm",onClick:t,className:"mt-1 gap-2",children:[o.jsx(Sr,{className:"h-3.5 w-3.5"}),"Try again"]})]})},Xr=({tabs:e,onRemoveTab:t})=>e.length===0?null:o.jsx("div",{className:"px-3 pt-2",children:o.jsx("div",{className:"styled-scrollbar flex items-center gap-2 overflow-x-auto pb-1",children:e.map(a=>o.jsxs("div",{className:"flex min-w-0 max-w-[200px] flex-shrink-0 items-center gap-1.5 rounded-lg border border-border bg-accent/50 px-2 py-1.5",children:[o.jsx("div",{className:"flex h-4 w-4 flex-shrink-0 items-center justify-center rounded border border-border bg-background",children:a.favIconUrl?o.jsx("img",{src:a.favIconUrl,alt:"",className:"h-3 w-3"}):o.jsx(jt,{className:"h-3 w-3 text-muted-foreground"})}),o.jsx("div",{className:"flex-1 truncate font-medium text-foreground text-xs",children:a.title}),o.jsx("button",{type:"button",onClick:()=>t(a.id),className:"flex-shrink-0 rounded p-0.5 transition-colors hover:bg-background",title:"Remove tab",children:o.jsx(xa,{className:"h-3 w-3 text-muted-foreground"})})]},a.id))})}),Qr=({input:e,status:t,mode:a,onInputChange:r,onSubmit:n,onStop:l})=>{const u=s=>{s.key==="Enter"&&!s.shiftKey&&!s.metaKey&&!s.ctrlKey&&!s.nativeEvent.isComposing&&(s.preventDefault(),e.trim()&&s.currentTarget.form?.requestSubmit())};return o.jsxs("form",{onSubmit:n,className:"relative mt-2 flex w-full items-end gap-2",children:[o.jsx("textarea",{className:L("field-sizing-content max-h-60 min-h-[42px] flex-1 resize-none overflow-hidden rounded-2xl border border-border/50 bg-muted/50 px-4 py-2.5 pr-11 text-sm outline-none transition-colors placeholder:text-muted-foreground/70 hover:border-border focus:border-[var(--accent-orange)]"),value:e,onChange:s=>r(s.target.value),onKeyDown:u,placeholder:a==="chat"?"Ask about this page...":"What should I do?",rows:1}),t==="streaming"?o.jsxs("button",{type:"button",onClick:l,className:"absolute right-1.5 bottom-1.5 cursor-pointer rounded-full bg-red-600 p-2 text-white shadow-sm transition-all duration-200 hover:bg-red-900 disabled:cursor-not-allowed disabled:opacity-50",children:[o.jsx(Zr,{className:"h-3.5 w-3.5"}),o.jsx("span",{className:"sr-only",children:"Stop"})]}):o.jsxs("button",{type:"submit",disabled:!e.trim(),className:"absolute right-1.5 bottom-1.5 cursor-pointer rounded-full bg-[var(--accent-orange)] p-2 text-white shadow-sm transition-all duration-200 hover:bg-[var(--accent-orange-bright)] disabled:cursor-not-allowed disabled:opacity-50",children:[o.jsx(Er,{className:"h-3.5 w-3.5"}),o.jsx("span",{className:"sr-only",children:"Send"})]})]})},es=({mode:e,onModeChange:t})=>o.jsxs("div",{className:"flex items-center rounded-full border border-border/50 bg-muted p-0.5",children:[o.jsxs("button",{type:"button",onClick:()=>t("chat"),className:L("flex items-center gap-1.5 rounded-full px-2.5 py-1.5 font-medium text-xs transition-all",e==="chat"?"bg-background text-foreground shadow-sm":"text-muted-foreground"),title:"Chat Mode",children:[o.jsx(jr,{className:"h-3 w-3"}),o.jsx("span",{children:"Chat"})]}),o.jsxs("button",{type:"button",onClick:()=>t("agent"),className:L("flex items-center gap-1.5 rounded-full px-2.5 py-1.5 font-medium text-xs transition-all",e==="agent"?"bg-background text-foreground shadow-sm":"text-muted-foreground"),title:"Agent Mode",children:[o.jsx(kr,{className:"h-3 w-3"}),o.jsx("span",{children:"Agent"})]})]}),ts=({mode:e,onModeChange:t,input:a,onInputChange:r,onSubmit:n,status:l,onStop:u,attachedTabs:s,onToggleTab:d,onRemoveTab:i})=>o.jsxs("footer",{className:"border-border/40 border-t bg-background/80 backdrop-blur-md",children:[e==="chat"&&o.jsx(Xr,{tabs:s,onRemoveTab:i}),o.jsxs("div",{className:"p-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(es,{mode:e,onModeChange:t}),e==="chat"&&o.jsx(Wa,{selectedTabs:s,onToggleTab:d,side:"top",children:o.jsxs("button",{type:"button",className:"flex cursor-pointer items-center gap-1.5 rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground data-[state=open]:bg-accent",title:"Select tabs",children:[o.jsx(Pr,{className:"h-4 w-4"}),s.length>0&&o.jsx("span",{className:"font-medium text-[var(--accent-orange)] text-xs",children:s.length}),o.jsx(Ge,{className:"h-3 w-3"})]})})]}),o.jsx(Qr,{input:a,status:l,mode:e,onInputChange:r,onSubmit:n,onStop:u})]})]}),as=({children:e,providers:t,selectedProvider:a,onSelectProvider:r})=>{const[n,l]=f.useState(!1);return o.jsxs(Ga,{open:n,onOpenChange:l,children:[o.jsx(Ha,{asChild:!0,children:e}),o.jsx(Ka,{side:"bottom",align:"start",className:"w-48 p-0",children:o.jsxs(Ya,{children:[o.jsx(Xa,{placeholder:"Search providers...",className:"h-9"}),o.jsxs(Qa,{children:[o.jsx("div",{className:"my-2 px-2 font-semibold text-muted-foreground text-xs uppercase tracking-wide",children:"AI Provider"}),o.jsx(er,{children:"No provider found"}),o.jsx(tr,{children:t.map(u=>{const s=a.id===u.id;return o.jsxs(ar,{value:`${u.id} ${u.name}`,onSelect:()=>{r(u),l(!1)},className:L("flex w-full items-center gap-3 rounded-md p-2 transition-colors",s&&"bg-[var(--accent-orange)]/10"),children:[o.jsx("span",{className:"text-muted-foreground",children:u.type==="browseros"?o.jsx(Rt,{size:18}):o.jsx(Pt,{type:u.type,size:18})}),o.jsx("span",{className:"flex-1 text-left text-sm",children:u.name}),s&&o.jsx(Nt,{className:"h-3.5 w-3.5 text-[var(--accent-orange)]"})]},u.id)})})]})]})})]})},rs=({selectedProvider:e,providers:t,onSelectProvider:a,onNewConversation:r,hasMessages:n})=>o.jsxs("header",{className:"flex items-center justify-between border-border/40 border-b bg-background/80 px-3 py-2.5 backdrop-blur-md",children:[o.jsx("div",{className:"flex items-center gap-2",children:o.jsx(as,{providers:t,selectedProvider:e,onSelectProvider:a,children:o.jsxs("button",{type:"button",className:"group relative inline-flex cursor-pointer items-center gap-2 rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground data-[state=open]:bg-accent",title:"Change AI Provider",children:[e.type==="browseros"?o.jsx(Rt,{size:18}):o.jsx(Pt,{type:e.type,size:18}),o.jsx("span",{className:"font-semibold text-base",children:e.name})]})})}),o.jsxs("div",{className:"flex items-center gap-1",children:[n&&o.jsx("button",{type:"button",onClick:r,className:"cursor-pointer rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground",title:"New conversation",children:o.jsx(wr,{className:"h-4 w-4"})}),o.jsx("a",{href:Mr,target:"_blank",rel:"noopener noreferrer",className:"cursor-pointer rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground",title:"Star on Github",children:o.jsx(zr,{className:"h-4 w-4"})}),o.jsx("a",{href:"/options.html",target:"_blank",rel:"noopener noreferrer",className:"cursor-pointer rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground",title:"Settings",children:o.jsx(Ar,{className:"h-4 w-4"})}),o.jsx(lr,{className:"rounded-lg p-2 text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground",iconClassName:"h-4 w-4"})]})]});const ss={damping:.7,stiffness:.05,mass:1.25},ns=70,os=1e3/60,is=350;let Me=!1;globalThis.document?.addEventListener("mousedown",()=>{Me=!0});globalThis.document?.addEventListener("mouseup",()=>{Me=!1});globalThis.document?.addEventListener("click",()=>{Me=!1});const ls=(e={})=>{const[t,a]=f.useState(!1),[r,n]=f.useState(e.initial!==!1),[l,u]=f.useState(!1),s=f.useRef(null);s.current=e;const d=f.useCallback(()=>{if(!Me)return!1;const g=window.getSelection();if(!g||!g.rangeCount)return!1;const v=g.getRangeAt(0);return v.commonAncestorContainer.contains(h.current)||h.current?.contains(v.commonAncestorContainer)},[]),i=f.useCallback(g=>{c.isAtBottom=g,n(g)},[]),m=f.useCallback(g=>{c.escapedFromLock=g,a(g)},[]),c=f.useMemo(()=>{let g;return{escapedFromLock:t,isAtBottom:r,resizeDifference:0,accumulated:0,velocity:0,listeners:new Set,get scrollTop(){return h.current?.scrollTop??0},set scrollTop(v){h.current&&(h.current.scrollTop=v,c.ignoreScrollToTop=h.current.scrollTop)},get targetScrollTop(){return!h.current||!T.current?0:h.current.scrollHeight-1-h.current.clientHeight},get calculatedTargetScrollTop(){if(!h.current||!T.current)return 0;const{targetScrollTop:v}=this;if(!e.targetScrollTop)return v;if(g?.targetScrollTop===v)return g.calculatedScrollTop;const p=Math.max(Math.min(e.targetScrollTop(v,{scrollElement:h.current,contentElement:T.current}),v),0);return g={targetScrollTop:v,calculatedScrollTop:p},requestAnimationFrame(()=>{g=void 0}),p},get scrollDifference(){return this.calculatedTargetScrollTop-this.scrollTop},get isNearBottom(){return this.scrollDifference<=ns}}},[]),E=f.useCallback((g={})=>{typeof g=="string"&&(g={animation:g}),g.preserveScrollPosition||i(!0);const v=Date.now()+(Number(g.wait)||0),p=Oe(s.current,g.animation),{ignoreEscapes:I=!1}=g;let N,w=c.calculatedTargetScrollTop;g.duration instanceof Promise?g.duration.finally(()=>{N=Date.now()}):N=v+(g.duration??0);const j=async()=>{const D=new Promise(requestAnimationFrame).then(()=>{if(!c.isAtBottom)return c.animation=void 0,!1;const{scrollTop:J}=c,Q=performance.now(),oe=(Q-(c.lastTick??Q))/os;if(c.animation||(c.animation={behavior:p,promise:D,ignoreEscapes:I}),c.animation.behavior===p&&(c.lastTick=Q),d()||v>Date.now())return j();if(J<Math.min(w,c.calculatedTargetScrollTop)){if(c.animation?.behavior===p){if(p==="instant")return c.scrollTop=c.calculatedTargetScrollTop,j();c.velocity=(p.damping*c.velocity+p.stiffness*c.scrollDifference)/p.mass,c.accumulated+=c.velocity*oe,c.scrollTop+=c.accumulated,c.scrollTop!==J&&(c.accumulated=0)}return j()}return N>Date.now()?(w=c.calculatedTargetScrollTop,j()):(c.animation=void 0,c.scrollTop<c.calculatedTargetScrollTop?E({animation:Oe(s.current,s.current.resize),ignoreEscapes:I,duration:Math.max(0,N-Date.now())||void 0}):c.isAtBottom)});return D.then(J=>(requestAnimationFrame(()=>{c.animation||(c.lastTick=void 0,c.velocity=0)}),J))};return g.wait!==!0&&(c.animation=void 0),c.animation?.behavior===p?c.animation.promise:j()},[i,d,c]),x=f.useCallback(()=>{m(!0),i(!1)},[m,i]),S=f.useCallback(({target:g})=>{if(g!==h.current)return;const{scrollTop:v,ignoreScrollToTop:p}=c;let{lastScrollTop:I=v}=c;c.lastScrollTop=v,c.ignoreScrollToTop=void 0,p&&p>v&&(I=p),u(c.isNearBottom),setTimeout(()=>{if(c.resizeDifference||v===p)return;if(d()){m(!0),i(!1);return}const N=v>I,w=v<I;if(c.animation?.ignoreEscapes){c.scrollTop=I;return}w&&(m(!0),i(!1)),N&&m(!1),!c.escapedFromLock&&c.isNearBottom&&i(!0)},1)},[m,i,d,c]),y=f.useCallback(({target:g,deltaY:v})=>{let p=g;for(;!["scroll","auto"].includes(getComputedStyle(p).overflow);){if(!p.parentElement)return;p=p.parentElement}p===h.current&&v<0&&h.current.scrollHeight>h.current.clientHeight&&!c.animation?.ignoreEscapes&&(m(!0),i(!1))},[m,i,c]),h=st(g=>{h.current?.removeEventListener("scroll",S),h.current?.removeEventListener("wheel",y),g?.addEventListener("scroll",S,{passive:!0}),g?.addEventListener("wheel",y,{passive:!0})},[]),T=st(g=>{if(c.resizeObserver?.disconnect(),!g)return;let v;c.resizeObserver=new ResizeObserver(([p])=>{const{height:I}=p.contentRect,N=I-(v??I);if(c.resizeDifference=N,c.scrollTop>c.targetScrollTop&&(c.scrollTop=c.targetScrollTop),u(c.isNearBottom),N>=0){const w=Oe(s.current,v?s.current.resize:s.current.initial);E({animation:w,wait:!0,preserveScrollPosition:!0,duration:w==="instant"?void 0:is})}else c.isNearBottom&&(m(!1),i(!0));v=I,requestAnimationFrame(()=>{setTimeout(()=>{c.resizeDifference===N&&(c.resizeDifference=0)},1)})}),c.resizeObserver?.observe(g)},[]);return{contentRef:T,scrollRef:h,scrollToBottom:E,stopScroll:x,isAtBottom:r||l,isNearBottom:l,escapedFromLock:t,state:c}};function st(e,t){const a=f.useCallback(r=>(a.current=r,e(r)),t);return a}const De=new Map;function Oe(...e){const t={...ss};let a=!1;for(const n of e){if(n==="instant"){a=!0;continue}typeof n=="object"&&(a=!1,t.damping=n.damping??t.damping,t.stiffness=n.stiffness??t.stiffness,t.mass=n.mass??t.mass)}const r=JSON.stringify(t);return De.has(r)||De.set(r,Object.freeze(t)),a?"instant":De.get(r)}const Dt=f.createContext(null),cs=typeof window<"u"?f.useLayoutEffect:f.useEffect;function Ce({instance:e,children:t,resize:a,initial:r,mass:n,damping:l,stiffness:u,targetScrollTop:s,contextRef:d,...i}){const m=f.useRef(null),c=f.useCallback((I,N)=>(p?.targetScrollTop??s)?.(I,N)??I,[s]),E=ls({mass:n,damping:l,stiffness:u,resize:a,initial:r,targetScrollTop:c}),{scrollRef:x,contentRef:S,scrollToBottom:y,stopScroll:h,isAtBottom:T,escapedFromLock:g,state:v}=e??E,p=f.useMemo(()=>({scrollToBottom:y,stopScroll:h,scrollRef:x,isAtBottom:T,escapedFromLock:g,contentRef:S,state:v,get targetScrollTop(){return m.current},set targetScrollTop(I){m.current=I}}),[y,T,S,x,h,g,v]);return f.useImperativeHandle(d,()=>p,[p]),cs(()=>{x.current&&getComputedStyle(x.current).overflow==="visible"&&(x.current.style.overflow="auto")},[]),o.jsx(Dt.Provider,{value:p,children:o.jsx("div",{...i,children:typeof t=="function"?t(p):t})})}(function(e){function t({children:a,...r}){const n=Ot();return o.jsx("div",{ref:n.scrollRef,style:{height:"100%",width:"100%"},children:o.jsx("div",{...r,ref:n.contentRef,children:typeof a=="function"?a(n):a})})}e.Content=t})(Ce||(Ce={}));function Ot(){const e=f.useContext(Dt);if(!e)throw new Error("use-stick-to-bottom component context must be used within a StickToBottom component");return e}const us=({className:e,...t})=>o.jsx(Ce,{className:L("styled-scrollbar relative flex-1 overflow-y-hidden",e),initial:"smooth",resize:"smooth",role:"log",...t}),ds=({className:e,...t})=>o.jsx(Ce.Content,{className:L("flex flex-col gap-8 p-4",e),...t}),ps=({className:e,...t})=>{const{isAtBottom:a,scrollToBottom:r}=Ot(),n=f.useCallback(()=>{r()},[r]);return!a&&o.jsx(_e,{className:L("absolute right-[16px] bottom-4 translate-x-[-50%] rounded-full",e),onClick:n,size:"icon",type:"button",variant:"outline",...t,children:o.jsx(Rr,{className:"size-4"})})},ms=({children:e,as:t="p",className:a,duration:r=2,spread:n=2})=>{const l=Ue.create(t),u=f.useMemo(()=>(e?.length??0)*n,[e,n]);return o.jsx(l,{animate:{backgroundPosition:"0% center"},className:L("relative inline-block bg-[length:250%_100%,auto] bg-clip-text text-transparent","[--bg:linear-gradient(90deg,#0000_calc(50%-var(--spread)),var(--color-background),#0000_calc(50%+var(--spread)))] [background-repeat:no-repeat,padding-box]",a),initial:{backgroundPosition:"100% center"},style:{"--spread":`${u}px`,backgroundImage:"var(--bg), linear-gradient(var(--color-muted-foreground), var(--color-muted-foreground))"},transition:{repeat:Number.POSITIVE_INFINITY,duration:r,ease:"linear"},children:e})},fs=f.memo(ms),Lt=f.createContext(null),hs=()=>{const e=f.useContext(Lt);if(!e)throw new Error("Reasoning components must be used within Reasoning");return e},gs=1e3,vs=1e3,Ft=f.memo(({className:e,isStreaming:t=!1,open:a,defaultOpen:r=!0,onOpenChange:n,duration:l,children:u,...s})=>{const[d,i]=at({prop:a,defaultProp:r,onChange:n}),[m,c]=at({prop:l,defaultProp:void 0}),[E,x]=f.useState(!1),[S,y]=f.useState(null);f.useEffect(()=>{t?S===null&&y(Date.now()):S!==null&&(c(Math.ceil((Date.now()-S)/vs)),y(null))},[t,S,c]),f.useEffect(()=>{if(r&&!t&&d&&!E){const T=setTimeout(()=>{i(!1),x(!0)},gs);return()=>clearTimeout(T)}},[t,d,r,i,E]);const h=T=>{i(T)};return o.jsx(Lt.Provider,{value:{isStreaming:t,isOpen:d,setIsOpen:i,duration:m},children:o.jsx(At,{className:L("not-prose mb-4",e),onOpenChange:h,open:d,...s,children:u})})}),ys=(e,t)=>e||t===0?o.jsx(fs,{duration:1,children:"Thinking..."}):t===void 0?o.jsx("p",{children:"Thought for a few seconds"}):o.jsxs("p",{children:["Thought for ",t," seconds"]}),$t=f.memo(({className:e,children:t,...a})=>{const{isStreaming:r,isOpen:n,duration:l}=hs();return o.jsx(kt,{className:L("flex w-full items-center gap-2 text-muted-foreground text-sm transition-colors hover:text-foreground",e),...a,children:t??o.jsxs(o.Fragment,{children:[o.jsx(Lr,{className:"size-4"}),ys(r,l),o.jsx(Ge,{className:L("size-4 transition-transform",n?"rotate-180":"rotate-0")})]})})}),Bt=f.memo(({className:e,children:t,...a})=>o.jsx(Mt,{className:L("mt-4 text-sm","data-[state=closed]:fade-out-0 data-[state=closed]:slide-out-to-top-2 data-[state=open]:slide-in-from-top-2 text-muted-foreground outline-none data-[state=closed]:animate-out data-[state=open]:animate-in",e),...a,children:o.jsx(cr,{...a,children:t})}));Ft.displayName="Reasoning";$t.displayName="ReasoningTrigger";Bt.displayName="ReasoningContent";const xs=({messageId:e,messageText:t,liked:a,disliked:r,onClickLike:n,onClickDislike:l})=>{const[u,s]=f.useState(!1),[d,i]=f.useState(""),m=a||r,c=()=>{n()},E=()=>{s(!0)},x=()=>{l(d.trim()||void 0),s(!1),i("")},S=()=>{s(!1),i("")};return o.jsxs(ur,{children:[o.jsx(Pe,{onClick:()=>navigator.clipboard.writeText(t),label:"Copy",tooltip:"Copy to clipboard",children:o.jsx(dr,{className:"size-3"})}),o.jsx(Dr,{mode:"wait",initial:!1,children:m?o.jsxs(Ue.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},className:"flex items-center gap-1 text-muted-foreground text-xs",children:[o.jsx(Nt,{className:"size-3"}),o.jsx("span",{children:"Feedback submitted"})]},`${e}-feedback-submitted`):o.jsxs(Ue.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},className:"flex items-center gap-1",children:[o.jsx(Pe,{label:"Like",onClick:c,tooltip:"Like this response",children:o.jsx(Wr,{className:"size-4",fill:a?"currentColor":"none"})}),o.jsx(Pe,{label:"Dislike",onClick:E,tooltip:"Dislike this response",children:o.jsx(Vr,{className:"size-4",fill:r?"currentColor":"none"})})]},`${e}-feedback-actions`)}),o.jsx(ba,{open:u,onOpenChange:s,children:o.jsxs(Ta,{children:[o.jsxs(Sa,{children:[o.jsx(Ea,{children:"What went wrong?"}),o.jsx(wa,{children:"Help us improve by sharing what was wrong with this response."})]}),o.jsx(Ir,{placeholder:"Add a comment (optional)",value:d,onChange:y=>i(y.target.value),onKeyDown:y=>{y.key==="Enter"&&x()}}),o.jsxs(Ia,{children:[o.jsx(_e,{variant:"outline",onClick:S,children:"Cancel"}),o.jsx(_e,{onClick:x,children:"Submit"})]})]})})]})},bs=(e,t,a)=>{const r=[];let n=[],l=0,u=0;const s=()=>{n.length>0&&(r.push({type:"tool-batch",key:`${e.id}-tools-${n[0].toolCallId}`,tools:[...n]}),n=[])};for(let d=0;d<e.parts.length;d++){const i=e.parts[d];if(i.type==="text")s(),r.push({type:"text",key:`${e.id}-text-${l}`,text:i.text}),l++;else if(i.type==="reasoning")s(),r.push({type:"reasoning",key:`${e.id}-reasoning-${u}`,text:i.text,isStreaming:a&&d===e.parts.length-1&&t}),u++;else if(i.type.startsWith("tool-")){const m=i;n.push({state:m.state,toolCallId:m.toolCallId,toolName:m.type?.replace("tool-",""),input:m?.input??{},output:m?.output??[]})}}return s(),r},Ts=({children:e,className:t,...a})=>o.jsx("div",{className:L("text-muted-foreground text-sm",t),...a,children:e}),Ss=({defaultOpen:e=!0,className:t,...a})=>o.jsx(At,{className:L(t),defaultOpen:e,...a}),Es=({children:e,className:t,title:a,TriggerIcon:r=_a,...n})=>o.jsx(kt,{asChild:!0,className:L("group",t),...n,children:e??o.jsxs("div",{className:"flex w-full cursor-pointer items-center gap-2 text-muted-foreground text-sm transition-colors hover:text-foreground",children:[o.jsx(r,{className:"size-4"}),o.jsx("p",{className:"text-sm",children:a}),o.jsx(Ge,{className:"size-4 transition-transform group-data-[state=open]:rotate-180"})]})}),ws=({children:e,className:t,...a})=>o.jsx(Mt,{className:L("data-[state=closed]:fade-out-0 data-[state=closed]:slide-out-to-top-2 data-[state=open]:slide-in-from-top-2 text-popover-foreground outline-none data-[state=closed]:animate-out data-[state=open]:animate-in",t),...a,children:o.jsx("div",{className:"mt-4 space-y-2 border-muted border-l-2 pl-4",children:e})}),Is=({tools:e,isLastBatch:t,isLastMessage:a,isStreaming:r})=>{const n=a&&t&&r,[l,u]=f.useState(n),[s,d]=f.useState(!1);f.useEffect(()=>{a&&!s&&u(t?r:!1)},[r,a,t,s]);const i=e.filter(c=>zt(c.state)).length,m=c=>{d(!0),u(c)};return o.jsxs(Ss,{open:l,onOpenChange:m,children:[o.jsx(Es,{title:`${i}/${e.length} actions completed`,TriggerIcon:He}),o.jsx(ws,{children:e.map(c=>o.jsxs(Ts,{className:"flex items-center gap-2",children:[o.jsx(js,{state:c.state}),o.jsx("span",{children:_s(c.toolName)})]},c.toolCallId))})]})},_s=e=>e?.replace(/_/g," ")?.replace(/([a-z])([A-Z])/g,"$1 $2")?.replace(/^./,t=>t.toUpperCase()),zt=e=>e==="result"||e==="output-available",Ns=e=>e==="call"||e==="input-available",Cs=e=>e==="output-error",js=({state:e})=>zt(e)?o.jsx(Na,{className:"h-3.5 w-3.5 text-green-500"}):Ns(e)?o.jsx(Ca,{className:"h-3.5 w-3.5 animate-spin text-[var(--accent-orange)]"}):Cs(e)?o.jsx(pr,{className:"h-3.5 w-3.5 text-destructive"}):o.jsx($r,{className:"h-3.5 w-3.5 text-muted-foreground"}),Ut=({tabs:e})=>e.length>0&&o.jsx("div",{className:"flex flex-wrap gap-1.5",children:e.map((t,a)=>o.jsxs("div",{className:"flex items-center gap-1.5 rounded-md border border-border/50 bg-accent/50 px-2 py-1",children:[t.favIconUrl?o.jsx("img",{src:t.favIconUrl,alt:t.title,className:"h-3 w-3 object-contain"}):o.jsx(jt,{className:"h-3 w-3 text-muted-foreground"}),o.jsx("span",{className:"max-w-[150px] truncate text-xs",children:t.title})]},t.id||a))}),As=({action:e})=>o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-[var(--accent-orange)]/10",children:o.jsx(rr,{className:"h-4 w-4 text-[var(--accent-orange)]"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium text-foreground text-sm",children:e.name}),e.description&&o.jsx("div",{className:"text-muted-foreground text-xs",children:e.description})]})]}),o.jsx(Ut,{tabs:e.tabs})]}),ks=({action:e})=>{const t=e.mode==="agent";return o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("div",{className:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-lg bg-[var(--accent-orange)]/10",children:t?o.jsx(He,{className:"h-4 w-4 text-[var(--accent-orange)]"}):o.jsx(_t,{className:"h-4 w-4 text-[var(--accent-orange)]"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"mb-0.5 flex items-center gap-1.5",children:o.jsx("span",{className:"rounded bg-[var(--accent-orange)]/10 px-1.5 py-0.5 font-medium text-[10px] text-[var(--accent-orange)] uppercase",children:t?"Agent":"Chat"})}),o.jsx("div",{className:"text-foreground text-sm",children:e.message})]})]}),e.tabs?o.jsx(Ut,{tabs:e.tabs}):null]})},Ms=({action:e})=>{switch(e.type){case"ai-tab":return o.jsx(As,{action:e});case"browseros":return o.jsx(ks,{action:e});default:return null}},Rs=({messages:e,status:t,messagesEndRef:a,getActionForMessage:r,liked:n,disliked:l,onClickLike:u,onClickDislike:s})=>{const d=t==="streaming"||t==="submitted";return o.jsxs(o.Fragment,{children:[o.jsxs(us,{className:"ph-mask",children:[o.jsx(ds,{children:e.map((i,m)=>{const c=r(i),E=m===e.length-1,x=bs(i,E,d),S=x.filter(v=>v.type==="tool-batch"),y=S[S.length-1]?.key,h=x?.filter(v=>v.type==="text")?.map(v=>v.text)?.join(`

`),T=()=>u(i.id),g=v=>s(i.id,v);return o.jsxs(f.Fragment,{children:[o.jsx(mr,{from:i.role,children:o.jsx(fr,{children:c?o.jsx(Ms,{action:c}):x.map(v=>{switch(v.type){case"text":return o.jsx(hr,{children:v.text},v.key);case"reasoning":return o.jsxs(Ft,{className:"w-full",isStreaming:v.isStreaming,children:[o.jsx($t,{}),o.jsx(Bt,{children:v.text})]},v.key);case"tool-batch":return o.jsx(Is,{tools:v.tools,isLastBatch:v.key===y,isLastMessage:E,isStreaming:d},v.key);default:return null}})})}),i.role==="assistant"&&(!E||!d)?o.jsx(xs,{messageId:i.id,messageText:h,liked:n[i.id]??!1,disliked:l[i.id]??!1,onClickLike:T,onClickDislike:g}):null]},i.id)})}),o.jsx(ps,{})]}),d&&o.jsxs("div",{className:"flex animate-fadeInUp gap-2 px-3",children:[o.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-[var(--accent-orange)] text-white",children:o.jsx(He,{className:"h-3.5 w-3.5"})}),o.jsxs("div",{className:"flex items-center gap-1 rounded-xl rounded-tl-none border border-border/50 bg-card px-3 py-2.5 shadow-sm",children:[o.jsx("span",{className:"h-1.5 w-1.5 animate-bounce rounded-full bg-[var(--accent-orange)] [animation-delay:-0.3s]"}),o.jsx("span",{className:"h-1.5 w-1.5 animate-bounce rounded-full bg-[var(--accent-orange)] [animation-delay:-0.15s]"}),o.jsx("span",{className:"h-1.5 w-1.5 animate-bounce rounded-full bg-[var(--accent-orange)]"})]})]}),o.jsx("div",{ref:a})]})};var Zt="vercel.ai.error",Ps=Symbol.for(Zt),qt,Ds=class Vt extends Error{constructor({name:t,message:a,cause:r}){super(a),this[qt]=!0,this.name=t,this.cause=r}static isInstance(t){return Vt.hasMarker(t,Zt)}static hasMarker(t,a){const r=Symbol.for(a);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}};qt=Ps;var ae=Ds;function Jt(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Wt="AI_InvalidArgumentError",Gt=`vercel.ai.error.${Wt}`,Os=Symbol.for(Gt),Ht,Ls=class extends ae{constructor({message:e,cause:t,argument:a}){super({name:Wt,message:e,cause:t}),this[Ht]=!0,this.argument=a}static isInstance(e){return ae.hasMarker(e,Gt)}};Ht=Os;var Kt="AI_JSONParseError",Yt=`vercel.ai.error.${Kt}`,Fs=Symbol.for(Yt),Xt,nt=class extends ae{constructor({text:e,cause:t}){super({name:Kt,message:`JSON parsing failed: Text: ${e}.
Error message: ${Jt(t)}`,cause:t}),this[Xt]=!0,this.text=e}static isInstance(e){return ae.hasMarker(e,Yt)}};Xt=Fs;var Qt="AI_TypeValidationError",ea=`vercel.ai.error.${Qt}`,$s=Symbol.for(ea),ta,Bs=class Ze extends ae{constructor({value:t,cause:a}){super({name:Qt,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Jt(a)}`,cause:a}),this[ta]=!0,this.value=t}static isInstance(t){return ae.hasMarker(t,ea)}static wrap({value:t,cause:a}){return Ze.isInstance(a)&&a.value===t?a:new Ze({value:t,cause:a})}};ta=$s;var je=Bs;class ot extends Error{constructor(t,a){super(t),this.name="ParseError",this.type=a.type,this.field=a.field,this.value=a.value,this.line=a.line}}function Le(e){}function zs(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=Le,onError:a=Le,onRetry:r=Le,onComment:n}=e;let l="",u=!0,s,d="",i="";function m(y){const h=u?y.replace(/^\xEF\xBB\xBF/,""):y,[T,g]=Us(`${l}${h}`);for(const v of T)c(v);l=g,u=!1}function c(y){if(y===""){x();return}if(y.startsWith(":")){n&&n(y.slice(y.startsWith(": ")?2:1));return}const h=y.indexOf(":");if(h!==-1){const T=y.slice(0,h),g=y[h+1]===" "?2:1,v=y.slice(h+g);E(T,v,y);return}E(y,"",y)}function E(y,h,T){switch(y){case"event":i=h;break;case"data":d=`${d}${h}
`;break;case"id":s=h.includes("\0")?void 0:h;break;case"retry":/^\d+$/.test(h)?r(parseInt(h,10)):a(new ot(`Invalid \`retry\` value: "${h}"`,{type:"invalid-retry",value:h,line:T}));break;default:a(new ot(`Unknown field "${y.length>20?`${y.slice(0,20)}â€¦`:y}"`,{type:"unknown-field",field:y,value:h,line:T}));break}}function x(){d.length>0&&t({id:s,event:i||void 0,data:d.endsWith(`
`)?d.slice(0,-1):d}),s=void 0,d="",i=""}function S(y={}){l&&y.consume&&c(l),u=!0,s=void 0,d="",i="",l=""}return{feed:m,reset:S}}function Us(e){const t=[];let a="",r=0;for(;r<e.length;){const n=e.indexOf("\r",r),l=e.indexOf(`
`,r);let u=-1;if(n!==-1&&l!==-1?u=Math.min(n,l):n!==-1?n===e.length-1?u=-1:u=n:l!==-1&&(u=l),u===-1){a=e.slice(r);break}else{const s=e.slice(r,u);t.push(s),r=u+1,e[r-1]==="\r"&&e[r]===`
`&&r++}}return[t,a]}class Zs extends TransformStream{constructor({onError:t,onRetry:a,onComment:r}={}){let n;super({start(l){n=zs({onEvent:u=>{l.enqueue(u)},onError(u){t==="terminate"?l.error(u):typeof t=="function"&&t(u)},onRetry:a,onComment:r})},transform(l){n.feed(l)}})}}var Te=({prefix:e,size:t=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const n=()=>{const l=a.length,u=new Array(t);for(let s=0;s<t;s++)u[s]=a[Math.random()*l|0];return u.join("")};if(e==null)return n;if(a.includes(r))throw new Ls({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${e}${r}${n()}`},qs=Te();function it(e=globalThis){var t,a,r;return e.window?"runtime/browser":(t=e.navigator)!=null&&t.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:(r=(a=e.process)==null?void 0:a.versions)!=null&&r.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function ne(e){if(e==null)return{};const t={};if(e instanceof Headers)e.forEach((a,r)=>{t[r.toLowerCase()]=a});else{Array.isArray(e)||(e=Object.entries(e));for(const[a,r]of e)r!=null&&(t[a.toLowerCase()]=r)}return t}function lt(e,...t){const a=new Headers(ne(e)),r=a.get("user-agent")||"";return a.set("user-agent",[r,...t].filter(Boolean).join(" ")),Object.fromEntries(a.entries())}var Vs=/"__proto__"\s*:/,Js=/"constructor"\s*:/;function ct(e){const t=JSON.parse(e);return t===null||typeof t!="object"||Vs.test(e)===!1&&Js.test(e)===!1?t:Ws(t)}function Ws(e){let t=[e];for(;t.length;){const a=t;t=[];for(const r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const n in r){const l=r[n];l&&typeof l=="object"&&t.push(l)}}}return e}function Gs(e){const{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch{return ct(e)}try{return ct(e)}finally{Error.stackTraceLimit=t}}var Ae=Symbol.for("vercel.ai.validator");function Hs(e){return{[Ae]:!0,validate:e}}function Ks(e){return typeof e=="object"&&e!==null&&Ae in e&&e[Ae]===!0&&"validate"in e}function Ys(e){let t;return()=>(t==null&&(t=e()),t)}function Xs(e){return Ks(e)?e:typeof e=="function"?e():Qs(e)}function Qs(e){return Hs(async t=>{const a=await e["~standard"].validate(t);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new je({value:t,cause:a.issues})}})}async function ut({value:e,schema:t}){const a=await Ke({value:e,schema:t});if(!a.success)throw je.wrap({value:e,cause:a.error});return a.value}async function Ke({value:e,schema:t}){const a=Xs(t);try{if(a.validate==null)return{success:!0,value:e,rawValue:e};const r=await a.validate(e);return r.success?{success:!0,value:r.value,rawValue:e}:{success:!1,error:je.wrap({value:e,cause:r.error}),rawValue:e}}catch(r){return{success:!1,error:je.wrap({value:e,cause:r}),rawValue:e}}}async function ke({text:e,schema:t}){try{const a=Gs(e);return t==null?{success:!0,value:a,rawValue:a}:await Ke({value:a,schema:t})}catch(a){return{success:!1,error:nt.isInstance(a)?a:new nt({text:e,cause:a}),rawValue:void 0}}}function en({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new Zs).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await ke({text:a,schema:t}))}}))}async function le(e){return typeof e=="function"&&(e=e()),Promise.resolve(e)}function Se(e){if(e.type==="object"){e.additionalProperties=!1;const t=e.properties;if(t!=null)for(const a in t)t[a]=Se(t[a])}return e.type==="array"&&e.items!=null&&(Array.isArray(e.items)?e.items=e.items.map(t=>Se(t)):e.items=Se(e.items)),e}var tn=(e,t)=>{let a=0;for(;a<e.length&&a<t.length&&e[a]===t[a];a++);return[(e.length-a).toString(),...t.slice(a)].join("/")},an=Symbol("Let zodToJsonSchema decide on which parser to use"),dt={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},rn=e=>typeof e=="string"?{...dt,name:e}:{...dt,...e};function V(){return{}}function sn(e,t){var a,r,n;const l={type:"array"};return(a=e.type)!=null&&a._def&&((n=(r=e.type)==null?void 0:r._def)==null?void 0:n.typeName)!==_.ZodAny&&(l.items=k(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(l.minItems=e.minLength.value),e.maxLength&&(l.maxItems=e.maxLength.value),e.exactLength&&(l.minItems=e.exactLength.value,l.maxItems=e.exactLength.value),l}function nn(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const a of e.checks)switch(a.kind){case"min":a.inclusive?t.minimum=a.value:t.exclusiveMinimum=a.value;break;case"max":a.inclusive?t.maximum=a.value:t.exclusiveMaximum=a.value;break;case"multipleOf":t.multipleOf=a.value;break}return t}function on(){return{type:"boolean"}}function aa(e,t){return k(e.type._def,t)}var ln=(e,t)=>k(e.innerType._def,t);function ra(e,t,a){const r=a??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((n,l)=>ra(e,t,n))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return cn(e)}}var cn=e=>{const t={type:"integer",format:"unix-time"};for(const a of e.checks)switch(a.kind){case"min":t.minimum=a.value;break;case"max":t.maximum=a.value;break}return t};function un(e,t){return{...k(e.innerType._def,t),default:e.defaultValue()}}function dn(e,t){return t.effectStrategy==="input"?k(e.schema._def,t):V()}function pn(e){return{type:"string",enum:Array.from(e.values)}}var mn=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function fn(e,t){const a=[k(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),k(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(n=>!!n),r=[];return a.forEach(n=>{if(mn(n))r.push(...n.allOf);else{let l=n;if("additionalProperties"in n&&n.additionalProperties===!1){const{additionalProperties:u,...s}=n;l=s}r.push(l)}}),r.length?{allOf:r}:void 0}function hn(e){const t=typeof e.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(e.value)?"array":"object"}:{type:t==="bigint"?"integer":t,const:e.value}}var Fe=void 0,G={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Fe===void 0&&(Fe=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Fe),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function sa(e,t){const a={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(t.emailStrategy){case"format:email":H(a,"email",r.message,t);break;case"format:idn-email":H(a,"idn-email",r.message,t);break;case"pattern:zod":U(a,G.email,r.message,t);break}break;case"url":H(a,"uri",r.message,t);break;case"uuid":H(a,"uuid",r.message,t);break;case"regex":U(a,r.regex,r.message,t);break;case"cuid":U(a,G.cuid,r.message,t);break;case"cuid2":U(a,G.cuid2,r.message,t);break;case"startsWith":U(a,RegExp(`^${$e(r.value,t)}`),r.message,t);break;case"endsWith":U(a,RegExp(`${$e(r.value,t)}$`),r.message,t);break;case"datetime":H(a,"date-time",r.message,t);break;case"date":H(a,"date",r.message,t);break;case"time":H(a,"time",r.message,t);break;case"duration":H(a,"duration",r.message,t);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":{U(a,RegExp($e(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&H(a,"ipv4",r.message,t),r.version!=="v4"&&H(a,"ipv6",r.message,t);break}case"base64url":U(a,G.base64url,r.message,t);break;case"jwt":U(a,G.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&U(a,G.ipv4Cidr,r.message,t),r.version!=="v4"&&U(a,G.ipv6Cidr,r.message,t);break}case"emoji":U(a,G.emoji(),r.message,t);break;case"ulid":{U(a,G.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{H(a,"binary",r.message,t);break}case"contentEncoding:base64":{a.contentEncoding="base64";break}case"pattern:zod":{U(a,G.base64,r.message,t);break}}break}case"nanoid":U(a,G.nanoid,r.message,t)}return a}function $e(e,t){return t.patternStrategy==="escape"?vn(e):e}var gn=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function vn(e){let t="";for(let a=0;a<e.length;a++)gn.has(e[a])||(t+="\\"),t+=e[a];return t}function H(e,t,a,r){var n;e.format||(n=e.anyOf)!=null&&n.some(l=>l.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...a&&r.errorMessages&&{errorMessage:{format:a}}})):e.format=t}function U(e,t,a,r){var n;e.pattern||(n=e.allOf)!=null&&n.some(l=>l.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:pt(t,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):e.pattern=pt(t,r)}function pt(e,t){var a;if(!t.applyRegexFlags||!e.flags)return e.source;const r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},n=r.i?e.source.toLowerCase():e.source;let l="",u=!1,s=!1,d=!1;for(let i=0;i<n.length;i++){if(u){l+=n[i],u=!1;continue}if(r.i){if(s){if(n[i].match(/[a-z]/)){d?(l+=n[i],l+=`${n[i-2]}-${n[i]}`.toUpperCase(),d=!1):n[i+1]==="-"&&((a=n[i+2])!=null&&a.match(/[a-z]/))?(l+=n[i],d=!0):l+=`${n[i]}${n[i].toUpperCase()}`;continue}}else if(n[i].match(/[a-z]/)){l+=`[${n[i]}${n[i].toUpperCase()}]`;continue}}if(r.m){if(n[i]==="^"){l+=`(^|(?<=[\r
]))`;continue}else if(n[i]==="$"){l+=`($|(?=[\r
]))`;continue}}if(r.s&&n[i]==="."){l+=s?`${n[i]}\r
`:`[${n[i]}\r
]`;continue}l+=n[i],n[i]==="\\"?u=!0:s&&n[i]==="]"?s=!1:!s&&n[i]==="["&&(s=!0)}try{new RegExp(l)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return l}function na(e,t){var a,r,n,l,u,s;const d={type:"object",additionalProperties:(a=k(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))!=null?a:t.allowedAdditionalProperties};if(((r=e.keyType)==null?void 0:r._def.typeName)===_.ZodString&&((n=e.keyType._def.checks)!=null&&n.length)){const{type:i,...m}=sa(e.keyType._def,t);return{...d,propertyNames:m}}else{if(((l=e.keyType)==null?void 0:l._def.typeName)===_.ZodEnum)return{...d,propertyNames:{enum:e.keyType._def.values}};if(((u=e.keyType)==null?void 0:u._def.typeName)===_.ZodBranded&&e.keyType._def.type._def.typeName===_.ZodString&&((s=e.keyType._def.type._def.checks)!=null&&s.length)){const{type:i,...m}=aa(e.keyType._def,t);return{...d,propertyNames:m}}}return d}function yn(e,t){if(t.mapStrategy==="record")return na(e,t);const a=k(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||V(),r=k(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||V();return{type:"array",maxItems:125,items:{type:"array",items:[a,r],minItems:2,maxItems:2}}}function xn(e){const t=e.values,r=Object.keys(e.values).filter(l=>typeof t[t[l]]!="number").map(l=>t[l]),n=Array.from(new Set(r.map(l=>typeof l)));return{type:n.length===1?n[0]==="string"?"string":"number":["string","number"],enum:r}}function bn(){return{not:V()}}function Tn(){return{type:"null"}}var qe={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Sn(e,t){const a=e.options instanceof Map?Array.from(e.options.values()):e.options;if(a.every(r=>r._def.typeName in qe&&(!r._def.checks||!r._def.checks.length))){const r=a.reduce((n,l)=>{const u=qe[l._def.typeName];return u&&!n.includes(u)?[...n,u]:n},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=a.reduce((n,l)=>{const u=typeof l._def.value;switch(u){case"string":case"number":case"boolean":return[...n,u];case"bigint":return[...n,"integer"];case"object":if(l._def.value===null)return[...n,"null"];default:return n}},[]);if(r.length===a.length){const n=r.filter((l,u,s)=>s.indexOf(l)===u);return{type:n.length>1?n:n[0],enum:a.reduce((l,u)=>l.includes(u._def.value)?l:[...l,u._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,n)=>[...r,...n._def.values.filter(l=>!r.includes(l))],[])};return En(e,t)}var En=(e,t)=>{const a=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,n)=>k(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function wn(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[qe[e.innerType._def.typeName],"null"]};const a=k(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function In(e){const t={type:"number"};if(!e.checks)return t;for(const a of e.checks)switch(a.kind){case"int":t.type="integer";break;case"min":a.inclusive?t.minimum=a.value:t.exclusiveMinimum=a.value;break;case"max":a.inclusive?t.maximum=a.value:t.exclusiveMaximum=a.value;break;case"multipleOf":t.multipleOf=a.value;break}return t}function _n(e,t){const a={type:"object",properties:{}},r=[],n=e.shape();for(const u in n){let s=n[u];if(s===void 0||s._def===void 0)continue;const d=Cn(s),i=k(s._def,{...t,currentPath:[...t.currentPath,"properties",u],propertyPath:[...t.currentPath,"properties",u]});i!==void 0&&(a.properties[u]=i,d||r.push(u))}r.length&&(a.required=r);const l=Nn(e,t);return l!==void 0&&(a.additionalProperties=l),a}function Nn(e,t){if(e.catchall._def.typeName!=="ZodNever")return k(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function Cn(e){try{return e.isOptional()}catch{return!0}}var jn=(e,t)=>{var a;if(t.currentPath.toString()===((a=t.propertyPath)==null?void 0:a.toString()))return k(e.innerType._def,t);const r=k(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:V()},r]}:V()},An=(e,t)=>{if(t.pipeStrategy==="input")return k(e.in._def,t);if(t.pipeStrategy==="output")return k(e.out._def,t);const a=k(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=k(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",a?"1":"0"]});return{allOf:[a,r].filter(n=>n!==void 0)}};function kn(e,t){return k(e.type._def,t)}function Mn(e,t){const r={type:"array",uniqueItems:!0,items:k(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(r.minItems=e.minSize.value),e.maxSize&&(r.maxItems=e.maxSize.value),r}function Rn(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((a,r)=>k(a._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:k(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((a,r)=>k(a._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function Pn(){return{not:V()}}function Dn(){return V()}var On=(e,t)=>k(e.innerType._def,t),Ln=(e,t,a)=>{switch(t){case _.ZodString:return sa(e,a);case _.ZodNumber:return In(e);case _.ZodObject:return _n(e,a);case _.ZodBigInt:return nn(e);case _.ZodBoolean:return on();case _.ZodDate:return ra(e,a);case _.ZodUndefined:return Pn();case _.ZodNull:return Tn();case _.ZodArray:return sn(e,a);case _.ZodUnion:case _.ZodDiscriminatedUnion:return Sn(e,a);case _.ZodIntersection:return fn(e,a);case _.ZodTuple:return Rn(e,a);case _.ZodRecord:return na(e,a);case _.ZodLiteral:return hn(e);case _.ZodEnum:return pn(e);case _.ZodNativeEnum:return xn(e);case _.ZodNullable:return wn(e,a);case _.ZodOptional:return jn(e,a);case _.ZodMap:return yn(e,a);case _.ZodSet:return Mn(e,a);case _.ZodLazy:return()=>e.getter()._def;case _.ZodPromise:return kn(e,a);case _.ZodNaN:case _.ZodNever:return bn();case _.ZodEffects:return dn(e,a);case _.ZodAny:return V();case _.ZodUnknown:return Dn();case _.ZodDefault:return un(e,a);case _.ZodBranded:return aa(e,a);case _.ZodReadonly:return On(e,a);case _.ZodCatch:return ln(e,a);case _.ZodPipeline:return An(e,a);case _.ZodFunction:case _.ZodVoid:case _.ZodSymbol:return;default:return(r=>{})()}};function k(e,t,a=!1){var r;const n=t.seen.get(e);if(t.override){const d=(r=t.override)==null?void 0:r.call(t,e,t,n,a);if(d!==an)return d}if(n&&!a){const d=Fn(n,t);if(d!==void 0)return d}const l={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,l);const u=Ln(e,e.typeName,t),s=typeof u=="function"?k(u(),t):u;if(s&&$n(e,t,s),t.postProcess){const d=t.postProcess(s,e,t);return l.jsonSchema=s,d}return l.jsonSchema=s,s}var Fn=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:tn(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((a,r)=>t.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),V()):t.$refStrategy==="seen"?V():void 0}},$n=(e,t,a)=>(e.description&&(a.description=e.description),a),Bn=e=>{const t=rn(e),a=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}},zn=(e,t)=>{var a;const r=Bn(t);let n=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((i,[m,c])=>{var E;return{...i,[m]:(E=k(c._def,{...r,currentPath:[...r.basePath,r.definitionPath,m]},!0))!=null?E:V()}},{}):void 0;const l=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,u=(a=k(e._def,l===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,l]},!1))!=null?a:V(),s=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;s!==void 0&&(u.title=s);const d=l===void 0?n?{...u,[r.definitionPath]:n}:u:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,l].join("/"),[r.definitionPath]:{...n,[l]:u}};return d.$schema="http://json-schema.org/draft-07/schema#",d},Un=zn;function Zn(e,t){var a;const r=(a=void 0)!=null?a:!1;return Ye(()=>Un(e,{$refStrategy:r?"root":"none"}),{validate:async n=>{const l=await e.safeParseAsync(n);return l.success?{success:!0,value:l.data}:{success:!1,error:l.error}}})}function qn(e,t){var a;const r=(a=void 0)!=null?a:!1;return Ye(()=>Se(Aa(e,{target:"draft-7",io:"input",reused:r?"ref":"inline"})),{validate:async n=>{const l=await ja(e,n);return l.success?{success:!0,value:l.data}:{success:!1,error:l.error}}})}function Vn(e){return"_zod"in e}function oa(e,t){return Vn(e)?qn(e):Zn(e)}var Ve=Symbol.for("vercel.ai.schema");function Ye(e,{validate:t}={}){return{[Ve]:!0,_type:void 0,[Ae]:!0,get jsonSchema(){return typeof e=="function"&&(e=e()),e},validate:t}}function Jn(e){return typeof e=="object"&&e!==null&&Ve in e&&e[Ve]===!0&&"jsonSchema"in e&&"validate"in e}function Wn(e){return e==null?Ye({properties:{},additionalProperties:!1}):Jn(e)?e:typeof e=="function"?e():oa(e)}var Gn=Object.defineProperty,Hn=(e,t)=>{for(var a in t)Gn(e,a,{get:t[a],enumerable:!0})},ia="AI_NoObjectGeneratedError",la=`vercel.ai.error.${ia}`,Kn=Symbol.for(la),ca,mt=class extends ae{constructor({message:e="No object generated.",cause:t,text:a,response:r,usage:n,finishReason:l}){super({name:ia,message:e,cause:t}),this[ca]=!0,this.text=a,this.response=r,this.usage=n,this.finishReason=l}static isInstance(e){return ae.hasMarker(e,la)}};ca=Kn;var ft="5.0.116",ua=K([b(),Ne(Uint8Array),Ne(ArrayBuffer),Ct(e=>{var t,a;return(a=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?a:!1},{message:"Must be a Buffer"})]),xe=ka(()=>K([Ra(),b(),Pa(),Z(),ze(b(),xe),be(xe)])),P=ze(b(),ze(b(),xe)),da=O({type:C("text"),text:b(),providerOptions:P.optional()}),Yn=O({type:C("image"),image:K([ua,Ne(URL)]),mediaType:b().optional(),providerOptions:P.optional()}),pa=O({type:C("file"),data:K([ua,Ne(URL)]),filename:b().optional(),mediaType:b(),providerOptions:P.optional()}),Xn=O({type:C("reasoning"),text:b(),providerOptions:P.optional()}),Qn=O({type:C("tool-call"),toolCallId:b(),toolName:b(),input:ee(),providerOptions:P.optional(),providerExecuted:Z().optional()}),eo=Ma("type",[O({type:C("text"),value:b()}),O({type:C("json"),value:xe}),O({type:C("error-text"),value:b()}),O({type:C("error-json"),value:xe}),O({type:C("content"),value:be(K([O({type:C("text"),text:b()}),O({type:C("media"),data:b(),mediaType:b()})]))})]),ma=O({type:C("tool-result"),toolCallId:b(),toolName:b(),output:eo,providerOptions:P.optional()}),to=O({role:C("system"),content:b(),providerOptions:P.optional()}),ao=O({role:C("user"),content:K([b(),be(K([da,Yn,pa]))]),providerOptions:P.optional()}),ro=O({role:C("assistant"),content:K([b(),be(K([da,pa,Xn,Qn,ma]))]),providerOptions:P.optional()}),so=O({role:C("tool"),content:be(ma),providerOptions:P.optional()});K([to,ao,ro,so]);Te({prefix:"aitxt",size:24});(class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue(`data: [DONE]

`)}})}});var no=Ys(()=>oa(K([R({type:C("text-start"),id:b(),providerMetadata:P.optional()}),R({type:C("text-delta"),id:b(),delta:b(),providerMetadata:P.optional()}),R({type:C("text-end"),id:b(),providerMetadata:P.optional()}),R({type:C("error"),errorText:b()}),R({type:C("tool-input-start"),toolCallId:b(),toolName:b(),providerExecuted:Z().optional(),dynamic:Z().optional()}),R({type:C("tool-input-delta"),toolCallId:b(),inputTextDelta:b()}),R({type:C("tool-input-available"),toolCallId:b(),toolName:b(),input:ee(),providerExecuted:Z().optional(),providerMetadata:P.optional(),dynamic:Z().optional()}),R({type:C("tool-input-error"),toolCallId:b(),toolName:b(),input:ee(),providerExecuted:Z().optional(),providerMetadata:P.optional(),dynamic:Z().optional(),errorText:b()}),R({type:C("tool-output-available"),toolCallId:b(),output:ee(),providerExecuted:Z().optional(),dynamic:Z().optional(),preliminary:Z().optional()}),R({type:C("tool-output-error"),toolCallId:b(),errorText:b(),providerExecuted:Z().optional(),dynamic:Z().optional()}),R({type:C("reasoning-start"),id:b(),providerMetadata:P.optional()}),R({type:C("reasoning-delta"),id:b(),delta:b(),providerMetadata:P.optional()}),R({type:C("reasoning-end"),id:b(),providerMetadata:P.optional()}),R({type:C("source-url"),sourceId:b(),url:b(),title:b().optional(),providerMetadata:P.optional()}),R({type:C("source-document"),sourceId:b(),mediaType:b(),title:b(),filename:b().optional(),providerMetadata:P.optional()}),R({type:C("file"),url:b(),mediaType:b(),providerMetadata:P.optional()}),R({type:Ct(e=>typeof e=="string"&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:b().optional(),data:ee(),transient:Z().optional()}),R({type:C("start-step")}),R({type:C("finish-step")}),R({type:C("start"),messageId:b().optional(),messageMetadata:ee().optional()}),R({type:C("finish"),finishReason:Da(["stop","length","content-filter","tool-calls","error","other","unknown"]).optional(),messageMetadata:ee().optional()}),R({type:C("abort")}),R({type:C("message-metadata"),messageMetadata:ee()})])));function oo(e){return e.type.startsWith("data-")}function fa(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;const a={...e};for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const n=t[r];if(n===void 0)continue;const l=r in e?e[r]:void 0,u=n!==null&&typeof n=="object"&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp),s=l!=null&&typeof l=="object"&&!Array.isArray(l)&&!(l instanceof Date)&&!(l instanceof RegExp);u&&s?a[r]=fa(l,n):a[r]=n}return a}function io(e){const t=["ROOT"];let a=-1,r=null;function n(d,i,m){switch(d){case'"':{a=i,t.pop(),t.push(m),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{a=i,r=i,t.pop(),t.push(m),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(m),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{a=i,t.pop(),t.push(m),t.push("INSIDE_NUMBER");break}case"{":{a=i,t.pop(),t.push(m),t.push("INSIDE_OBJECT_START");break}case"[":{a=i,t.pop(),t.push(m),t.push("INSIDE_ARRAY_START");break}}}function l(d,i){switch(d){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{a=i,t.pop();break}}}function u(d,i){switch(d){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{a=i,t.pop();break}}}for(let d=0;d<e.length;d++){const i=e[d];switch(t[t.length-1]){case"ROOT":n(i,d,"FINISH");break;case"INSIDE_OBJECT_START":{switch(i){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{a=d,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{i==='"'&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break}case"INSIDE_OBJECT_KEY":{i==='"'&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break}case"INSIDE_OBJECT_AFTER_KEY":{i===":"&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break}case"INSIDE_OBJECT_BEFORE_VALUE":{n(i,d,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{l(i,d);break}case"INSIDE_STRING":{switch(i){case'"':{t.pop(),a=d;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:a=d}break}case"INSIDE_ARRAY_START":{i==="]"?(a=d,t.pop()):(a=d,n(i,d,"INSIDE_ARRAY_AFTER_VALUE"));break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(i){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{a=d,t.pop();break}default:{a=d;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{n(i,d,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),a=d;break}case"INSIDE_NUMBER":{switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{a=d;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(i,d),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&l(i,d);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&l(i,d);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(i,d);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const c=e.substring(r,d+1);!"false".startsWith(c)&&!"true".startsWith(c)&&!"null".startsWith(c)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?l(i,d):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(i,d)):a=d;break}}}let s=e.slice(0,a+1);for(let d=t.length-1;d>=0;d--)switch(t[d]){case"INSIDE_STRING":{s+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{s+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{s+="]";break}case"INSIDE_LITERAL":{const m=e.substring(r,e.length);"true".startsWith(m)?s+="true".slice(m.length):"false".startsWith(m)?s+="false".slice(m.length):"null".startsWith(m)&&(s+="null".slice(m.length))}}return s}async function ha(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=await ke({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await ke({text:io(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function Ee(e){return e.type.startsWith("tool-")}function lo(e){return e.type==="dynamic-tool"}function ht(e){return Ee(e)||lo(e)}function gt(e){return e.type.split("-").slice(1).join("-")}function co({lastMessage:e,messageId:t}){return{message:e?.role==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function uo({stream:e,messageMetadataSchema:t,dataPartSchemas:a,runUpdateMessageJob:r,onError:n,onToolCall:l,onData:u}){return e.pipeThrough(new TransformStream({async transform(s,d){await r(async({state:i,write:m})=>{var c,E,x,S;function y(p){const N=i.message.parts.filter(Ee).find(w=>w.toolCallId===p);if(N==null)throw new Error("tool-output-error must be preceded by a tool-input-available");return N}function h(p){const N=i.message.parts.filter(w=>w.type==="dynamic-tool").find(w=>w.toolCallId===p);if(N==null)throw new Error("tool-output-error must be preceded by a tool-input-available");return N}function T(p){var I;const N=i.message.parts.find(D=>Ee(D)&&D.toolCallId===p.toolCallId),w=p,j=N;N!=null?(N.state=p.state,j.input=w.input,j.output=w.output,j.errorText=w.errorText,j.rawInput=w.rawInput,j.preliminary=w.preliminary,j.providerExecuted=(I=w.providerExecuted)!=null?I:N.providerExecuted,w.providerMetadata!=null&&N.state==="input-available"&&(N.callProviderMetadata=w.providerMetadata)):i.message.parts.push({type:`tool-${p.toolName}`,toolCallId:p.toolCallId,state:p.state,input:w.input,output:w.output,rawInput:w.rawInput,errorText:w.errorText,providerExecuted:w.providerExecuted,preliminary:w.preliminary,...w.providerMetadata!=null?{callProviderMetadata:w.providerMetadata}:{}})}function g(p){var I,N;const w=i.message.parts.find(J=>J.type==="dynamic-tool"&&J.toolCallId===p.toolCallId),j=p,D=w;w!=null?(w.state=p.state,D.toolName=p.toolName,D.input=j.input,D.output=j.output,D.errorText=j.errorText,D.rawInput=(I=j.rawInput)!=null?I:D.rawInput,D.preliminary=j.preliminary,D.providerExecuted=(N=j.providerExecuted)!=null?N:w.providerExecuted,j.providerMetadata!=null&&w.state==="input-available"&&(w.callProviderMetadata=j.providerMetadata)):i.message.parts.push({type:"dynamic-tool",toolName:p.toolName,toolCallId:p.toolCallId,state:p.state,input:j.input,output:j.output,errorText:j.errorText,preliminary:j.preliminary,providerExecuted:j.providerExecuted,...j.providerMetadata!=null?{callProviderMetadata:j.providerMetadata}:{}})}async function v(p){if(p!=null){const I=i.message.metadata!=null?fa(i.message.metadata,p):p;t!=null&&await ut({value:I,schema:t}),i.message.metadata=I}}switch(s.type){case"text-start":{const p={type:"text",text:"",providerMetadata:s.providerMetadata,state:"streaming"};i.activeTextParts[s.id]=p,i.message.parts.push(p),m();break}case"text-delta":{const p=i.activeTextParts[s.id];p.text+=s.delta,p.providerMetadata=(c=s.providerMetadata)!=null?c:p.providerMetadata,m();break}case"text-end":{const p=i.activeTextParts[s.id];p.state="done",p.providerMetadata=(E=s.providerMetadata)!=null?E:p.providerMetadata,delete i.activeTextParts[s.id],m();break}case"reasoning-start":{const p={type:"reasoning",text:"",providerMetadata:s.providerMetadata,state:"streaming"};i.activeReasoningParts[s.id]=p,i.message.parts.push(p),m();break}case"reasoning-delta":{const p=i.activeReasoningParts[s.id];p.text+=s.delta,p.providerMetadata=(x=s.providerMetadata)!=null?x:p.providerMetadata,m();break}case"reasoning-end":{const p=i.activeReasoningParts[s.id];p.providerMetadata=(S=s.providerMetadata)!=null?S:p.providerMetadata,p.state="done",delete i.activeReasoningParts[s.id],m();break}case"file":{i.message.parts.push({type:"file",mediaType:s.mediaType,url:s.url}),m();break}case"source-url":{i.message.parts.push({type:"source-url",sourceId:s.sourceId,url:s.url,title:s.title,providerMetadata:s.providerMetadata}),m();break}case"source-document":{i.message.parts.push({type:"source-document",sourceId:s.sourceId,mediaType:s.mediaType,title:s.title,filename:s.filename,providerMetadata:s.providerMetadata}),m();break}case"tool-input-start":{const p=i.message.parts.filter(Ee);i.partialToolCalls[s.toolCallId]={text:"",toolName:s.toolName,index:p.length,dynamic:s.dynamic},s.dynamic?g({toolCallId:s.toolCallId,toolName:s.toolName,state:"input-streaming",input:void 0,providerExecuted:s.providerExecuted}):T({toolCallId:s.toolCallId,toolName:s.toolName,state:"input-streaming",input:void 0,providerExecuted:s.providerExecuted}),m();break}case"tool-input-delta":{const p=i.partialToolCalls[s.toolCallId];p.text+=s.inputTextDelta;const{value:I}=await ha(p.text);p.dynamic?g({toolCallId:s.toolCallId,toolName:p.toolName,state:"input-streaming",input:I}):T({toolCallId:s.toolCallId,toolName:p.toolName,state:"input-streaming",input:I}),m();break}case"tool-input-available":{s.dynamic?g({toolCallId:s.toolCallId,toolName:s.toolName,state:"input-available",input:s.input,providerExecuted:s.providerExecuted,providerMetadata:s.providerMetadata}):T({toolCallId:s.toolCallId,toolName:s.toolName,state:"input-available",input:s.input,providerExecuted:s.providerExecuted,providerMetadata:s.providerMetadata}),m(),l&&!s.providerExecuted&&await l({toolCall:s});break}case"tool-input-error":{s.dynamic?g({toolCallId:s.toolCallId,toolName:s.toolName,state:"output-error",input:s.input,errorText:s.errorText,providerExecuted:s.providerExecuted,providerMetadata:s.providerMetadata}):T({toolCallId:s.toolCallId,toolName:s.toolName,state:"output-error",input:void 0,rawInput:s.input,errorText:s.errorText,providerExecuted:s.providerExecuted,providerMetadata:s.providerMetadata}),m();break}case"tool-output-available":{if(s.dynamic){const p=h(s.toolCallId);g({toolCallId:s.toolCallId,toolName:p.toolName,state:"output-available",input:p.input,output:s.output,preliminary:s.preliminary})}else{const p=y(s.toolCallId);T({toolCallId:s.toolCallId,toolName:gt(p),state:"output-available",input:p.input,output:s.output,providerExecuted:s.providerExecuted,preliminary:s.preliminary})}m();break}case"tool-output-error":{if(s.dynamic){const p=h(s.toolCallId);g({toolCallId:s.toolCallId,toolName:p.toolName,state:"output-error",input:p.input,errorText:s.errorText,providerExecuted:s.providerExecuted})}else{const p=y(s.toolCallId);T({toolCallId:s.toolCallId,toolName:gt(p),state:"output-error",input:p.input,rawInput:p.rawInput,errorText:s.errorText,providerExecuted:s.providerExecuted})}m();break}case"start-step":{i.message.parts.push({type:"step-start"});break}case"finish-step":{i.activeTextParts={},i.activeReasoningParts={};break}case"start":{s.messageId!=null&&(i.message.id=s.messageId),await v(s.messageMetadata),(s.messageId!=null||s.messageMetadata!=null)&&m();break}case"finish":{s.finishReason!=null&&(i.finishReason=s.finishReason),await v(s.messageMetadata),s.messageMetadata!=null&&m();break}case"message-metadata":{await v(s.messageMetadata),s.messageMetadata!=null&&m();break}case"error":{n?.(new Error(s.errorText));break}default:if(oo(s)){a?.[s.type]!=null&&await ut({value:s.data,schema:a[s.type]});const p=s;if(p.transient){u?.(p);break}const I=p.id!=null?i.message.parts.find(N=>p.type===N.type&&p.id===N.id):void 0;I!=null?I.data=p.data:i.message.parts.push(p),u?.(p),m()}}d.enqueue(s)})}}))}async function po({stream:e,onError:t}){const a=e.getReader();try{for(;;){const{done:r}=await a.read();if(r)break}}catch(r){t?.(r)}finally{a.releaseLock()}}Te({prefix:"aitxt",size:24});Te({prefix:"aiobj",size:24});var mo=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,a)=>{this.queue.push(async()=>{try{await e(),t()}catch(r){a(r)}}),this.processQueue()})}};Te({prefix:"aiobj",size:24});var fo={};Hn(fo,{object:()=>go,text:()=>ho});var ho=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:e}){return{partial:e}},async parseOutput({text:e}){return e}}),go=({schema:e})=>{const t=Wn(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:a}){const r=await ha(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{const n=r.state;throw new Error(`Unsupported parse state: ${n}`)}}},async parseOutput({text:a},r){const n=await ke({text:a});if(!n.success)throw new mt({message:"No object generated: could not parse the response.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});const l=await Ke({value:n.value,schema:t});if(!l.success)throw new mt({message:"No object generated: response did not match schema.",cause:l.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return l.value}}};async function vo(e){if(e==null)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw new Error("FileList is not supported in the current environment");return Promise.all(Array.from(e).map(async t=>{const{name:a,type:r}=t,n=await new Promise((l,u)=>{const s=new FileReader;s.onload=d=>{var i;l((i=d.target)==null?void 0:i.result)},s.onerror=d=>u(d),s.readAsDataURL(t)});return{type:"file",mediaType:r,filename:a,url:n}}))}var yo=class{constructor({api:e="/api/chat",credentials:t,headers:a,body:r,fetch:n,prepareSendMessagesRequest:l,prepareReconnectToStreamRequest:u}){this.api=e,this.credentials=t,this.headers=a,this.body=r,this.fetch=n,this.prepareSendMessagesRequest=l,this.prepareReconnectToStreamRequest=u}async sendMessages({abortSignal:e,...t}){var a,r,n,l,u;const s=await le(this.body),d=await le(this.headers),i=await le(this.credentials),m={...ne(d),...ne(t.headers)},c=await((a=this.prepareSendMessagesRequest)==null?void 0:a.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...s,...t.body},headers:m,credentials:i,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),E=(r=c?.api)!=null?r:this.api,x=c?.headers!==void 0?ne(c.headers):m,S=c?.body!==void 0?c.body:{...s,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},y=(n=c?.credentials)!=null?n:i,T=await((l=this.fetch)!=null?l:globalThis.fetch)(E,{method:"POST",headers:lt({"Content-Type":"application/json",...x},`ai-sdk/${ft}`,it()),body:JSON.stringify(S),credentials:y,signal:e});if(!T.ok)throw new Error((u=await T.text())!=null?u:"Failed to fetch the chat response.");if(!T.body)throw new Error("The response body is empty.");return this.processResponseStream(T.body)}async reconnectToStream(e){var t,a,r,n,l;const u=await le(this.body),s=await le(this.headers),d=await le(this.credentials),i={...ne(s),...ne(e.headers)},m=await((t=this.prepareReconnectToStreamRequest)==null?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...u,...e.body},headers:i,credentials:d,requestMetadata:e.metadata})),c=(a=m?.api)!=null?a:`${this.api}/${e.chatId}/stream`,E=m?.headers!==void 0?ne(m.headers):i,x=(r=m?.credentials)!=null?r:d,y=await((n=this.fetch)!=null?n:globalThis.fetch)(c,{method:"GET",headers:lt(E,`ai-sdk/${ft}`,it()),credentials:x});if(y.status===204)return null;if(!y.ok)throw new Error((l=await y.text())!=null?l:"Failed to fetch the chat response.");if(!y.body)throw new Error("The response body is empty.");return this.processResponseStream(y.body)}},ga=class extends yo{constructor(e={}){super(e)}processResponseStream(e){return en({stream:e,schema:no}).pipeThrough(new TransformStream({async transform(t,a){if(!t.success)throw t.error;a.enqueue(t.value)}}))}},xo=class{constructor({generateId:e=qs,id:t=e(),transport:a=new ga,messageMetadataSchema:r,dataPartSchemas:n,state:l,onError:u,onToolCall:s,onFinish:d,onData:i,sendAutomaticallyWhen:m}){this.activeResponse=void 0,this.jobExecutor=new mo,this.sendMessage=async(c,E)=>{var x,S,y,h;if(c==null){await this.makeRequest({trigger:"submit-message",messageId:(x=this.lastMessage)==null?void 0:x.id,...E});return}let T;if("text"in c||"files"in c?T={parts:[...Array.isArray(c.files)?c.files:await vo(c.files),..."text"in c&&c.text!=null?[{type:"text",text:c.text}]:[]]}:T=c,c.messageId!=null){const g=this.state.messages.findIndex(v=>v.id===c.messageId);if(g===-1)throw new Error(`message with id ${c.messageId} not found`);if(this.state.messages[g].role!=="user")throw new Error(`message with id ${c.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,g+1),this.state.replaceMessage(g,{...T,id:c.messageId,role:(S=T.role)!=null?S:"user",metadata:c.metadata})}else this.state.pushMessage({...T,id:(y=T.id)!=null?y:this.generateId(),role:(h=T.role)!=null?h:"user",metadata:c.metadata});await this.makeRequest({trigger:"submit-message",messageId:c.messageId,...E})},this.regenerate=async({messageId:c,...E}={})=>{const x=c==null?this.state.messages.length-1:this.state.messages.findIndex(S=>S.id===c);if(x===-1)throw new Error(`message ${c} not found`);this.state.messages=this.state.messages.slice(0,this.messages[x].role==="assistant"?x:x+1),await this.makeRequest({trigger:"regenerate-message",messageId:c,...E})},this.resumeStream=async(c={})=>{await this.makeRequest({trigger:"resume-stream",...c})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolOutput=async({state:c="output-available",tool:E,toolCallId:x,output:S,errorText:y})=>this.jobExecutor.run(async()=>{var h,T;const g=this.state.messages,v=g[g.length-1];this.state.replaceMessage(g.length-1,{...v,parts:v.parts.map(p=>ht(p)&&p.toolCallId===x?{...p,state:c,output:S,errorText:y}:p)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(p=>ht(p)&&p.toolCallId===x?{...p,state:c,output:S,errorText:y}:p)),this.status!=="streaming"&&this.status!=="submitted"&&((h=this.sendAutomaticallyWhen)!=null&&h.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(T=this.lastMessage)==null?void 0:T.id})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{var c;this.status!=="streaming"&&this.status!=="submitted"||(c=this.activeResponse)!=null&&c.abortController&&this.activeResponse.abortController.abort()},this.id=t,this.transport=a,this.generateId=e,this.messageMetadataSchema=r,this.dataPartSchemas=n,this.state=l,this.onError=u,this.onToolCall=s,this.onFinish=d,this.onData=i,this.sendAutomaticallyWhen=m}get status(){return this.state.status}setStatus({status:e,error:t}){this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async makeRequest({trigger:e,metadata:t,headers:a,body:r,messageId:n}){var l,u,s,d;this.setStatus({status:"submitted",error:void 0});const i=this.lastMessage;let m=!1,c=!1,E=!1;try{const x={state:co({lastMessage:this.state.snapshot(i),messageId:this.generateId()}),abortController:new AbortController};x.abortController.signal.addEventListener("abort",()=>{m=!0}),this.activeResponse=x;let S;if(e==="resume-stream"){const h=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:a,body:r});if(h==null){this.setStatus({status:"ready"});return}S=h}else S=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:x.abortController.signal,metadata:t,headers:a,body:r,trigger:e,messageId:n});const y=h=>this.jobExecutor.run(()=>h({state:x.state,write:()=>{var T;this.setStatus({status:"streaming"}),x.state.message.id===((T=this.lastMessage)==null?void 0:T.id)?this.state.replaceMessage(this.state.messages.length-1,x.state.message):this.state.pushMessage(x.state.message)}}));await po({stream:uo({stream:S,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:y,onError:h=>{throw h}}),onError:h=>{throw h}}),this.setStatus({status:"ready"})}catch(x){if(m||x.name==="AbortError")return m=!0,this.setStatus({status:"ready"}),null;E=!0,x instanceof TypeError&&(x.message.toLowerCase().includes("fetch")||x.message.toLowerCase().includes("network"))&&(c=!0),this.onError&&x instanceof Error&&this.onError(x),this.setStatus({status:"error",error:x})}finally{try{(u=this.onFinish)==null||u.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:m,isDisconnect:c,isError:E,finishReason:(l=this.activeResponse)==null?void 0:l.state.finishReason})}catch(x){console.error(x)}this.activeResponse=void 0}(s=this.sendAutomaticallyWhen)!=null&&s.call(this,{messages:this.state.messages})&&!E&&await this.makeRequest({trigger:"submit-message",messageId:(d=this.lastMessage)==null?void 0:d.id,metadata:t,headers:a,body:r})}},Be,vt;function bo(){if(vt)return Be;vt=1;function e(t,a){if(typeof t!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof t}\`.`);let r,n=0;return function(...u){clearTimeout(r);const s=Date.now(),d=s-n,i=a-d;i<=0?(n=s,t.apply(this,u)):r=setTimeout(()=>{n=Date.now(),t.apply(this,u)},i)}}return Be=e,Be}var To=bo();const So=Oa(To);var va=(e,t,a)=>{if(!t.has(e))throw TypeError("Cannot "+a)},M=(e,t,a)=>(va(e,t,"read from private field"),a?a.call(e):t.get(e)),X=(e,t,a)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,a)},te=(e,t,a,r)=>(va(e,t,"write to private field"),t.set(e,a),a);function Eo(e,t){return t!=null?So(e,t):e}var W,we,Ie,he,ge,ve,ue,Je,We,wo=class{constructor(e=[]){X(this,W,void 0),X(this,we,"ready"),X(this,Ie,void 0),X(this,he,new Set),X(this,ge,new Set),X(this,ve,new Set),this.pushMessage=t=>{te(this,W,M(this,W).concat(t)),M(this,ue).call(this)},this.popMessage=()=>{te(this,W,M(this,W).slice(0,-1)),M(this,ue).call(this)},this.replaceMessage=(t,a)=>{te(this,W,[...M(this,W).slice(0,t),this.snapshot(a),...M(this,W).slice(t+1)]),M(this,ue).call(this)},this.snapshot=t=>structuredClone(t),this["~registerMessagesCallback"]=(t,a)=>{const r=a?Eo(t,a):t;return M(this,he).add(r),()=>{M(this,he).delete(r)}},this["~registerStatusCallback"]=t=>(M(this,ge).add(t),()=>{M(this,ge).delete(t)}),this["~registerErrorCallback"]=t=>(M(this,ve).add(t),()=>{M(this,ve).delete(t)}),X(this,ue,()=>{M(this,he).forEach(t=>t())}),X(this,Je,()=>{M(this,ge).forEach(t=>t())}),X(this,We,()=>{M(this,ve).forEach(t=>t())}),te(this,W,e)}get status(){return M(this,we)}set status(e){te(this,we,e),M(this,Je).call(this)}get error(){return M(this,Ie)}set error(e){te(this,Ie,e),M(this,We).call(this)}get messages(){return M(this,W)}set messages(e){te(this,W,[...e]),M(this,ue).call(this)}};W=new WeakMap;we=new WeakMap;Ie=new WeakMap;he=new WeakMap;ge=new WeakMap;ve=new WeakMap;ue=new WeakMap;Je=new WeakMap;We=new WeakMap;var de,yt=class extends xo{constructor({messages:t,...a}){const r=new wo(t);super({...a,state:r}),X(this,de,void 0),this["~registerMessagesCallback"]=(n,l)=>M(this,de)["~registerMessagesCallback"](n,l),this["~registerStatusCallback"]=n=>M(this,de)["~registerStatusCallback"](n),this["~registerErrorCallback"]=n=>M(this,de)["~registerErrorCallback"](n),te(this,de,r)}};de=new WeakMap;function Io({experimental_throttle:e,resume:t=!1,...a}={}){const r=f.useRef("chat"in a?a.chat:new yt(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new yt(a));const l=f.useCallback(m=>r.current["~registerMessagesCallback"](m,e),[e,r.current.id]),u=f.useSyncExternalStore(l,()=>r.current.messages,()=>r.current.messages),s=f.useSyncExternalStore(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),d=f.useSyncExternalStore(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),i=f.useCallback(m=>{typeof m=="function"&&(m=m(r.current.messages)),r.current.messages=m},[r]);return f.useEffect(()=>{t&&r.current.resumeStream()},[t,r]),{id:r.current.id,messages:u,setMessages:i,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:d,resumeStream:r.current.resumeStream,status:s,addToolResult:r.current.addToolOutput,addToolOutput:r.current.addToolOutput}}var xt=Object.prototype.hasOwnProperty;function bt(e,t,a){for(a of e.keys())if(ye(a,t))return a}function ye(e,t){var a,r,n;if(e===t)return!0;if(e&&t&&(a=e.constructor)===t.constructor){if(a===Date)return e.getTime()===t.getTime();if(a===RegExp)return e.toString()===t.toString();if(a===Array){if((r=e.length)===t.length)for(;r--&&ye(e[r],t[r]););return r===-1}if(a===Set){if(e.size!==t.size)return!1;for(r of e)if(n=r,n&&typeof n=="object"&&(n=bt(t,n),!n)||!t.has(n))return!1;return!0}if(a===Map){if(e.size!==t.size)return!1;for(r of e)if(n=r[0],n&&typeof n=="object"&&(n=bt(t,n),!n)||!ye(r[1],t.get(n)))return!1;return!0}if(a===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(a===DataView){if((r=e.byteLength)===t.byteLength)for(;r--&&e.getInt8(r)===t.getInt8(r););return r===-1}if(ArrayBuffer.isView(e)){if((r=e.byteLength)===t.byteLength)for(;r--&&e[r]===t[r];);return r===-1}if(!a||typeof e=="object"){r=0;for(a in e)if(xt.call(e,a)&&++r&&!xt.call(t,a)||!(a in t)||!ye(e[a],t[a]))return!1;return Object.keys(t).length===r}}return e!==e&&t!==t}function _o(e){var t=f.useRef(e),a=f.useRef(0);return ye(e,t.current)||(t.current=e,a.current+=1),f.useMemo(function(){return t.current},[a.current])}function Tt(e,t){return f.useEffect(e,_o(t))}const No=La.defineItem("local:search-actions"),Co=({messages:e,status:t,conversationId:a})=>{const r=f.useRef(null),u=(e?.[e.length-1]?.parts?.findLast(s=>s?.type?.startsWith("tool-"))??null)?.input?.tabId;f.useEffect(()=>{const s=t==="streaming",d=r.current;if((!s&&d||s&&u&&d&&u!==d)&&d){const c={conversationId:a,isActive:!1};chrome.tabs.sendMessage(d,c).catch(()=>{})}if(s&&u){const c={conversationId:a,isActive:!0};chrome.tabs.sendMessage(u,c).catch(()=>{})}u&&(r.current=u)},[a,t,u])},jo=e=>{const t=e[e.length-1];return t?t.parts.filter(a=>a.type==="text").map(a=>a.text).join(""):""},St=(e,t)=>{const a=e.findIndex(s=>s.id===t),r=e?.[a]??[],n=e?.[a-1]??[],l=r.parts.filter(s=>s.type==="text").map(s=>s.text).join(`

`),u=n.parts.filter(s=>s.type==="text").map(s=>s.text).join(`
`);return{responseText:l,queryText:u}},Et=e=>e.filter(t=>t.type==="managed").map(t=>t.managedServerName),wt=e=>e.filter(t=>t.type==="custom").map(t=>({name:t.displayName,url:t.config?.url})),Ao=()=>{const{servers:e}=_r(),t=f.useRef(Et(e)),a=f.useRef(wt(e));Tt(()=>{t.current=Et(e),a.current=wt(e)},[e]);const{providers:r,selectedProvider:n,isLoading:l,setDefaultProvider:u}=Nr(),{personalization:s}=sr(),d=f.useRef(s);f.useEffect(()=>{d.current=s},[s]);const{baseUrl:i,isLoading:m,error:c}=Cr(),E=f.useRef(i);f.useEffect(()=>{E.current=i},[i]);const x=r.map(A=>({id:A.id,name:A.name,type:A.type})),[S,y]=f.useState("chat"),[h,T]=f.useState(new Map),[g,v]=f.useState({}),[p,I]=f.useState({}),N=f.useRef(crypto.randomUUID()),w=A=>{const{responseText:q,queryText:z}=St(re,A);ce(yr,{responseText:q,queryText:z,messageId:A}),v(Y=>({...Y,[A]:!Y[A]}))},j=(A,q)=>{const{responseText:z,queryText:Y}=St(re,A);ce(vr,{responseText:z,queryText:Y,messageId:A,comment:q}),I($=>({...$,[A]:!$[A]}))},D=f.useRef(n),J=f.useRef(S),Q=f.useRef(h);Tt(()=>{D.current=n,J.current=S,Q.current=h},[n,S,h]);const oe=n?{id:n.id,name:n.name,type:n.id==="browseros"?"browseros":n.type}:x[0],{messages:re,sendMessage:Re,setMessages:F,status:B,stop:se,error:me}=Io({transport:new ga({prepareSendMessagesRequest:async({messages:A})=>{const z=(await chrome.tabs.query({active:!0,currentWindow:!0}))?.[0]??void 0,Y=jo(A),$=D.current,ya=J.current,Qe=t.current,et=a.current,tt=(fe=>Q.current.get(fe))(Y),ie={};return z&&(ie.windowId=z.windowId,ie.activeTab={id:z.id,url:z.url,title:z.title}),tt?.tabs?.length&&(ie.selectedTabs=tt?.tabs?.map(fe=>({id:fe.id,url:fe.url,title:fe.title}))),Qe.length&&(ie.enabledMcpServers=nr(Qe)),et.length&&(ie.customMcpServers=et),{api:`${E.current}/chat`,body:{message:Y,provider:$?.type,providerType:$?.type,providerName:$?.name,apiKey:$?.apiKey,baseUrl:$?.baseUrl,conversationId:N.current,model:$?.modelId??"default",mode:ya,contextWindowSize:$?.contextWindow,temperature:$?.temperature,resourceName:$?.resourceName,accessKeyId:$?.accessKeyId,secretAccessKey:$?.secretAccessKey,region:$?.region,sessionToken:$?.sessionToken,browserContext:ie,userSystemPrompt:d.current}}}})});Co({messages:re,status:B,conversationId:N.current});const Xe=A=>{if(ce(gr,{mode:S,provider_type:n?.type,model:n?.modelId}),A.action){const q=A.action;T(z=>{const Y=new Map(z);return Y.set(A.text,q),Y})}Re({text:A.text})};return f.useEffect(()=>{const A=No.watch(q=>{q&&(y(q.mode),Xe({text:q.query,action:q.action}))});return()=>A()},[]),{mode:S,setMode:y,messages:re,sendMessage:Xe,status:B,stop:se,providers:x,selectedProvider:oe,isLoading:l||m,agentUrlError:c,chatError:me,handleSelectProvider:A=>{ce(br,{provider_id:A.id,provider_type:A.type}),u(A.id)},getActionForMessage:A=>{if(A.role!=="user")return;const q=A.parts.filter(z=>z.type==="text").map(z=>z.text).join("");return h.get(q)},resetConversation:()=>{ce(xr,{message_count:re.length}),se();const A=N.current;N.current=crypto.randomUUID(),F([]),T(new Map),v({}),I({}),i&&A&&fetch(`${i}/chat/${A}`,{method:"DELETE"}).catch(()=>{})},liked:g,onClickLike:w,disliked:p,onClickDislike:j}},ko=()=>{const{mode:e,setMode:t,messages:a,sendMessage:r,status:n,stop:l,providers:u,selectedProvider:s,isLoading:d,agentUrlError:i,chatError:m,handleSelectProvider:c,getActionForMessage:E,resetConversation:x,liked:S,onClickLike:y,disliked:h,onClickDislike:T}=Ao(),[g,v]=f.useState(""),[p,I]=f.useState([]),N=f.useRef(null),[w,j]=f.useState(!1);f.useEffect(()=>{j(!0)},[]),f.useEffect(()=>{(async()=>{const F=(await chrome.tabs.query({active:!0,currentWindow:!0})).filter(B=>B.url?.startsWith("http"));I(F)})()},[]);const D=()=>{N.current?.scrollIntoView({behavior:"smooth"})};f.useEffect(()=>{D()},[a]);const J=F=>{I(B=>B.some(me=>me.id===F.id)?B.filter(me=>me.id!==F.id):[...B,F])},Q=F=>{I(B=>B.filter(se=>se.id!==F))},oe=F=>{const B=F||g.trim();if(B){if(p.length){const se=or({mode:e,message:B,tabs:p});r({text:B,action:se})}else r({text:B});v(""),I([])}},re=F=>{F.preventDefault(),a.length===0&&ce(Tr,{mode:e,tabs_count:p.length}),oe()},Re=F=>{oe(F)};return d||!s?o.jsx("div",{className:"flex h-screen w-screen items-center justify-center bg-background",children:o.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-2 border-muted-foreground border-t-transparent"})}):o.jsxs("div",{className:"mx-auto flex h-screen w-screen flex-col bg-background text-foreground",children:[o.jsx(rs,{selectedProvider:s,onSelectProvider:c,providers:u,onNewConversation:x,hasMessages:a.length>0}),o.jsxs("main",{className:"mt-4 flex h-full flex-1 flex-col space-y-4 overflow-y-auto",children:[a.length===0?o.jsx(Kr,{mode:e,mounted:w,onSuggestionClick:Re}):o.jsx(Rs,{messages:a,status:n,messagesEndRef:N,getActionForMessage:E,liked:S,onClickLike:y,disliked:h,onClickDislike:T}),i&&o.jsx(rt,{error:i}),m&&o.jsx(rt,{error:m})]}),o.jsx(ts,{mode:e,onModeChange:t,input:g,onInputChange:v,onSubmit:re,status:n,onStop:l,attachedTabs:p,onToggleTab:J,onRemoveTab:Q})]})},Mo=()=>o.jsx(Fa,{children:o.jsx($a,{children:o.jsx(Ba,{index:!0,element:o.jsx(ko,{})})})}),It=document.getElementById("root");It&&za.createRoot(It,Ua).render(o.jsx(Za.StrictMode,{children:o.jsx(qa,{children:o.jsxs(Va,{children:[o.jsx(Mo,{}),o.jsx(Ja,{})]})})}));
